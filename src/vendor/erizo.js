var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.inherits=function(l,r){function h(){}h.prototype=r.prototype;l.superClass_=r.prototype;l.prototype=new h;l.prototype.constructor=l;for(var d in r)if(Object.defineProperties){var f=Object.getOwnPropertyDescriptor(r,d);f&&Object.defineProperty(l,d,f)}else l[d]=r[d]};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(l,r,h){l!=Array.prototype&&l!=Object.prototype&&(l[r]=h.value)};$jscomp.getGlobal=function(l){return"undefined"!=typeof window&&window===l?l:"undefined"!=typeof global&&null!=global?global:l};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.symbolCounter_=0;$jscomp.Symbol=function(l){return $jscomp.SYMBOL_PREFIX+(l||"")+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var l=$jscomp.global.Symbol.iterator;l||(l=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[l]&&$jscomp.defineProperty(Array.prototype,l,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.arrayIterator=function(l){var r=0;return $jscomp.iteratorPrototype(function(){return r<l.length?{done:!1,value:l[r++]}:{done:!0}})};$jscomp.iteratorPrototype=function(l){$jscomp.initSymbolIterator();l={next:l};l[$jscomp.global.Symbol.iterator]=function(){return this};return l};$jscomp.makeIterator=function(l){$jscomp.initSymbolIterator();var r=l[Symbol.iterator];return r?r.call(l):$jscomp.arrayIterator(l)};
$jscomp.arrayFromIterator=function(l){for(var r,h=[];!(r=l.next()).done;)h.push(r.value);return h};$jscomp.arrayFromIterable=function(l){return l instanceof Array?l:$jscomp.arrayFromIterator($jscomp.makeIterator(l))};$jscomp.polyfill=function(l,r,h,d){if(r){h=$jscomp.global;l=l.split(".");for(d=0;d<l.length-1;d++){var f=l[d];f in h||(h[f]={});h=h[f]}l=l[l.length-1];d=h[l];r=r(d);r!=d&&null!=r&&$jscomp.defineProperty(h,l,{configurable:!0,writable:!0,value:r})}};
$jscomp.polyfill("Array.from",function(l){return l?l:function(l,h,d){$jscomp.initSymbolIterator();h=null!=h?h:function(a){return a};var f=[],c=l[Symbol.iterator];if("function"==typeof c)for(l=c.call(l);!(c=l.next()).done;)f.push(h.call(d,c.value));else for(var c=l.length,a=0;a<c;a++)f.push(h.call(d,l[a]));return f}},"es6-impl","es3");$jscomp.owns=function(l,r){return Object.prototype.hasOwnProperty.call(l,r)};
$jscomp.polyfill("WeakMap",function(l){function r(a){$jscomp.owns(a,d)||$jscomp.defineProperty(a,d,{value:{}})}function h(a){var u=Object[a];u&&(Object[a]=function(a){r(a);return u(a)})}if(function(){if(!l||!Object.seal)return!1;try{var a=Object.seal({}),u=Object.seal({}),g=new l([[a,2],[u,3]]);if(2!=g.get(a)||3!=g.get(u))return!1;g.delete(a);g.set(u,4);return!g.has(a)&&4==g.get(u)}catch(b){return!1}}())return l;var d="$jscomp_hidden_"+Math.random().toString().substring(2);h("freeze");h("preventExtensions");
h("seal");var f=0,c=function(a){this.id_=(f+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var u;!(u=a.next()).done;)u=u.value,this.set(u[0],u[1])}};c.prototype.set=function(a,u){r(a);if(!$jscomp.owns(a,d))throw Error("WeakMap key fail: "+a);a[d][this.id_]=u;return this};c.prototype.get=function(a){return $jscomp.owns(a,d)?a[d][this.id_]:void 0};c.prototype.has=function(a){return $jscomp.owns(a,d)&&$jscomp.owns(a[d],this.id_)};c.prototype.delete=
function(a){return $jscomp.owns(a,d)&&$jscomp.owns(a[d],this.id_)?delete a[d][this.id_]:!1};return c},"es6-impl","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(l){if(!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!l||!l.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),g=new l($jscomp.makeIterator([[a,"s"]]));if("s"!=g.get(a)||1!=g.size||g.get({x:4})||g.set({x:4},"t")!=g||2!=g.size)return!1;var b=g.entries(),e=b.next();if(e.done||e.value[0]!=a||"s"!=e.value[1])return!1;e=b.next();return e.done||4!=e.value[0].x||"t"!=e.value[1]||!b.next().done?!1:!0}catch(n){return!1}}())return l;$jscomp.initSymbol();
$jscomp.initSymbolIterator();var r=new WeakMap,h=function(a){this.data_={};this.head_=c();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var g;!(g=a.next()).done;)g=g.value,this.set(g[0],g[1])}};h.prototype.set=function(a,g){var b=d(this,a);b.list||(b.list=this.data_[b.id]=[]);b.entry?b.entry.value=g:(b.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:g},b.list.push(b.entry),this.head_.previous.next=b.entry,this.head_.previous=b.entry,this.size++);return this};h.prototype.delete=
function(a){a=d(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};h.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=c();this.size=0};h.prototype.has=function(a){return!!d(this,a).entry};h.prototype.get=function(a){return(a=d(this,a).entry)&&a.value};h.prototype.entries=function(){return f(this,function(a){return[a.key,
a.value]})};h.prototype.keys=function(){return f(this,function(a){return a.key})};h.prototype.values=function(){return f(this,function(a){return a.value})};h.prototype.forEach=function(a,g){for(var b=this.entries(),e;!(e=b.next()).done;)e=e.value,a.call(g,e[1],e[0],this)};h.prototype[Symbol.iterator]=h.prototype.entries;var d=function(c,g){var b=g&&typeof g;"object"==b||"function"==b?r.has(g)?b=r.get(g):(b=""+ ++a,r.set(g,b)):b="p_"+g;var e=c.data_[b];if(e&&$jscomp.owns(c.data_,b))for(c=0;c<e.length;c++){var u=
e[c];if(g!==g&&u.key!==u.key||g===u.key)return{id:b,list:e,index:c,entry:u}}return{id:b,list:e,index:-1,entry:void 0}},f=function(a,g){var b=a.head_;return $jscomp.iteratorPrototype(function(){if(b){for(;b.head!=a.head_;)b=b.previous;for(;b.next!=b.head;)return b=b.next,{done:!1,value:g(b)};b=null}return{done:!0,value:void 0}})},c=function(){var a={};return a.previous=a.next=a.head=a},a=0;return h},"es6-impl","es3");
$jscomp.iteratorFromArray=function(l,r){$jscomp.initSymbolIterator();l instanceof String&&(l+="");var h=0,d={next:function(){if(h<l.length){var f=h++;return{value:r(f,l[f]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(l){return l?l:function(){return $jscomp.iteratorFromArray(this,function(l){return l})}},"es6-impl","es3");$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(l){function r(){this.batch_=null}function h(a){return a instanceof f?a:new f(function(c,g){c(a)})}if(l&&!$jscomp.FORCE_POLYFILL_PROMISE)return l;r.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};r.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var d=$jscomp.global.setTimeout;r.prototype.asyncExecuteFunction=function(a){d(a,
0)};r.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var c=0;c<a.length;++c){var g=a[c];delete a[c];try{g()}catch(b){this.asyncThrow_(b)}}}this.batch_=null};r.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var f=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var c=this.createResolveAndReject_();try{a(c.resolve,c.reject)}catch(g){c.reject(g)}};f.prototype.createResolveAndReject_=
function(){function a(b){return function(a){g||(g=!0,b.call(c,a))}}var c=this,g=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};f.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof f)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var c=null!=a;break a;case "function":c=!0;break a;default:c=!1}c?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};f.prototype.resolveToNonPromiseObj_=function(a){var c=
void 0;try{c=a.then}catch(g){this.reject_(g);return}"function"==typeof c?this.settleSameAsThenable_(c,a):this.fulfill_(a)};f.prototype.reject_=function(a){this.settle_(2,a)};f.prototype.fulfill_=function(a){this.settle_(1,a)};f.prototype.settle_=function(a,c){if(0!=this.state_)throw Error("Cannot settle("+a+", "+c|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=c;this.executeOnSettledCallbacks_()};f.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
this.onSettledCallbacks_,c=0;c<a.length;++c)a[c].call(),a[c]=null;this.onSettledCallbacks_=null}};var c=new r;f.prototype.settleSameAsPromise_=function(a){var c=this.createResolveAndReject_();a.callWhenSettled_(c.resolve,c.reject)};f.prototype.settleSameAsThenable_=function(a,c){var g=this.createResolveAndReject_();try{a.call(c,g.resolve,g.reject)}catch(b){g.reject(b)}};f.prototype.then=function(a,c){function g(a,c){return"function"==typeof a?function(c){try{b(a(c))}catch(w){e(w)}}:c}var b,e,d=new f(function(a,
c){b=a;e=c});this.callWhenSettled_(g(a,b),g(c,e));return d};f.prototype.catch=function(a){return this.then(void 0,a)};f.prototype.callWhenSettled_=function(a,d){function g(){switch(b.state_){case 1:a(b.result_);break;case 2:d(b.result_);break;default:throw Error("Unexpected state: "+b.state_);}}var b=this;null==this.onSettledCallbacks_?c.asyncExecute(g):this.onSettledCallbacks_.push(function(){c.asyncExecute(g)})};f.resolve=h;f.reject=function(a){return new f(function(c,g){g(a)})};f.race=function(a){return new f(function(c,
g){for(var b=$jscomp.makeIterator(a),e=b.next();!e.done;e=b.next())h(e.value).callWhenSettled_(c,g)})};f.all=function(a){var c=$jscomp.makeIterator(a),g=c.next();return g.done?h([]):new f(function(b,a){function e(a){return function(e){k[a]=e;d--;0==d&&b(k)}}var k=[],d=0;do k.push(void 0),d++,h(g.value).callWhenSettled_(e(k.length-1),a),g=c.next();while(!g.done)})};return f},"es6-impl","es3");
$jscomp.findInternal=function(l,r,h){l instanceof String&&(l=String(l));for(var d=l.length,f=0;f<d;f++){var c=l[f];if(r.call(h,c,f,l))return{i:f,v:c}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(l){return l?l:function(l,h){return $jscomp.findInternal(this,l,h).v}},"es6-impl","es3");
$jscomp.polyfill("Object.assign",function(l){return l?l:function(l,h){for(var d=1;d<arguments.length;d++){var f=arguments[d];if(f)for(var c in f)$jscomp.owns(f,c)&&(l[c]=f[c])}return l}},"es6-impl","es3");$jscomp.polyfill("Array.prototype.values",function(l){return l?l:function(){return $jscomp.iteratorFromArray(this,function(l,h){return h})}},"es6","es3");
var Erizo=function(l){function r(d){if(h[d])return h[d].exports;var f=h[d]={i:d,l:!1,exports:{}};return l[d].call(f.exports,f,f.exports,r),f.l=!0,f.exports}var h={};return r.m=l,r.c=h,r.d=function(d,f,c){r.o(d,f)||Object.defineProperty(d,f,{configurable:!1,enumerable:!0,get:c})},r.r=function(d){Object.defineProperty(d,"__esModule",{value:!0})},r.n=function(d){var f=d&&d.__esModule?function(){return d.default}:function(){return d};return r.d(f,"a",f),f},r.o=function(d,f){return Object.prototype.hasOwnProperty.call(d,
f)},r.p="",r(r.s=20)}([function(l,r,h){var d=function(){var f="";var c=function(a){console.log.apply(console,[].concat($jscomp.arrayFromIterable(a)))};return{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5,setLogLevel:function(a){var c=a;a>d.NONE?c=d.NONE:a<d.DEBUG&&(c=d.DEBUG);d.logLevel=c},setOutputFunction:function(a){c=a},setLogPrefix:function(a){f=a},log:function(a,u){for(var g=[],b=1;b<arguments.length;++b)g[b-1]=arguments[b];b=f;if(!(a<d.logLevel))if(a===d.DEBUG?b+="DEBUG":a===d.TRACE?b+="TRACE":
a===d.INFO?b+="INFO":a===d.WARNING?b+="WARNING":a===d.ERROR&&(b+="ERROR"),g=[b+": "].concat(g),void 0!==d.panel){for(var b="",e=0;e<g.length;e+=1)b+=g[e];d.panel.value=d.panel.value+"\n"+b}else c.apply(d,[g])},debug:function(a){for(var c=[],g=0;g<arguments.length;++g)c[g-0]=arguments[g];d.log.apply(d,[].concat([d.DEBUG],$jscomp.arrayFromIterable(c)))},trace:function(a){for(var c=[],g=0;g<arguments.length;++g)c[g-0]=arguments[g];d.log.apply(d,[].concat([d.TRACE],$jscomp.arrayFromIterable(c)))},info:function(a){for(var c=
[],g=0;g<arguments.length;++g)c[g-0]=arguments[g];d.log.apply(d,[].concat([d.INFO],$jscomp.arrayFromIterable(c)))},warning:function(a){for(var c=[],g=0;g<arguments.length;++g)c[g-0]=arguments[g];d.log.apply(d,[].concat([d.WARNING],$jscomp.arrayFromIterable(c)))},error:function(a){for(var c=[],g=0;g<arguments.length;++g)c[g-0]=arguments[g];d.log.apply(d,[].concat([d.ERROR],$jscomp.arrayFromIterable(c)))}}}();r.a=d},function(l,r,h){r=h(33);var d=h(17),f=h(16),c=h(15),a=h(14),u=h(13),g=h(6),b=h(11),
e=h(10),n=h(9),k=h(8);h=h(4);l.exports={SDPInfo:r,CandidateInfo:d,CodecInfo:f,DTLSInfo:c,ICEInfo:a,MediaInfo:u,Setup:g,SourceGroupInfo:b,SourceInfo:e,StreamInfo:n,TrackInfo:k,Direction:h}},function(l,r,h){(function(d){var f=h(0),c=function(){var a="none";return void 0!==d&&d.exports?a="fake":null!==window.navigator.userAgent.match("Firefox")?a="mozilla":null!==window.navigator.userAgent.match("Chrome")?(a="chrome-stable",null!==window.navigator.userAgent.match("Electron")&&(a="electron")):null!==
window.navigator.userAgent.match("Safari")?a="safari":null!==window.navigator.userAgent.match("AppleWebKit")&&(a="safari"),a};r.a={GetUserMedia:function(a,u,g){u=void 0===u?function(){}:u;g=void 0===g?function(){}:g;var b,e=function(b,a,c){navigator.mediaDevices.getUserMedia(b).then(a).catch(c)};a.screen?function(){switch(f.a.debug("Screen access requested"),c()){case "electron":f.a.debug("Screen sharing in Electron");(b={}).video=a.video||{};b.video.mandatory=a.video.mandatory||{};b.video.mandatory.chromeMediaSource=
"desktop";b.video.mandatory.chromeMediaSourceId=a.desktopStreamId;e(b,u,g);break;case "mozilla":f.a.debug("Screen sharing in Firefox");b={};void 0!==a.video?(b.video=a.video,b.video.mediaSource||(b.video.mediaSource="window")):b={audio:a.audio,video:{mediaSource:"window"}};e(b,u,g);break;case "chrome-stable":if(f.a.debug("Screen sharing in Chrome"),b={},a.desktopStreamId)b.video=a.video||{mandatory:{}},b.video.mandatory=b.video.mandatory||{},b.video.mandatory.chromeMediaSource="desktop",b.video.mandatory.chromeMediaSourceId=
a.desktopStreamId,e(b,u,g);else{var d="okeephmleflklcdebijnponpabbmmgeo";a.extensionId&&(f.a.debug("extensionId supplied, using "+a.extensionId),d=a.extensionId);f.a.debug("Screen access on chrome stable, looking for extension");try{chrome.runtime.sendMessage(d,{getStream:!0},function(c){if(void 0===c)return f.a.error("Access to screen denied"),void g({code:"Access to screen denied"});c=c.streamId;void 0!==a.video.mandatory?(b.video=a.video||{mandatory:{}},b.video.mandatory.chromeMediaSource="desktop",
b.video.mandatory.chromeMediaSourceId=c):b={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:c}}};e(b,u,g)})}catch(k){f.a.debug("Screensharing plugin is not accessible "),g({code:"no_plugin_present"})}}break;default:f.a.error("This browser does not support ScreenSharing")}}():void 0!==d&&d.exports?f.a.error("Video/audio streams not supported in erizofc yet"):(f.a.debug("Calling getUserMedia with config",a),e(a,u,g))},getBrowser:c}}).call(this,h(26)(l))},function(l,r,h){var d=h(5)("SEND",
"RECV");d.byValue=function(f){return d[f.toUpperCase()]};d.toString=function(f){switch(f){case d.SEND:return"send";case d.RECV:return"recv";default:return"unknown"}};d.reverse=function(f){switch(f){case d.SEND:return d.RECV;default:return d.SEND}};l.exports=d},function(l,r,h){var d=h(5)("SENDRECV","SENDONLY","RECVONLY","INACTIVE");d.byValue=function(f){return d[f.toUpperCase()]};d.toString=function(f){switch(f){case d.SENDRECV:return"sendrecv";case d.SENDONLY:return"sendonly";case d.RECVONLY:return"recvonly";
case d.INACTIVE:return"inactive";default:return"unknown"}};d.reverse=function(f){switch(f){case d.SENDRECV:return d.SENDRECV;case d.SENDONLY:return d.RECVONLY;case d.RECVONLY:return d.SENDONLY;case d.INACTIVE:return d.INACTIVE;default:return d.SENDRECV}};l.exports=d},function(l,r){l.exports=function d(f){for(var c=[],a=0;a<arguments.length;++a)c[a-0]=arguments[a];var u=this;if(!(this instanceof d))return new (Function.prototype.bind.apply(d,[null].concat(Array.prototype.slice.call(c))));Array.from(c).forEach(function(a){$jscomp.initSymbol();
u[a]=Symbol.for("LICODE_SEMANTIC_SDP_"+a)})}},function(l,r,h){var d=h(5)("ACTIVE","PASSIVE","ACTPASS","INACTIVE");d.byValue=function(f){return d[f.toUpperCase()]};d.toString=function(f){switch(f){case d.ACTIVE:return"active";case d.PASSIVE:return"passive";case d.ACTPASS:return"actpass";case d.INACTIVE:return"inactive";default:return null}};d.reverse=function(f){switch(f){case d.ACTIVE:return d.PASSIVE;case d.PASSIVE:return d.ACTIVE;case d.ACTPASS:return d.PASSIVE;case d.INACTIVE:return d.INACTIVE;
default:return d.ACTIVE}};l.exports=d},function(l,r){r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(h){"object"==typeof window&&(r=window)}l.exports=r},function(l,r){var h=function(d,f){this.media=d;this.id=f;this.ssrcs=[];this.groups=[];this.encodings=[]};h.prototype.clone=function(){var d=new h(this.media,this.id);return this.mediaId&&d.setMediaId(this.mediaId),this.ssrcs.forEach(function(f){d.addSSRC(f)}),this.groups.forEach(function(f){d.addSourceGroup(f.clone())}),
this.encodings.forEach(function(f){var c=[];f.forEach(function(a){c.push(a.cloned())});d.addAlternativeEncoding(c)}),d};h.prototype.plain=function(){var d={media:this.media,id:this.id,ssrcs:[],groups:[],encodings:[]};return this.mediaId&&(d.mediaId=this.mediaId),this.ssrcs.forEach(function(f){d.ssrcs.push(f)}),this.groups.forEach(function(f){d.groups.push(f.plain())}),this.encodings.forEach(function(f){var c=[];f.forEach(function(a){c.push(a.plain())});d.encodings.push(c)}),d};h.prototype.getMedia=
function(){return this.media};h.prototype.setMediaId=function(d){this.mediaId=d};h.prototype.getMediaId=function(){return this.mediaId};h.prototype.getId=function(){return this.id};h.prototype.addSSRC=function(d){this.ssrcs.push(d)};h.prototype.getSSRCs=function(){return this.ssrcs};h.prototype.addSourceGroup=function(d){this.groups.push(d)};h.prototype.getSourceGroup=function(d){var f;return this.groups.forEach(function(c){c.getSemantics().toLowerCase()===d.toLowerCase()&&(f=c)}),f};h.prototype.getSourceGroups=
function(){return this.groups};h.prototype.hasSourceGroup=function(d){var f=!1;return this.groups.forEach(function(c){c.getSemantics().toLowerCase()===d.toLowerCase()&&(f=!0)}),f};h.prototype.getEncodings=function(){return this.encodings};h.prototype.addAlternaticeEncodings=function(d){this.encodings.push(d)};h.prototype.setEncodings=function(d){this.encodings=d};l.exports=h},function(l,r){var h=function(d){this.id=d;this.tracks=new Map};h.prototype.clone=function(){var d=new h(this.id);return this.tracks.forEach(function(f){d.addTrack(f.clone())}),
d};h.prototype.plain=function(){var d={id:this.id,tracks:[]};return this.tracks.forEach(function(f){d.tracks.push(f.plain())}),d};h.prototype.getId=function(){return this.id};h.prototype.addTrack=function(d){this.tracks.set(d.getId(),d)};h.prototype.getFirstTrack=function(d){var f;return this.tracks.forEach(function(c){c.getMedia().toLowerCase()===d.toLowerCase()&&(f=c)}),f};h.prototype.getTracks=function(){return this.tracks};h.prototype.removeAllTracks=function(){this.tracks.clear()};h.prototype.getTrack=
function(d){return this.tracks.get(d)};l.exports=h},function(l,r){var h=function(d){this.ssrc=d};h.prototype.clone=function(){var d=new h(this.ssrc);d.setCName(this.cname);d.setStreamId(this.streamId);this.setTrackId(this.trackId)};h.prototype.plain=function(){var d={ssrc:this.ssrc};return this.cname&&(d.cname=this.cname),this.label&&(d.label=this.label),this.mslabel&&(d.mslabel=this.mslabel),this.streamId&&(d.streamId=this.streamId),this.trackId&&(d.trackid=this.trackId),d};h.prototype.getCName=
function(){return this.cname};h.prototype.setCName=function(d){this.cname=d};h.prototype.getStreamId=function(){return this.streamId};h.prototype.setStreamId=function(d){this.streamId=d};h.prototype.getTrackId=function(){return this.trackId};h.prototype.setTrackId=function(d){this.trackId=d};h.prototype.getMSLabel=function(){return this.mslabel};h.prototype.setMSLabel=function(d){this.mslabel=d};h.prototype.getLabel=function(){return this.label};h.prototype.setLabel=function(d){this.label=d};h.prototype.getSSRC=
function(){return this.ssrc};l.exports=h},function(l,r){var h=function(d,f){var c=this;this.semantics=d;this.ssrcs=[];f.forEach(function(a){c.ssrcs.push(parseInt(a,10))})};h.prototype.clone=function(){return new h(this.semantics,this.ssrcs)};h.prototype.plain=function(){var d={semantics:this.semantics,ssrcs:[]};return d.ssrcs=this.ssrcs,d};h.prototype.getSemantics=function(){return this.semantics};h.prototype.getSSRCs=function(){return this.ssrcs};l.exports=h},function(l,r,h){var d=h(3),f=function(){this.send=
[];this.recv=[];this.plainString=null};f.prototype.clone=function(){var c=new f;return this.send.forEach(function(a){var d=[];a.forEach(function(a){d.push(a.clone())});c.addSimulcastAlternativeStreams(d)}),this.recv.forEach(function(a){var d=[];a.forEach(function(a){d.push(a.clone())});c.addSimulcastAlternativeStreams(d)}),c};f.prototype.plain=function(){var c={send:[],recv:[]};return this.send.forEach(function(a){var d=[];a.forEach(function(a){d.push(a.plain())});c.send.push(d)}),this.recv.forEach(function(a){var d=
[];a.forEach(function(a){d.push(a.plain())});c.recv.push(d)}),c};f.prototype.addSimulcastAlternativeStreams=function(c,a){return c===d.SEND?this.send.push(a):this.recv.push(a)};f.prototype.addSimulcastStream=function(c,a){return c===d.SEND?this.send.push([a]):this.recv.push([a])};f.prototype.getSimulcastStreams=function(c){return c===d.SEND?this.send:this.recv};f.prototype.setSimulcastPlainString=function(c){this.plainString=c};f.prototype.getSimulcastPlainString=function(){return this.plainString};
l.exports=f},function(l,r,h){var d=h(12),f=h(4),c=h(3),a=function(a,c,b){this.id=a;this.type=b;this.port=c;this.direction=f.SENDRECV;this.extensions=new Map;this.codecs=new Map;this.rids=new Map;this.simulcast_03=this.simulcast=null;this.bitrate=0;this.connection=this.dtls=this.ice=null;this.candidates=[]};a.prototype.clone=function(){var c=new a(this.id,this.port,this.type);return c.setDirection(this.direction),c.setBitrate(this.bitrate),c.setConnection(this.connection),this.codecs.forEach(function(a){c.addCodec(a.clone())}),
this.extensions.forEach(function(a,b){c.addExtension(b,a)}),this.rids.forEach(function(a,b){c.addRID(b,a.clone())}),this.simulcast&&c.setSimulcast(this.simulcast.clone()),this.xGoogleFlag&&c.setXGoogleFlag(this.xGoogleFlag),this.ice&&c.setICE(this.ice.clone()),this.dtls&&c.setDTLS(this.dtls.clone()),this.candidates.forEach(function(a){c.addCandidate(a.clone())}),this.setup&&c.setSetup(this.setup),c};a.prototype.plain=function(){var a={id:this.id,port:this.port,type:this.type,connection:this.connection,
direction:f.toString(this.direction),xGoogleFlag:this.xGoogleFlag,extensions:{},rids:[],codecs:[],candidates:[]};return this.bitrate&&(a.bitrate=this.bitrate),this.codecs.forEach(function(c){a.codecs.push(c.plain())}),this.extensions.forEach(function(c){a.extensions.push(c.plain())}),this.rids.forEach(function(c){a.rids.push(c.plain())}),this.simulcast&&(a.simulcast=this.simulcast.plain()),this.candidates.forEach(function(c){a.candidates.push(c.plain())}),a.ice=this.ice&&this.ice.plain(),a.dtls=this.dtls&&
this.dtls.plain(),a};a.prototype.getType=function(){return this.type};a.prototype.getPort=function(){return this.port};a.prototype.getId=function(){return this.id};a.prototype.addExtension=function(a,c){this.extensions.set(a,c)};a.prototype.addRID=function(a){this.rids.set(a.getId(),a)};a.prototype.addCodec=function(a){this.codecs.set(a.getType(),a)};a.prototype.getCodecForType=function(a){return this.codecs.get(a)};a.prototype.getCodec=function(a){var c;return this.codecs.forEach(function(b){b.getCodec().toLowerCase()===
a.toLowerCase()&&(c=b)}),c};a.prototype.hasCodec=function(a){return null!==this.getCodec(a)};a.prototype.getCodecs=function(){return this.codecs};a.prototype.getExtensions=function(){return this.extensions};a.prototype.getRIDs=function(){return this.rids};a.prototype.getRID=function(a){return this.rids.get(a)};a.prototype.getBitrate=function(){return this.bitrate};a.prototype.setBitrate=function(a){this.bitrate=a};a.prototype.getDirection=function(){return this.direction};a.prototype.setDirection=
function(a){this.direction=a};a.prototype.getDTLS=function(){return this.dtls};a.prototype.setDTLS=function(a){this.dtls=a};a.prototype.getICE=function(){return this.ice};a.prototype.setICE=function(a){this.ice=a};a.prototype.addCandidate=function(a){this.candidates.push(a)};a.prototype.addCandidates=function(a){var c=this;a.forEach(function(b){c.addCandidate(b)})};a.prototype.getCandidates=function(){return this.candidates};a.prototype.setXGoogleFlag=function(a){this.xGoogleFlag=a};a.prototype.getXGoogleFlag=
function(){return this.xGoogleFlag};a.prototype.getConnection=function(){return this.connection};a.prototype.setConnection=function(a){this.connection=a};a.prototype.answer=function(u){var g=new a(this.id,this.port,this.type);if(g.setDirection(f.reverse(this.direction)),u.codecs&&this.codecs.forEach(function(a){if(u.codecs.has(a.getCodec().toLowerCase())){var b=u.codecs.get(a.getCodec().toLowerCase()).clone();b.setType(a.getType());b.hasRTX()&&b.setRTX(a.getRTX());g.addCodec(b)}}),this.extensions.forEach(function(a,
b){u.extensions.has(b)&&g.addExtension(b,a)}),u.simulcast&&this.simulcast){var b=new d,e=this.simulcast.getSimulcastStreams(c.SEND);e&&e.forEach(function(a){var e=[];a.forEach(function(a){e.push(a.clone())});b.addSimulcastAlternativeStreams(c.RECV,e)});(e=this.simulcast.getSimulcastStreams(c.RECV))&&e.forEach(function(a){var e=[];a.forEach(function(a){e.push(a.clone())});b.addSimulcastAlternativeStreams(c.SEND,e)});this.rids.forEach(function(a){var b=a.clone();b.setDirection(c.reverse(a.getDirection()));
g.addRID(b)});g.setSimulcast(b)}return g};a.prototype.getSimulcast=function(){return this.simulcast};a.prototype.setSimulcast=function(a){this.simulcast=a};a.prototype.getSimulcast03=function(){return this.simulcast_03};a.prototype.setSimulcast03=function(a){this.simulcast_03=a};a.prototype.getSetup=function(){return this.setup};a.prototype.setSetup=function(a){this.setup=a};l.exports=a},function(l,r){function h(c){c=new Uint8Array(c);for(var a=0;a<c.length;a+=1)c[a]=Math.floor(256*Math.random()+
0);return c}function d(c){return Array.prototype.map.call(new Uint8Array(c),function(a){return("00"+a.toString(16)).slice(-2)}).join("")}var f=function(c,a,d){this.ufrag=c;this.pwd=a;this.opts=d;this.endOfCandidates=this.lite=!1};f.prototype.clone=function(){var c=new f(this.ufrag,this.pwd,this.opts);return c.setLite(this.lite),c.setEndOfCandidates(this.endOfCandidates),c};f.prototype.plain=function(){var c={ufrag:this.ufrag,pwd:this.pwd};return this.lite&&(c.lite=this.lite),this.endOfCandidates&&
(c.endOfCandidates=this.endOfCandidates),c};f.prototype.getUfrag=function(){return this.ufrag};f.prototype.getPwd=function(){return this.pwd};f.prototype.isLite=function(){return this.lite};f.prototype.getOpts=function(){return this.opts};f.prototype.setLite=function(c){this.lite=c};f.prototype.isEndOfCandidates=function(){return this.endOfCandidates};f.prototype.setEndOfCandidates=function(c){this.endOfCandidates=c};f.generate=function(){var c=new f,a=h(8),u=h(24);return c.ufrag=d(a),c.pwd=d(u),
c};l.exports=f},function(l,r,h){var d=h(6),f=function(c,a,d){this.setup=c;this.hash=a;this.fingerprint=d};f.prototype.clone=function(){return new f(this.setup,this.hash,this.fingerprint)};f.prototype.plain=function(){return{setup:d.toString(this.setup),hash:this.hash,fingerprint:this.fingerprint}};f.prototype.getFingerprint=function(){return this.fingerprint};f.prototype.getHash=function(){return this.hash};f.prototype.getSetup=function(){return this.setup};f.prototype.setSetup=function(c){this.setup=
c};l.exports=f},function(l,r){var h=function(d,f,c,a,u,g){this.codec=d;this.type=f;this.rate=c;this.encoding=a;this.params=u||{};this.feedback=g||[]};h.prototype.clone=function(){var d=new h(this.codec,this.type,this.rate,this.encoding,this.params,this.feedback);return this.rtx&&d.setRTX(this.rtx),d};h.prototype.plain=function(){return{codec:this.codec,type:this.type,rate:this.rate,encoding:this.encoding,params:this.params,feedback:this.feedback}};h.prototype.setRTX=function(d){this.rtx=d};h.prototype.getType=
function(){return this.type};h.prototype.setType=function(d){this.type=d};h.prototype.getCodec=function(){return this.codec};h.prototype.getParams=function(){return this.params};h.prototype.setParam=function(d,f){this.params[d]=f};h.prototype.hasRTX=function(){return this.rtx};h.prototype.getRTX=function(){return this.rtx};h.prototype.getRate=function(){return this.rate};h.prototype.getEncoding=function(){return this.encoding};h.prototype.getFeedback=function(){return this.feedback};h.mapFromNames=
function(d,f){var c=new Map,a=96;return d.forEach(function(d){d=d.toLowerCase();var g="pcmu"===d?0:"pcma"===d?8:a+=1;g=new h(d,g);f&&"ulpfec"!==d&&"flexfec-03"!==d&&"red"!==d&&(a+=1,g.setRTX(a));c.set(g.getCodec().toLowerCase(),g)}),c};l.exports=h},function(l,r){var h=function(d,f,c,a,u,g,b,e,n,k){this.foundation=d;this.componentId=f;this.transport=c;this.priority=a;this.address=u;this.port=g;this.type=b;this.generation=e;this.relAddr=n;this.relPort=k};h.prototype.clone=function(){return new h(this.foundation,
this.componentId,this.transport,this.priority,this.address,this.port,this.type,this.generation,this.relAddr,this.relPort)};h.prototype.plain=function(){var d={foundation:this.foundation,componentId:this.componentId,transport:this.transport,priority:this.priority,address:this.address,port:this.port,type:this.type,generation:this.generation};return this.relAddr&&(d.relAddr=this.relAddr),this.relPort&&(d.relPort=this.relPort),d};h.prototype.getFoundation=function(){return this.foundation};h.prototype.getComponentId=
function(){return this.componentId};h.prototype.getTransport=function(){return this.transport};h.prototype.getPriority=function(){return this.priority};h.prototype.getAddress=function(){return this.address};h.prototype.getPort=function(){return this.port};h.prototype.getType=function(){return this.type};h.prototype.getGeneration=function(){return this.generation};h.prototype.getRelAddr=function(){return this.relAddr};h.prototype.getRelPort=function(){return this.relPort};l.exports=h},function(l,r){var h=
l.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:"username sessionId sessionVersion netType ipVer address".split(" "),format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],
format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(d){return d.encoding?"rtpmap:%d %s/%s/%s":d.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload",
"config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(d){return null!=d.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(d){return null!=
d.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(d){return"extmap:%d"+(d.direction?"/%s":"%v")+" %s"+(d.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(d){return null!=d.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",
reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},
{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:"foundation component transport priority ip port type raddr rport tcptype generation network-id network-cost".split(" "),format:function(d){var f="candidate:%s %d %s %d %s %d typ %s";return f+=null!=d.raddr?" raddr %s rport %d":"%v%v",f+=null!=d.tcptype?" tcptype %s":"%v",null!=d.generation&&(f+=
" generation %d"),f+=null!=d["network-id"]?" network-id %d":"%v",f+(null!=d["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*)(?::(.*))?/,names:["id","attribute","value"],format:function(d){var f="ssrc:%d";return null!=d.attribute&&(f+=" %s",null!=d.value&&(f+=":%s")),
f}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber",
"app","maxMessageSize"],format:function(d){return null!=d.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(d){return d.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:/^imageattr:(\d+|\*)[\s\t]+(send|recv)[\s\t]+(\*|\[\S+\](?:[\s\t]+\[\S+\])*)(?:[\s\t]+(recv|send)[\s\t]+(\*|\[\S+\](?:[\s\t]+\[\S+\])*))?/,
names:["pt","dir1","attrs1","dir2","attrs2"],format:function(d){return"imageattr:%s %s %s"+(d.dir2?" %s %s":"")}},{name:"simulcast",reg:/^simulcast:(send|recv) ([a-zA-Z0-9\-_~;,]+)(?:\s?(send|recv) ([a-zA-Z0-9\-_~;,]+))?$/,names:["dir1","list1","dir2","list2"],format:function(d){return"simulcast:%s %s"+(d.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},
{push:"invalid",names:["value"]}]};Object.keys(h).forEach(function(d){h[d].forEach(function(d){d.reg||(d.reg=/(.*)/);d.format||(d.format="%s")})})},function(l,r,h){l.exports=function(d){function f(a){if(c[a])return c[a].exports;var u=c[a]={exports:{},id:a,loaded:!1};return d[a].call(u.exports,u,u.exports,f),u.loaded=!0,u.exports}var c={};return f.m=d,f.c=c,f.p="",f(0)}([function(d,f,c){function a(a,b){"object"===(void 0===a?"undefined":u(a))&&(b=a,a=void 0);b=b||{};var c;a=g(a);var p=a.source,q=a.id,
m=a.path,m=k[q]&&m in k[q].nsps;return b.forceNew||b["force new connection"]||!1===b.multiplex||m?(n("ignoring socket cache for %s",p),c=e(p,b)):(k[q]||(n("new io instance for %s",p),k[q]=e(p,b)),c=k[q]),a.query&&!b.query&&(b.query=a.query),c.socket(a.path,b)}$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbol();
return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},g=c(1),b=c(7),e=c(13),n=c(3)("socket.io-client");d.exports=f=a;var k=f.managers={};f.protocol=b.protocol;f.connect=a;f.Manager=c(13);f.Socket=c(39)},function(d,f,c){(function(a){var f=c(2),g=c(3)("socket.io-client:url");d.exports=function(b,c){var e=b;c=c||a.location;null==b&&(b=c.protocol+"//"+c.host);"string"==typeof b&&("/"===b.charAt(0)&&(b="/"===b.charAt(1)?c.protocol+b:c.host+b),/^(https?|wss?):\/\//.test(b)||
(g("protocol-less url %s",b),b=void 0!==c?c.protocol+"//"+b:"https://"+b),g("parse %s",b),e=f(b));e.port||(/^(http|ws)$/.test(e.protocol)?e.port="80":/^(http|ws)s$/.test(e.protocol)&&(e.port="443"));e.path=e.path||"/";b=-1!==e.host.indexOf(":")?"["+e.host+"]":e.host;return e.id=e.protocol+"://"+b+":"+e.port,e.href=e.protocol+"://"+b+(c&&c.port===e.port?"":":"+e.port),e}}).call(f,function(){return this}())},function(d,f){var c=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
a="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");d.exports=function(d){var g=d,b=d.indexOf("["),e=d.indexOf("]");-1!=b&&-1!=e&&(d=d.substring(0,b)+d.substring(b,e).replace(/:/g,";")+d.substring(e,d.length));d=c.exec(d||"");for(var f={},k=14;k--;)f[a[k]]=d[k]||"";return-1!=b&&-1!=e&&(f.source=g,f.host=f.host.substring(1,f.host.length-1).replace(/;/g,":"),f.authority=f.authority.replace("[","").replace("]","").replace(/;/g,":"),f.ipv6uri=
!0),f}},function(d,f,c){(function(a){function u(){try{var b=f.storage.debug}catch(n){}return!b&&void 0!==a&&"env"in a&&(b=a.env.DEBUG),b}(f=d.exports=c(5)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)};f.formatArgs=function(a){var b=this.useColors;if(a[0]=(b?"%c":"")+this.namespace+(b?" %c":" ")+a[0]+(b?"%c ":" ")+"+"+f.humanize(this.diff),b){b="color: "+this.color;a.splice(1,0,b,"color: inherit");var c=0,e=0;a[0].replace(/%[a-zA-Z%]/g,
function(a){"%%"!==a&&"%c"===a&&(e=++c)});a.splice(e,0,b)}};f.save=function(a){try{null==a?f.storage.removeItem("debug"):f.storage.debug=a}catch(n){}};f.load=u;f.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&
window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)};var g=f;if("undefined"!=typeof chrome&&void 0!==chrome.storage)var b=chrome.storage.local;else a:{try{b=window.localStorage;break a}catch(e){}b=void 0}g.storage=b;f.colors="lightseagreen forestgreen goldenrod dodgerblue darkorchid crimson".split(" ");
f.formatters.j=function(a){try{return JSON.stringify(a)}catch(n){return"[UnexpectedJSONParseError]: "+n.message}};f.enable(u())}).call(f,c(4))},function(d,f){function c(){throw Error("setTimeout has not been defined");}function a(){throw Error("clearTimeout has not been defined");}function u(a){if(k===setTimeout)return setTimeout(a,0);if((k===c||!k)&&setTimeout)return k=setTimeout,setTimeout(a,0);try{return k(a,0)}catch(A){try{return k.call(null,a,0)}catch(B){return k.call(this,a,0)}}}function g(){p&&
x&&(p=!1,x.length?w=x.concat(w):q=-1,w.length&&b())}function b(){if(!p){var b=u(g);p=!0;for(var c=w.length;c;){x=w;for(w=[];++q<c;)x&&x[q].run();q=-1;c=w.length}x=null;p=!1;(function(b){if(t===clearTimeout)return clearTimeout(b);if((t===a||!t)&&clearTimeout)return t=clearTimeout,clearTimeout(b);try{t(b)}catch(v){try{return t.call(null,b)}catch(D){return t.call(this,b)}}})(b)}}function e(a,b){this.fun=a;this.array=b}function n(){}d=d.exports={};try{var k="function"==typeof setTimeout?setTimeout:c}catch(m){k=
c}try{var t="function"==typeof clearTimeout?clearTimeout:a}catch(m){t=a}!0;var x,w=[],p=!1,q=-1;d.nextTick=function(a){var c=Array(arguments.length-1);if(1<arguments.length)for(var q=1;q<arguments.length;q++)c[q-1]=arguments[q];w.push(new e(a,c));1!==w.length||p||u(b)};e.prototype.run=function(){this.fun.apply(null,this.array)};d.title="browser";d.browser=!0;d.env={};d.argv=[];d.version="";d.versions={};d.on=n;d.addListener=n;d.once=n;d.off=n;d.removeListener=n;d.removeAllListeners=n;d.emit=n;d.prependListener=
n;d.prependOnceListener=n;d.listeners=function(a){return[]};d.binding=function(a){throw Error("process.binding is not supported");};d.cwd=function(){return"/"};d.chdir=function(a){throw Error("process.chdir is not supported");};d.umask=function(){return 0}},function(d,f,c){function a(a){function b(){if(b.enabled){var a=+new Date;b.diff=a-(u||a);b.prev=u;u=b.curr=a;for(var c=Array(arguments.length),a=0;a<c.length;a++)c[a]=arguments[a];c[0]=f.coerce(c[0]);"string"!=typeof c[0]&&c.unshift("%O");var d=
0;c[0]=c[0].replace(/%([a-zA-Z%])/g,function(a,e){if("%%"===a)return a;d++;e=f.formatters[e];"function"==typeof e&&(a=e.call(b,c[d]),c.splice(d,1),d--);return a});f.formatArgs.call(b,c);(b.log||f.log||console.log.bind(console)).apply(b,c)}}return b.namespace=a,b.enabled=f.enabled(a),b.useColors=f.useColors(),b.color=function(a){var b,c=0;for(b in a)c=(c<<5)-c+a.charCodeAt(b),c|=0;return f.colors[Math.abs(c)%f.colors.length]}(a),"function"==typeof f.init&&f.init(b),b}var u;(f=d.exports=a.debug=a.default=
a).coerce=function(a){return a instanceof Error?a.stack||a.message:a};f.disable=function(){f.enable("")};f.enable=function(a){f.save(a);f.names=[];f.skips=[];for(var b=("string"==typeof a?a:"").split(/[\s,]+/),c=b.length,d=0;d<c;d++)b[d]&&("-"===(a=b[d].replace(/\*/g,".*?"))[0]?f.skips.push(new RegExp("^"+a.substr(1)+"$")):f.names.push(new RegExp("^"+a+"$")))};f.enabled=function(a){var b;var c=0;for(b=f.skips.length;c<b;c++)if(f.skips[c].test(a))return!1;c=0;for(b=f.names.length;c<b;c++)if(f.names[c].test(a))return!0;
return!1};f.humanize=c(6);f.names=[];f.skips=[];f.formatters={}},function(d,f){function c(c){return a(c,e,"day")||a(c,b,"hour")||a(c,g,"minute")||a(c,u,"second")||c+" ms"}function a(a,b,c){if(!(a<b))return a<1.5*b?Math.floor(a/b)+" "+c:Math.ceil(a/b)+" "+c+"s"}var u=1E3,g=60*u,b=60*g,e=24*b,n=365.25*e;d.exports=function(a,d){d=d||{};var k=typeof a;if("string"===k&&0<a.length)return function(a){if(!(100<(a=String(a)).length)&&(a=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(a))){var c=
parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case "years":case "year":case "yrs":case "yr":case "y":return c*n;case "days":case "day":case "d":return c*e;case "hours":case "hour":case "hrs":case "hr":case "h":return c*b;case "minutes":case "minute":case "mins":case "min":case "m":return c*g;case "seconds":case "second":case "secs":case "sec":case "s":return c*u;case "milliseconds":case "millisecond":case "msecs":case "msec":case "ms":return c}}}(a);if("number"===k&&!1===isNaN(a))return d.long?
c(a):a>=e?Math.round(a/e)+"d":a>=b?Math.round(a/b)+"h":a>=g?Math.round(a/g)+"m":a>=u?Math.round(a/u)+"s":a+"ms";throw Error("val is not a non-empty string or a valid number. val\x3d"+JSON.stringify(a));}},function(d,f,c){function a(){}function u(a){var b=""+a.type;return f.BINARY_EVENT!==a.type&&f.BINARY_ACK!==a.type||(b+=a.attachments+"-"),a.nsp&&"/"!==a.nsp&&(b+=a.nsp+","),null!=a.id&&(b+=a.id),null!=a.data&&(b+=JSON.stringify(a.data)),n("encoded %j as %s",a,b),b}function g(){this.reconstructor=
null}function b(a){this.reconPack=a;this.buffers=[]}function e(){return{type:f.ERROR,data:"parser error"}}var n=c(3)("socket.io-parser");d=c(8);var k=c(9),t=c(11),x=c(12);f.protocol=4;f.types="CONNECT DISCONNECT EVENT ACK ERROR BINARY_EVENT BINARY_ACK".split(" ");f.CONNECT=0;f.DISCONNECT=1;f.EVENT=2;f.ACK=3;f.ERROR=4;f.BINARY_EVENT=5;f.BINARY_ACK=6;f.Encoder=a;f.Decoder=g;a.prototype.encode=function(a,b){(a.type!==f.EVENT&&a.type!==f.ACK||!k(a.data)||(a.type=a.type===f.EVENT?f.BINARY_EVENT:f.BINARY_ACK),
n("encoding packet %j",a),f.BINARY_EVENT===a.type||f.BINARY_ACK===a.type)?!function(a,b){t.removeBlobs(a,function(a){var c=t.deconstructPacket(a);a=u(c.packet);c=c.buffers;c.unshift(a);b(c)})}(a,b):(a=u(a),b([a]))};d(g.prototype);g.prototype.add=function(a){if("string"==typeof a){var c;var q=0;var m={type:Number(a.charAt(0))};if(null==f.types[m.type])q=e();else{if(f.BINARY_EVENT===m.type||f.BINARY_ACK===m.type){for(c="";"-"!==a.charAt(++q)&&(c+=a.charAt(q),q!=a.length););if(c!=Number(c)||"-"!==a.charAt(q))throw Error("Illegal attachments");
m.attachments=Number(c)}if("/"===a.charAt(q+1))for(m.nsp="";++q;){c=a.charAt(q);if(","===c)break;if(m.nsp+=c,q===a.length)break}else m.nsp="/";c=a.charAt(q+1);if(""!==c&&Number(c)==c){for(m.id="";++q;){c=a.charAt(q);if(null==c||Number(c)!=c){--q;break}if(m.id+=a.charAt(q),q===a.length)break}m.id=Number(m.id)}if(a.charAt(++q)){b:{q=a.substr(q);try{m.data=JSON.parse(q)}catch(A){q=e();break b}q=m}m=q}q=(n("decoded %s as %j",a,m),m)}f.BINARY_EVENT===q.type||f.BINARY_ACK===q.type?(this.reconstructor=new b(q),
0===this.reconstructor.reconPack.attachments&&this.emit("decoded",q)):this.emit("decoded",q)}else{if(!x(a)&&!a.base64)throw Error("Unknown type: "+a);if(!this.reconstructor)throw Error("got binary data when not reconstructing a packet");(q=this.reconstructor.takeBinaryData(a))&&(this.reconstructor=null,this.emit("decoded",q))}};g.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};b.prototype.takeBinaryData=function(a){return(this.buffers.push(a),this.buffers.length===
this.reconPack.attachments)?(a=t.reconstructPacket(this.reconPack,this.buffers),this.finishedReconstruction(),a):null};b.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]}},function(d,f,c){function a(c){if(c){for(var d in a.prototype)c[d]=a.prototype[d];return c}}d.exports=a;a.prototype.on=a.prototype.addEventListener=function(a,c){return this._callbacks=this._callbacks||{},(this._callbacks["$"+a]=this._callbacks["$"+a]||[]).push(c),this};a.prototype.once=function(a,
c){function b(){this.off(a,b);c.apply(this,arguments)}return b.fn=c,this.on(a,b),this};a.prototype.off=a.prototype.removeListener=a.prototype.removeAllListeners=a.prototype.removeEventListener=function(a,c){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var b=this._callbacks["$"+a];if(!b)return this;if(1==arguments.length)return delete this._callbacks["$"+a],this;for(var e,d=0;d<b.length;d++)if((e=b[d])===c||e.fn===c){b.splice(d,1);break}return this};a.prototype.emit=
function(a){this._callbacks=this._callbacks||{};var c=[].slice.call(arguments,1),b=this._callbacks["$"+a];if(b)for(var e=0,d=(b=b.slice(0)).length;e<d;++e)b[e].apply(this,c);return this};a.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks["$"+a]||[]};a.prototype.hasListeners=function(a){return!!this.listeners(a).length}},function(d,f,c){(function(a){var f=c(10),g=Object.prototype.toString,b="function"==typeof a.Blob||"[object BlobConstructor]"===g.call(a.Blob),
e="function"==typeof a.File||"[object FileConstructor]"===g.call(a.File);d.exports=function k(c){if(!c||"object"!=typeof c)return!1;if(f(c)){for(var d=0,g=c.length;d<g;d++)if(k(c[d]))return!0;return!1}if("function"==typeof a.Buffer&&a.Buffer.isBuffer&&a.Buffer.isBuffer(c)||"function"==typeof a.ArrayBuffer&&c instanceof ArrayBuffer||b&&c instanceof Blob||e&&c instanceof File)return!0;if(c.toJSON&&"function"==typeof c.toJSON&&1===arguments.length)return k(c.toJSON(),!0);for(d in c)if(Object.prototype.hasOwnProperty.call(c,
d)&&k(c[d]))return!0;return!1}}).call(f,function(){return this}())},function(d,f){var c={}.toString;d.exports=Array.isArray||function(a){return"[object Array]"==c.call(a)}},function(d,f,c){(function(a){var d=c(10),g=c(12),b=Object.prototype.toString,e="function"==typeof a.Blob||"[object BlobConstructor]"===b.call(a.Blob),n="function"==typeof a.File||"[object FileConstructor]"===b.call(a.File);f.deconstructPacket=function(a){var c=[];return a.data=function w(a,c){if(!a)return a;if(g(a)){var b={_placeholder:!0,
num:c.length};return c.push(a),b}if(d(a)){b=Array(a.length);for(var q=0;q<a.length;q++)b[q]=w(a[q],c);return b}if("object"==typeof a&&!(a instanceof Date)){b={};for(q in a)b[q]=w(a[q],c);return b}return a}(a.data,c),a.attachments=c.length,{packet:a,buffers:c}};f.reconstructPacket=function(a,c){return a.data=function w(a,c){if(!a)return a;if(a&&a._placeholder)return c[a.num];if(d(a))for(var b=0;b<a.length;b++)a[b]=w(a[b],c);else if("object"==typeof a)for(b in a)a[b]=w(a[b],c);return a}(a.data,c),a.attachments=
void 0,a};f.removeBlobs=function(a,c){var b=0,f=a;(function q(a,k,t){if(!a)return a;if(e&&a instanceof Blob||n&&a instanceof File){b++;var m=new FileReader;m.onload=function(){t?t[k]=this.result:f=this.result;--b||c(f)};m.readAsArrayBuffer(a)}else if(d(a))for(m=0;m<a.length;m++)q(a[m],m,a);else if("object"==typeof a&&!g(a))for(m in a)q(a[m],m,a)})(f);b||c(f)}}).call(f,function(){return this}())},function(d,f){(function(c){d.exports=function(a){return c.Buffer&&c.Buffer.isBuffer(a)||c.ArrayBuffer&&
a instanceof ArrayBuffer}}).call(f,function(){return this}())},function(d,f,c){function a(c,b){if(!(this instanceof a))return new a(c,b);c&&"object"===(void 0===c?"undefined":u(c))&&(b=c,c=void 0);(b=b||{}).path=b.path||"/socket.io";this.nsps={};this.subs=[];this.opts=b;this.reconnection(!1!==b.reconnection);this.reconnectionAttempts(b.reconnectionAttempts||1/0);this.reconnectionDelay(b.reconnectionDelay||1E3);this.reconnectionDelayMax(b.reconnectionDelayMax||5E3);this.randomizationFactor(b.randomizationFactor||
.5);this.backoff=new w({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==b.timeout?2E4:b.timeout);this.readyState="closed";this.uri=c;this.connecting=[];this.lastPing=null;this.encoding=!1;this.packetBuffer=[];c=b.parser||e;this.encoder=new c.Encoder;this.decoder=new c.Decoder;(this.autoConnect=!1!==b.autoConnect)&&this.open()}$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();var u="function"==typeof Symbol&&"symbol"==
typeof Symbol.iterator?function(a){return typeof a}:function(a){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbol();return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},g=c(14),b=c(39);f=c(8);var e=c(7),n=c(41),k=c(42),t=c(3)("socket.io-client:manager"),h=c(37),w=c(43),p=Object.prototype.hasOwnProperty;d.exports=a;a.prototype.emitAll=function(){for(var a in this.emit.apply(this,arguments),this.nsps)p.call(this.nsps,a)&&this.nsps[a].emit.apply(this.nsps[a],
arguments)};a.prototype.updateSocketIds=function(){for(var a in this.nsps)p.call(this.nsps,a)&&(this.nsps[a].id=this.generateId(a))};a.prototype.generateId=function(a){return("/"===a?"":a+"#")+this.engine.id};f(a.prototype);a.prototype.reconnection=function(a){return arguments.length?(this._reconnection=!!a,this):this._reconnection};a.prototype.reconnectionAttempts=function(a){return arguments.length?(this._reconnectionAttempts=a,this):this._reconnectionAttempts};a.prototype.reconnectionDelay=function(a){return arguments.length?
(this._reconnectionDelay=a,this.backoff&&this.backoff.setMin(a),this):this._reconnectionDelay};a.prototype.randomizationFactor=function(a){return arguments.length?(this._randomizationFactor=a,this.backoff&&this.backoff.setJitter(a),this):this._randomizationFactor};a.prototype.reconnectionDelayMax=function(a){return arguments.length?(this._reconnectionDelayMax=a,this.backoff&&this.backoff.setMax(a),this):this._reconnectionDelayMax};a.prototype.timeout=function(a){return arguments.length?(this._timeout=
a,this):this._timeout};a.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()};a.prototype.open=a.prototype.connect=function(a,b){if(t("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;t("opening %s",this.uri);var c=this.engine=g(this.uri,this.opts),p=this;this.readyState="opening";this.skipReconnect=!1;var q=n(c,"open",function(){p.onopen();a&&a()});b=n(c,"error",function(c){if(t("connect_error"),
p.cleanup(),p.readyState="closed",p.emitAll("connect_error",c),a){var b=Error("Connection error");b.data=c;a(b)}else p.maybeReconnectOnOpen()});if(!1!==this._timeout){var e=this._timeout;t("connect attempt will timeout after %d",e);var d=setTimeout(function(){t("connect attempt timed out after %d",e);q.destroy();c.close();c.emit("error","timeout");p.emitAll("connect_timeout",e)},e);this.subs.push({destroy:function(){clearTimeout(d)}})}return this.subs.push(q),this.subs.push(b),this};a.prototype.onopen=
function(){t("open");this.cleanup();this.readyState="open";this.emit("open");var a=this.engine;this.subs.push(n(a,"data",k(this,"ondata")));this.subs.push(n(a,"ping",k(this,"onping")));this.subs.push(n(a,"pong",k(this,"onpong")));this.subs.push(n(a,"error",k(this,"onerror")));this.subs.push(n(a,"close",k(this,"onclose")));this.subs.push(n(this.decoder,"decoded",k(this,"ondecoded")))};a.prototype.onping=function(){this.lastPing=new Date;this.emitAll("ping")};a.prototype.onpong=function(){this.emitAll("pong",
new Date-this.lastPing)};a.prototype.ondata=function(a){this.decoder.add(a)};a.prototype.ondecoded=function(a){this.emit("packet",a)};a.prototype.onerror=function(a){t("error",a);this.emitAll("error",a)};a.prototype.socket=function(a,c){function p(){~h(q.connecting,e)||q.connecting.push(e)}var e=this.nsps[a];if(!e){e=new b(this,a,c);this.nsps[a]=e;var q=this;e.on("connecting",p);e.on("connect",function(){e.id=q.generateId(a)});this.autoConnect&&p()}return e};a.prototype.destroy=function(a){a=h(this.connecting,
a);~a&&this.connecting.splice(a,1);this.connecting.length||this.close()};a.prototype.packet=function(a){t("writing packet %j",a);var c=this;a.query&&0===a.type&&(a.nsp+="?"+a.query);c.encoding?c.packetBuffer.push(a):(c.encoding=!0,this.encoder.encode(a,function(b){for(var p=0;p<b.length;p++)c.engine.write(b[p],a.options);c.encoding=!1;c.processPacketQueue()}))};a.prototype.processPacketQueue=function(){if(0<this.packetBuffer.length&&!this.encoding){var a=this.packetBuffer.shift();this.packet(a)}};
a.prototype.cleanup=function(){t("cleanup");for(var a=this.subs.length,c=0;c<a;c++)this.subs.shift().destroy();this.packetBuffer=[];this.encoding=!1;this.lastPing=null;this.decoder.destroy()};a.prototype.close=a.prototype.disconnect=function(){t("disconnect");this.skipReconnect=!0;this.reconnecting=!1;"opening"===this.readyState&&this.cleanup();this.backoff.reset();this.readyState="closed";this.engine&&this.engine.close()};a.prototype.onclose=function(a){t("onclose");this.cleanup();this.backoff.reset();
this.readyState="closed";this.emit("close",a);this._reconnection&&!this.skipReconnect&&this.reconnect()};a.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var a=this;if(this.backoff.attempts>=this._reconnectionAttempts)t("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var c=this.backoff.duration();t("will wait %dms before reconnect attempt",c);this.reconnecting=!0;var b=setTimeout(function(){a.skipReconnect||(t("attempting reconnect"),
a.emitAll("reconnect_attempt",a.backoff.attempts),a.emitAll("reconnecting",a.backoff.attempts),a.skipReconnect||a.open(function(c){c?(t("reconnect attempt error"),a.reconnecting=!1,a.reconnect(),a.emitAll("reconnect_error",c.data)):(t("reconnect success"),a.onreconnect())}))},c);this.subs.push({destroy:function(){clearTimeout(b)}})}};a.prototype.onreconnect=function(){var a=this.backoff.attempts;this.reconnecting=!1;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",a)}},function(d,
f,c){d.exports=c(15)},function(d,f,c){d.exports=c(16);d.exports.parser=c(23)},function(d,f,c){(function(a){function f(c,b){if(!(this instanceof f))return new f(c,b);b=b||{};c&&"object"==typeof c&&(b=c,c=null);c?(c=t(c),b.hostname=c.host,b.secure="https"===c.protocol||"wss"===c.protocol,b.port=c.port,c.query&&(b.query=c.query)):b.host&&(b.hostname=t(b.host).host);this.secure=null!=b.secure?b.secure:a.location&&"https:"===location.protocol;b.hostname&&!b.port&&(b.port=this.secure?"443":"80");this.agent=
b.agent||!1;this.hostname=b.hostname||(a.location?location.hostname:"localhost");this.port=b.port||(a.location&&location.port?location.port:this.secure?443:80);this.query=b.query||{};"string"==typeof this.query&&(this.query=w.decode(this.query));this.upgrade=!1!==b.upgrade;this.path=(b.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!b.forceJSONP;this.jsonp=!1!==b.jsonp;this.forceBase64=!!b.forceBase64;this.enablesXDR=!!b.enablesXDR;this.timestampParam=b.timestampParam||"t";this.timestampRequests=
b.timestampRequests;this.transports=b.transports||["polling","websocket"];this.transportOptions=b.transportOptions||{};this.readyState="";this.writeBuffer=[];this.prevBufferLen=0;this.policyPort=b.policyPort||843;this.rememberUpgrade=b.rememberUpgrade||!1;this.binaryType=null;this.onlyBinaryUpgrades=b.onlyBinaryUpgrades;this.perMessageDeflate=!1!==b.perMessageDeflate&&(b.perMessageDeflate||{});!0===this.perMessageDeflate&&(this.perMessageDeflate={});this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&
(this.perMessageDeflate.threshold=1024);this.pfx=b.pfx||null;this.key=b.key||null;this.passphrase=b.passphrase||null;this.cert=b.cert||null;this.ca=b.ca||null;this.ciphers=b.ciphers||null;this.rejectUnauthorized=void 0===b.rejectUnauthorized||b.rejectUnauthorized;this.forceNode=!!b.forceNode;c="object"==typeof a&&a;c.global===c&&(b.extraHeaders&&0<Object.keys(b.extraHeaders).length&&(this.extraHeaders=b.extraHeaders),b.localAddress&&(this.localAddress=b.localAddress));this.pingTimeoutTimer=this.pingIntervalTimer=
this.pingTimeout=this.pingInterval=this.upgrades=this.id=null;this.open()}var g=c(17),b=c(8),e=c(3)("engine.io-client:socket"),n=c(37),k=c(23),t=c(2),h=c(38),w=c(31);d.exports=f;f.priorWebsocketSuccess=!1;b(f.prototype);f.protocol=k.protocol;f.Socket=f;f.Transport=c(22);f.transports=c(17);f.parser=c(23);f.prototype.createTransport=function(a){e('creating transport "%s"',a);var b=this.query,c={},p;for(p in b)b.hasOwnProperty(p)&&(c[p]=b[p]);c.EIO=k.protocol;c.transport=a;b=this.transportOptions[a]||
{};this.id&&(c.sid=this.id);return new g[a]({query:c,socket:this,agent:b.agent||this.agent,hostname:b.hostname||this.hostname,port:b.port||this.port,secure:b.secure||this.secure,path:b.path||this.path,forceJSONP:b.forceJSONP||this.forceJSONP,jsonp:b.jsonp||this.jsonp,forceBase64:b.forceBase64||this.forceBase64,enablesXDR:b.enablesXDR||this.enablesXDR,timestampRequests:b.timestampRequests||this.timestampRequests,timestampParam:b.timestampParam||this.timestampParam,policyPort:b.policyPort||this.policyPort,
pfx:b.pfx||this.pfx,key:b.key||this.key,passphrase:b.passphrase||this.passphrase,cert:b.cert||this.cert,ca:b.ca||this.ca,ciphers:b.ciphers||this.ciphers,rejectUnauthorized:b.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:b.perMessageDeflate||this.perMessageDeflate,extraHeaders:b.extraHeaders||this.extraHeaders,forceNode:b.forceNode||this.forceNode,localAddress:b.localAddress||this.localAddress,requestTimeout:b.requestTimeout||this.requestTimeout,protocols:b.protocols||void 0})};f.prototype.open=
function(){if(this.rememberUpgrade&&f.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))var a="websocket";else{if(0===this.transports.length){var b=this;return void setTimeout(function(){b.emit("error","No transports available")},0)}a=this.transports[0]}this.readyState="opening";try{a=this.createTransport(a)}catch(m){return this.transports.shift(),void this.open()}a.open();this.setTransport(a)};f.prototype.setTransport=function(a){e("setting transport %s",a.name);var b=this;this.transport&&
(e("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners());this.transport=a;a.on("drain",function(){b.onDrain()}).on("packet",function(a){b.onPacket(a)}).on("error",function(a){b.onError(a)}).on("close",function(){b.onClose("transport close")})};f.prototype.probe=function(a){function b(){if(x.onlyBinaryUpgrades){var b=!this.supportsBinary&&x.transport.supportsBinary;h=h||b}h||(e('probe transport "%s" opened',a),t.send([{type:"ping",data:"probe"}]),t.once("packet",
function(b){if(!h)if("pong"===b.type&&"probe"===b.data){if(e('probe transport "%s" pong',a),x.upgrading=!0,x.emit("upgrading",t),t)f.priorWebsocketSuccess="websocket"===t.name,e('pausing current transport "%s"',x.transport.name),x.transport.pause(function(){h||"closed"!==x.readyState&&(e("changing transport and sending upgrade packet"),n(),x.setTransport(t),t.send([{type:"upgrade"}]),x.emit("upgrade",t),t=null,x.upgrading=!1,x.flush())})}else e('probe transport "%s" failed',a),b=Error("probe error"),
b.transport=t.name,x.emit("upgradeError",b)}))}function c(){h||(h=!0,n(),t.close(),t=null)}function p(b){var p=Error("probe error: "+b);p.transport=t.name;c();e('probe transport "%s" failed because of error: %s',a,b);x.emit("upgradeError",p)}function d(){p("transport closed")}function g(){p("socket closed")}function k(a){t&&a.name!==t.name&&(e('"%s" works - aborting "%s"',a.name,t.name),c())}function n(){t.removeListener("open",b);t.removeListener("error",p);t.removeListener("close",d);x.removeListener("close",
g);x.removeListener("upgrading",k)}e('probing transport "%s"',a);var t=this.createTransport(a,{probe:1}),h=!1,x=this;f.priorWebsocketSuccess=!1;t.once("open",b);t.once("error",p);t.once("close",d);this.once("close",g);this.once("upgrading",k);t.open()};f.prototype.onOpen=function(){if(e("socket open"),this.readyState="open",f.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){e("starting upgrade probes");
for(var a=0,b=this.upgrades.length;a<b;a++)this.probe(this.upgrades[a])}};f.prototype.onPacket=function(a){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(e('socket receive: type "%s", data "%s"',a.type,a.data),this.emit("packet",a),this.emit("heartbeat"),a.type){case "open":this.onHandshake(h(a.data));break;case "pong":this.setPing();this.emit("pong");break;case "error":var b=Error("server error");b.code=a.data;this.onError(b);break;case "message":this.emit("data",
a.data),this.emit("message",a.data)}else e('packet received with socket readyState "%s"',this.readyState)};f.prototype.onHandshake=function(a){this.emit("handshake",a);this.id=a.sid;this.transport.query.sid=a.sid;this.upgrades=this.filterUpgrades(a.upgrades);this.pingInterval=a.pingInterval;this.pingTimeout=a.pingTimeout;this.onOpen();"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))};f.prototype.onHeartbeat=function(a){clearTimeout(this.pingTimeoutTimer);
var b=this;b.pingTimeoutTimer=setTimeout(function(){"closed"!==b.readyState&&b.onClose("ping timeout")},a||b.pingInterval+b.pingTimeout)};f.prototype.setPing=function(){var a=this;clearTimeout(a.pingIntervalTimer);a.pingIntervalTimer=setTimeout(function(){e("writing ping packet - expecting pong within %sms",a.pingTimeout);a.ping();a.onHeartbeat(a.pingTimeout)},a.pingInterval)};f.prototype.ping=function(){var a=this;this.sendPacket("ping",function(){a.emit("ping")})};f.prototype.onDrain=function(){this.writeBuffer.splice(0,
this.prevBufferLen);this.prevBufferLen=0;0===this.writeBuffer.length?this.emit("drain"):this.flush()};f.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(e("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))};f.prototype.write=f.prototype.send=function(a,b,c){return this.sendPacket("message",a,b,c),this};f.prototype.sendPacket=
function(a,b,c,e){if("function"==typeof b&&(e=b,b=void 0),"function"==typeof c&&(e=c,c=null),"closing"!==this.readyState&&"closed"!==this.readyState)(c=c||{}).compress=!1!==c.compress,a={type:a,data:b,options:c},this.emit("packetCreate",a),this.writeBuffer.push(a),e&&this.once("flush",e),this.flush()};f.prototype.close=function(){function a(){d.onClose("forced close");e("socket closing - telling transport to close");d.transport.close()}function b(){d.removeListener("upgrade",b);d.removeListener("upgradeError",
b);a()}function c(){d.once("upgrade",b);d.once("upgradeError",b)}if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var d=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?c():a()}):this.upgrading?c():a()}return this};f.prototype.onError=function(a){e("socket error %j",a);f.priorWebsocketSuccess=!1;this.emit("error",a);this.onClose("transport error",a)};f.prototype.onClose=function(a,b){"opening"!==this.readyState&&"open"!==this.readyState&&
"closing"!==this.readyState||(e('socket close with reason: "%s"',a),clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",a,b),this.writeBuffer=[],this.prevBufferLen=0)};f.prototype.filterUpgrades=function(a){for(var b=[],c=0,e=a.length;c<e;c++)~n(this.transports,a[c])&&b.push(a[c]);return b}}).call(f,function(){return this}())},
function(d,f,c){(function(a){var d=c(18),g=c(20),b=c(34),e=c(35);f.polling=function(c){var e=!1,f=!1,n=!1!==c.jsonp;a.location&&(f="https:"===location.protocol,(e=location.port)||(e=f?443:80),e=c.hostname!==location.hostname||e!==c.port,f=c.secure!==f);if(c.xdomain=e,c.xscheme=f,"open"in new d(c)&&!c.forceJSONP)return new g(c);if(!n)throw Error("JSONP disabled");return new b(c)};f.websocket=e}).call(f,function(){return this}())},function(d,f,c){(function(a){var f=c(19);d.exports=function(c){var b=
c.xdomain,e=c.xscheme;c=c.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!b||f))return new XMLHttpRequest}catch(n){}try{if("undefined"!=typeof XDomainRequest&&!e&&c)return new XDomainRequest}catch(n){}if(!b)try{return new (a[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(n){}}}).call(f,function(){return this}())},function(d,f){try{d.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(c){d.exports=!1}},function(d,f,c){(function(a){function f(){}
function g(b){if(k.call(this,b),this.requestTimeout=b.requestTimeout,this.extraHeaders=b.extraHeaders,a.location){var c="https:"===location.protocol,e=location.port;e||(e=c?443:80);this.xd=b.hostname!==a.location.hostname||e!==b.port;this.xs=b.secure!==c}}function b(a){this.method=a.method||"GET";this.uri=a.uri;this.xd=!!a.xd;this.xs=!!a.xs;this.async=!1!==a.async;this.data=void 0!==a.data?a.data:null;this.agent=a.agent;this.isBinary=a.isBinary;this.supportsBinary=a.supportsBinary;this.enablesXDR=
a.enablesXDR;this.requestTimeout=a.requestTimeout;this.pfx=a.pfx;this.key=a.key;this.passphrase=a.passphrase;this.cert=a.cert;this.ca=a.ca;this.ciphers=a.ciphers;this.rejectUnauthorized=a.rejectUnauthorized;this.extraHeaders=a.extraHeaders;this.create()}function e(){for(var a in b.requests)b.requests.hasOwnProperty(a)&&b.requests[a].abort()}var n=c(18),k=c(21),t=c(8),h=c(32),w=c(3)("engine.io-client:polling-xhr");d.exports=g;d.exports.Request=b;h(g,k);g.prototype.supportsBinary=!0;g.prototype.request=
function(a){return(a=a||{}).uri=this.uri(),a.xd=this.xd,a.xs=this.xs,a.agent=this.agent||!1,a.supportsBinary=this.supportsBinary,a.enablesXDR=this.enablesXDR,a.pfx=this.pfx,a.key=this.key,a.passphrase=this.passphrase,a.cert=this.cert,a.ca=this.ca,a.ciphers=this.ciphers,a.rejectUnauthorized=this.rejectUnauthorized,a.requestTimeout=this.requestTimeout,a.extraHeaders=this.extraHeaders,new b(a)};g.prototype.doWrite=function(a,b){a=this.request({method:"POST",data:a,isBinary:"string"!=typeof a&&void 0!==
a});var c=this;a.on("success",b);a.on("error",function(a){c.onError("xhr post error",a)});this.sendXhr=a};g.prototype.doPoll=function(){w("xhr poll");var a=this.request(),b=this;a.on("data",function(a){b.onData(a)});a.on("error",function(a){b.onError("xhr poll error",a)});this.pollXhr=a};t(b.prototype);b.prototype.create=function(){var c={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};c.pfx=this.pfx;c.key=this.key;c.passphrase=this.passphrase;c.cert=this.cert;c.ca=this.ca;
c.ciphers=this.ciphers;c.rejectUnauthorized=this.rejectUnauthorized;var e=this.xhr=new n(c),d=this;try{w("xhr open %s: %s",this.method,this.uri);e.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var f in e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(f)&&e.setRequestHeader(f,this.extraHeaders[f])}catch(B){}if("POST"===this.method)try{this.isBinary?e.setRequestHeader("Content-type","application/octet-stream"):e.setRequestHeader("Content-type",
"text/plain;charset\x3dUTF-8")}catch(B){}try{e.setRequestHeader("Accept","*/*")}catch(B){}"withCredentials"in e&&(e.withCredentials=!0);this.requestTimeout&&(e.timeout=this.requestTimeout);this.hasXDR()?(e.onload=function(){d.onLoad()},e.onerror=function(){d.onError(e.responseText)}):e.onreadystatechange=function(){if(2===e.readyState){try{var a=e.getResponseHeader("Content-Type")}catch(v){}"application/octet-stream"===a&&(e.responseType="arraybuffer")}4===e.readyState&&(200===e.status||1223===e.status?
d.onLoad():setTimeout(function(){d.onError(e.status)},0))};w("xhr data %s",this.data);e.send(this.data)}catch(B){return void setTimeout(function(){d.onError(B)},0)}a.document&&(this.index=b.requestsCount++,b.requests[this.index]=this)};b.prototype.onSuccess=function(){this.emit("success");this.cleanup()};b.prototype.onData=function(a){this.emit("data",a);this.onSuccess()};b.prototype.onError=function(a){this.emit("error",a);this.cleanup(!0)};b.prototype.cleanup=function(c){if(void 0!==this.xhr&&null!==
this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=f:this.xhr.onreadystatechange=f,c)try{this.xhr.abort()}catch(q){}a.document&&delete b.requests[this.index];this.xhr=null}};b.prototype.onLoad=function(){try{try{var a=this.xhr.getResponseHeader("Content-Type")}catch(m){}var b="application/octet-stream"===a&&this.xhr.response||this.xhr.responseText}catch(m){this.onError(m)}null!=b&&this.onData(b)};b.prototype.hasXDR=function(){return void 0!==a.XDomainRequest&&!this.xs&&this.enablesXDR};b.prototype.abort=
function(){this.cleanup()};b.requestsCount=0;b.requests={};a.document&&(a.attachEvent?a.attachEvent("onunload",e):a.addEventListener&&a.addEventListener("beforeunload",e,!1))}).call(f,function(){return this}())},function(d,f,c){function a(a){var b=a&&a.forceBase64;k&&!b||(this.supportsBinary=!1);h.call(this,a)}var h=c(22),g=c(31),b=c(23);f=c(32);var e=c(33),n=c(3)("engine.io-client:polling");d.exports=a;var k=null!=(new (c(18))({xdomain:!1})).responseType;f(a,h);a.prototype.name="polling";a.prototype.doOpen=
function(){this.poll()};a.prototype.pause=function(a){function b(){n("paused");c.readyState="paused";a()}var c=this;if(this.readyState="pausing",this.polling||!this.writable){var e=0;this.polling&&(n("we are currently polling - waiting to pause"),e++,this.once("pollComplete",function(){n("pre-pause polling complete");--e||b()}));this.writable||(n("we are currently writing - waiting to pause"),e++,this.once("drain",function(){n("pre-pause writing complete");--e||b()}))}else b()};a.prototype.poll=function(){n("polling");
this.polling=!0;this.doPoll();this.emit("poll")};a.prototype.onData=function(a){var c=this;n("polling got data %s",a);b.decodePayload(a,this.socket.binaryType,function(a,b,e){return"opening"===c.readyState&&c.onOpen(),"close"===a.type?(c.onClose(),!1):void c.onPacket(a)});"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():n('ignoring poll - transport state "%s"',this.readyState))};a.prototype.doClose=function(){function a(){n("writing close packet");
b.write([{type:"close"}])}var b=this;"open"===this.readyState?(n("transport open - closing"),a()):(n("transport not open - deferring close"),this.once("open",a))};a.prototype.write=function(a){var c=this;this.writable=!1;var e=function(){c.writable=!0;c.emit("drain")};b.encodePayload(a,this.supportsBinary,function(a){c.doWrite(a,e)})};a.prototype.uri=function(){var a=this.query||{},b=this.secure?"https":"http",c="";!1!==this.timestampRequests&&(a[this.timestampParam]=e());this.supportsBinary||a.sid||
(a.b64=1);a=g.encode(a);this.port&&("https"===b&&443!==Number(this.port)||"http"===b&&80!==Number(this.port))&&(c=":"+this.port);a.length&&(a="?"+a);var d=-1!==this.hostname.indexOf(":");return b+"://"+(d?"["+this.hostname+"]":this.hostname)+c+this.path+a}},function(d,f,c){function a(a){this.path=a.path;this.hostname=a.hostname;this.port=a.port;this.secure=a.secure;this.query=a.query;this.timestampParam=a.timestampParam;this.timestampRequests=a.timestampRequests;this.readyState="";this.agent=a.agent||
!1;this.socket=a.socket;this.enablesXDR=a.enablesXDR;this.pfx=a.pfx;this.key=a.key;this.passphrase=a.passphrase;this.cert=a.cert;this.ca=a.ca;this.ciphers=a.ciphers;this.rejectUnauthorized=a.rejectUnauthorized;this.forceNode=a.forceNode;this.extraHeaders=a.extraHeaders;this.localAddress=a.localAddress}var h=c(23);f=c(8);d.exports=a;f(a.prototype);a.prototype.onError=function(a,b){a=Error(a);return a.type="TransportError",a.description=b,this.emit("error",a),this};a.prototype.open=function(){return"closed"!==
this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this};a.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this};a.prototype.send=function(a){if("open"!==this.readyState)throw Error("Transport not open");this.write(a)};a.prototype.onOpen=function(){this.readyState="open";this.writable=!0;this.emit("open")};a.prototype.onData=function(a){a=h.decodePacket(a,this.socket.binaryType);this.onPacket(a)};
a.prototype.onPacket=function(a){this.emit("packet",a)};a.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},function(d,f,c){(function(a){function d(a,b,c){if(!b)return f.encodeBase64Packet(a,c);if(q)return function(a,b,c){if(!b)return f.encodeBase64Packet(a,c);var e=new FileReader;return e.onload=function(){a.data=e.result;f.encodePacket(a,b,!0,c)},e.readAsArrayBuffer(a.data)}(a,b,c);b=new Uint8Array(1);b[0]=m[a.type];a=new v([b.buffer,a.data]);return c(a)}function g(a,b,
c){var e=Array(a.length);c=t(a.length,c);for(var d=function(a,c,d){b(c,function(b,c){e[a]=c;d(b,e)})},f=0;f<a.length;f++)d(f,a[f],c)}var b,e=c(24),n=c(9),k=c(25),t=c(26),h=c(27);a&&a.ArrayBuffer&&(b=c(29));var w="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),p="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),q=w||p;f.protocol=3;var m=f.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},A=e(m),B={type:"error",data:"parser error"},v=c(30);f.encodePacket=
function(b,c,e,p){"function"==typeof c&&(p=c,c=!1);"function"==typeof e&&(p=e,e=null);var g=void 0===b.data?void 0:b.data.buffer||b.data;if(a.ArrayBuffer&&g instanceof ArrayBuffer){e=p;if(c){p=b.data;c=new Uint8Array(p);p=new Uint8Array(1+p.byteLength);p[0]=m[b.type];for(b=0;b<c.length;b++)p[b+1]=c[b];b=e(p.buffer)}else b=f.encodeBase64Packet(b,e);return b}if(v&&g instanceof a.Blob)return d(b,c,p);if(g&&g.base64)return p("b"+f.packets[b.type]+b.data.data);c=m[b.type];return void 0!==b.data&&(c+=e?
h.encode(String(b.data),{strict:!1}):String(b.data)),p(""+c)};f.encodeBase64Packet=function(b,c){var e="b"+f.packets[b.type];if(v&&b.data instanceof a.Blob){var d=new FileReader;return d.onload=function(){var a=d.result.split(",")[1];c(e+a)},d.readAsDataURL(b.data)}try{var p=String.fromCharCode.apply(null,new Uint8Array(b.data))}catch(G){b=new Uint8Array(b.data);p=Array(b.length);for(var g=0;g<b.length;g++)p[g]=b[g];p=String.fromCharCode.apply(null,p)}return e+=a.btoa(p),c(e)};f.decodePacket=function(a,
b,c){if(void 0===a)return B;if("string"==typeof a){if("b"===a.charAt(0))return f.decodeBase64Packet(a.substr(1),b);if(b=c){try{a=h.decode(a,{strict:!1})}catch(E){a=!1}b=!1===a}if(b)return B;c=a.charAt(0);return Number(c)==c&&A[c]?1<a.length?{type:A[c],data:a.substring(1)}:{type:A[c]}:B}c=(new Uint8Array(a))[0];a=k(a,1);return v&&"blob"===b&&(a=new v([a])),{type:A[c],data:a}};f.decodeBase64Packet=function(a,c){var e=A[a.charAt(0)];if(!b)return{type:e,data:{base64:!0,data:a.substr(1)}};a=b.decode(a.substr(1));
return"blob"===c&&v&&(a=new v([a])),{type:e,data:a}};f.encodePayload=function(a,b,c){"function"==typeof b&&(c=b,b=null);var e=n(a);return b&&e?v&&!q?f.encodePayloadAsBlob(a,c):f.encodePayloadAsArrayBuffer(a,c):a.length?void g(a,function(a,c){f.encodePacket(a,!!e&&b,!1,function(a){c(null,a.length+":"+a)})},function(a,b){return c(b.join(""))}):c("0:")};f.decodePayload=function(a,b,c){if("string"!=typeof a)return f.decodePayloadAsBinary(a,b,c);var e;if("function"==typeof b&&(c=b,b=null),""===a)return c(B,
0,1);for(var d,p,g="",k=0,m=a.length;k<m;k++){var y=a.charAt(k);if(":"===y){if(""===g||g!=(d=Number(g))||(p=a.substr(k+1,d),g!=p.length))return c(B,0,1);if(p.length){if(e=f.decodePacket(p,b,!1),B.type===e.type&&B.data===e.data)return c(B,0,1);if(!1===c(e,k+d,m))return}k+=d;g=""}else g+=y}return""!==g?c(B,0,1):void 0};f.encodePayloadAsArrayBuffer=function(a,b){return a.length?void g(a,function(a,b){f.encodePacket(a,!0,!0,function(a){return b(null,a)})},function(a,c){a=c.reduce(function(a,b){var c;
return c="string"==typeof b?b.length:b.byteLength,a+c.toString().length+c+2},0);var e=new Uint8Array(a),d=0;return c.forEach(function(a){var b="string"==typeof a,c=a;if(b){for(var c=new Uint8Array(a.length),y=0;y<a.length;y++)c[y]=a.charCodeAt(y);c=c.buffer}e[d++]=b?0:1;a=c.byteLength.toString();for(y=0;y<a.length;y++)e[d++]=parseInt(a[y]);e[d++]=255;c=new Uint8Array(c);for(y=0;y<c.length;y++)e[d++]=c[y]}),b(e.buffer)}):b(new ArrayBuffer(0))};f.encodePayloadAsBlob=function(a,b){g(a,function(a,b){f.encodePacket(a,
!0,!0,function(a){var c=new Uint8Array(1);if(c[0]=1,"string"==typeof a){for(var e=new Uint8Array(a.length),d=0;d<a.length;d++)e[d]=a.charCodeAt(d);a=e.buffer;c[0]=0}for(var e=(a instanceof ArrayBuffer?a.byteLength:a.size).toString(),f=new Uint8Array(e.length+1),d=0;d<e.length;d++)f[d]=parseInt(e[d]);if(f[e.length]=255,v)a=new v([c.buffer,f.buffer,a]),b(null,a)})},function(a,c){return b(new v(c))})};f.decodePayloadAsBinary=function(a,b,c){"function"==typeof b&&(c=b,b=null);for(var e=[];0<a.byteLength;){for(var d=
new Uint8Array(a),p=0===d[0],g="",m=1;255!==d[m];m++){if(310<g.length)return c(B,0,1);g+=d[m]}a=k(a,2+g.length);g=parseInt(g);d=k(a,0,g);if(p)try{d=String.fromCharCode.apply(null,new Uint8Array(d))}catch(y){for(p=new Uint8Array(d),d="",m=0;m<p.length;m++)d+=String.fromCharCode(p[m])}e.push(d);a=k(a,g)}var q=e.length;e.forEach(function(a,e){c(f.decodePacket(a,b,!0),e,q)})}}).call(f,function(){return this}())},function(d,f){d.exports=Object.keys||function(c){var a=[],d=Object.prototype.hasOwnProperty,
f;for(f in c)d.call(c,f)&&a.push(f);return a}},function(d,f){d.exports=function(c,a,d){var f=c.byteLength;if(a=a||0,d=d||f,c.slice)return c.slice(a,d);if(0>a&&(a+=f),0>d&&(d+=f),d>f&&(d=f),a>=f||a>=d||0===f)return new ArrayBuffer(0);c=new Uint8Array(c);for(var f=new Uint8Array(d-a),b=0;a<d;a++,b++)f[b]=c[a];return f.buffer}},function(d,f){function c(){}d.exports=function(a,d,f){function b(a,c){if(0>=b.count)throw Error("after called too many times");--b.count;a?(e=!0,d(a),d=f):0!==b.count||e||d(null,
c)}var e=!1;return f=f||c,b.count=a,0===a?d():b}},function(d,f,c){var a;(function(d,g){!function(b){function e(a){for(var b,c,e=[],d=0,f=a.length;d<f;)55296<=(b=a.charCodeAt(d++))&&56319>=b&&d<f?56320==(64512&(c=a.charCodeAt(d++)))?e.push(((1023&b)<<10)+(1023&c)+65536):(e.push(b),d--):e.push(b);return e}function n(a,b){if(55296<=a&&57343>=a){if(b)throw Error("Lone surrogate U+"+a.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function k(){if(p>=w)throw Error("Invalid byte index");
var a=255&h[p];if(p++,128==(192&a))return 63&a;throw Error("Invalid continuation byte");}function t(a){var b,c,e,d,f;if(p>w)throw Error("Invalid byte index");if(p==w)return!1;if(b=255&h[p],p++,0==(128&b))return b;if(192==(224&b)){if(c=k(),128<=(f=(31&b)<<6|c))return f;throw Error("Invalid continuation byte");}if(224==(240&b)){if(c=k(),e=k(),2048<=(f=(15&b)<<12|c<<6|e))return n(f,a)?f:65533;throw Error("Invalid continuation byte");}if(240==(248&b)&&(c=k(),e=k(),d=k(),65536<=(f=(7&b)<<18|c<<12|e<<6|
d)&&1114111>=f))return f;throw Error("Invalid UTF-8 detected");}b=("object"==typeof d&&d&&d.exports,"object"==typeof g&&g);b.global!==b&&b.window;var h,w,p,q=String.fromCharCode,m={version:"2.1.2",encode:function(a,b){b=!1!==(b||{}).strict;a=e(a);for(var c=a.length,d=-1,f="";++d<c;){var p=a[d];var g=b;if(0==(4294967168&p))g=q(p);else{var m="";g=(0==(4294965248&p)?m=q(p>>6&31|192):0==(4294901760&p)?(n(p,g)||(p=65533),m=q(p>>12&15|224),m+=q(p>>6&63|128)):0==(4292870144&p)&&(m=q(p>>18&7|240),m+=q(p>>
12&63|128),m+=q(p>>6&63|128)),m+q(63&p|128))}f+=g}return f},decode:function(a,b){b=!1!==(b||{}).strict;h=e(a);w=h.length;p=0;var c;for(a=[];!1!==(c=t(b));)a.push(c);var d;b=a.length;c=-1;for(var f="";++c<b;)65535<(d=a[c])&&(f+=q((d-=65536)>>>10&1023|55296),d=56320|1023&d),f+=q(d);return f}};void 0===(a=function(){return m}.call(f,c,f,d))||(d.exports=a)}()}).call(f,c(28)(d),function(){return this}())},function(d,f){d.exports=function(c){return c.webpackPolyfill||(c.deprecate=function(){},c.paths=[],
c.children=[],c.webpackPolyfill=1),c}},function(d,f){!function(){for(var c=new Uint8Array(256),a=0;64>a;a++)c["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(a)]=a;f.encode=function(a){var c=new Uint8Array(a),b=c.length,e="";for(a=0;a<b;a+=3)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c[a]>>2],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&c[a])<<4|c[a+1]>>4],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&
c[a+1])<<2|c[a+2]>>6],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&c[a+2]];return 2==b%3?e=e.substring(0,e.length-1)+"\x3d":1==b%3&&(e=e.substring(0,e.length-2)+"\x3d\x3d"),e};f.decode=function(a){var d=.75*a.length;var b=a.length,e=0;"\x3d"===a[a.length-1]&&(d--,"\x3d"===a[a.length-2]&&d--);var f=new ArrayBuffer(d),k=new Uint8Array(f);for(d=0;d<b;d+=4){var t=c[a.charCodeAt(d)];var h=c[a.charCodeAt(d+1)];var w=c[a.charCodeAt(d+2)];var p=c[a.charCodeAt(d+3)];k[e++]=t<<2|
h>>4;k[e++]=(15&h)<<4|w>>2;k[e++]=(3&w)<<6|63&p}return f}}()},function(d,f){(function(c){function a(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.buffer instanceof ArrayBuffer){var e=c.buffer;if(c.byteLength!==e.byteLength){var d=new Uint8Array(c.byteLength);d.set(new Uint8Array(e,c.byteOffset,c.byteLength));e=d.buffer}a[b]=e}}}function f(c,e){e=e||{};var d=new b;a(c);for(var f=0;f<c.length;f++)d.append(c[f]);return e.type?d.getBlob(e.type):d.getBlob()}function g(b,c){return a(b),new Blob(b,c||{})}
var b=c.BlobBuilder||c.WebKitBlobBuilder||c.MSBlobBuilder||c.MozBlobBuilder;try{var e=2===(new Blob(["hi"])).size}catch(t){e=!1}var n;if(n=e)try{n=2===(new Blob([new Uint8Array([1,2])])).size}catch(t){n=!1}var k=b&&b.prototype.append&&b.prototype.getBlob;d.exports=e?n?c.Blob:g:k?f:void 0}).call(f,function(){return this}())},function(d,f){f.encode=function(c){var a="",d;for(d in c)c.hasOwnProperty(d)&&(a.length&&(a+="\x26"),a+=encodeURIComponent(d)+"\x3d"+encodeURIComponent(c[d]));return a};f.decode=
function(c){var a={};c=c.split("\x26");for(var d=0,f=c.length;d<f;d++){var b=c[d].split("\x3d");a[decodeURIComponent(b[0])]=decodeURIComponent(b[1])}return a}},function(d,f){d.exports=function(c,a){var d=function(){};d.prototype=a.prototype;c.prototype=new d;c.prototype.constructor=c}},function(d,f){function c(a){var c="";do c=g[a%b]+c,a=Math.floor(a/b);while(0<a);return c}function a(){var a=c(+new Date);return a!==h?(n=0,h=a):a+"."+c(n++)}for(var h,g="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),
b=64,e={},n=0,k=0;k<b;k++)e[g[k]]=k;a.encode=c;a.decode=function(a){var c=0;for(k=0;k<a.length;k++)c=c*b+e[a.charAt(k)];return c};d.exports=a},function(d,f,c){(function(a){function f(){}function g(c){b.call(this,c);this.query=this.query||{};n||(a.___eio||(a.___eio=[]),n=a.___eio);this.index=n.length;var e=this;n.push(function(a){e.onData(a)});this.query.j=this.index;a.document&&a.addEventListener&&a.addEventListener("beforeunload",function(){e.script&&(e.script.onerror=f)},!1)}var b=c(21),e=c(32);
d.exports=g;var n,k=/\n/g,h=/\\n/g;e(g,b);g.prototype.supportsBinary=!1;g.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null);b.prototype.doClose.call(this)};g.prototype.doPoll=function(){var a=this,b=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);b.async=!0;b.src=this.uri();b.onerror=function(b){a.onError("jsonp poll error",
b)};var c=document.getElementsByTagName("script")[0];c?c.parentNode.insertBefore(b,c):(document.head||document.body).appendChild(b);this.script=b;"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a);document.body.removeChild(a)},100)};g.prototype.doWrite=function(a,b){function c(){e();b()}function e(){if(f.iframe)try{f.form.removeChild(f.iframe)}catch(z){f.onError("jsonp polling iframe removal error",
z)}try{d=document.createElement('\x3ciframe src\x3d"javascript:0" name\x3d"'+f.iframeId+'"\x3e')}catch(z){(d=document.createElement("iframe")).name=f.iframeId,d.src="javascript:0"}d.id=f.iframeId;f.form.appendChild(d);f.iframe=d}var d,f=this;if(!this.form){var g=document.createElement("form"),n=document.createElement("textarea"),t=this.iframeId="eio_iframe_"+this.index;g.className="socketio";g.style.position="absolute";g.style.top="-1000px";g.style.left="-1000px";g.target=t;g.method="POST";g.setAttribute("accept-charset",
"utf-8");n.name="d";g.appendChild(n);document.body.appendChild(g);this.form=g;this.area=n}this.form.action=this.uri();e();a=a.replace(h,"\\\n");this.area.value=a.replace(k,"\\n");try{this.form.submit()}catch(z){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===f.iframe.readyState&&c()}:this.iframe.onload=c}}).call(f,function(){return this}())},function(d,f,c){(function(a){function f(a){a&&a.forceBase64&&(this.supportsBinary=!1);this.perMessageDeflate=a.perMessageDeflate;
this.usingBrowserWebSocket=x&&!a.forceNode;this.protocols=a.protocols;this.usingBrowserWebSocket||(p=l);g.call(this,a)}var g=c(22),b=c(23),e=c(31),n=c(32),k=c(33),h=c(3)("engine.io-client:websocket"),x=a.WebSocket||a.MozWebSocket;if("undefined"==typeof window)try{var l=c(36)}catch(q){}var p=x;p||"undefined"!=typeof window||(p=l);d.exports=f;n(f,g);f.prototype.name="websocket";f.prototype.supportsBinary=!0;f.prototype.doOpen=function(){if(this.check()){var a=this.uri(),b=this.protocols,c={agent:this.agent,
perMessageDeflate:this.perMessageDeflate};c.pfx=this.pfx;c.key=this.key;c.passphrase=this.passphrase;c.cert=this.cert;c.ca=this.ca;c.ciphers=this.ciphers;c.rejectUnauthorized=this.rejectUnauthorized;this.extraHeaders&&(c.headers=this.extraHeaders);this.localAddress&&(c.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?b?new p(a,b):new p(a):new p(a,b,c)}catch(B){return this.emit("error",B)}void 0===this.ws.binaryType&&(this.supportsBinary=!1);this.ws.supports&&this.ws.supports.binary?
(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer";this.addEventListeners()}};f.prototype.addEventListeners=function(){var a=this;this.ws.onopen=function(){a.onOpen()};this.ws.onclose=function(){a.onClose()};this.ws.onmessage=function(b){a.onData(b.data)};this.ws.onerror=function(b){a.onError("websocket error",b)}};f.prototype.write=function(c){var e=this;this.writable=!1;for(var d=c.length,f=0,p=d;f<p;f++)!function(c){b.encodePacket(c,e.supportsBinary,function(b){if(!e.usingBrowserWebSocket){var f=
{};(c.options&&(f.compress=c.options.compress),e.perMessageDeflate)&&("string"==typeof b?a.Buffer.byteLength(b):b.length)<e.perMessageDeflate.threshold&&(f.compress=!1)}try{e.usingBrowserWebSocket?e.ws.send(b):e.ws.send(b,f)}catch(E){h("websocket closed before onclose event")}--d||(e.emit("flush"),setTimeout(function(){e.writable=!0;e.emit("drain")},0))})}(c[f])};f.prototype.onClose=function(){g.prototype.onClose.call(this)};f.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()};f.prototype.uri=
function(){var a=this.query||{},b=this.secure?"wss":"ws",c="";this.port&&("wss"===b&&443!==Number(this.port)||"ws"===b&&80!==Number(this.port))&&(c=":"+this.port);this.timestampRequests&&(a[this.timestampParam]=k());this.supportsBinary||(a.b64=1);(a=e.encode(a)).length&&(a="?"+a);var d=-1!==this.hostname.indexOf(":");return b+"://"+(d?"["+this.hostname+"]":this.hostname)+c+this.path+a};f.prototype.check=function(){return!(!p||"__initialize"in p&&this.name===f.prototype.name)}}).call(f,function(){return this}())},
function(d,f){},function(d,f){var c=[].indexOf;d.exports=function(a,d){if(c)return a.indexOf(d);for(var f=0;f<a.length;++f)if(a[f]===d)return f;return-1}},function(d,f){(function(c){var a=/^[\],:{}\s]*$/,f=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,g=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,b=/(?:^|:|,)(?:\s*\[)+/g,e=/^\s+/,n=/\s+$/;d.exports=function(d){return"string"==typeof d&&d?(d=d.replace(e,"").replace(n,""),c.JSON&&JSON.parse?JSON.parse(d):a.test(d.replace(f,"@").replace(g,
"]").replace(b,""))?(new Function("return "+d))():void 0):null}}).call(f,function(){return this}())},function(d,f,c){function a(a,b,c){this.io=a;this.nsp=b;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=!1;this.disconnected=!0;c&&c.query&&(this.query=c.query);this.io.autoConnect&&this.open()}$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:
function(a){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbol();return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},g=c(7);f=c(8);var b=c(40),e=c(41),n=c(42),k=c(3)("socket.io-client:socket"),t=c(31);d.exports=a;var x={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},l=f.prototype.emit;f(a.prototype);a.prototype.subEvents=
function(){if(!this.subs){var a=this.io;this.subs=[e(a,"open",n(this,"onopen")),e(a,"packet",n(this,"onpacket")),e(a,"close",n(this,"onclose"))]}};a.prototype.open=a.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)};a.prototype.send=function(){var a=b(arguments);return a.unshift("message"),this.emit.apply(this,a),this};a.prototype.emit=function(a){if(x.hasOwnProperty(a))return l.apply(this,
arguments),this;var c=b(arguments),e={type:g.EVENT,data:c,options:{}};return e.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof c[c.length-1]&&(k("emitting packet with ack id %d",this.ids),this.acks[this.ids]=c.pop(),e.id=this.ids++),this.connected?this.packet(e):this.sendBuffer.push(e),delete this.flags,this};a.prototype.packet=function(a){a.nsp=this.nsp;this.io.packet(a)};a.prototype.onopen=function(){if(k("transport is open - connecting"),"/"!==this.nsp)if(this.query){var a=
"object"===h(this.query)?t.encode(this.query):this.query;k("sending connect packet with query %s",a);this.packet({type:g.CONNECT,query:a})}else this.packet({type:g.CONNECT})};a.prototype.onclose=function(a){k("close (%s)",a);this.connected=!1;this.disconnected=!0;delete this.id;this.emit("disconnect",a)};a.prototype.onpacket=function(a){if(a.nsp===this.nsp)switch(a.type){case g.CONNECT:this.onconnect();break;case g.EVENT:case g.BINARY_EVENT:this.onevent(a);break;case g.ACK:case g.BINARY_ACK:this.onack(a);
break;case g.DISCONNECT:this.ondisconnect();break;case g.ERROR:this.emit("error",a.data)}};a.prototype.onevent=function(a){var b=a.data||[];k("emitting event %j",b);null!=a.id&&(k("attaching ack callback to event"),b.push(this.ack(a.id)));this.connected?l.apply(this,b):this.receiveBuffer.push(b)};a.prototype.ack=function(a){var c=this,e=!1;return function(){if(!e){e=!0;var d=b(arguments);k("sending ack %j",d);c.packet({type:g.ACK,id:a,data:d})}}};a.prototype.onack=function(a){var b=this.acks[a.id];
"function"==typeof b?(k("calling ack %s with %j",a.id,a.data),b.apply(this,a.data),delete this.acks[a.id]):k("bad ack %s",a.id)};a.prototype.onconnect=function(){this.connected=!0;this.disconnected=!1;this.emit("connect");this.emitBuffered()};a.prototype.emitBuffered=function(){var a;for(a=0;a<this.receiveBuffer.length;a++)l.apply(this,this.receiveBuffer[a]);this.receiveBuffer=[];for(a=0;a<this.sendBuffer.length;a++)this.packet(this.sendBuffer[a]);this.sendBuffer=[]};a.prototype.ondisconnect=function(){k("server disconnect (%s)",
this.nsp);this.destroy();this.onclose("io server disconnect")};a.prototype.destroy=function(){if(this.subs){for(var a=0;a<this.subs.length;a++)this.subs[a].destroy();this.subs=null}this.io.destroy(this)};a.prototype.close=a.prototype.disconnect=function(){return this.connected&&(k("performing disconnect (%s)",this.nsp),this.packet({type:g.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this};a.prototype.compress=function(a){return this.flags=this.flags||{},this.flags.compress=
a,this}},function(d,f){d.exports=function(c,a){for(var d=[],f=(a=a||0)||0;f<c.length;f++)d[f-a]=c[f];return d}},function(d,f){d.exports=function(c,a,d){return c.on(a,d),{destroy:function(){c.removeListener(a,d)}}}},function(d,f){var c=[].slice;d.exports=function(a,d){if("string"==typeof d&&(d=a[d]),"function"!=typeof d)throw Error("bind() requires a function");var f=c.call(arguments,2);return function(){return d.apply(a,f.concat(c.call(arguments)))}}},function(d,f){function c(a){a=a||{};this.ms=a.min||
100;this.max=a.max||1E4;this.factor=a.factor||2;this.jitter=0<a.jitter&&1>=a.jitter?a.jitter:0;this.attempts=0}d.exports=c;c.prototype.duration=function(){var a=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter)var c=Math.random(),d=Math.floor(c*this.jitter*a),a=0==(1&Math.floor(10*c))?a-d:a+d;return 0|Math.min(a,this.max)};c.prototype.reset=function(){this.attempts=0};c.prototype.setMin=function(a){this.ms=a};c.prototype.setMax=function(a){this.max=a};c.prototype.setJitter=function(a){this.jitter=
a}}])},function(l,r,h){h.r(r);l=h(1);var d=h.n(l),f={addSim:function(a){var b="a\x3dssrc-group:SIM";return a.forEach(function(a){b+=" "+a}),b+"\r\n"},addGroup:function(a,b){return"a\x3dssrc-group:FID "+a+" "+b+"\r\n"},addSpatialLayer:function(a,b,c,e,d,f){return"a\x3dssrc:"+d+" cname:"+a+"\r\n"+("a\x3dssrc:"+d+" msid:"+b+"\r\n")+("a\x3dssrc:"+d+" mslabel:"+c+"\r\n")+("a\x3dssrc:"+d+" label:"+e+"\r\n")+("a\x3dssrc:"+f+" cname:"+a+"\r\n")+("a\x3dssrc:"+f+" msid:"+b+"\r\n")+("a\x3dssrc:"+f+" mslabel:"+
c+"\r\n")+("a\x3dssrc:"+f+" label:"+e+"\r\n")},setMaxBW:function(a,b){if(b.p2p){if(b.video&&b.maxVideoBW){var c=a.getMedia("video");c&&c.setBitrate(b.maxVideoBW)}b.audio&&b.maxAudioBW&&(a=a.getMedia("audio"))&&a.setBitrate(b.maxAudioBW)}},enableOpusNacks:function(a){var b=a.match(/a=rtpmap:(.*)opus.*\r\n/);null!==b&&(a=a.replace(b[0],b[0]+"a\x3drtcp-fb:"+b[1]+"nack\r\n"));return a},setParamForCodecs:function(a,b,c,e){a.medias.forEach(function(a){a.id===b&&a.codecs.forEach(function(a){a.setParam(c,
e)})})}},c=h(0),a=function(a){var b={},e=[],k,g,p,m,n=!1,q=-1;c.a.info("Starting Base stack",a);b.pcConfig={iceServers:[]};b.con={};void 0!==a.iceServers&&(b.pcConfig.iceServers=a.iceServers);!0===a.forceTurn&&(b.pcConfig.iceTransportPolicy="relay");b.audio=a.audio;b.video=a.video;void 0===b.audio&&(b.audio=!0);void 0===b.video&&(b.video=!0);a.remoteCandidates=[];a.localCandidates=[];a.remoteDescriptionSet=!1;b.mediaConstraints={offerToReceiveVideo:void 0!==b.video&&!1!==b.video,offerToReceiveAudio:void 0!==
b.audio&&!1!==b.audio};b.peerConnection=new RTCPeerConnection(b.pcConfig,b.con);var h=function(a,b,e){c.a.error("message:",e,"in baseStack at",a);void 0!==b&&b("error")},t=function(a){c.a.info("Success in BaseStack",a)},v=function(e){k=e;p=d.a.SDPInfo.processString(k.sdp);f.setMaxBW(p,a);k.sdp=p.toString();b.localSdp=p;a.callback({type:k.type,sdp:k.sdp});c.a.info("Setting local description p2p",k);b.peerConnection.setLocalDescription(k).then(t).catch(h)};return b.peerConnection.onicecandidate=function(b){var e=
{};(b=b.candidate)?(e={sdpMLineIndex:b.sdpMLineIndex,sdpMid:b.sdpMid,candidate:b.candidate}).candidate.match(/a=/)||(e.candidate="a\x3d"+e.candidate):(c.a.info("Gathered all candidates. Sending END candidate"),e={sdpMLineIndex:-1,sdpMid:"end",candidate:"end"});a.remoteDescriptionSet?a.callback({type:"candidate",candidate:e}):(a.localCandidates.push(e),c.a.info("Storing candidate: ",a.localCandidates.length,e))},b.setStartVideoBW=function(a){return c.a.error("startVideoBW not implemented for this browser"),
a},b.setHardMinVideoBW=function(a){return c.a.error("hardMinVideoBw not implemented for this browser"),a},b.enableSimulcast=function(a){return c.a.error("Simulcast not implemented"),a},b.close=function(){b.state="closed";b.peerConnection.close()},b.setSimulcast=function(a){b.simulcast=a},b.setVideo=function(a){b.video=a},b.setAudio=function(a){b.audio=a},b.updateSpec=function(e,y,F){F=void 0===F?function(){}:F;var n=!a.p2p&&e.maxVideoBW;(a.p2p&&e.maxVideoBW||e.maxAudioBW)&&(e.maxVideoBW&&(c.a.debug("Maxvideo Requested:",
e.maxVideoBW,"limit:",a.limitMaxVideoBW),e.maxVideoBW>a.limitMaxVideoBW&&(e.maxVideoBW=a.limitMaxVideoBW),a.maxVideoBW=e.maxVideoBW,c.a.debug("Result",a.maxVideoBW)),e.maxAudioBW&&(e.maxAudioBW>a.limitMaxAudioBW&&(e.maxAudioBW=a.limitMaxAudioBW),a.maxAudioBW=e.maxAudioBW),p=d.a.SDPInfo.processString(k.sdp),f.setMaxBW(p,a),k.sdp=p.toString(),b.localSdp=p,e.Sdp||e.maxAudioBW?(c.a.debug("Updating with SDP renegotiation",a.maxVideoBW,a.maxAudioBW),b.peerConnection.setLocalDescription(k).then(function(){return m=
d.a.SDPInfo.processString(g.sdp),f.setMaxBW(m,a),g.sdp=m.toString(),b.remoteSdp=m,b.peerConnection.setRemoteDescription(new RTCSessionDescription(g))}).then(function(){a.remoteDescriptionSet=!0;a.callback({type:"updatestream",sdp:k.sdp},y)}).catch(h.bind(null,"updateSpec",F))):(c.a.debug("Updating without SDP renegotiation, newVideoBW:",a.maxVideoBW,"newAudioBW:",a.maxAudioBW),a.callback({type:"updatestream",sdp:k.sdp},y)));(n||e.minVideoBW||void 0!==e.slideShowMode||void 0!==e.muteStream||void 0!==
e.qualityLayer||void 0!==e.minLayer||void 0!==e.video)&&(c.a.debug("MaxVideoBW Changed to ",e.maxVideoBW),c.a.debug("MinVideo Changed to ",e.minVideoBW),c.a.debug("SlideShowMode Changed to ",e.slideShowMode),c.a.debug("muteStream changed to ",e.muteStream),c.a.debug("Video Constraints",e.video),a.callback({type:"updatestream",config:e},y))},b.createOffer=function(y,g,m){y=void 0===y?!1:y;g=void 0===g?!1:g;m=void 0===m?"":m;y||g||(b.mediaConstraints={offerToReceiveVideo:!1,offerToReceiveAudio:!1});
n?e.push([y,g,m]):(n=!0,c.a.debug("Creating offer",b.mediaConstraints,m),b.peerConnection.createOffer(b.mediaConstraints).then(function(c,e,y){k=y;c||(k.sdp=b.enableSimulcast(k.sdp));p=d.a.SDPInfo.processString(k.sdp);f.setMaxBW(p,a);k.sdp=p.toString();b.localSdp=p;a.callback({type:k.type,sdp:k.sdp,config:{maxVideoBW:a.maxVideoBW}},e)}.bind(null,y,m)).catch(h.bind(null,"Create Offer",void 0)))},b.addStream=function(a){b.peerConnection.addStream(a)},b.processSignalingMessage=function(y){"offer"===
y.type?function(c){m=d.a.SDPInfo.processString(c.sdp);f.setMaxBW(m,a);c.sdp=m.toString();b.remoteSdp=m;b.peerConnection.setRemoteDescription(c).then(function(){b.peerConnection.createAnswer(b.mediaConstraints).then(v).catch(h.bind(null,"createAnswer p2p",void 0));a.remoteDescriptionSet=!0}).catch(h.bind(null,"process Offer",void 0))}(y):"answer"===y.type?function(y){var p=(m=d.a.SDPInfo.processString(y.sdp))&&m.origin&&m.origin.sessionVersion;q>=p||(c.a.info("Set remote and local description"),q=
p,f.setMaxBW(m,a),b.setStartVideoBW(m),b.setHardMinVideoBW(m),y.sdp=m.toString(),c.a.debug("Remote Description",y.sdp),c.a.debug("Local Description",k.sdp),b.remoteSdp=m,g=y,b.peerConnection.setLocalDescription(k).then(function(){b.peerConnection.setRemoteDescription(new RTCSessionDescription(y)).then(function(){a.remoteDescriptionSet=!0;for(c.a.info("Candidates to be added: ",a.remoteCandidates.length,a.remoteCandidates);0<a.remoteCandidates.length;)b.peerConnection.addIceCandidate(a.remoteCandidates.shift());
for(c.a.info("Local candidates to send:",a.localCandidates.length);0<a.localCandidates.length;)a.callback({type:"candidate",candidate:a.localCandidates.shift()});if(n=!1,0<e.length){var d=e.pop();b.createOffer(d[0],d[1],d[2])}}).catch(h.bind(null,"processAnswer",void 0))}).catch(h.bind(null,"processAnswer",void 0)))}(y):"candidate"===y.type&&function(e){try{var d;if("end"!==(d="object"==typeof e.candidate?e.candidate:JSON.parse(e.candidate)).candidate){d.candidate=d.candidate.replace(/a=/g,"");d.sdpMLineIndex=
parseInt(d.sdpMLineIndex,10);var f=new RTCIceCandidate(d);a.remoteDescriptionSet?b.peerConnection.addIceCandidate(f):a.remoteCandidates.push(f)}}catch(P){c.a.error("Error parsing candidate",e.candidate)}}(y)},b},u=function(b){c.a.info("Starting Chrome stable stack",b);var e=a(b);return e.enableSimulcast=function(a){var b=a;if(!e.simulcast)return b;a=b.match(/a=ssrc-group:FID ([0-9]*) ([0-9]*)\r?\n/);if(!a||0>=a.length)return b;var c=e.simulcast.numSpatialLayers||2;var d=parseInt(a[1],10),y=parseInt(a[2],
10),k=b.match(new RegExp("a\x3dssrc:"+a[1]+" cname:(.*)\r?\n"))[1],g=b.match(new RegExp("a\x3dssrc:"+a[1]+" msid:(.*)\r?\n"))[1],m=b.match(new RegExp("a\x3dssrc:"+a[1]+" mslabel:(.*)\r?\n"))[1],p=b.match(new RegExp("a\x3dssrc:"+a[1]+" label:(.*)\r?\n"))[1];b.match(new RegExp("a\x3dssrc:"+a[1]+".*\r?\n","g")).forEach(function(a){b=b.replace(a,"")});b.match(new RegExp("a\x3dssrc:"+a[2]+".*\r?\n","g")).forEach(function(a){b=b.replace(a,"")});for(var F=[d],n=[y],q=1;q<c;q+=1)F.push(d+1E3*q),n.push(y+
1E3*q);c=f.addSim(F);for(q=0;q<F.length;q+=1)d=F[q],y=n[q],c+=f.addGroup(d,y);for(q=0;q<F.length;q+=1)d=F[q],y=n[q],c+=f.addSpatialLayer(k,g,m,p,d,y);return c+="a\x3dx-google-flag:conference\r\n",b.replace(a[0],c)},e.setStartVideoBW=function(a){e.video&&b.startVideoBW&&(c.a.debug("startVideoBW requested: "+b.startVideoBW),f.setParamForCodecs(a,"video","x-google-start-bitrate",b.startVideoBW))},e.setHardMinVideoBW=function(a){e.video&&b.hardMinVideoBW&&(c.a.debug("hardMinVideoBW requested: "+b.hardMinVideoBW),
f.setParamForCodecs(a,"video","x-google-min-bitrate",b.hardMinVideoBW))},e},g=function(b){c.a.info("Starting Firefox stack");var e=a(b),d=[{rid:"low",scaleResolutionDownBy:3},{rid:"med",scaleResolutionDownBy:2},{rid:"high"}],f=function(){if(!e.simulcast)return[];var a=[];return e.peerConnection.getSenders().forEach(function(b){"video"===b.track.kind&&a.push(function(a){var b=e.simulcast.numSpatialLayers||2,c=d.length,b=b<c?b:c,f=a.getParameters()||{};f.encodings=[];for(var y=c-1;y>=c-b;--y)f.encodings.push(d[y]);
return a.setParameters(f)}(b))}),a};e.enableSimulcast=function(a){return a};var k=e.createOffer;return e.createOffer=function(a,b,c){b=void 0===b?!1:b;c=void 0===c?"":c;var e=[];!0!==a&&(e=f());Promise.all(e).then(function(){k(a,b,c)})},e},b=function(a){var b={pcConfig:{},peerConnection:{},desc:{},signalCallback:void 0,close:function(){c.a.info("Close FcStack")},createOffer:function(){c.a.debug("FCSTACK: CreateOffer")},addStream:function(a){c.a.debug("FCSTACK: addStream",a)},processSignalingMessage:function(a){c.a.debug("FCSTACK: processSignaling",
a);void 0!==b.signalCallback&&b.signalCallback(a)},sendSignalingMessage:function(b){c.a.debug("FCSTACK: Sending signaling Message",b);a.callback(b)},setSignalingCallback:function(a){a=void 0===a?function(){}:a;c.a.debug("FCSTACK: Setting signalling callback");b.signalCallback=a}};return b},e=function(){var a={},b={};return a.addEventListener=function(a,c){void 0===b[a]&&(b[a]=[]);b[a].push(c)},a.removeEventListener=function(a,c){b[a]&&(c=b[a].indexOf(c),-1!==c&&b[a].splice(c,1))},a.dispatchEvent=
function(a){if(!a||!a.type)throw Error("Undefined event");c.a.debug("Event: "+a.type);for(var e=b[a.type]||[],d=0;d<e.length;d+=1)e[d](a)},a.on=a.addEventListener,a.off=a.removeEventListener,a.emit=a.dispatchEvent,a},n=function(a){var b={};return b.type=a.type,b},k=function(a){var b=n(a);return b.stream=a.stream,b.state=a.state,b},t=function(a){var b=n(a);return b.streams=a.streams,b.message=a.message,b},x=function(a){var b=n(a);return b.stream=a.stream,b.msg=a.msg,b.bandwidth=a.bandwidth,b.attrs=
a.attrs,b},w=function(){var a={},b={};return a.add=function(a,c){b[a]=c},a.get=function(a){return b[a]},a.has=function(a){return void 0!==b[a]},a.size=function(){return Object.keys(b).length},a.forEach=function(a){for(var c=Object.keys(b),e=0;e<c.length;e+=1){var d=c[e];a(b[d],d)}},a.keys=function(){return Object.keys(b)},a.remove=function(a){delete b[a]},a.clear=function(){b={}},a},p=h(2);l=function(){this.emitter=e()};l.prototype.addEventListener=function(a,b){this.emitter.addEventListener(a,b)};
l.prototype.removeEventListener=function(a,b){this.emitter.removeEventListener(a,b)};l.prototype.dispatchEvent=function(a){this.emitter.dispatchEvent(a)};l.prototype.on=function(a,b){this.addEventListener(a,b)};l.prototype.off=function(a,b){this.removeEventListener(a,b)};l.prototype.emit=function(a){this.dispatchEvent(a)};var q=103,m=function(a,d){this.emitter=e();var f=this;c.a.debug("Building a new Connection");f.stack={};f.erizoId=d;f.streamsMap=w();if(q+=1,a.sessionId=q,f.sessionId=q,f.browser=
p.a.getBrowser(),"fake"===f.browser)c.a.warning("Publish/subscribe video/audio streams not supported in erizofc yet"),f.stack=b(a);else if("mozilla"===f.browser)c.a.debug("Firefox Stack"),f.stack=g(a);else{if("safari"===f.browser)c.a.debug("Safari using Chrome Stable Stack");else{if("chrome-stable"!==f.browser&&"electron"!==f.browser)throw c.a.error("No stack available for this browser"),Error("WebRTC stack not available");c.a.debug("Chrome Stable Stack")}f.stack=u(a)}f.stack.updateSpec||(f.stack.updateSpec=
function(a,b){b=void 0===b?function(){}:b;c.a.error("Update Configuration not implemented in this browser");b("unimplemented")});f.stack.setSignallingCallback||(f.stack.setSignallingCallback=function(){c.a.error("setSignallingCallback is not implemented in this stack")});f.stack.peerConnection&&(f.peerConnection=f.stack.peerConnection,f.stack.peerConnection.onaddstream=function(a){f.emit(k({type:"add-stream",stream:a.stream}))},f.stack.peerConnection.onremovestream=function(a){f.emit(k({type:"remove-stream",
stream:a.stream}))},f.stack.peerConnection.oniceconnectionstatechange=function(a){f.emit(k({type:"ice-state-change",state:a}))});return f};$jscomp.inherits(m,l);m.prototype.close=function(){c.a.debug("Closing ErizoConnection");this.streamsMap.clear();this.stack.close()};m.prototype.createOffer=function(a,b,c){this.stack.createOffer(a,b,c)};m.prototype.addStream=function(a){c.a.debug("message: Adding stream to Connection, streamId: "+a.getID());this.streamsMap.add(a.getID(),a);a.local&&this.stack.addStream(a.stream)};
m.prototype.removeStream=function(a){a=a.getID();this.streamsMap.has(a)?this.streamsMap.remove(a):c.a.warning("message: Cannot remove stream not in map, streamId: "+a)};m.prototype.processSignalingMessage=function(a){this.stack.processSignalingMessage(a)};m.prototype.sendSignalingMessage=function(a){this.stack.sendSignalingMessage(a)};m.prototype.setSimulcast=function(a){this.stack.setSimulcast(a)};m.prototype.setVideo=function(a){this.stack.setVideo(a)};m.prototype.setAudio=function(a){this.stack.setAudio(a)};
m.prototype.updateSpec=function(a,b,c){this.stack.updateSpec(a,b,c)};var A=function(){this.ErizoConnectionsMap=new Map};l=h(19);var B=h.n(l);A.prototype.getOrBuildErizoConnection=function(a,b,e){e=void 0===e?!1:e;c.a.debug("message: getOrBuildErizoConnection, erizoId: "+b);if(void 0===b)return new m(a);if(e){var d;this.ErizoConnectionsMap.has(b)?d=this.ErizoConnectionsMap.get(b):(d={},this.ErizoConnectionsMap.set(b,d));d["single-pc"]||(d["single-pc"]=new m(a,b));e=d["single-pc"]}else(e=new m(a,b),
this.ErizoConnectionsMap.has(b))?this.ErizoConnectionsMap.get(b)[e.sessionId]=e:(d={},d[e.sessionId]=e,this.ErizoConnectionsMap.set(b,d));return a.simulcast&&e.setSimulcast(a.simulcast),a.video&&e.setVideo(a.video),a.audio&&e.setVideo(a.audio),e};A.prototype.maybeCloseConnection=function(a){c.a.debug("Trying to remove connection "+a.sessionId+"\n       with erizoId "+a.erizoId);0===a.streamsMap.size()&&(a.close(),void 0!==this.ErizoConnectionsMap.get(a.erizoId)&&delete this.ErizoConnectionsMap.get(a.erizoId)[a.sessionId])};
var v=function(a){var b=e(),d=function(){},f=[];$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbol();b.CONNECTED=Symbol("connected");b.RECONNECTING=Symbol("reconnecting");b.DISCONNECTED=Symbol("disconnected");var k;b.state=b.DISCONNECTED;b.IO=void 0===a?B.a:a;var g=function(a,c){for(var e=[],d=1;d<arguments.length;++d)e[d-1]=arguments[d];b.emit(function(a,b){a=n({type:a});return a.args=b.args,a}(a,{args:e}))};return b.connect=function(a,e,m,p){m=void 0===m?d:m;p=void 0===p?d:p;var y=1E3,
n=(k=b.IO.connect((a.secure?"wss://":"ws://")+a.host,{reconnection:!0,reconnectionAttempts:3,secure:a.secure,forceNew:!0,transports:["websocket"],rejectUnauthorized:!1})).io.engine.transport.ws.onclose;k.io.engine.transport.ws.onclose=function(a){c.a.warning("WebSocket closed, code:",a.code);y=a.code;n(a)};b.socket=k;k.on("onAddStream",g.bind(b,"onAddStream"));k.on("signaling_message_erizo",g.bind(b,"signaling_message_erizo"));k.on("signaling_message_peer",g.bind(b,"signaling_message_peer"));k.on("publish_me",
g.bind(b,"publish_me"));k.on("unpublish_me",g.bind(b,"unpublish_me"));k.on("onBandwidthAlert",g.bind(b,"onBandwidthAlert"));k.on("onDataStream",g.bind(b,"onDataStream"));k.on("onUpdateAttributeStream",g.bind(b,"onUpdateAttributeStream"));k.on("onRemoveStream",g.bind(b,"onRemoveStream"));k.on("disconnect",function(a){c.a.debug("disconnect",b.id,a);1E3===y?(g("disconnect",a),k.close()):b.state=b.RECONNECTING});k.on("connection_failed",function(a){c.a.error("connection failed, id:",b.id);g("connection_failed",
a)});k.on("error",function(a){c.a.warning("socket error, id:",b.id,", error:",a.message);g("error")});k.on("connect_error",function(a){c.a.warning("connect error, id:",b.id,", error:",a.message)});k.on("connect_timeout",function(a){c.a.warning("connect timeout, id:",b.id,", error:",a.message)});k.on("reconnecting",function(a){c.a.debug("reconnecting, id:",b.id,", attempet:",a)});k.on("reconnect",function(a){c.a.debug("reconnected, id:",b.id,", attempet:",a);b.state=b.CONNECTED;k.emit("reconnected",
b.id);b.state===b.CONNECTED&&f.forEach(function(a){b.sendMessage.apply(b,[].concat($jscomp.arrayFromIterable(a)))})});k.on("reconnect_attempt",function(a){c.a.debug("reconnect attempt, id:",b.id,", attempet:",a)});k.on("reconnect_error",function(a){c.a.debug("error reconnecting, id:",b.id,", error:",a.message)});k.on("reconnect_failed",function(){c.a.warning("reconnect failed, id:",b.id);b.state=b.DISCONNECTED;g("disconnect","reconnect failed")});e.token=a;b.sendMessage("token",e,function(a){b.state=
b.CONNECTED;b.id=a.clientId;m(a)},p)},b.disconnect=function(){b.state=b.DISCONNECTED;k.disconnect()},b.sendMessage=function(a,e,g,m){g=void 0===g?d:g;m=void 0===m?d:m;if(b.state!==b.DISCONNECTED||"token"===a)return b.state===b.RECONNECTING?(D=e,void f.push([a,D,g,m])):void k.emit(a,e,function(a,b){"success"===a?g(b):"error"===a?m(b):g(a,b)});c.a.error("Trying to send a message over a disconnected Socket")},b.sendSDP=function(a,e,f,g){g=void 0===g?d:g;b.state!==b.DISCONNECTED?k.emit(a,e,f,function(a){for(var b=
[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];g.apply(null,[].concat($jscomp.arrayFromIterable(b)))}):c.a.error("Trying to send a message over a disconnected Socket")},b},D,z=function(){var a=e({});return a.url="",a},C=function(a){var b=z({}),c=50;if(b.elementID=a.elementID,b.media=a.media,b.id=a.id,b.stream=a.stream,b.div=document.createElement("div"),b.div.setAttribute("style","width: 40%; height: 100%; max-width: 32px; position: absolute; right: 0;z-index:0;"),b.icon=document.createElement("img"),
b.icon.setAttribute("id","volume_"+b.id),b.icon.setAttribute("src",b.url+"/assets/sound48.png"),b.icon.setAttribute("style","width: 80%; height: 100%; position: absolute;"),b.div.appendChild(b.icon),b.icon.onclick=function(){b.media.muted?(b.media.muted=!1,b.icon.setAttribute("src",b.url+"/assets/sound48.png"),b.stream.local?b.stream.stream.getAudioTracks()[0].enabled=!0:(b.picker.value=c,b.media.volume=b.picker.value/100)):(b.media.muted=!0,b.icon.setAttribute("src",b.url+"/assets/mute48.png"),b.stream.local?
b.stream.stream.getAudioTracks()[0].enabled=!1:(c=b.picker.value,b.picker.value=0,b.media.volume=0))},!b.stream.local){b.picker=document.createElement("input");b.picker.setAttribute("id","picker_"+b.id);b.picker.type="range";b.picker.min=0;b.picker.max=100;b.picker.step=10;b.picker.value=c;b.picker.setAttribute("orient","vertical");b.div.appendChild(b.picker);b.media.volume=b.picker.value/100;b.media.muted=!1;b.picker.oninput=function(){0<b.picker.value?(b.media.muted=!1,b.icon.setAttribute("src",
b.url+"/assets/sound48.png")):(b.media.muted=!0,b.icon.setAttribute("src",b.url+"/assets/mute48.png"));b.media.volume=b.picker.value/100};var e=function(a){b.picker.setAttribute("style","background: transparent; width: 32px;\n                                         height: 100px; position: absolute; bottom: 90%;\n                                         z-index: 1; right: 0px; -webkit-appearance: slider-vertical;\n                                         bottom: "+b.div.offsetHeight+"px; display: "+
a)};b.div.onmouseover=function(){e("block")};b.div.onmouseout=function(){e("none")};e("none")}return document.getElementById(b.elementID).appendChild(b.div),b},E=function(a){var b=z({}),c;b.elementID=a.elementID;b.id=a.id;b.div=document.createElement("div");b.div.setAttribute("id","bar_"+b.id);b.div.setAttribute("class","licode_bar");b.bar=document.createElement("div");b.bar.setAttribute("style","width: 100%; height: 15%; max-height: 30px; position: absolute; bottom: 0; right: 0; background-color: rgba(255,255,255,0.62)");
b.bar.setAttribute("id","subbar_"+b.id);b.bar.setAttribute("class","licode_subbar");b.link=document.createElement("a");b.link.setAttribute("href","http://www.lynckia.com/");b.link.setAttribute("class","licode_link");b.link.setAttribute("target","_blank");b.logo=document.createElement("img");b.logo.setAttribute("style","width: 100%; height: 100%; max-width: 30px; position: absolute; top: 0; left: 2px;");b.logo.setAttribute("class","licode_logo");b.logo.setAttribute("alt","Lynckia");b.logo.setAttribute("src",
b.url+"/assets/star.svg");var e=function(a){var e=a;"block"!==a?e="none":clearTimeout(c);b.div.setAttribute("style","width: 100%; height: 100%; position: relative; bottom: 0; right: 0; display: "+e)};return b.display=function(){e("block")},b.hide=function(){c=setTimeout(e,1E3)},document.getElementById(b.elementID).appendChild(b.div),b.div.appendChild(b.bar),b.bar.appendChild(b.link),b.link.appendChild(b.logo),a.stream.screen||void 0!==a.options&&void 0!==a.options.speaker&&!0!==a.options.speaker||
(b.speaker=C({elementID:"subbar_"+b.id,id:b.id,stream:a.stream,media:a.media})),b.display(),b.hide(),b},I=function(a){var b=z({});b.id=a.id;b.stream=a.stream.stream;b.elementID=a.elementID;var c=function(){b.bar.display()},e=function(){b.bar.hide()},d=function(a,c,e,d){(d?1/a*c>e:1/a*c<e)?(b.video.style.width=c+"px",b.video.style.height=1/a*c+"px",b.video.style.top=-(1/a*c/2-e/2)+"px",b.video.style.left="0px"):(b.video.style.height=e+"px",b.video.style.width=a*e+"px",b.video.style.left=-(a*e/2-c/
2)+"px",b.video.style.top="0px")};return b.destroy=function(){b.video.pause();delete b.resizer;b.parentNode.removeChild(b.div)},b.resize=function(){var c=b.container.offsetWidth,e=b.container.offsetHeight;a.stream.screen||!1===a.options.crop?d(16/9,c,e,!1):c===b.containerWidth&&e===b.containerHeight||d(4/3,c,e,!0);b.containerWidth=c;b.containerHeight=e},b.div=document.createElement("div"),b.div.setAttribute("id","player_"+b.id),b.div.setAttribute("class","licode_player"),b.div.setAttribute("style",
"width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"),!1!==a.options.loader&&(b.loader=document.createElement("img"),b.loader.setAttribute("style","width: 16px; height: 16px; position: absolute; top: 50%; left: 50%; margin-top: -8px; margin-left: -8px"),b.loader.setAttribute("id","back_"+b.id),b.loader.setAttribute("class","licode_loader"),b.loader.setAttribute("src",b.url+"/assets/loader.gif")),b.video=document.createElement("video"),b.video.setAttribute("id",
"stream"+b.id),b.video.setAttribute("class","licode_stream"),b.video.setAttribute("style","width: 100%; height: 100%; position: absolute"),b.video.setAttribute("autoplay","autoplay"),b.video.setAttribute("playsinline","playsinline"),a.stream.local&&(b.video.volume=0),void 0!==b.elementID?"object"==typeof b.elementID&&"function"==typeof b.elementID.appendChild?b.container=b.elementID:b.container=document.getElementById(b.elementID):b.container=document.body,b.container.appendChild(b.div),b.parentNode=
b.div.parentNode,b.loader&&b.div.appendChild(b.loader),b.div.appendChild(b.video),b.containerWidth=0,b.containerHeight=0,!1!==a.options.resizer&&(b.resizer=L.ResizeSensor(b.container,b.resize),b.resize()),!1!==a.options.bar?(b.bar=E({elementID:"player_"+b.id,id:b.id,stream:a.stream,media:b.video,options:a.options}),b.div.onmouseover=c,b.div.onmouseout=e):b.media=b.video,b.video.srcObject=b.stream,b},J=function(a){var b=z({}),c,e;return b.id=a.id,b.stream=a.stream.stream,b.elementID=a.elementID,b.audio=
document.createElement("audio"),b.audio.setAttribute("id","stream"+b.id),b.audio.setAttribute("class","licode_stream"),b.audio.setAttribute("style","width: 100%; height: 100%; position: absolute"),b.audio.setAttribute("autoplay","autoplay"),a.stream.local&&(b.audio.volume=0),void 0!==b.elementID?(b.destroy=function(){b.audio.pause();b.parentNode.removeChild(b.div)},c=function(){b.bar.display()},e=function(){b.bar.hide()},b.div=document.createElement("div"),b.div.setAttribute("id","player_"+b.id),
b.div.setAttribute("class","licode_player"),b.div.setAttribute("style","width: 100%; height: 100%; position: relative; overflow: hidden;"),"object"==typeof b.elementID&&"function"==typeof b.elementID.appendChild?b.container=b.elementID:b.container=document.getElementById(b.elementID),b.container.appendChild(b.div),b.parentNode=b.div.parentNode,b.div.appendChild(b.audio),!1!==a.options.bar?(b.bar=E({elementID:"player_"+b.id,id:b.id,stream:a.stream,media:b.audio,options:a.options}),b.div.onmouseover=
c,b.div.onmouseout=e):b.media=b.audio):(b.destroy=function(){b.audio.pause();b.parentNode.removeChild(b.audio)},document.body.appendChild(b.audio),b.parentNode=document.body),b.audio.srcObject=b.stream,b},G=function(a,b){var d=e(b);d.stream=b.stream;d.url=b.url;d.recording=b.recording;d.room=void 0;d.showing=!1;d.local=!1;d.video=b.video;d.audio=b.audio;d.screen=b.screen;d.videoSize=b.videoSize;d.videoFrameRate=b.videoFrameRate;d.extensionId=b.extensionId;d.desktopStreamId=b.desktopStreamId;d.audioMuted=
!1;d.videoMuted=!1;d.ConnectionHelpers=void 0===a?p.a:a;var f=function(a){a.stream.id===d.getLabel()&&d.emit(x({type:"added",stream:a.stream}))},k=function(a){a.stream.id===d.getLabel()&&d.emit(x({type:"removed",stream:d}))},g=function(a){d.emit(x({type:"icestatechanged",msg:a}))};if(!(void 0===d.videoSize||d.videoSize instanceof Array&&4===d.videoSize.length))throw Error("Invalid Video Size");void 0!==b.local&&!0!==b.local||(d.local=!0);d.getID=function(){return d.local&&!b.streamID?"local":b.streamID};
d.getLabel=function(){return d.stream&&d.stream.id?d.stream.id:b.label};d.getAttributes=function(){return b.attributes};d.setAttributes=function(a){d.local?d.emit(x({type:"internal-set-attributes",stream:d,attrs:a})):c.a.error("Failed to set attributes data. This Stream object has not been published.")};d.updateLocalAttributes=function(a){b.attributes=a};d.hasAudio=function(){return!1!==b.audio&&void 0!==b.audio};d.hasVideo=function(){return!1!==b.video&&void 0!==b.video};d.hasData=function(){return!1!==
b.data&&void 0!==b.data};d.hasScreen=function(){return b.screen};d.hasMedia=function(){return b.audio||b.video||b.screen};d.isExternal=function(){return void 0!==d.url||void 0!==d.recording};d.addPC=function(a,b){if(b)return void 0===d.pc&&(d.pc=w()),d.pc.add(b,a),void a.on("ice-state-change",g);d.pc&&(d.pc.off("add-stream",f),d.pc.off("remove-stream",k),d.pc.off("ice-state-change",g));d.pc=a;d.pc.on("add-stream",f);d.pc.on("remove-stream",k);d.pc.on("ice-state-change",g)};d.sendData=function(a){d.local&&
d.hasData()?d.emit(x({type:"internal-send-data",stream:d,msg:a})):c.a.error("Failed to send data. This Stream object has not been published.")};d.init=function(){try{if((b.audio||b.video||b.screen)&&void 0===b.url){c.a.info("Requested access to local media");var a=b.video;!0===a||!0===b.screen?(a=!0===a?{}:a,void 0!==d.videoSize&&(a.width={min:d.videoSize[0],max:d.videoSize[2]},a.height={min:d.videoSize[1],max:d.videoSize[3]}),void 0!==d.videoFrameRate&&(a.frameRate={min:d.videoFrameRate[0],max:d.videoFrameRate[1]})):
!0===b.screen&&void 0===a&&(a=!0);d.ConnectionHelpers.GetUserMedia({video:a,audio:b.audio,fake:b.fake,screen:b.screen,extensionId:d.extensionId,desktopStreamId:d.desktopStreamId},function(a){c.a.info("User has granted access to local media.");d.stream=a;d.dispatchEvent(x({type:"access-accepted"}));d.stream.getTracks().forEach(function(a){c.a.info("getTracks",a);a.onended=function(){d.stream.getTracks().forEach(function(a){a.onended=null});var b=x({type:"stream-ended",stream:d,msg:a.kind});d.dispatchEvent(b)}})},
function(a){c.a.error("Failed to get access to local media. Error code was "+a.code+".");a=x({type:"access-denied",msg:a});d.dispatchEvent(a)})}else{var e=x({type:"access-accepted"});d.dispatchEvent(e)}}catch(H){c.a.error("Failed to get access to local media. Error was "+H+"."),a=x({type:"access-denied",msg:H}),d.dispatchEvent(a)}};d.close=function(){d.local&&(void 0!==d.room&&d.room.unpublish(d),d.hide(),void 0!==d.stream&&d.stream.getTracks().forEach(function(a){a.onended=null;a.stop()}),d.stream=
void 0);d.pc&&(d.pc.off("add-stream",b.onStreamAddedToPC),d.pc.off("remove-stream",b.onStreamRemovedFroPC),d.pc.off("ice-state-change",b.onICEConnectionStateChange))};d.play=function(a,b){b=b||{};var c;d.elementID=a;d.hasVideo()||d.hasScreen()?void 0!==a&&(c=I({id:d.getID(),stream:d,elementID:a,options:b}),d.player=c,d.showing=!0):d.hasAudio()&&(c=J({id:d.getID(),stream:d,elementID:a,options:b}),d.player=c,d.showing=!0)};d.stop=function(){d.showing&&void 0!==d.player&&(d.player.destroy(),d.showing=
!1)};d.show=d.play;d.hide=d.stop;var m=function(){if(void 0!==d.player&&void 0!==d.stream){var a=d.player.video,b=document.defaultView.getComputedStyle(a),c=parseInt(b.getPropertyValue("width"),10),e=parseInt(b.getPropertyValue("height"),10),f=parseInt(b.getPropertyValue("left"),10),b=parseInt(b.getPropertyValue("top"),10);var k="object"==typeof d.elementID&&"function"==typeof d.elementID.appendChild?d.elementID:document.getElementById(d.elementID);var g=document.defaultView.getComputedStyle(k);k=
parseInt(g.getPropertyValue("width"),10);var g=parseInt(g.getPropertyValue("height"),10),m=document.createElement("canvas");return m.id="testing",m.width=k,m.height=g,m.setAttribute("style","display: none"),m.getContext("2d").drawImage(a,f,b,c,e),m}return null};d.getVideoFrameURL=function(a){var b=m();return null!==b?a?b.toDataURL(a):b.toDataURL():null};d.getVideoFrame=function(){var a=m();return null!==a?a.getContext("2d").getImageData(0,0,a.width,a.height):null};d.checkOptions=function(a,b){!0===
b?(a.audio||a.screen)&&(c.a.warning("Cannot update type of subscription"),a.audio=void 0,a.screen=void 0):!1===d.local&&(!0===a.video&&!1===d.hasVideo()&&(c.a.warning("Trying to subscribe to video when there is no video, won't subscribe to video"),a.video=!1),!0===a.audio&&!1===d.hasAudio()&&(c.a.warning("Trying to subscribe to audio when there is no audio, won't subscribe to audio"),a.audio=!1));!1===d.local&&(d.hasVideo()||!0!==a.slideShowMode||(c.a.warning("Cannot enable slideShowMode if it is not a video subscription, please check your parameters"),
a.slideShowMode=!1))};var n=function(a){a=void 0===a?function(){}:a;if(d.room&&d.room.p2p)return c.a.warning("muteAudio/muteVideo are not implemented in p2p streams"),void a("error");if(d.stream)for(var b=0;b<d.stream.getVideoTracks().length;b+=1)d.stream.getVideoTracks()[b].enabled=!d.videoMuted;b={muteStream:{audio:d.audioMuted,video:d.videoMuted}};d.checkOptions(b,!0);d.pc&&d.pc.updateSpec(b,d.getID(),a)};d.muteAudio=function(a,b){d.audioMuted=a;n(void 0===b?function(){}:b)};d.muteVideo=function(a,
b){d.videoMuted=a;n(void 0===b?function(){}:b)};d._setStaticQualityLayer=function(a,b,e){e=void 0===e?function(){}:e;if(d.room&&d.room.p2p)return c.a.warning("setStaticQualityLayer is not implemented in p2p streams"),void e("error");a={qualityLayer:{spatialLayer:a,temporalLayer:b}};d.checkOptions(a,!0);d.pc.updateSpec(a,d.getID(),e)};d._setDynamicQualityLayer=function(a){if(d.room&&d.room.p2p)return c.a.warning("setDynamicQualityLayer is not implemented in p2p streams"),void a("error");var b={qualityLayer:{spatialLayer:-1,
temporalLayer:-1}};d.checkOptions(b,!0);d.pc.updateSpec(b,d.getID(),a)};d._setMinSpatialLayer=function(a,b){b=void 0===b?function(){}:b;if(d.room&&d.room.p2p)return c.a.warning("setMinSpatialLayer is not implemented in p2p streams"),void b("error");a={minLayer:{spatialLayer:a}};d.checkOptions(a,!0);c.a.debug("Calling updateSpec with config",a);d.pc.updateSpec(a,d.getID(),b)};var q=function(a,b,c){!0!==b&&(b=!1);0<(a=(a="string"==typeof a?[a]:a)instanceof Array?a:[]).length&&d.room.sendControlMessage(d,
"control",{name:"controlhandlers",enable:c,publisherSide:b,handlers:a})};return d.disableHandlers=function(a,b){q(a,b,!1)},d.enableHandlers=function(a,b){q(a,b,!0)},d.updateConfiguration=function(a,b){b=void 0===b?function(){}:b;if(void 0!==a)if(d.pc)if(d.checkOptions(a,!0),d.local)if(d.room.p2p)for(var c=0;c<d.pc.length;c+=1)d.pc[c].updateSpec(a,d.getID(),b);else d.pc.updateSpec(a,d.getID(),b);else d.pc.updateSpec(a,d.getID(),b);else b("This stream has no peerConnection attached, ignoring")},d},
K=function(){for(var a,b,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),d=[],e=0;e<c.length;e+=1)d[c[e]]=e;var f=function(){if(!a||b>=a.length)return-1;var c=255&a.charCodeAt(b);return b+=1,c},k=function(){if(!a)return-1;for(;;){if(b>=a.length)return-1;var c=a.charAt(b);if(b+=1,d[c])return d[c];if("A"===c)return 0}},g=function(a){a=a.toString(16);return 1===a.length&&(a="0"+a),a="%"+a,unescape(a)};return{encodeBase64:function(d){var e;a=d;b=0;d="";var k=Array(3);var g=
0;for(e=!1;!e&&-1!==(k[0]=f());)k[1]=f(),k[2]=f(),d+=c[k[0]>>2],-1!==k[1]?(d+=c[k[0]<<4&48|k[1]>>4],-1!==k[2]?(d+=c[k[1]<<2&60|k[2]>>6],d+=c[63&k[2]]):(d=(d+=c[k[1]<<2&60])+"\x3d",e=!0)):(d=(d=(d+=c[k[0]<<4&48])+"\x3d")+"\x3d",e=!0),76<=(g+=4)&&(d+="\n",g=0);return d},decodeBase64:function(c){var d;a=c;b=0;c="";var e=Array(4);for(d=!1;!d&&-1!==(e[0]=k())&&-1!==(e[1]=k());)e[2]=k(),e[3]=k(),c+=g(e[0]<<2&255|e[1]>>4),-1!==e[2]?(c+=g(e[1]<<4&255|e[2]>>2),-1!==e[3]?c+=g(e[2]<<6&255|e[3]):d=!0):d=!0;return c}}}();
h(25);h(23);h={Room:function(a,b,d,f){var k=e(f);k.remoteStreams=w();k.localStreams=w();k.roomID="";k.state=0;k.p2p=!1;k.ConnectionHelpers=void 0===b?p.a:b;k.erizoConnectionManager=void 0===d?new A:new d.ErizoConnectionManager;var g=v(a);k.socket=g;var m=k.remoteStreams,n=k.localStreams,q=function(a){a.stream&&(a.hide(),a.stop(),a.close(),delete a.stream);a.pc&&(a.local&&k.p2p?a.pc.forEach(function(b,c){b.close();a.pc.remove(c)}):(a.pc.removeStream(a),k.erizoConnectionManager.maybeCloseConnection(a.pc),
delete a.pc))},h=function(a,b){0!==k.state&&a&&!a.failed&&(a.failed=!0,b=x({type:"stream-failed",msg:b||"Stream failed after connection",stream:a}),k.dispatchEvent(b),a.local?k.unpublish(a):k.unsubscribe(a))},D=function(a,b){c.a.info("Stream subscribed");a.stream=b.stream;k.p2p||a.pc.addStream(a);a=x({type:"stream-subscribed",stream:a});k.dispatchEvent(a)},l=function(a,b){return{callback:function(c){g.sendSDP("signaling_message",{streamId:a.getID(),peerSocket:b,msg:c})},audio:a.hasAudio(),video:a.hasVideo(),
iceServers:k.iceServers,maxAudioBW:a.maxAudioBW,maxVideoBW:a.maxVideoBW,limitMaxAudioBW:f.maxAudioBW,limitMaxVideoBW:f.maxVideoBW,forceTurn:a.forceTurn,p2p:!0}},B=function(a,b,d){var e={callback:function(b,d){d=void 0===d?a.getID():d;c.a.info("Sending message",b,a.getID(),d);g.sendSDP("signaling_message",{streamId:d,msg:b,browser:a.pc&&a.pc.browser},void 0,function(){})},nop2p:!0,audio:b.audio&&a.hasAudio(),video:b.video&&a.hasVideo(),maxAudioBW:b.maxAudioBW,maxVideoBW:b.maxVideoBW,limitMaxAudioBW:f.maxAudioBW,
limitMaxVideoBW:f.maxVideoBW,label:a.getLabel(),iceServers:k.iceServers,forceTurn:a.forceTurn,p2p:!1};return d||(e.simulcast=b.simulcast,e.startVideoBW=b.startVideoBW,e.hardMinVideoBW=b.hardMinVideoBW),e},z=function(a){var b=a.stream;a=a.msg;b.local?g.sendMessage("sendDataStream",{id:b.getID(),msg:a}):c.a.error("You can not send data through a remote stream")},u=function(a){var b=a.stream;a=a.attrs;b.local?(b.updateLocalAttributes(a),g.sendMessage("updateStreamAttributes",{id:b.getID(),attrs:a})):
c.a.error("You can not update attributes in a remote stream")};a=function(a,b){b.args?a.apply(null,[].concat($jscomp.arrayFromIterable(b.args))):a()};var r=function(a,b,c){return{state:a,data:b.hasData(),audio:b.hasAudio(),video:b.hasVideo(),label:b.getLabel(),screen:b.hasScreen(),attributes:b.getAttributes(),metadata:c.metadata,createOffer:c.createOffer,muteStream:c.muteStream}},C=function(a,b,d,e){e=void 0===e?function(){}:e;if(null===a)return c.a.error("Error when publishing the stream",d),void e(void 0,
d);c.a.info("Stream published");b.getID=function(){return a};b.on("internal-send-data",z);b.on("internal-set-attributes",u);n.add(a,b);b.room=k;e(a)},y=function(a,b,d){d=void 0===d?function(){}:d;c.a.info("Publishing to Erizo Normally, is createOffer",b.createOffer);var e=r("erizo",a,b);e.minVideoBW=b.minVideoBW;e.maxVideoBW=b.maxVideoBW;e.scheme=b.scheme;g.sendSDP("publish",e,void 0,function(e,g,m){if(null===e)return c.a.error("Error publishing stream",m),void d(void 0,m);C(e,a,m,void 0);(function(a,
b,c){a.addPC(k.erizoConnectionManager.getOrBuildErizoConnection(B(a,c),b,f.singlePC));a.on("icestatechanged",function(b){"failed"===b.state&&h(a)});a.pc.addStream(a);c.createOffer||a.pc.createOffer(!1,f.singlePC,a.getID())})(a,g,b);d(e)})},E=function(a,b,d){d=void 0===d?function(){}:d;b.maxVideoBW=b.maxVideoBW||f.defaultVideoBW;b.maxVideoBW>f.maxVideoBW&&(b.maxVideoBW=f.maxVideoBW);b.audio=void 0===b.audio||b.audio;b.video=void 0===b.video||b.video;b.data=void 0===b.data||b.data;a.checkOptions(b);
var e={streamId:a.getID(),audio:b.audio&&a.hasAudio(),video:function(a,b){a=b&&a.hasVideo();var c=b&&b.width,d=b&&b.height;b=b&&b.frameRate;return c||d||b?{width:c,height:d,frameRate:b}:a}(a,b.video),maxVideoBW:b.maxVideoBW,data:b.data&&a.hasData(),browser:k.ConnectionHelpers.getBrowser(),createOffer:b.createOffer,metadata:b.metadata,muteStream:b.muteStream,slideShowMode:b.slideShowMode};g.sendSDP("subscribe",e,void 0,function(e,g,m){if(null===e)return c.a.error("Error subscribing to stream ",m),
void d(void 0,m);c.a.info("Subscriber added");(function(a,b,c){a.addPC(k.erizoConnectionManager.getOrBuildErizoConnection(B(a,c,!0),b,f.singlePC));a.on("added",D.bind(null,a));a.on("icestatechanged",function(b){"failed"===b.state&&h(a)});a.pc.createOffer(!0,!1,a.getID())})(a,g,b);d(!0)})};return k.connect=function(a){a=void 0===a?{}:a;var b=K.decodeBase64(f.token);0!==k.state&&c.a.warning("Room already connected");k.state=1;g.connect(JSON.parse(b),a,function(a){var b=[],d=a.streams||[],e=a.id;k.p2p=
a.p2p;k.iceServers=a.iceServers;k.state=2;f.singlePC=a.singlePC;f.defaultVideoBW=a.defaultVideoBW;f.maxVideoBW=a.maxVideoBW;for(var g=Object.keys(d),p=0;p<g.length;p+=1){var n=d[g[p]];a=G(k.ConnectionHelpers,{streamID:n.id,local:!1,audio:n.audio,video:n.video,data:n.data,label:n.label,screen:n.screen,attributes:n.attributes});b.push(a);m.add(n.id,a)}k.roomID=e;c.a.info("Connected to room "+k.roomID);b=t({type:"room-connected",streams:b});k.dispatchEvent(b)},function(a){c.a.error("Not Connected! Error: "+
a);a=t({type:"room-error",message:a});k.dispatchEvent(a)})},k.disconnect=function(){c.a.debug("Disconnection requested");var a=t({type:"room-disconnected",message:"expected-disconnection"});k.dispatchEvent(a)},k.publish=function(a,b,d){b=void 0===b?{}:b;d=void 0===d?function(){}:d;b.maxVideoBW=b.maxVideoBW||f.defaultVideoBW;b.maxVideoBW>f.maxVideoBW&&(b.maxVideoBW=f.maxVideoBW);void 0===b.minVideoBW&&(b.minVideoBW=0);b.minVideoBW>f.defaultVideoBW&&(b.minVideoBW=f.defaultVideoBW);a.forceTurn=b.forceTurn;
b.simulcast=b.simulcast||!1;b.muteStream={audio:a.audioMuted,video:a.videoMuted};a&&a.local&&!a.failed&&!n.has(a.getID())?a.hasMedia()?a.isExternal()?function(a,b,d){d=void 0===d?function(){}:d;var e,f;a.url?(e="url",f=a.url):(e="recording",f=a.recording);c.a.info("Checking publish options for",a.getID());a.checkOptions(b);g.sendSDP("publish",r(e,a,b),f,function(b,c){C(b,a,c,d)})}(a,b,d):k.p2p?function(a,b,c){c=void 0===c?function(){}:c;a.maxAudioBW=b.maxAudioBW;a.maxVideoBW=b.maxVideoBW;g.sendSDP("publish",
r("p2p",a,b),void 0,function(b,d){C(b,a,d,c)})}(a,b,d):y(a,b,d):a.hasData()&&function(a,b,c){c=void 0===c?function(){}:c;g.sendSDP("publish",r("data",a,b),void 0,function(b,d){C(b,a,d,c)})}(a,b,d):(c.a.error("Trying to publish invalid stream"),d(void 0,"Invalid Stream"))},k.startRecording=function(a,b){var d=function(){},e="mkv",f=null;if("function"==typeof b?d=b:"object"==typeof b&&(d=b.callback||d,e=b.extension||e,f=b.url||f),void 0===a)return c.a.error("Trying to start recording on an invalid stream",
a),void d(void 0,"Invalid Stream");c.a.debug("Start Recording stream: "+a.getID());g.sendMessage("startRecorder",{to:a.getID(),extension:e,url:f},function(a,b){if(null===a)return c.a.error("Error on start recording",b),void d(void 0,b);c.a.info("Start recording",a);d(a)})},k.stopRecording=function(a,b){b=void 0===b?function(){}:b;g.sendMessage("stopRecorder",{id:a},function(d,e){if(null===d)return c.a.error("Error on stop recording",e),void b(void 0,e);c.a.info("Stop recording",a);b(!0)})},k.unpublish=
function(a,b){b=void 0===b?function(){}:b;a&&a.local?(g.sendMessage("unpublish",a.getID(),function(d,e){if(null===d)return c.a.error("Error unpublishing stream",e),void b(void 0,e);delete a.failed;c.a.info("Stream unpublished");b(!0)}),a.room=void 0,a.hasMedia()&&!a.isExternal()&&q(a),n.remove(a.getID()),a.getID=function(){},a.off("internal-send-data",z),a.off("internal-set-attributes",u)):(c.a.error("Cannot unpublish, stream does not exist or is not local"),b(void 0,"Cannot unpublish, stream does not exist or is not local"))},
k.sendControlMessage=function(a,b,c){a&&a.getID()&&(b={type:"control",action:c},g.sendSDP("signaling_message",{streamId:a.getID(),msg:b}))},k.subscribe=function(a,b,d){b=void 0===b?{}:b;d=void 0===d?function(){}:d;if(!a||a.local||a.failed)b="Error on subscribe",a?a.local?(c.a.warning("Cannot subscribe to local stream, you should subscribe to the remote version of your local stream"),b="Local copy of stream"):a.failed&&(c.a.warning("Cannot subscribe to failed stream."),b="Failed stream"):(c.a.warning("Cannot subscribe to invalid stream"),
b="Invalid or undefined stream"),d(void 0,b);else{if(a.hasMedia())a.hasVideo()||a.hasScreen()||(b.video=!1),a.hasAudio()||(b.audio=!1),b.muteStream={audio:a.audioMuted,video:a.videoMuted},a.forceTurn=b.forceTurn,k.p2p?(g.sendSDP("subscribe",{streamId:a.getID(),metadata:b.metadata}),d(!0)):E(a,b,d);else{if(!a.hasData()||!1===b.data)return c.a.warning("There's nothing to subscribe to"),void d(void 0,"Nothing to subscribe to");(function(a,b,d){d=void 0===d?function(){}:d;g.sendSDP("subscribe",{streamId:a.getID(),
data:b.data,metadata:b.metadata},void 0,function(b,e){if(null===b)return c.a.error("Error subscribing to stream ",e),void d(void 0,e);c.a.info("Stream subscribed");b=x({type:"stream-subscribed",stream:a});k.dispatchEvent(b);d(!0)})})(a,b,d)}c.a.info("Subscribing to: "+a.getID())}},k.unsubscribe=function(a,b){b=void 0===b?function(){}:b;void 0!==g&&a&&!a.local&&g.sendMessage("unsubscribe",a.getID(),function(c,d){null!==c?(q(a),delete a.failed,b(!0)):b(void 0,d)},function(){c.a.error("Error calling unsubscribe.")})},
k.getStreamStats=function(a,b){b=void 0===b?function(){}:b;return g?a?void g.sendMessage("getStreamStats",a.getID(),function(a){a&&b(a)}):"Error getting stats - no stream":"Error getting stats - no socket"},k.getStreamsByAttribute=function(a,b){var c=[];return m.forEach(function(d){void 0!==d.getAttributes()&&d.getAttributes()[a]===b&&c.push(d)}),c},k.on("room-disconnected",function(){k.state=0;g.state=g.DISCONNECTED;m.forEach(function(a,b){if(q(a),m.remove(b),a&&!a.failed)a=x({type:"stream-removed",
stream:a}),k.dispatchEvent(a)});m=w();n.forEach(function(a,b){q(a);n.remove(b)});n=w();try{g.disconnect()}catch(Q){c.a.debug("Socket already disconnected")}g=void 0}),g.on("onAddStream",a.bind(null,function(a){if(!m.has(a.id)){var b=G(k.Connection,{streamID:a.id,local:!1,audio:a.audio,video:a.video,data:a.data,label:a.label,screen:a.screen,attributes:a.attributes});b.room=k;m.add(a.id,b);a=x({type:"stream-added",stream:b});k.dispatchEvent(a)}})),g.on("signaling_message_erizo",a.bind(null,function(a){var b;
(b=a.peerId?m.get(a.peerId):n.get(a.streamId))&&b.pc&&!b.failed&&b.pc.processSignalingMessage(a.mess)})),g.on("signaling_message_peer",a.bind(null,function(a){var b=n.get(a.streamId);b&&!b.failed?b.pc.get(a.peerSocket).processSignalingMessage(a.msg):((b=m.get(a.streamId)).pc||function(a,b){a.addPC(k.erizoConnectionManager.getOrBuildErizoConnection(l(a,b)));a.on("added",D.bind(null,a));a.on("icestatechanged",function(b){"failed"===b.state&&h(a)})}(b,a.peerSocket),b.pc.processSignalingMessage(a.msg))})),
g.on("publish_me",a.bind(null,function(a){(function(a,b){var c=k.erizoConnectionManager.getOrBuildErizoConnection(l(a,b));a.addPC(c,b);a.on("icestatechanged",function(c){"failed"===c.state&&(a.pc.get(b).close(),a.pc.remove(b))});c.addStream(a);c.createOffer()})(n.get(a.streamId),a.peerSocket)})),g.on("unpublish_me",a.bind(null,function(a){var b=n.get(a.streamId);b&&(a=a.peerSocket,void 0!==b.pc&&b.pc.has(a)&&(b.pc.get(a).close(),b.pc.remove(a)))})),g.on("onBandwidthAlert",a.bind(null,function(a){if(c.a.info("Bandwidth Alert on",
a.streamID,"message",a.message,"BW:",a.bandwidth),a.streamID){var b=m.get(a.streamID);b&&!b.failed&&(a=x({type:"bandwidth-alert",stream:b,msg:a.message,bandwidth:a.bandwidth}),b.dispatchEvent(a))}})),g.on("onDataStream",a.bind(null,function(a){var b=m.get(a.id);a=x({type:"stream-data",msg:a.msg,stream:b});b.dispatchEvent(a)})),g.on("onUpdateAttributeStream",a.bind(null,function(a){var b=m.get(a.id),c=x({type:"stream-attributes-update",attrs:a.attrs,stream:b});b.updateLocalAttributes(a.attrs);b.dispatchEvent(c)})),
g.on("onRemoveStream",a.bind(null,function(a){var b=n.get(a.id);if(b)h(b);else if(b=m.get(a.id))q(b),m.remove(a.id),a=x({type:"stream-removed",stream:b}),k.dispatchEvent(a)})),g.on("disconnect",a.bind(null,function(){if(c.a.info("Socket disconnected, lost connection to ErizoController"),0!==k.state){c.a.error("Unexpected disconnection from ErizoController");var a=t({type:"room-disconnected",message:"unexpected-disconnection"});k.dispatchEvent(a)}})),g.on("connection_failed",a.bind(null,function(a){if(a.streamId){var b=
"ICE Connection Failed on "+a.type+" "+a.streamId+" "+k.state;c.a.error(b);a="publish"===a.type?n.get(a.streamId):m.get(a.streamId);h(a,b)}})),g.on("error",a.bind(null,function(a){c.a.error("Cannot connect to erizo Controller");a=t({type:"room-error",message:a});k.dispatchEvent(a)})),k}.bind(null,void 0,void 0,void 0),LicodeEvent:n,RoomEvent:t,StreamEvent:x,Stream:G.bind(null,void 0),Logger:c.a};r.default=h},function(l,r){l.exports="/* globals $$, jQuery, Elements, document, window, L */\n\n/**\n* Copyright 2013 Marc J. Schmidt. See the LICENSE file at the top-level\n* directory of this distribution and at\n* https://github.com/marcj/css-element-queries/blob/master/LICENSE.\n*/\nthis.L \x3d this.L || {};\n\n/**\n * @param {HTMLElement} element\n * @param {String}      prop\n * @returns {String|Number}\n */\nL.GetComputedStyle \x3d (computedElement, prop) \x3d\x3e {\n  if (computedElement.currentStyle) {\n    return computedElement.currentStyle[prop];\n  } else if (window.getComputedStyle) {\n    return window.getComputedStyle(computedElement, null).getPropertyValue(prop);\n  }\n  return computedElement.style[prop];\n};\n\n  /**\n   *\n   * @type {Function}\n   * @constructor\n   */\nL.ElementQueries \x3d function ElementQueries() {\n      /**\n       *\n       * @param element\n       * @returns {Number}\n       */\n  function getEmSize(element \x3d document.documentElement) {\n    const fontSize \x3d L.GetComputedStyle(element, 'fontSize');\n    return parseFloat(fontSize) || 16;\n  }\n\n      /**\n       *\n       * @copyright https://github.com/Mr0grog/element-query/blob/master/LICENSE\n       *\n       * @param element\n       * @param value\n       * @param units\n       * @returns {*}\n       */\n  function convertToPx(element, originalValue) {\n    let vh;\n    let vw;\n    let chooser;\n    const units \x3d originalValue.replace(/[0-9]*/, '');\n    const value \x3d parseFloat(originalValue);\n    switch (units) {\n      case 'px':\n        return value;\n      case 'em':\n        return value * getEmSize(element);\n      case 'rem':\n        return value * getEmSize();\n              // Viewport units!\n              // According to http://quirksmode.org/mobile/tableViewport.html\n              // documentElement.clientWidth/Height gets us the most reliable info\n      case 'vw':\n        return (value * document.documentElement.clientWidth) / 100;\n      case 'vh':\n        return (value * document.documentElement.clientHeight) / 100;\n      case 'vmin':\n      case 'vmax':\n        vw \x3d document.documentElement.clientWidth / 100;\n        vh \x3d document.documentElement.clientHeight / 100;\n        chooser \x3d Math[units \x3d\x3d\x3d 'vmin' ? 'min' : 'max'];\n        return value * chooser(vw, vh);\n      default:\n        return value;\n              // for now, not supporting physical units (since they are just a set number of px)\n              // or ex/ch (getting accurate measurements is hard)\n    }\n  }\n\n      /**\n       *\n       * @param {HTMLElement} element\n       * @constructor\n       */\n  function SetupInformation(element) {\n    this.element \x3d element;\n    this.options \x3d [];\n    let i;\n    let j;\n    let option;\n    let width \x3d 0;\n    let height \x3d 0;\n    let value;\n    let actualValue;\n    let attrValues;\n    let attrValue;\n    let attrName;\n\n          /**\n           * @param option {mode: 'min|max', property: 'width|height', value: '123px'}\n           */\n    this.addOption \x3d (newOption) \x3d\x3e {\n      this.options.push(newOption);\n    };\n\n    const attributes \x3d ['min-width', 'min-height', 'max-width', 'max-height'];\n\n          /**\n           * Extracts the computed width/height and sets to min/max- attribute.\n           */\n    this.call \x3d () \x3d\x3e {\n              // extract current dimensions\n      width \x3d this.element.offsetWidth;\n      height \x3d this.element.offsetHeight;\n\n      attrValues \x3d {};\n\n      for (i \x3d 0, j \x3d this.options.length; i \x3c j; i +\x3d 1) {\n        option \x3d this.options[i];\n        value \x3d convertToPx(this.element, option.value);\n\n        actualValue \x3d option.property \x3d\x3d\x3d 'width' ? width : height;\n        attrName \x3d `${option.mode}-${option.property}`;\n        attrValue \x3d '';\n\n        if (option.mode \x3d\x3d\x3d 'min' \x26\x26 actualValue \x3e\x3d value) {\n          attrValue +\x3d option.value;\n        }\n\n        if (option.mode \x3d\x3d\x3d 'max' \x26\x26 actualValue \x3c\x3d value) {\n          attrValue +\x3d option.value;\n        }\n\n        if (!attrValues[attrName]) attrValues[attrName] \x3d '';\n        if (attrValue \x26\x26 (` ${attrValues[attrName]} `)\n                                            .indexOf(` ${attrValue} `) \x3d\x3d\x3d -1) {\n          attrValues[attrName] +\x3d ` ${attrValue}`;\n        }\n      }\n\n      for (let k \x3d 0; k \x3c attributes.length; k +\x3d 1) {\n        if (attrValues[attributes[k]]) {\n          this.element.setAttribute(attributes[k],\n                                                attrValues[attributes[k]].substr(1));\n        } else {\n          this.element.removeAttribute(attributes[k]);\n        }\n      }\n    };\n  }\n\n      /**\n       * @param {HTMLElement} element\n       * @param {Object}      options\n       */\n  function setupElement(originalElement, options) {\n    const element \x3d originalElement;\n    if (element.elementQueriesSetupInformation) {\n      element.elementQueriesSetupInformation.addOption(options);\n    } else {\n      element.elementQueriesSetupInformation \x3d new SetupInformation(element);\n      element.elementQueriesSetupInformation.addOption(options);\n      element.sensor \x3d new L.ResizeSensor(element, () \x3d\x3e {\n        element.elementQueriesSetupInformation.call();\n      });\n    }\n    element.elementQueriesSetupInformation.call();\n    return element;\n  }\n\n      /**\n       * @param {String} selector\n       * @param {String} mode min|max\n       * @param {String} property width|height\n       * @param {String} value\n       */\n  function queueQuery(selector, mode, property, value) {\n    let query;\n    if (document.querySelectorAll) query \x3d document.querySelectorAll.bind(document);\n    if (!query \x26\x26 typeof $$ !\x3d\x3d 'undefined') query \x3d $$;\n    if (!query \x26\x26 typeof jQuery !\x3d\x3d 'undefined') query \x3d jQuery;\n\n    if (!query) {\n      throw new Error('No document.querySelectorAll, jQuery or Mootools\\'s $$ found.');\n    }\n\n    const elements \x3d query(selector) || [];\n    for (let i \x3d 0, j \x3d elements.length; i \x3c j; i +\x3d 1) {\n      elements[i] \x3d setupElement(elements[i], {\n        mode,\n        property,\n        value,\n      });\n    }\n  }\n\n  const regex \x3d /,?([^,\\n]*)\\[[\\s\\t]*(min|max)-(width|height)[\\s\\t]*[~$^]?\x3d[\\s\\t]*\"([^\"]*)\"[\\s\\t]*]([^\\n\\s{]*)/mgi;  // jshint ignore:line\n\n      /**\n       * @param {String} css\n       */\n  function extractQuery(originalCss) {\n    let match;\n    const css \x3d originalCss.replace(/'/g, '\"');\n    while ((match \x3d regex.exec(css)) !\x3d\x3d null) {\n      if (match.length \x3e 5) {\n        queueQuery(match[1] || match[5], match[2], match[3], match[4]);\n      }\n    }\n  }\n\n      /**\n       * @param {CssRule[]|String} rules\n       */\n  function readRules(originalRules) {\n    if (!originalRules) {\n      return;\n    }\n    let selector \x3d '';\n    let rules \x3d originalRules;\n    if (typeof originalRules \x3d\x3d\x3d 'string') {\n      rules \x3d originalRules.toLowerCase();\n      if (rules.indexOf('min-width') !\x3d\x3d -1 || rules.indexOf('max-width') !\x3d\x3d -1) {\n        extractQuery(rules);\n      }\n    } else {\n      for (let i \x3d 0, j \x3d rules.length; i \x3c j; i +\x3d 1) {\n        if (rules[i].type \x3d\x3d\x3d 1) {\n          selector \x3d rules[i].selectorText || rules[i].cssText;\n          if (selector.indexOf('min-height') !\x3d\x3d -1 ||\n                          selector.indexOf('max-height') !\x3d\x3d -1) {\n            extractQuery(selector);\n          } else if (selector.indexOf('min-width') !\x3d\x3d -1 ||\n                                 selector.indexOf('max-width') !\x3d\x3d -1) {\n            extractQuery(selector);\n          }\n        } else if (rules[i].type \x3d\x3d\x3d 4) {\n          readRules(rules[i].cssRules || rules[i].rules);\n        }\n      }\n    }\n  }\n\n      /**\n       * Searches all css rules and setups the event listener\n       * to all elements with element query rules..\n       */\n  this.init \x3d () \x3d\x3e {\n    const styleSheets \x3d document.styleSheets || [];\n    for (let i \x3d 0, j \x3d styleSheets.length; i \x3c j; i +\x3d 1) {\n      if (Object.prototype.hasOwnProperty.call(styleSheets[i], 'cssText')) {\n        readRules(styleSheets[i].cssText);\n      } else if (Object.prototype.hasOwnProperty.call(styleSheets[i], 'cssRules')) {\n        readRules(styleSheets[i].cssRules);\n      } else if (Object.prototype.hasOwnProperty.call(styleSheets[i], 'rules')) {\n        readRules(styleSheets[i].rules);\n      }\n    }\n  };\n};\n\nfunction init() {\n  (new L.ElementQueries()).init();\n}\n\nif (window.addEventListener) {\n  window.addEventListener('load', init, false);\n} else {\n  window.attachEvent('onload', init);\n}\n\n  /**\n   * Iterate over each of the provided element(s).\n   *\n   * @param {HTMLElement|HTMLElement[]} elements\n   * @param {Function}                  callback\n   */\nfunction forEachElement(elements, callback \x3d () \x3d\x3e {}) {\n  const elementsType \x3d Object.prototype.toString.call(elements);\n  const isCollectionTyped \x3d (elementsType \x3d\x3d\x3d '[object Array]' ||\n          (elementsType \x3d\x3d\x3d '[object NodeList]') ||\n          (elementsType \x3d\x3d\x3d '[object HTMLCollection]') ||\n          (typeof jQuery !\x3d\x3d 'undefined' \x26\x26 elements instanceof jQuery) || // jquery\n          (typeof Elements !\x3d\x3d 'undefined' \x26\x26 elements instanceof Elements) // mootools\n      );\n  let i \x3d 0;\n  const j \x3d elements.length;\n  if (isCollectionTyped) {\n    for (; i \x3c j; i +\x3d 1) {\n      callback(elements[i]);\n    }\n  } else {\n    callback(elements);\n  }\n}\n  /**\n   * Class for dimension change detection.\n   *\n   * @param {Element|Element[]|Elements|jQuery} element\n   * @param {Function} callback\n   *\n   * @constructor\n   */\nL.ResizeSensor \x3d function ResizeSensor(element, callback \x3d () \x3d\x3e {}) {\n      /**\n       *\n       * @constructor\n       */\n  function EventQueue() {\n    let q \x3d [];\n    this.add \x3d (ev) \x3d\x3e {\n      q.push(ev);\n    };\n\n    let i;\n    let j;\n    this.call \x3d () \x3d\x3e {\n      for (i \x3d 0, j \x3d q.length; i \x3c j; i +\x3d 1) {\n        q[i].call();\n      }\n    };\n\n    this.remove \x3d (ev) \x3d\x3e {\n      const newQueue \x3d [];\n      for (i \x3d 0, j \x3d q.length; i \x3c j; i +\x3d 1) {\n        if (q[i] !\x3d\x3d ev) newQueue.push(q[i]);\n      }\n      q \x3d newQueue;\n    };\n\n    this.length \x3d () \x3d\x3e q.length;\n  }\n\n      /**\n       *\n       * @param {HTMLElement} element\n       * @param {Function}    resized\n       */\n  function attachResizeEvent(htmlElement, resized) {\n    // Only used for the dirty checking, so the event callback count is limted\n    //  to max 1 call per fps per sensor.\n    // In combination with the event based resize sensor this saves cpu time,\n    // because the sensor is too fast and\n    // would generate too many unnecessary events.\n    const customRequestAnimationFrame \x3d window.requestAnimationFrame ||\n    window.mozRequestAnimationFrame ||\n    window.webkitRequestAnimationFrame ||\n    function delay(fn) {\n      return window.setTimeout(fn, 20);\n    };\n\n    const newElement \x3d htmlElement;\n    if (!newElement.resizedAttached) {\n      newElement.resizedAttached \x3d new EventQueue();\n      newElement.resizedAttached.add(resized);\n    } else if (newElement.resizedAttached) {\n      newElement.resizedAttached.add(resized);\n      return;\n    }\n\n    newElement.resizeSensor \x3d document.createElement('div');\n    newElement.resizeSensor.className \x3d 'resize-sensor';\n    const style \x3d 'position: absolute; left: 0; top: 0; right: 0; bottom: 0; ' +\n                      'overflow: hidden; z-index: -1; visibility: hidden;';\n    const styleChild \x3d 'position: absolute; left: 0; top: 0; transition: 0s;';\n\n    newElement.resizeSensor.style.cssText \x3d style;\n    newElement.resizeSensor.innerHTML \x3d\n              `\x3cdiv class\x3d\"resize-sensor-expand\" style\x3d\"${style}\"\x3e` +\n                  `\x3cdiv style\x3d\"${styleChild}\"\x3e\x3c/div\x3e` +\n              '\x3c/div\x3e' +\n              `\x3cdiv class\x3d\"resize-sensor-shrink\" style\x3d\"${style}\"\x3e` +\n                  `\x3cdiv style\x3d\"${styleChild} width: 200%; height: 200%\"\x3e\x3c/div\x3e` +\n              '\x3c/div\x3e';\n    newElement.appendChild(newElement.resizeSensor);\n\n    if (L.GetComputedStyle(newElement, 'position') \x3d\x3d\x3d 'static') {\n      newElement.style.position \x3d 'relative';\n    }\n\n    const expand \x3d newElement.resizeSensor.childNodes[0];\n    const expandChild \x3d expand.childNodes[0];\n    const shrink \x3d newElement.resizeSensor.childNodes[1];\n\n    const reset \x3d () \x3d\x3e {\n      expandChild.style.width \x3d `${100000}px`;\n      expandChild.style.height \x3d `${100000}px`;\n\n      expand.scrollLeft \x3d 100000;\n      expand.scrollTop \x3d 100000;\n\n      shrink.scrollLeft \x3d 100000;\n      shrink.scrollTop \x3d 100000;\n    };\n\n    reset();\n    let dirty \x3d false;\n\n    const dirtyChecking \x3d () \x3d\x3e {\n      if (!newElement.resizedAttached) return;\n\n      if (dirty) {\n        newElement.resizedAttached.call();\n        dirty \x3d false;\n      }\n\n      customRequestAnimationFrame(dirtyChecking);\n    };\n\n    customRequestAnimationFrame(dirtyChecking);\n    let lastWidth;\n    let lastHeight;\n    let cachedWidth;\n    let cachedHeight; // useful to not query offsetWidth twice\n\n    const onScroll \x3d () \x3d\x3e {\n      if ((cachedWidth \x3d newElement.offsetWidth) !\x3d\x3d lastWidth ||\n                (cachedHeight \x3d newElement.offsetHeight) !\x3d\x3d lastHeight) {\n        dirty \x3d true;\n\n        lastWidth \x3d cachedWidth;\n        lastHeight \x3d cachedHeight;\n      }\n      reset();\n    };\n\n    const addEvent \x3d (el, name, cb) \x3d\x3e {\n      if (el.attachEvent) {\n        el.attachEvent(`on${name}`, cb);\n      } else {\n        el.addEventListener(name, cb);\n      }\n    };\n\n    addEvent(expand, 'scroll', onScroll);\n    addEvent(shrink, 'scroll', onScroll);\n  }\n\n  forEachElement(element, (elem) \x3d\x3e {\n    attachResizeEvent(elem, callback);\n  });\n\n  this.detach \x3d (ev) \x3d\x3e {\n    L.ResizeSensor.detach(element, ev);\n  };\n};\n\nL.ResizeSensor.detach \x3d (element, ev) \x3d\x3e {\n  forEachElement(element, (elem) \x3d\x3e {\n    const elementItem \x3d elem;\n    if (elementItem.resizedAttached \x26\x26 typeof ev \x3d\x3d\x3d 'function') {\n      elementItem.resizedAttached.remove(ev);\n      if (elementItem.resizedAttached.length()) return;\n    }\n    if (elementItem.resizeSensor) {\n      if (elementItem.contains(elementItem.resizeSensor)) {\n        elementItem.removeChild(elementItem.resizeSensor);\n      }\n      delete elementItem.resizeSensor;\n      delete elementItem.resizedAttached;\n    }\n  });\n};\n"},
function(l,r){l.exports=function(h){function d(d){"undefined"!=typeof console&&(console.error||console.log)("[Script Loader]",d)}try{"undefined"!=typeof execScript&&"undefined"!=typeof attachEvent&&"undefined"==typeof addEventListener?execScript(h):"undefined"!=typeof eval?eval.call(null,h):d("EvalError: No eval function available")}catch(f){d(f)}}},function(l,r,h){h(22)(h(21))},function(l,r,h){(function(d){l.exports=function c(a,d,g){function b(k,n){if(!d[k]){if(!a[k]){if(e)return e(k,!0);n=Error("Cannot find module '"+
k+"'");throw n.code="MODULE_NOT_FOUND",n;}n=d[k]={exports:{}};a[k][0].call(n.exports,function(c){return b(a[k][1][c]||c)},n,n.exports,c,a,d,g)}return d[k].exports}for(var e=!1,n=0;n<g.length;n++)b(g[n]);return b}({1:[function(c,a,d){function g(a,b,c,d,e){b=k.writeRtpDescription(a.kind,b);if(b+=k.writeIceParameters(a.iceGatherer.getLocalParameters()),b+=k.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":e||"active"),b+="a\x3dmid:"+a.mid+"\r\n",a.direction?b+="a\x3d"+a.direction+
"\r\n":a.rtpSender&&a.rtpReceiver?b+="a\x3dsendrecv\r\n":a.rtpSender?b+="a\x3dsendonly\r\n":a.rtpReceiver?b+="a\x3drecvonly\r\n":b+="a\x3dinactive\r\n",a.rtpSender)c="msid:"+d.id+" "+a.rtpSender.track.id+"\r\n",b=b+("a\x3d"+c)+("a\x3dssrc:"+a.sendEncodingParameters[0].ssrc+" "+c),a.sendEncodingParameters[0].rtx&&(b+="a\x3dssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+c,b+="a\x3dssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n");return b+="a\x3dssrc:"+
a.sendEncodingParameters[0].ssrc+" cname:"+k.localCName+"\r\n",a.rtpSender&&a.sendEncodingParameters[0].rtx&&(b+="a\x3dssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+k.localCName+"\r\n"),b}function b(a,b){var c={codecs:[],headerExtensions:[],fecMechanisms:[]},d=function(a,b){a=parseInt(a,10);for(var c=0;c<b.length;c++)if(b[c].payloadType===a||b[c].preferredPayloadType===a)return b[c]},e=function(a,b,c,e){a=d(a.parameters.apt,c);b=d(b.parameters.apt,e);return a&&b&&a.name.toLowerCase()===b.name.toLowerCase()};
return a.codecs.forEach(function(d){for(var k=0;k<b.codecs.length;k++){var g=b.codecs[k];if(d.name.toLowerCase()===g.name.toLowerCase()&&d.clockRate===g.clockRate&&("rtx"!==d.name.toLowerCase()||!d.parameters||!g.parameters.apt||e(d,g,a.codecs,b.codecs))){(g=JSON.parse(JSON.stringify(g))).numChannels=Math.min(d.numChannels,g.numChannels);c.codecs.push(g);g.rtcpFeedback=g.rtcpFeedback.filter(function(a){for(var b=0;b<d.rtcpFeedback.length;b++)if(d.rtcpFeedback[b].type===a.type&&d.rtcpFeedback[b].parameter===
a.parameter)return!0;return!1});break}}}),a.headerExtensions.forEach(function(a){for(var d=0;d<b.headerExtensions.length;d++){var e=b.headerExtensions[d];if(a.uri===e.uri){c.headerExtensions.push(e);break}}}),c}function e(a,b,c){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[b][a].indexOf(c)}
function n(a,b){var c=a.getRemoteCandidates().find(function(a){return b.foundation===a.foundation&&b.ip===a.ip&&b.port===a.port&&b.priority===a.priority&&b.protocol===a.protocol&&b.type===a.type});return c||a.addRemoteCandidate(b),!c}var k=c("sdp");a.exports=function(a,c){var d=function(b){var d=this,e=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(a){d[a]=e[a].bind(e)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,
this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onicegatheringstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this.localDescription=null,this.remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",b=JSON.parse(JSON.stringify(b||{})),this.usingBundle="max-bundle"===b.bundlePolicy,
"negotiate"===b.rtcpMuxPolicy)throw b=Error("rtcpMuxPolicy 'negotiate' is not supported"),b.name="NotSupportedError",b;switch(b.rtcpMuxPolicy||(b.rtcpMuxPolicy="require"),b.iceTransportPolicy){case "all":case "relay":break;default:b.iceTransportPolicy="all"}switch(b.bundlePolicy){case "balanced":case "max-compat":case "max-bundle":break;default:b.bundlePolicy="balanced"}if(b.iceServers=function(a,b){var c=!1;return(a=JSON.parse(JSON.stringify(a))).filter(function(a){if(a&&(a.urls||a.url)){var d=a.urls||
a.url;a.url&&!a.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var e="string"==typeof d;return e&&(d=[d]),d=d.filter(function(a){return 0!==a.indexOf("turn:")||-1===a.indexOf("transport\x3dudp")||-1!==a.indexOf("turn:[")||c?0===a.indexOf("stun:")&&14393<=b&&-1===a.indexOf("?transport\x3dudp"):(c=!0,!0)}),delete a.url,a.urls=e?d[0]:d,!!d.length}return!1})}(b.iceServers||[],c),this._iceGatherers=[],b.iceCandidatePoolSize)for(var g=b.iceCandidatePoolSize;0<g;g--)this._iceGatherers=
new a.RTCIceGatherer({iceServers:b.iceServers,gatherPolicy:b.iceTransportPolicy});else b.iceCandidatePoolSize=0;this._config=b;this.transceivers=[];this._sdpSessionId=k.generateSessionId();this._sdpSessionVersion=0;this._dtlsRole=void 0};return d.prototype._emitGatheringStateChange=function(){var a=new Event("icegatheringstatechange");this.dispatchEvent(a);"function"==typeof this.onicegatheringstatechange&&this.onicegatheringstatechange(a)},d.prototype.getConfiguration=function(){return this._config},
d.prototype.getLocalStreams=function(){return this.localStreams},d.prototype.getRemoteStreams=function(){return this.remoteStreams},d.prototype._createTransceiver=function(a){var b=0<this.transceivers.length;a={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:a,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,wantReceive:!0};this.usingBundle&&b?(a.iceTransport=this.transceivers[0].iceTransport,
a.dtlsTransport=this.transceivers[0].dtlsTransport):(b=this._createIceAndDtlsTransports(),a.iceTransport=b.iceTransport,a.dtlsTransport=b.dtlsTransport);return this.transceivers.push(a),a},d.prototype.addTrack=function(b,c){for(var d,e=0;e<this.transceivers.length;e++)this.transceivers[e].track||this.transceivers[e].kind!==b.kind||(d=this.transceivers[e]);return d||(d=this._createTransceiver(b.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(c)&&this.localStreams.push(c),d.track=
b,d.stream=c,d.rtpSender=new a.RTCRtpSender(b,d.dtlsTransport),d.rtpSender},d.prototype.addStream=function(a){var b=this;if(15025<=c)a.getTracks().forEach(function(c){b.addTrack(c,a)});else{var d=a.clone();a.getTracks().forEach(function(a,b){var c=d.getTracks()[b];a.addEventListener("enabled",function(a){c.enabled=a.enabled})});d.getTracks().forEach(function(a){b.addTrack(a,d)})}},d.prototype.removeStream=function(a){a=this.localStreams.indexOf(a);-1<a&&(this.localStreams.splice(a,1),this._maybeFireNegotiationNeeded())},
d.prototype.getSenders=function(){return this.transceivers.filter(function(a){return!!a.rtpSender}).map(function(a){return a.rtpSender})},d.prototype.getReceivers=function(){return this.transceivers.filter(function(a){return!!a.rtpReceiver}).map(function(a){return a.rtpReceiver})},d.prototype._createIceGatherer=function(b,c){var d=this;if(c&&0<b)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var e=new a.RTCIceGatherer({iceServers:this._config.iceServers,
gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(e,"state",{value:"new",writable:!0}),this.transceivers[b].candidates=[],this.transceivers[b].bufferCandidates=function(a){var c=!a.candidate||0===Object.keys(a.candidate).length;e.state=c?"completed":"gathering";null!==d.transceivers[b].candidates&&d.transceivers[b].candidates.push(a.candidate)},e.addEventListener("localcandidate",this.transceivers[b].bufferCandidates),e},d.prototype._gather=function(b,c){var d=this,e=this.transceivers[c].iceGatherer;
if(!e.onlocalcandidate){var g=this.transceivers[c].candidates;this.transceivers[c].candidates=null;e.removeEventListener("localcandidate",this.transceivers[c].bufferCandidates);e.onlocalcandidate=function(a){if(!(d.usingBundle&&0<c)){var g=new Event("icecandidate");g.candidate={sdpMid:b,sdpMLineIndex:c};var m=a.candidate;(a=!m||0===Object.keys(m).length)?"new"!==e.state&&"gathering"!==e.state||(e.state="completed"):("new"===e.state&&(e.state="gathering"),m.component=1,g.candidate.candidate=k.writeCandidate(m));
m=k.splitSections(d.localDescription.sdp);m[g.candidate.sdpMLineIndex+1]+=a?"a\x3dend-of-candidates\r\n":"a\x3d"+g.candidate.candidate+"\r\n";d.localDescription.sdp=m.join("");m=d.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});"gathering"!==d.iceGatheringState&&(d.iceGatheringState="gathering",d._emitGatheringStateChange());a||(d.dispatchEvent(g),"function"==typeof d.onicecandidate&&d.onicecandidate(g));m&&(d.dispatchEvent(new Event("icecandidate")),"function"==
typeof d.onicecandidate&&d.onicecandidate(new Event("icecandidate")),d.iceGatheringState="complete",d._emitGatheringStateChange())}};a.setTimeout(function(){g.forEach(function(a){var b=new Event("RTCIceGatherEvent");b.candidate=a;e.onlocalcandidate(b)})},0)}},d.prototype._createIceAndDtlsTransports=function(){var b=this,c=new a.RTCIceTransport(null);c.onicestatechange=function(){b._updateConnectionState()};var d=new a.RTCDtlsTransport(c);return d.ondtlsstatechange=function(){b._updateConnectionState()},
d.onerror=function(){Object.defineProperty(d,"state",{value:"failed",writable:!0});b._updateConnectionState()},{iceTransport:c,dtlsTransport:d}},d.prototype._disposeIceAndDtlsTransports=function(a){var b=this.transceivers[a].iceGatherer;b&&(delete b.onlocalcandidate,delete this.transceivers[a].iceGatherer);(b=this.transceivers[a].iceTransport)&&(delete b.onicestatechange,delete this.transceivers[a].iceTransport);(b=this.transceivers[a].dtlsTransport)&&(delete b.ondtlsstatechange,delete b.onerror,
delete this.transceivers[a].dtlsTransport)},d.prototype._transceive=function(a,d,e){var g=b(a.localCapabilities,a.remoteCapabilities);d&&a.rtpSender&&(g.encodings=a.sendEncodingParameters,g.rtcp={cname:k.localCName,compound:a.rtcpParameters.compound},a.recvEncodingParameters.length&&(g.rtcp.ssrc=a.recvEncodingParameters[0].ssrc),a.rtpSender.send(g));e&&a.rtpReceiver&&0<g.codecs.length&&("video"===a.kind&&a.recvEncodingParameters&&15019>c&&a.recvEncodingParameters.forEach(function(a){delete a.rtx}),
g.encodings=a.recvEncodingParameters,g.rtcp={cname:a.rtcpParameters.cname,compound:a.rtcpParameters.compound},a.sendEncodingParameters.length&&(g.rtcp.ssrc=a.sendEncodingParameters[0].ssrc),a.rtpReceiver.receive(g))},d.prototype.setLocalDescription=function(a){var c=this,d=arguments;if(!e("setLocalDescription",a.type,this.signalingState))return new Promise(function(b,e){b=Error("Can not set local "+a.type+" in state "+c.signalingState);b.name="InvalidStateError";2<d.length&&"function"==typeof d[2]&&
d[2].apply(null,[b]);e(b)});if("offer"===a.type){var g=k.splitSections(a.sdp);var n=g.shift();g.forEach(function(a,b){a=k.parseRtpParameters(a);c.transceivers[b].localCapabilities=a});this.transceivers.forEach(function(a,b){c._gather(a.mid,b)})}else if("answer"===a.type){g=k.splitSections(c.remoteDescription.sdp);n=g.shift();var h=0<k.matchPrefix(n,"a\x3dice-lite").length;g.forEach(function(a,d){var e=c.transceivers[d],g=e.iceGatherer,m=e.iceTransport,p=e.dtlsTransport,q=e.localCapabilities,v=e.remoteCapabilities;
if(!(k.isRejected(a)&&1===!k.matchPrefix(a,"a\x3dbundle-only").length||e.isDatachannel)){var t=k.getIceParameters(a,n);a=k.getDtlsParameters(a,n);h&&(a.role="server");c.usingBundle&&0!==d||(c._gather(e.mid,d),"new"===m.state&&m.start(g,t,h?"controlling":"controlled"),"new"===p.state&&p.start(a));d=b(q,v);c._transceive(e,0<d.codecs.length,!1)}})}switch(this.localDescription={type:a.type,sdp:a.sdp},a.type){case "offer":this._updateSignalingState("have-local-offer");break;case "answer":this._updateSignalingState("stable");
break;default:throw new TypeError('unsupported type "'+a.type+'"');}var p=1<arguments.length&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(a){p&&p.apply(null);a()})},d.prototype.setRemoteDescription=function(b){var d=this,g=arguments;if(!e("setRemoteDescription",b.type,this.signalingState))return new Promise(function(a,c){a=Error("Can not set remote "+b.type+" in state "+d.signalingState);a.name="InvalidStateError";2<g.length&&"function"==typeof g[2]&&g[2].apply(null,
[a]);c(a)});var h={};this.remoteStreams.forEach(function(a){h[a.id]=a});var p=[],v=k.splitSections(b.sdp),t=v.shift(),l=0<k.matchPrefix(t,"a\x3dice-lite").length,x=0<k.matchPrefix(t,"a\x3dgroup:BUNDLE ").length;this.usingBundle=x;var w=k.matchPrefix(t,"a\x3dice-options:")[0];switch(this.canTrickleIceCandidates=!!w&&0<=w.substr(14).split(" ").indexOf("trickle"),v.forEach(function(e,g){var m=k.splitLines(e),q=k.getKind(e),v=k.isRejected(e)&&1===!k.matchPrefix(e,"a\x3dbundle-only").length,D=m[0].substr(2).split(" ")[2],
m=k.getDirection(e,t),A=k.parseMsid(e),w=k.getMid(e)||k.generateIdentifier();if("application"!==q||"DTLS/SCTP"!==D){var z,B,u,r,C,E,J,H,N=k.parseRtpParameters(e);v||(J=k.getIceParameters(e,t),(H=k.getDtlsParameters(e,t)).role="client");var D=k.parseRtpEncodingParameters(e),O=k.parseRtcpParameters(e),I=0<k.matchPrefix(e,"a\x3dend-of-candidates",t).length;e=k.matchPrefix(e,"a\x3dcandidate:").map(function(a){return k.parseCandidate(a)}).filter(function(a){return 1===a.component});if(("offer"===b.type||
"answer"===b.type)&&!v&&x&&0<g&&d.transceivers[g]&&(d._disposeIceAndDtlsTransports(g),d.transceivers[g].iceGatherer=d.transceivers[0].iceGatherer,d.transceivers[g].iceTransport=d.transceivers[0].iceTransport,d.transceivers[g].dtlsTransport=d.transceivers[0].dtlsTransport,d.transceivers[g].rtpSender&&d.transceivers[g].rtpSender.setTransport(d.transceivers[0].dtlsTransport),d.transceivers[g].rtpReceiver&&d.transceivers[g].rtpReceiver.setTransport(d.transceivers[0].dtlsTransport)),"offer"!==b.type||
v)"answer"!==b.type||v||(z=d.transceivers[g],B=z.iceGatherer,u=z.iceTransport,r=z.dtlsTransport,C=z.rtpReceiver,v=z.sendEncodingParameters,w=z.localCapabilities,d.transceivers[g].recvEncodingParameters=D,d.transceivers[g].remoteCapabilities=N,d.transceivers[g].rtcpParameters=O,e.length&&"new"===u.state&&(!l&&!I||x&&0!==g?e.forEach(function(a){n(z.iceTransport,a)}):u.setRemoteCandidates(e)),x&&0!==g||("new"===u.state&&u.start(B,J,"controlling"),"new"===r.state&&r.start(H)),d._transceive(z,"sendrecv"===
m||"recvonly"===m,"sendrecv"===m||"sendonly"===m),!C||"sendrecv"!==m&&"sendonly"!==m?delete z.rtpReceiver:(E=C.track,A?(h[A.stream]||(h[A.stream]=new a.MediaStream),h[A.stream].addTrack(E),p.push([E,C,h[A.stream]])):(h.default||(h.default=new a.MediaStream),h.default.addTrack(E),p.push([E,C,h.default]))));else{(z=d.transceivers[g]||d._createTransceiver(q)).mid=w;z.iceGatherer||(z.iceGatherer=d._createIceGatherer(g,x));e.length&&"new"===z.iceTransport.state&&(!I||x&&0!==g?e.forEach(function(a){n(z.iceTransport,
a)}):z.iceTransport.setRemoteCandidates(e));w=a.RTCRtpReceiver.getCapabilities(q);15019>c&&(w.codecs=w.codecs.filter(function(a){return"rtx"!==a.name}));var v=z.sendEncodingParameters||[{ssrc:1001*(2*g+2)}],M;B=!1;"sendrecv"!==m&&"sendonly"!==m||(B=!z.rtpReceiver,C=z.rtpReceiver||new a.RTCRtpReceiver(z.dtlsTransport,q),B&&(E=C.track,A?(h[A.stream]||(h[A.stream]=new a.MediaStream,Object.defineProperty(h[A.stream],"id",{get:function(){return A.stream}})),Object.defineProperty(E,"id",{get:function(){return A.track}}),
M=h[A.stream]):(h.default||(h.default=new a.MediaStream),M=h.default),M.addTrack(E),p.push([E,C,M])));z.localCapabilities=w;z.remoteCapabilities=N;z.rtpReceiver=C;z.rtcpParameters=O;z.sendEncodingParameters=v;z.recvEncodingParameters=D;d._transceive(d.transceivers[g],!1,B)}}else d.transceivers[g]={mid:w,isDatachannel:!0}}),void 0===this._dtlsRole&&(this._dtlsRole="offer"===b.type?"active":"passive"),this.remoteDescription={type:b.type,sdp:b.sdp},b.type){case "offer":this._updateSignalingState("have-remote-offer");
break;case "answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+b.type+'"');}return Object.keys(h).forEach(function(b){var c=h[b];if(c.getTracks().length){if(-1===d.remoteStreams.indexOf(c)){d.remoteStreams.push(c);var e=new Event("addstream");e.stream=c;a.setTimeout(function(){d.dispatchEvent(e);"function"==typeof d.onaddstream&&d.onaddstream(e)})}p.forEach(function(b){var e=b[0],g=b[1];if(c.id===b[2].id){var k=new Event("track");k.track=e;k.receiver=
g;k.transceiver={receiver:g};k.streams=[c];a.setTimeout(function(){d.dispatchEvent(k);"function"==typeof d.ontrack&&d.ontrack(k)})}})}}),a.setTimeout(function(){d&&d.transceivers&&d.transceivers.forEach(function(a){a.iceTransport&&"new"===a.iceTransport.state&&0<a.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),a.iceTransport.addRemoteCandidate({}))})},4E3),new Promise(function(a){1<g.length&&"function"==
typeof g[1]&&g[1].apply(null);a()})},d.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop();a.dtlsTransport&&a.dtlsTransport.stop();a.rtpSender&&a.rtpSender.stop();a.rtpReceiver&&a.rtpReceiver.stop()});this._updateSignalingState("closed")},d.prototype._updateSignalingState=function(a){this.signalingState=a;a=new Event("signalingstatechange");this.dispatchEvent(a);"function"==typeof this.onsignalingstatechange&&this.onsignalingstatechange(a)},d.prototype._maybeFireNegotiationNeeded=
function(){var b=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,a.setTimeout(function(){if(!1!==b.needNegotiation){b.needNegotiation=!1;var a=new Event("negotiationneeded");b.dispatchEvent(a);"function"==typeof b.onnegotiationneeded&&b.onnegotiationneeded(a)}},0))},d.prototype._updateConnectionState=function(){var a,b={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(a){b[a.iceTransport.state]++;
b[a.dtlsTransport.state]++}),b.connected+=b.completed,a="new",0<b.failed?a="failed":0<b.connecting||0<b.checking?a="connecting":0<b.disconnected?a="disconnected":0<b.new?a="new":(0<b.connected||0<b.completed)&&(a="connected"),a!==this.iceConnectionState)this.iceConnectionState=a,a=new Event("iceconnectionstatechange"),this.dispatchEvent(a),"function"==typeof this.oniceconnectionstatechange&&this.oniceconnectionstatechange(a)},d.prototype.createOffer=function(){var b,d=this,e=arguments;1===arguments.length&&
"function"!=typeof arguments[0]?b=arguments[0]:3===arguments.length&&(b=arguments[2]);var n=this.transceivers.filter(function(a){return"audio"===a.kind}).length,h=this.transceivers.filter(function(a){return"video"===a.kind}).length;if(b){if(b.mandatory||b.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==b.offerToReceiveAudio&&(n=!0===b.offerToReceiveAudio?1:!1===b.offerToReceiveAudio?0:b.offerToReceiveAudio);void 0!==b.offerToReceiveVideo&&(h=!0===b.offerToReceiveVideo?
1:!1===b.offerToReceiveVideo?0:b.offerToReceiveVideo)}for(this.transceivers.forEach(function(a){"audio"===a.kind?0>--n&&(a.wantReceive=!1):"video"===a.kind&&0>--h&&(a.wantReceive=!1)});0<n||0<h;)0<n&&(this._createTransceiver("audio"),n--),0<h&&(this._createTransceiver("video"),h--);var v=k.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.transceivers.forEach(function(b,e){var g=b.track,m=b.kind,n=k.generateIdentifier();b.mid=n;b.iceGatherer||(b.iceGatherer=d._createIceGatherer(e,
d.usingBundle));n=a.RTCRtpSender.getCapabilities(m);15019>c&&(n.codecs=n.codecs.filter(function(a){return"rtx"!==a.name}));n.codecs.forEach(function(a){"H264"===a.name&&void 0===a.parameters["level-asymmetry-allowed"]&&(a.parameters["level-asymmetry-allowed"]="1")});e=b.sendEncodingParameters||[{ssrc:1001*(2*e+1)}];g&&15019<=c&&"video"===m&&!e[0].rtx&&(e[0].rtx={ssrc:e[0].ssrc+1});b.wantReceive&&(b.rtpReceiver=new a.RTCRtpReceiver(b.dtlsTransport,m));b.localCapabilities=n;b.sendEncodingParameters=
e});"max-compat"!==this._config.bundlePolicy&&(v+="a\x3dgroup:BUNDLE "+this.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n");v+="a\x3dice-options:trickle\r\n";this.transceivers.forEach(function(a,b){v+=g(a,a.localCapabilities,"offer",a.stream,d._dtlsRole);v+="a\x3drtcp-rsize\r\n";!a.iceGatherer||"new"===d.iceGatheringState||0!==b&&d.usingBundle||(a.iceGatherer.getLocalCandidates().forEach(function(a){a.component=1;v+="a\x3d"+k.writeCandidate(a)+"\r\n"}),"completed"===a.iceGatherer.state&&
(v+="a\x3dend-of-candidates\r\n"))});var t=new a.RTCSessionDescription({type:"offer",sdp:v});return new Promise(function(a){if(0<e.length&&"function"==typeof e[0])return e[0].apply(null,[t]),void a();a(t)})},d.prototype.createAnswer=function(){var d=this,e=arguments,m=k.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.usingBundle&&(m+="a\x3dgroup:BUNDLE "+this.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n");var n=k.splitSections(this.remoteDescription.sdp).length-
1;this.transceivers.forEach(function(a,e){if(!(e+1>n))if(a.isDatachannel)m+="m\x3dapplication 0 DTLS/SCTP 5000\r\nc\x3dIN IP4 0.0.0.0\r\na\x3dmid:"+a.mid+"\r\n";else{var k;a.stream&&("audio"===a.kind?k=a.stream.getAudioTracks()[0]:"video"===a.kind&&(k=a.stream.getVideoTracks()[0]),k&&15019<=c&&"video"===a.kind&&!a.sendEncodingParameters[0].rtx&&(a.sendEncodingParameters[0].rtx={ssrc:a.sendEncodingParameters[0].ssrc+1}));e=b(a.localCapabilities,a.remoteCapabilities);!e.codecs.filter(function(a){return"rtx"===
a.name.toLowerCase()}).length&&a.sendEncodingParameters[0].rtx&&delete a.sendEncodingParameters[0].rtx;m+=g(a,e,"answer",a.stream,d._dtlsRole);a.rtcpParameters&&a.rtcpParameters.reducedSize&&(m+="a\x3drtcp-rsize\r\n")}});var h=new a.RTCSessionDescription({type:"answer",sdp:m});return new Promise(function(a){if(0<e.length&&"function"==typeof e[0])return e[0].apply(null,[h]),void a();a(h)})},d.prototype.addIceCandidate=function(a){var b,c;if(a&&""!==a.candidate){if(void 0===a.sdpMLineIndex&&!a.sdpMid)throw new TypeError("sdpMLineIndex or sdpMid required");
if(this.remoteDescription){var d=a.sdpMLineIndex;if(a.sdpMid)for(c=0;c<this.transceivers.length;c++)if(this.transceivers[c].mid===a.sdpMid){d=c;break}if(c=this.transceivers[d]){if(c.isDatachannel)return Promise.resolve();var e=0<Object.keys(a.candidate).length?k.parseCandidate(a.candidate):{};if("tcp"===e.protocol&&(0===e.port||9===e.port)||e.component&&1!==e.component)return Promise.resolve();if((0===d||0<d&&c.iceTransport!==this.transceivers[0].iceTransport)&&(n(c.iceTransport,e)||((b=Error("Can not add ICE candidate")).name=
"OperationError")),!b){var g=a.candidate.trim();0===g.indexOf("a\x3d")&&(g=g.substr(2));(c=k.splitSections(this.remoteDescription.sdp))[d+1]+="a\x3d"+(e.type?g:"end-of-candidates")+"\r\n";this.remoteDescription.sdp=c.join("")}}else(b=Error("Can not add ICE candidate")).name="OperationError"}else(b=Error("Can not add ICE candidate without a remote description")).name="InvalidStateError"}else for(d=0;d<this.transceivers.length&&(this.transceivers[d].isDatachannel||(this.transceivers[d].iceTransport.addRemoteCandidate({}),
(c=k.splitSections(this.remoteDescription.sdp))[d+1]+="a\x3dend-of-candidates\r\n",this.remoteDescription.sdp=c.join(""),!this.usingBundle));d++);var h=arguments;return new Promise(function(a,c){b?(2<h.length&&"function"==typeof h[2]&&h[2].apply(null,[b]),c(b)):(1<h.length&&"function"==typeof h[1]&&h[1].apply(null),a())})},d.prototype.getStats=function(){var a=[];this.transceivers.forEach(function(b){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(c){b[c]&&
a.push(b[c].getStats())})});var b=1<arguments.length&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(c){var d=new Map;Promise.all(a).then(function(a){a.forEach(function(a){Object.keys(a).forEach(function(b){var c;a[b].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(c=a[b]).type]||c.type;d.set(b,a[b])})});b&&b.apply(null,d);c(d)})})},d}},{sdp:2}],2:[function(c,a,
d){var g={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};g.localCName=g.generateIdentifier();g.splitLines=function(a){return a.trim().split("\n").map(function(a){return a.trim()})};g.splitSections=function(a){return a.split("\nm\x3d").map(function(a,b){return(0<b?"m\x3d"+a:a).trim()+"\r\n"})};g.matchPrefix=function(a,c){return g.splitLines(a).filter(function(a){return 0===a.indexOf(c)})};g.parseCandidate=function(a){var b;a={foundation:(b=0===a.indexOf("a\x3dcandidate:")?
a.substring(12).split(" "):a.substring(10).split(" "))[0],component:parseInt(b[1],10),protocol:b[2].toLowerCase(),priority:parseInt(b[3],10),ip:b[4],port:parseInt(b[5],10),type:b[7]};for(var c=8;c<b.length;c+=2)switch(b[c]){case "raddr":a.relatedAddress=b[c+1];break;case "rport":a.relatedPort=parseInt(b[c+1],10);break;case "tcptype":a.tcpType=b[c+1];break;case "ufrag":a.ufrag=b[c+1];a.usernameFragment=b[c+1];break;default:a[b[c]]=b[c+1]}return a};g.writeCandidate=function(a){var b=[];b.push(a.foundation);
b.push(a.component);b.push(a.protocol.toUpperCase());b.push(a.priority);b.push(a.ip);b.push(a.port);var c=a.type;return b.push("typ"),b.push(c),"host"!==c&&a.relatedAddress&&a.relatedPort&&(b.push("raddr"),b.push(a.relatedAddress),b.push("rport"),b.push(a.relatedPort)),a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(b.push("tcptype"),b.push(a.tcpType)),a.ufrag&&(b.push("ufrag"),b.push(a.ufrag)),"candidate:"+b.join(" ")};g.parseIceOptions=function(a){return a.substr(14).split(" ")};g.parseRtpMap=function(a){a=
a.substr(9).split(" ");var b={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),b.name=a[0],b.clockRate=parseInt(a[1],10),b.numChannels=3===a.length?parseInt(a[2],10):1,b};g.writeRtpMap=function(a){var b=a.payloadType;return void 0!==a.preferredPayloadType&&(b=a.preferredPayloadType),"a\x3drtpmap:"+b+" "+a.name+"/"+a.clockRate+(1!==a.numChannels?"/"+a.numChannels:"")+"\r\n"};g.parseExtmap=function(a){a=a.substr(9).split(" ");return{id:parseInt(a[0],10),direction:0<a[0].indexOf("/")?a[0].split("/")[1]:
"sendrecv",uri:a[1]}};g.writeExtmap=function(a){return"a\x3dextmap:"+(a.id||a.preferredId)+(a.direction&&"sendrecv"!==a.direction?"/"+a.direction:"")+" "+a.uri+"\r\n"};g.parseFmtp=function(a){for(var b={},c=a.substr(a.indexOf(" ")+1).split(";"),d=0;d<c.length;d++)a=c[d].trim().split("\x3d"),b[a[0].trim()]=a[1];return b};g.writeFmtp=function(a){var b="",c=a.payloadType;if(void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.parameters&&Object.keys(a.parameters).length){var d=[];Object.keys(a.parameters).forEach(function(b){d.push(b+
"\x3d"+a.parameters[b])});b+="a\x3dfmtp:"+c+" "+d.join(";")+"\r\n"}return b};g.parseRtcpFb=function(a){a=a.substr(a.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}};g.writeRtcpFb=function(a){var b="",c=a.payloadType;return void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(a){b+="a\x3drtcp-fb:"+c+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+"\r\n"}),b};g.parseSsrcMedia=function(a){var b=
a.indexOf(" "),c={ssrc:parseInt(a.substr(7,b-7),10)},d=a.indexOf(":",b);return-1<d?(c.attribute=a.substr(b+1,d-b-1),c.value=a.substr(d+1)):c.attribute=a.substr(b+1),c};g.getMid=function(a){if(a=g.matchPrefix(a,"a\x3dmid:")[0])return a.substr(6)};g.parseFingerprint=function(a){a=a.substr(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1]}};g.getDtlsParameters=function(a,c){return{role:"auto",fingerprints:g.matchPrefix(a+c,"a\x3dfingerprint:").map(g.parseFingerprint)}};g.writeDtlsParameters=
function(a,c){var b="a\x3dsetup:"+c+"\r\n";return a.fingerprints.forEach(function(a){b+="a\x3dfingerprint:"+a.algorithm+" "+a.value+"\r\n"}),b};g.getIceParameters=function(a,c){a=g.splitLines(a);return{usernameFragment:(a=a.concat(g.splitLines(c))).filter(function(a){return 0===a.indexOf("a\x3dice-ufrag:")})[0].substr(12),password:a.filter(function(a){return 0===a.indexOf("a\x3dice-pwd:")})[0].substr(10)}};g.writeIceParameters=function(a){return"a\x3dice-ufrag:"+a.usernameFragment+"\r\na\x3dice-pwd:"+
a.password+"\r\n"};g.parseRtpParameters=function(a){for(var b={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=g.splitLines(a)[0].split(" "),d=3;d<c.length;d++){var h=c[d],l=g.matchPrefix(a,"a\x3drtpmap:"+h+" ")[0];if(l){var l=g.parseRtpMap(l),w=g.matchPrefix(a,"a\x3dfmtp:"+h+" ");switch(l.parameters=w.length?g.parseFmtp(w[0]):{},l.rtcpFeedback=g.matchPrefix(a,"a\x3drtcp-fb:"+h+" ").map(g.parseRtcpFb),b.codecs.push(l),l.name.toUpperCase()){case "RED":case "ULPFEC":b.fecMechanisms.push(l.name.toUpperCase())}}}return g.matchPrefix(a,
"a\x3dextmap:").forEach(function(a){b.headerExtensions.push(g.parseExtmap(a))}),b};g.writeRtpDescription=function(a,c){var b="",b=b+("m\x3d"+a+" "),b=b+(0<c.codecs.length?"9":"0"),b=b+" UDP/TLS/RTP/SAVPF ",b=b+(c.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType}).join(" ")+"\r\n"),b=b+"c\x3dIN IP4 0.0.0.0\r\n",b=b+"a\x3drtcp:9 IN IP4 0.0.0.0\r\n";c.codecs.forEach(function(a){b+=g.writeRtpMap(a);b+=g.writeFmtp(a);b+=g.writeRtcpFb(a)});var d=0;return c.codecs.forEach(function(a){a.maxptime>
d&&(d=a.maxptime)}),0<d&&(b+="a\x3dmaxptime:"+d+"\r\n"),b+="a\x3drtcp-mux\r\n",c.headerExtensions.forEach(function(a){b+=g.writeExtmap(a)}),b};g.parseRtpEncodingParameters=function(a){var b,c=[],d=g.parseRtpParameters(a),h=-1!==d.fecMechanisms.indexOf("RED"),l=-1!==d.fecMechanisms.indexOf("ULPFEC"),w=g.matchPrefix(a,"a\x3dssrc:").map(function(a){return g.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute}),p=0<w.length&&w[0].ssrc,w=g.matchPrefix(a,"a\x3dssrc-group:FID").map(function(a){a=
a.split(" ");return a.shift(),a.map(function(a){return parseInt(a,10)})});0<w.length&&1<w[0].length&&w[0][0]===p&&(b=w[0][1]);d.codecs.forEach(function(a){"RTX"===a.name.toUpperCase()&&a.parameters.apt&&(a={ssrc:p,codecPayloadType:parseInt(a.parameters.apt,10),rtx:{ssrc:b}},c.push(a),h&&((a=JSON.parse(JSON.stringify(a))).fec={ssrc:b,mechanism:l?"red+ulpfec":"red"},c.push(a)))});0===c.length&&p&&c.push({ssrc:p});var q=g.matchPrefix(a,"b\x3d");return q.length&&(q=0===q[0].indexOf("b\x3dTIAS:")?parseInt(q[0].substr(7),
10):0===q[0].indexOf("b\x3dAS:")?950*parseInt(q[0].substr(5),10)-16E3:void 0,c.forEach(function(a){a.maxBitrate=q})),c};g.parseRtcpParameters=function(a){var b={},c=g.matchPrefix(a,"a\x3dssrc:").map(function(a){return g.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute})[0];c&&(b.cname=c.value,b.ssrc=c.ssrc);c=g.matchPrefix(a,"a\x3drtcp-rsize");b.reducedSize=0<c.length;b.compound=0===c.length;a=g.matchPrefix(a,"a\x3drtcp-mux");return b.mux=0<a.length,b};g.parseMsid=function(a){var b,
c=g.matchPrefix(a,"a\x3dmsid:");if(1===c.length)return{stream:(b=c[0].substr(7).split(" "))[0],track:b[1]};a=g.matchPrefix(a,"a\x3dssrc:").map(function(a){return g.parseSsrcMedia(a)}).filter(function(a){return"msid"===a.attribute});return 0<a.length?{stream:(b=a[0].value.split(" "))[0],track:b[1]}:void 0};g.generateSessionId=function(){return Math.random().toString().substr(2,21)};g.writeSessionBoilerplate=function(a,c){c=void 0!==c?c:2;return"v\x3d0\r\no\x3dthisisadapterortc "+(a||g.generateSessionId())+
" "+c+" IN IP4 127.0.0.1\r\ns\x3d-\r\nt\x3d0 0\r\n"};g.writeMediaSection=function(a,c,d,k){c=g.writeRtpDescription(a.kind,c);if(c+=g.writeIceParameters(a.iceGatherer.getLocalParameters()),c+=g.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===d?"actpass":"active"),c+="a\x3dmid:"+a.mid+"\r\n",a.direction?c+="a\x3d"+a.direction+"\r\n":a.rtpSender&&a.rtpReceiver?c+="a\x3dsendrecv\r\n":a.rtpSender?c+="a\x3dsendonly\r\n":a.rtpReceiver?c+="a\x3drecvonly\r\n":c+="a\x3dinactive\r\n",a.rtpSender)d=
"msid:"+k.id+" "+a.rtpSender.track.id+"\r\n",c=c+("a\x3d"+d)+("a\x3dssrc:"+a.sendEncodingParameters[0].ssrc+" "+d),a.sendEncodingParameters[0].rtx&&(c+="a\x3dssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+d,c+="a\x3dssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n");return c+="a\x3dssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+g.localCName+"\r\n",a.rtpSender&&a.sendEncodingParameters[0].rtx&&(c+="a\x3dssrc:"+a.sendEncodingParameters[0].rtx.ssrc+
" cname:"+g.localCName+"\r\n"),c};g.getDirection=function(a,c){a=g.splitLines(a);for(var b=0;b<a.length;b++)switch(a[b]){case "a\x3dsendrecv":case "a\x3dsendonly":case "a\x3drecvonly":case "a\x3dinactive":return a[b].substr(2)}return c?g.getDirection(c):"sendrecv"};g.getKind=function(a){return g.splitLines(a)[0].split(" ")[0].substr(2)};g.isRejected=function(a){return"0"===a.split(" ",2)[1]};g.parseMLine=function(a){a=g.splitLines(a)[0].split(" ");return{kind:a[0].substr(2),port:parseInt(a[1],10),
protocol:a[2],fmt:a.slice(3).join(" ")}};"object"==typeof a&&(a.exports=g)},{}],3:[function(c,a,h){h=void 0!==d?d:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};c=c("./adapter_factory.js");a.exports=c({window:h.window})},{"./adapter_factory.js":4}],4:[function(c,a,d){var g=c("./utils");a.exports=function(a,d){a=a&&a.window;var b={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(e in d)hasOwnProperty.call(d,e)&&(b[e]=d[e]);d=g.log;var e=g.detectBrowser(a);var h={browserDetails:e,
extractVersion:g.extractVersion,disableLog:g.disableLog,disableWarnings:g.disableWarnings},l=c("./chrome/chrome_shim")||null,w=c("./edge/edge_shim")||null,p=c("./firefox/firefox_shim")||null,q=c("./safari/safari_shim")||null,m=c("./common_shim")||null;switch(e.browser){case "chrome":if(!l||!l.shimPeerConnection||!b.shimChrome)return d("Chrome shim is not included in this adapter release."),h;d("adapter.js shimming chrome.");h.browserShim=l;m.shimCreateObjectURL(a);l.shimGetUserMedia(a);l.shimMediaStream(a);
l.shimSourceObject(a);l.shimPeerConnection(a);l.shimOnTrack(a);l.shimAddTrackRemoveTrack(a);l.shimGetSendersWithDtmf(a);m.shimRTCIceCandidate(a);break;case "firefox":if(!p||!p.shimPeerConnection||!b.shimFirefox)return d("Firefox shim is not included in this adapter release."),h;d("adapter.js shimming firefox.");h.browserShim=p;m.shimCreateObjectURL(a);p.shimGetUserMedia(a);p.shimSourceObject(a);p.shimPeerConnection(a);p.shimOnTrack(a);m.shimRTCIceCandidate(a);break;case "edge":if(!w||!w.shimPeerConnection||
!b.shimEdge)return d("MS edge shim is not included in this adapter release."),h;d("adapter.js shimming edge.");h.browserShim=w;m.shimCreateObjectURL(a);w.shimGetUserMedia(a);w.shimPeerConnection(a);w.shimReplaceTrack(a);break;case "safari":if(!q||!b.shimSafari)return d("Safari shim is not included in this adapter release."),h;d("adapter.js shimming safari.");h.browserShim=q;m.shimCreateObjectURL(a);q.shimRTCIceServerUrls(a);q.shimCallbacksAPI(a);q.shimLocalStreamsAPI(a);q.shimRemoteStreamsAPI(a);
q.shimTrackEventTransceiver(a);q.shimGetUserMedia(a);q.shimCreateOfferLegacy(a);m.shimRTCIceCandidate(a);break;default:d("Unsupported browser!")}return h}},{"./chrome/chrome_shim":5,"./common_shim":7,"./edge/edge_shim":8,"./firefox/firefox_shim":10,"./safari/safari_shim":12,"./utils":13}],5:[function(c,a,d){var g=c("../utils.js"),b=g.log;a.exports={shimMediaStream:function(a){a.MediaStream=a.MediaStream||a.webkitMediaStream},shimOnTrack:function(a){if("object"==typeof a&&a.RTCPeerConnection&&!("ontrack"in
a.RTCPeerConnection.prototype)){Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&this.removeEventListener("track",this._ontrack);this.addEventListener("track",this._ontrack=a)}});var b=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){var c=this;return c._ontrackpoly||(c._ontrackpoly=function(b){b.stream.addEventListener("addtrack",function(d){var e=a.RTCPeerConnection.prototype.getReceivers?
c.getReceivers().find(function(a){return a.track&&a.track.id===d.track.id}):{track:d.track};var g=new Event("track");g.track=d.track;g.receiver=e;g.transceiver={receiver:e};g.streams=[b.stream];c.dispatchEvent(g)});b.stream.getTracks().forEach(function(d){var e=a.RTCPeerConnection.prototype.getReceivers?c.getReceivers().find(function(a){return a.track&&a.track.id===d.id}):{track:d};var g=new Event("track");g.track=d;g.receiver=e;g.transceiver={receiver:e};g.streams=[b.stream];c.dispatchEvent(g)})},
c.addEventListener("addstream",c._ontrackpoly)),b.apply(c,arguments)}}},shimAddTrackRemoveTrack:function(a){function b(a,b){var c=b.sdp;return Object.keys(a._reverseStreams||[]).forEach(function(b){b=a._reverseStreams[b];c=c.replace(new RegExp(a._streams[b.id].id,"g"),b.id)}),new RTCSessionDescription({type:b.type,sdp:c})}var c=g.detectBrowser(a);if(!(a.RTCPeerConnection.prototype.addTrack&&63<=c.version)){var d=a.RTCPeerConnection.prototype.getLocalStreams;a.RTCPeerConnection.prototype.getLocalStreams=
function(){var a=this,b=d.apply(this);return a._reverseStreams=a._reverseStreams||{},b.map(function(b){return a._reverseStreams[b.id]})};var e=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(b){var c=this;if(c._streams=c._streams||{},c._reverseStreams=c._reverseStreams||{},b.getTracks().forEach(function(a){if(c.getSenders().find(function(b){return b.track===a}))throw new DOMException("Track already exists.","InvalidAccessError");}),!c._reverseStreams[b.id]){var d=
new a.MediaStream(b.getTracks());c._streams[b.id]=d;c._reverseStreams[d.id]=b;b=d}e.apply(c,[b])};var h=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){this._streams=this._streams||{};this._reverseStreams=this._reverseStreams||{};h.apply(this,[this._streams[a.id]||a]);delete this._reverseStreams[this._streams[a.id]?this._streams[a.id].id:a.id];delete this._streams[a.id]};a.RTCPeerConnection.prototype.addTrack=function(b,c){var d=this;if("closed"===
d.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var e=[].slice.call(arguments,1);if(1!==e.length||!e[0].getTracks().find(function(a){return a===b}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(d.getSenders().find(function(a){return a.track===b}))throw new DOMException("Track already exists.","InvalidAccessError");d._streams=
d._streams||{};d._reverseStreams=d._reverseStreams||{};(e=d._streams[c.id])?(e.addTrack(b),Promise.resolve().then(function(){d.dispatchEvent(new Event("negotiationneeded"))})):(e=new a.MediaStream([b]),d._streams[c.id]=e,d._reverseStreams[e.id]=c,d.addStream(e));return d.getSenders().find(function(a){return a.track===b})};["createOffer","createAnswer"].forEach(function(c){var d=a.RTCPeerConnection.prototype[c];a.RTCPeerConnection.prototype[c]=function(){var a=this,c=arguments;return arguments.length&&
"function"==typeof arguments[0]?d.apply(a,[function(d){d=b(a,d);c[0].apply(null,[d])},function(a){c[1]&&c[1].apply(null,a)},arguments[2]]):d.apply(a,arguments).then(function(c){return b(a,c)})}});var p=a.RTCPeerConnection.prototype.setLocalDescription;a.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(a,b){var c=b.sdp;return Object.keys(a._reverseStreams||[]).forEach(function(b){b=a._reverseStreams[b];c=c.replace(new RegExp(b.id,
"g"),a._streams[b.id].id)}),new RTCSessionDescription({type:b.type,sdp:c})}(this,arguments[0]),p.apply(this,arguments)):p.apply(this,arguments)};var l=Object.getOwnPropertyDescriptor(a.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(a.RTCPeerConnection.prototype,"localDescription",{get:function(){var a=l.get.apply(this);return""===a.type?a:b(this,a)}});a.RTCPeerConnection.prototype.removeTrack=function(a){var b=this;if("closed"===b.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.",
"InvalidStateError");if(!a._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");var c;if(a._pc!==b)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");b._streams=b._streams||{};Object.keys(b._streams).forEach(function(d){b._streams[d].getTracks().find(function(b){return a.track===b})&&(c=b._streams[d])});c&&(1===c.getTracks().length?b.removeStream(b._reverseStreams[c.id]):c.removeTrack(a.track),
b.dispatchEvent(new Event("negotiationneeded")))}}},shimGetSendersWithDtmf:function(a){if("object"==typeof a&&a.RTCPeerConnection&&!("getSenders"in a.RTCPeerConnection.prototype)&&"createDTMFSender"in a.RTCPeerConnection.prototype){var b=function(a,b){return{track:b,get dtmf(){return void 0===this._dtmf&&("audio"===b.kind?this._dtmf=a.createDTMFSender(b):this._dtmf=null),this._dtmf},_pc:a}};if(!a.RTCPeerConnection.prototype.getSenders){a.RTCPeerConnection.prototype.getSenders=function(){return this._senders=
this._senders||[],this._senders.slice()};var c=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,d){var e=c.apply(this,arguments);return e||(e=b(this,a),this._senders.push(e)),e};var d=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){d.apply(this,arguments);var b=this._senders.indexOf(a);-1!==b&&this._senders.splice(b,1)}}var e=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){var c=
this;c._senders=c._senders||[];e.apply(c,[a]);a.getTracks().forEach(function(a){c._senders.push(b(c,a))})};var g=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){var b=this;b._senders=b._senders||[];g.apply(b,[a]);a.getTracks().forEach(function(a){var c=b._senders.find(function(b){return b.track===a});c&&b._senders.splice(b._senders.indexOf(c),1)})}}else if("object"==typeof a&&a.RTCPeerConnection&&"getSenders"in a.RTCPeerConnection.prototype&&"createDTMFSender"in
a.RTCPeerConnection.prototype&&a.RTCRtpSender&&!("dtmf"in a.RTCRtpSender.prototype)){var h=a.RTCPeerConnection.prototype.getSenders;a.RTCPeerConnection.prototype.getSenders=function(){var a=this,b=h.apply(a,[]);return b.forEach(function(b){b._pc=a}),b};Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSourceObject:function(a){var b=a&&a.URL;
"object"==typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement.prototype||Object.defineProperty(a.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(a){var c=this;this._srcObject=a;this.src&&b.revokeObjectURL(this.src);a?(this.src=b.createObjectURL(a),a.addEventListener("addtrack",function(){c.src&&b.revokeObjectURL(c.src);c.src=b.createObjectURL(a)}),a.addEventListener("removetrack",function(){c.src&&b.revokeObjectURL(c.src);c.src=b.createObjectURL(a)})):
this.src=""}}))},shimPeerConnection:function(a){var c=g.detectBrowser(a);if(a.RTCPeerConnection){var d=a.RTCPeerConnection;a.RTCPeerConnection=function(a,b){if(a&&a.iceServers){for(var c=[],e=0;e<a.iceServers.length;e++){var k=a.iceServers[e];!k.hasOwnProperty("urls")&&k.hasOwnProperty("url")?(g.deprecated("RTCIceServer.url","RTCIceServer.urls"),(k=JSON.parse(JSON.stringify(k))).urls=k.url,c.push(k)):c.push(a.iceServers[e])}a.iceServers=c}return new d(a,b)};a.RTCPeerConnection.prototype=d.prototype;
Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return d.generateCertificate}})}else a.RTCPeerConnection=function(c,d){return b("PeerConnection"),c&&c.iceTransportPolicy&&(c.iceTransports=c.iceTransportPolicy),new a.webkitRTCPeerConnection(c,d)},a.RTCPeerConnection.prototype=a.webkitRTCPeerConnection.prototype,a.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return a.webkitRTCPeerConnection.generateCertificate}});
var e=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(a,b,c){var d=this,g=arguments;if(0<arguments.length&&"function"==typeof a)return e.apply(this,arguments);if(0===e.length&&(0===arguments.length||"function"!=typeof arguments[0]))return e.apply(this,[]);var k=function(a){var b={};return a.result().forEach(function(a){var c={id:a.id,timestamp:a.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type};a.names().forEach(function(b){c[b]=
a.stat(b)});b[c.id]=c}),b},h=function(a){return new Map(Object.keys(a).map(function(b){return[b,a[b]]}))};return 2<=arguments.length?e.apply(this,[function(a){g[1](h(k(a)))},arguments[0]]):(new Promise(function(a,b){e.apply(d,[function(b){a(h(k(b)))},b])})).then(b,c)};51>c.version&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){var a=arguments,b=this,d=new Promise(function(d,e){c.apply(b,
[a[0],d,e])});return 2>a.length?d:d.then(function(){a[1].apply(null,[])},function(b){3<=a.length&&a[2].apply(null,[b])})}});52>c.version&&["createOffer","createAnswer"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){var a=this;if(1>arguments.length||1===arguments.length&&"object"==typeof arguments[0]){var b=1===arguments.length?arguments[0]:void 0;return new Promise(function(d,e){c.apply(a,[d,e,b])})}return c.apply(this,arguments)}});["setLocalDescription",
"setRemoteDescription","addIceCandidate"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){return arguments[0]=new ("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}});var h=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?h.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}},shimGetUserMedia:c("./getusermedia")}},
{"../utils.js":13,"./getusermedia":6}],6:[function(c,a,d){var g=c("../utils.js"),b=g.log;a.exports=function(a){var c=g.detectBrowser(a),d=a&&a.navigator,e=function(a){if("object"!=typeof a||a.mandatory||a.optional)return a;var b={};return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d="object"==typeof a[c]?a[c]:{ideal:a[c]};void 0!==d.exact&&"number"==typeof d.exact&&(d.min=d.max=d.exact);var e=function(a,b){return a?a+b.charAt(0).toUpperCase()+b.slice(1):
"deviceId"===b?"sourceId":b};if(void 0!==d.ideal){b.optional=b.optional||[];var g={};"number"==typeof d.ideal?(g[e("min",c)]=d.ideal,b.optional.push(g),(g={})[e("max",c)]=d.ideal,b.optional.push(g)):(g[e("",c)]=d.ideal,b.optional.push(g))}void 0!==d.exact&&"number"!=typeof d.exact?(b.mandatory=b.mandatory||{},b.mandatory[e("",c)]=d.exact):["min","max"].forEach(function(a){void 0!==d[a]&&(b.mandatory=b.mandatory||{},b.mandatory[e(a,c)]=d[a])})}}),a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced)),
b},h=function(a,g){if((a=JSON.parse(JSON.stringify(a)))&&"object"==typeof a.audio){var k=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])};a=JSON.parse(JSON.stringify(a));k(a.audio,"autoGainControl","googAutoGainControl");k(a.audio,"noiseSuppression","googNoiseSuppression");a.audio=e(a.audio)}if(a&&"object"==typeof a.video){var h=a.video.facingMode,h=h&&("object"==typeof h?h:{ideal:h}),n,k=66>c.version;if(!(!h||"user"!==h.exact&&"environment"!==h.exact&&"user"!==h.ideal&&"environment"!==
h.ideal||d.mediaDevices.getSupportedConstraints&&d.mediaDevices.getSupportedConstraints().facingMode&&!k)&&(delete a.video.facingMode,"environment"===h.exact||"environment"===h.ideal?n=["back","rear"]:"user"!==h.exact&&"user"!==h.ideal||(n=["front"]),n))return d.mediaDevices.enumerateDevices().then(function(c){var d=(c=c.filter(function(a){return"videoinput"===a.kind})).find(function(a){return n.some(function(b){return-1!==a.label.toLowerCase().indexOf(b)})});return!d&&c.length&&-1!==n.indexOf("back")&&
(d=c[c.length-1]),d&&(a.video.deviceId=h.exact?{exact:d.deviceId}:{ideal:d.deviceId}),a.video=e(a.video),b("chrome: "+JSON.stringify(a)),g(a)});a.video=e(a.video)}return b("chrome: "+JSON.stringify(a)),g(a)},l=function(a){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[a.name]||
a.name,message:a.message,constraint:a.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};d.getUserMedia=function(a,b,c){h(a,function(a){d.webkitGetUserMedia(a,b,function(a){c&&c(l(a))})})};var p=function(a){return new Promise(function(b,c){d.getUserMedia(a,b,c)})};if(d.mediaDevices||(d.mediaDevices={getUserMedia:p,enumerateDevices:function(){return new Promise(function(b){var c={audio:"audioinput",video:"videoinput"};return a.MediaStreamTrack.getSources(function(a){b(a.map(function(a){return{label:a.label,
kind:c[a.kind],deviceId:a.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),d.mediaDevices.getUserMedia){var q=d.mediaDevices.getUserMedia.bind(d.mediaDevices);d.mediaDevices.getUserMedia=function(a){return h(a,function(a){return q(a).then(function(b){if(a.audio&&!b.getAudioTracks().length||a.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(function(a){a.stop()}),new DOMException("","NotFoundError");
return b},function(a){return Promise.reject(l(a))})})}}else d.mediaDevices.getUserMedia=function(a){return p(a)};void 0===d.mediaDevices.addEventListener&&(d.mediaDevices.addEventListener=function(){b("Dummy mediaDevices.addEventListener called.")});void 0===d.mediaDevices.removeEventListener&&(d.mediaDevices.removeEventListener=function(){b("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":13}],7:[function(c,a,d){var g=c("sdp"),b=c("./utils");a.exports={shimRTCIceCandidate:function(a){if(!(a.RTCIceCandidate&&
"foundation"in a.RTCIceCandidate.prototype)){var b=a.RTCIceCandidate;a.RTCIceCandidate=function(a){"object"==typeof a&&a.candidate&&0===a.candidate.indexOf("a\x3d")&&((a=JSON.parse(JSON.stringify(a))).candidate=a.candidate.substr(2));var c=new b(a);a=g.parseCandidate(a.candidate);var d=Object.assign(c,a);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d};(function(a,b,c){if(a.RTCPeerConnection){a=a.RTCPeerConnection.prototype;
var d=a.addEventListener;a.addEventListener=function(a,e){if(a!==b)return d.apply(this,arguments);var g=function(a){e(c(a))};return this._eventMap=this._eventMap||{},this._eventMap[e]=g,d.apply(this,[a,g])};var e=a.removeEventListener;a.removeEventListener=function(a,c){if(a!==b||!this._eventMap||!this._eventMap[c])return e.apply(this,arguments);var d=this._eventMap[c];return delete this._eventMap[c],e.apply(this,[a,d])};Object.defineProperty(a,"on"+b,{get:function(){return this["_on"+b]},set:function(a){this["_on"+
b]&&(this.removeEventListener(b,this["_on"+b]),delete this["_on"+b]);a&&this.addEventListener(b,this["_on"+b]=a)}})}})(a,"icecandidate",function(b){return b.candidate&&Object.defineProperty(b,"candidate",{value:new a.RTCIceCandidate(b.candidate),writable:"false"}),b})}},shimCreateObjectURL:function(a){var c=a&&a.URL;if("object"==typeof a&&a.HTMLMediaElement&&"srcObject"in a.HTMLMediaElement.prototype&&c.createObjectURL&&c.revokeObjectURL){var d=c.createObjectURL.bind(c),e=c.revokeObjectURL.bind(c),
g=new Map,h=0;c.createObjectURL=function(a){if("getTracks"in a){var c="polyblob:"+ ++h;return g.set(c,a),b.deprecated("URL.createObjectURL(stream)","elem.srcObject \x3d stream"),c}return d(a)};c.revokeObjectURL=function(a){e(a);g.delete(a)};var l=Object.getOwnPropertyDescriptor(a.HTMLMediaElement.prototype,"src");Object.defineProperty(a.HTMLMediaElement.prototype,"src",{get:function(){return l.get.apply(this)},set:function(a){return this.srcObject=g.get(a)||null,l.set.apply(this,[a])}});var q=a.HTMLMediaElement.prototype.setAttribute;
a.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=g.get(arguments[1])||null),q.apply(this,arguments)}}}}},{"./utils":13,sdp:2}],8:[function(c,a,d){var g=c("../utils"),b=c("rtcpeerconnection-shim");a.exports={shimGetUserMedia:c("./getusermedia"),shimPeerConnection:function(a){var c=g.detectBrowser(a);if(a.RTCIceGatherer&&(a.RTCIceCandidate||(a.RTCIceCandidate=function(a){return a}),a.RTCSessionDescription||(a.RTCSessionDescription=
function(a){return a}),15025>c.version)){var d=Object.getOwnPropertyDescriptor(a.MediaStreamTrack.prototype,"enabled");Object.defineProperty(a.MediaStreamTrack.prototype,"enabled",{set:function(a){d.set.call(this,a);var b=new Event("enabled");b.enabled=a;this.dispatchEvent(b)}})}!a.RTCRtpSender||"dtmf"in a.RTCRtpSender.prototype||Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new a.RTCDtmfSender(this):"video"===
this.track.kind&&(this._dtmf=null)),this._dtmf}});a.RTCPeerConnection=b(a,c.version)},shimReplaceTrack:function(a){!a.RTCRtpSender||"replaceTrack"in a.RTCRtpSender.prototype||(a.RTCRtpSender.prototype.replaceTrack=a.RTCRtpSender.prototype.setTrack)}}},{"../utils":13,"./getusermedia":9,"rtcpeerconnection-shim":1}],9:[function(c,a,d){a.exports=function(a){a=a&&a.navigator;var b=a.mediaDevices.getUserMedia.bind(a.mediaDevices);a.mediaDevices.getUserMedia=function(a){return b(a).catch(function(a){return Promise.reject(function(a){return{name:{PermissionDeniedError:"NotAllowedError"}[a.name]||
a.name,message:a.message,constraint:a.constraint,toString:function(){return this.name}}}(a))})}}},{}],10:[function(c,a,d){var g=c("../utils");a.exports={shimOnTrack:function(a){"object"!=typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly));this.addEventListener("track",
this._ontrack=a);this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.getTracks().forEach(function(b){var c=new Event("track");c.track=b;c.receiver={track:b};c.transceiver={receiver:c.receiver};c.streams=[a.stream];this.dispatchEvent(c)}.bind(this))}.bind(this))}});"object"==typeof a&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},
shimSourceObject:function(a){"object"==typeof a&&(!a.HTMLMediaElement||"srcObject"in a.HTMLMediaElement.prototype||Object.defineProperty(a.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(a){this.mozSrcObject=a}}))},shimPeerConnection:function(a){var b=g.detectBrowser(a);if("object"==typeof a&&(a.RTCPeerConnection||a.mozRTCPeerConnection)){a.RTCPeerConnection||(a.RTCPeerConnection=function(c,d){if(38>b.version&&c&&c.iceServers){for(var e=[],g=0;g<c.iceServers.length;g++){var k=
c.iceServers[g];if(k.hasOwnProperty("urls"))for(var h=0;h<k.urls.length;h++){var n={url:k.urls[h]};0===k.urls[h].indexOf("turn")&&(n.username=k.username,n.credential=k.credential);e.push(n)}else e.push(c.iceServers[g])}c.iceServers=e}return new a.mozRTCPeerConnection(c,d)},a.RTCPeerConnection.prototype=a.mozRTCPeerConnection.prototype,a.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return a.mozRTCPeerConnection.generateCertificate}}),
a.RTCSessionDescription=a.mozRTCSessionDescription,a.RTCIceCandidate=a.mozRTCIceCandidate);["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){var c=a.RTCPeerConnection.prototype[b];a.RTCPeerConnection.prototype[b]=function(){return arguments[0]=new ("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}});var c=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?
c.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var d={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},h=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(a,c,e){return h.apply(this,[a||null]).then(function(a){if(48>b.version&&(a=function(a){var b=new Map;return Object.keys(a).forEach(function(c){b.set(c,a[c]);b[c]=a[c]}),
b}(a)),53>b.version&&!c)try{a.forEach(function(a){a.type=d[a.type]||a.type})}catch(m){if("TypeError"!==m.name)throw m;a.forEach(function(b,c){a.set(c,Object.assign({},b,{type:d[b.type]||b.type}))})}return a}).then(c,e)}}},shimGetUserMedia:c("./getusermedia")}},{"../utils":13,"./getusermedia":11}],11:[function(c,a,d){var g=c("../utils"),b=g.log;a.exports=function(a){var c=g.detectBrowser(a),d=a&&a.navigator;a=a&&a.MediaStreamTrack;var e=function(a){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",
PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[a.name]||a.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[a.message]||a.message,constraint:a.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},h=function(a,g,k){var h=function(a){if("object"!=typeof a||a.require)return a;var b=[];return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==
c){var d=a[c]="object"==typeof a[c]?a[c]:{ideal:a[c]};if(void 0===d.min&&void 0===d.max&&void 0===d.exact||b.push(c),void 0!==d.exact&&("number"==typeof d.exact?d.min=d.max=d.exact:a[c]=d.exact,delete d.exact),void 0!==d.ideal){a.advanced=a.advanced||[];var e={};"number"==typeof d.ideal?e[c]={min:d.ideal,max:d.ideal}:e[c]=d.ideal;a.advanced.push(e);delete d.ideal;Object.keys(d).length||delete a[c]}}}),b.length&&(a.require=b),a};return a=JSON.parse(JSON.stringify(a)),38>c.version&&(b("spec: "+JSON.stringify(a)),
a.audio&&(a.audio=h(a.audio)),a.video&&(a.video=h(a.video)),b("ff37: "+JSON.stringify(a))),d.mozGetUserMedia(a,g,function(a){k(e(a))})};if(d.mediaDevices||(d.mediaDevices={getUserMedia:function(a){return new Promise(function(b,c){h(a,b,c)})},addEventListener:function(){},removeEventListener:function(){}}),d.mediaDevices.enumerateDevices=d.mediaDevices.enumerateDevices||function(){return new Promise(function(a){a([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",
label:"",groupId:""}])})},41>c.version){var l=d.mediaDevices.enumerateDevices.bind(d.mediaDevices);d.mediaDevices.enumerateDevices=function(){return l().then(void 0,function(a){if("NotFoundError"===a.name)return[];throw a;})}}if(49>c.version){var p=d.mediaDevices.getUserMedia.bind(d.mediaDevices);d.mediaDevices.getUserMedia=function(a){return p(a).then(function(b){if(a.audio&&!b.getAudioTracks().length||a.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(function(a){a.stop()}),new DOMException("The object can not be found here.",
"NotFoundError");return b},function(a){return Promise.reject(e(a))})}}if(!(55<c.version&&"autoGainControl"in d.mediaDevices.getSupportedConstraints())){var q=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])},m=d.mediaDevices.getUserMedia.bind(d.mediaDevices);if(d.mediaDevices.getUserMedia=function(a){return"object"==typeof a&&"object"==typeof a.audio&&(a=JSON.parse(JSON.stringify(a)),q(a.audio,"autoGainControl","mozAutoGainControl"),q(a.audio,"noiseSuppression","mozNoiseSuppression")),m(a)},
a&&a.prototype.getSettings){var r=a.prototype.getSettings;a.prototype.getSettings=function(){var a=r.apply(this,arguments);return q(a,"mozAutoGainControl","autoGainControl"),q(a,"mozNoiseSuppression","noiseSuppression"),a}}if(a&&a.prototype.applyConstraints){var u=a.prototype.applyConstraints;a.prototype.applyConstraints=function(a){return"audio"===this.kind&&"object"==typeof a&&(a=JSON.parse(JSON.stringify(a)),q(a,"autoGainControl","mozAutoGainControl"),q(a,"noiseSuppression","mozNoiseSuppression")),
u.apply(this,[a])}}}d.getUserMedia=function(a,b,e){if(44>c.version)return h(a,b,e);g.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia");d.mediaDevices.getUserMedia(a).then(b,e)}}},{"../utils":13}],12:[function(c,a,d){var g=c("../utils");a.exports={shimCallbacksAPI:function(a){if("object"==typeof a&&a.RTCPeerConnection){a=a.RTCPeerConnection.prototype;var b=a.createOffer,c=a.createAnswer,d=a.setLocalDescription,g=a.setRemoteDescription,h=a.addIceCandidate;a.createOffer=function(a,
c){var d=b.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);return c?(d.then(a,c),Promise.resolve()):d};a.createAnswer=function(a,b){var d=c.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);return b?(d.then(a,b),Promise.resolve()):d};var l=function(a,b,c){a=d.apply(this,[a]);return c?(a.then(b,c),Promise.resolve()):a};a.setLocalDescription=l;l=function(a,b,c){a=g.apply(this,[a]);return c?(a.then(b,c),Promise.resolve()):a};a.setRemoteDescription=l;l=function(a,b,c){a=h.apply(this,
[a]);return c?(a.then(b,c),Promise.resolve()):a};a.addIceCandidate=l}},shimLocalStreamsAPI:function(a){if("object"==typeof a&&a.RTCPeerConnection){if("getLocalStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getStreamById=function(a){var b=null;return this._localStreams&&this._localStreams.forEach(function(c){c.id===
a&&(b=c)}),this._remoteStreams&&this._remoteStreams.forEach(function(c){c.id===a&&(b=c)}),b}),!("addStream"in a.RTCPeerConnection.prototype)){var b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addStream=function(a){this._localStreams||(this._localStreams=[]);-1===this._localStreams.indexOf(a)&&this._localStreams.push(a);var c=this;a.getTracks().forEach(function(d){b.call(c,d,a)})};a.RTCPeerConnection.prototype.addTrack=function(a,c){c&&(this._localStreams?-1===this._localStreams.indexOf(c)&&
this._localStreams.push(c):this._localStreams=[c]);b.call(this,a,c)}}"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){this._localStreams||(this._localStreams=[]);var b=this._localStreams.indexOf(a);if(-1!==b){this._localStreams.splice(b,1);var c=this,d=a.getTracks();this.getSenders().forEach(function(a){-1!==d.indexOf(a.track)&&c.removeTrack(a)})}})}},shimRemoteStreamsAPI:function(a){"object"==typeof a&&a.RTCPeerConnection&&("getRemoteStreams"in
a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(a){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly));this.addEventListener("addstream",this._onaddstream=a);
this.addEventListener("track",this._onaddstreampoly=function(a){var b=a.streams[0];(this._remoteStreams||(this._remoteStreams=[]),0<=this._remoteStreams.indexOf(b))||(this._remoteStreams.push(b),b=new Event("addstream"),b.stream=a.streams[0],this.dispatchEvent(b))}.bind(this))}}))},shimGetUserMedia:function(a){var b=a&&a.navigator;b.getUserMedia||(b.webkitGetUserMedia?b.getUserMedia=b.webkitGetUserMedia.bind(b):b.mediaDevices&&b.mediaDevices.getUserMedia&&(b.getUserMedia=function(a,c,d){b.mediaDevices.getUserMedia(a).then(c,
d)}.bind(b)))},shimRTCIceServerUrls:function(a){var b=a.RTCPeerConnection;a.RTCPeerConnection=function(a,c){if(a&&a.iceServers){for(var d=[],e=0;e<a.iceServers.length;e++){var k=a.iceServers[e];!k.hasOwnProperty("urls")&&k.hasOwnProperty("url")?(g.deprecated("RTCIceServer.url","RTCIceServer.urls"),(k=JSON.parse(JSON.stringify(k))).urls=k.url,delete k.url,d.push(k)):d.push(a.iceServers[e])}a.iceServers=d}return new b(a,c)};a.RTCPeerConnection.prototype=b.prototype;"generateCertificate"in a.RTCPeerConnection&&
Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return b.generateCertificate}})},shimTrackEventTransceiver:function(a){"object"==typeof a&&a.RTCPeerConnection&&"receiver"in a.RTCTrackEvent.prototype&&!a.RTCTransceiver&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(a){var b=a.RTCPeerConnection.prototype.createOffer;a.RTCPeerConnection.prototype.createOffer=function(a){if(a){var c=
this.getTransceivers().find(function(a){return a.sender.track&&"audio"===a.sender.track.kind});!1===a.offerToReceiveAudio&&c?"sendrecv"===c.direction?c.setDirection("sendonly"):"recvonly"===c.direction&&c.setDirection("inactive"):!0!==a.offerToReceiveAudio||c||this.addTransceiver("audio");c=this.getTransceivers().find(function(a){return a.sender.track&&"video"===a.sender.track.kind});!1===a.offerToReceiveVideo&&c?"sendrecv"===c.direction?c.setDirection("sendonly"):"recvonly"===c.direction&&c.setDirection("inactive"):
!0!==a.offerToReceiveVideo||c||this.addTransceiver("video")}return b.apply(this,arguments)}}}},{"../utils":13}],13:[function(c,a,d){var g=!0,b=!0;c={disableLog:function(a){return"boolean"!=typeof a?Error("Argument type: "+typeof a+". Please use a boolean."):(g=a,a?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(a){return"boolean"!=typeof a?Error("Argument type: "+typeof a+". Please use a boolean."):(b=!a,"adapter.js deprecation warnings "+(a?"disabled":"enabled"))},
log:function(){"object"!=typeof window||g||"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)},deprecated:function(a,c){b&&console.warn(a+" is deprecated, please use "+c+" instead.")},extractVersion:function(a,b,c){return(a=a.match(b))&&a.length>=c&&parseInt(a[c],10)},detectBrowser:function(a){var b=a&&a.navigator,c={browser:null,version:null};if(void 0===a||!a.navigator)return c.browser="Not a browser.",c;if(b.mozGetUserMedia)c.browser="firefox",c.version=
this.extractVersion(b.userAgent,/Firefox\/(\d+)\./,1);else if(b.webkitGetUserMedia)if(a.webkitRTCPeerConnection)c.browser="chrome",c.version=this.extractVersion(b.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!b.userAgent.match(/Version\/(\d+).(\d+)/))return c.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",c;c.browser="safari";c.version=this.extractVersion(b.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(b.mediaDevices&&b.userAgent.match(/Edge\/(\d+).(\d+)$/))c.browser=
"edge",c.version=this.extractVersion(b.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!b.mediaDevices||!b.userAgent.match(/AppleWebKit\/(\d+)\./))return c.browser="Not a supported browser.",c;c.browser="safari";c.version=this.extractVersion(b.userAgent,/AppleWebKit\/(\d+)\./,1)}return c}};a.exports={log:c.log,deprecated:c.deprecated,disableLog:c.disableLog,disableWarnings:c.disableWarnings,extractVersion:c.extractVersion,shimCreateObjectURL:c.shimCreateObjectURL,detectBrowser:c.detectBrowser.bind(c)}},
{}]},{},[3])(3)}).call(this,h(7))},function(l,r,h){r=h(7);l.exports=r.adapter=h(24)},function(l,r){l.exports=function(h){if(!h.webpackPolyfill){var d=Object.create(h);d.children||(d.children=[]);Object.defineProperty(d,"loaded",{enumerable:!0,get:function(){return d.l}});Object.defineProperty(d,"id",{enumerable:!0,get:function(){return d.i}});Object.defineProperty(d,"exports",{enumerable:!0});d.webpackPolyfill=1}return d}},function(l,r,h){var d=h(3),f=function(c,a){this.id=c;this.direction=a;this.formats=
[];this.params=new Map};f.prototype.clone=function(){var c=new f(this.id,this.direction);return c.setFormats(this.formats),c.setParams(this.params),c};f.prototype.plain=function(){var c={id:this.id,direction:d.toString(this.direction),formats:this.formats,params:{}};return this.params.forEach(function(a,d){c.params[d]=a}),c};f.prototype.getId=function(){return this.id};f.prototype.getDirection=function(){return this.direction};f.prototype.setDirection=function(c){this.direction=c};f.prototype.getFormats=
function(){return this.formats};f.prototype.setFormats=function(c){var a=this;this.formats=[];c.forEach(function(c){a.formats.push(parseInt(c,10))})};f.prototype.getParams=function(){return this.params};f.prototype.setParams=function(c){this.params=new Map(c)};l.exports=f},function(l,r){var h=function(d,f){this.paused=f;this.id=d};h.prototype.clone=function(){return new h(this.id,this.paused)};h.prototype.plain=function(){return{id:this.id,paused:this.paused}};h.prototype.isPaused=function(){return this.paused};
h.prototype.getId=function(){return this.id};l.exports=h},function(l,r){var h=function(d,f){this.id=d;this.paused=f;this.codecs=new Map;this.params=new Map};h.prototype.clone=function(){var d=new h(this.id,this.paused);return this.codecs.forEach(function(f){d.addCodec(f.cloned())}),d.setParams(this.params),d};h.prototype.plain=function(){var d=this,f={id:this.id,paused:this.paused,codecs:{},params:{}};return this.codecs.keys().forEach(function(c){f.codecs[c]=d.codecs.get(c).plain()}),this.params.keys().forEach(function(c){f.params[c]=
d.params.get(c).param}),f};h.prototype.getId=function(){return this.id};h.prototype.getCodecs=function(){return this.codecs};h.prototype.addCodec=function(d){this.codecs.set(d.getType(),d)};h.prototype.getParams=function(){return this.params};h.prototype.setParams=function(d){this.params=new Map(d)};h.prototype.isPaused=function(){return this.paused};l.exports=h},function(l,r,h){var d=h(18),f=/%[sdv%]/g,c=function(a,b,c){a=[a+"\x3d"+(b.format instanceof Function?b.format(b.push?c:c[b.name]):b.format)];
if(b.names)for(var d=0;d<b.names.length;d+=1){var e=b.names[d];b.name?a.push(c[b.name][e]):a.push(c[b.names[d]])}else a.push(c[b.name]);return function(a){var b=1,c=arguments,d=c.length;return a.replace(f,function(a){if(b>=d)return a;var e=c[b];switch(b+=1,a){case "%%":return"%";case "%s":return String(e);case "%d":return Number(e);case "%v":return""}})}.apply(null,a)},a="vosiuepcbtrza".split(""),u=["i","c","b","a"];l.exports=function(f,b){b=b||{};null==f.version&&(f.version=0);null==f.name&&(f.name=
" ");f.media.forEach(function(a){null==a.payloads&&(a.payloads="")});var e=b.innerOrder||u,g=[];return(b.outerOrder||a).forEach(function(a){d[a].forEach(function(b){b.name in f&&null!=f[b.name]?g.push(c(a,b,f)):b.push in f&&null!=f[b.push]&&f[b.push].forEach(function(d){g.push(c(a,b,d))})})}),f.media.forEach(function(a){g.push(c("m",d.m[0],a));e.forEach(function(b){d[b].forEach(function(d){d.name in a&&null!=a[d.name]?g.push(c(b,d,a)):d.push in a&&null!=a[d.push]&&a[d.push].forEach(function(a){g.push(c(b,
d,a))})})})}),g.join("\r\n")+"\r\n"}},function(l,r,h){var d=function(a){return String(Number(a))===a?Number(a):a},f=h(18),c=RegExp.prototype.test.bind(/^([a-z])=(.*)/);r.parse=function(a){var g={},b=[],e=g;return a.split(/(\r\n|\r|\n)/).filter(c).forEach(function(a){var c=a[0],g=a.slice(2);"m"===c&&(b.push({rtp:[],fmtp:[]}),e=b[b.length-1]);for(a=0;a<(f[c]||[]).length;a+=1){var h=f[c][a];if(h.reg.test(g)){c=h;a=e;h=g;g=c.name&&c.names;c.push&&!a[c.push]?a[c.push]=[]:g&&!a[c.name]&&(a[c.name]={});
var g=c.push?{}:g?a[c.name]:a,h=h.match(c.reg),l=c.names,n=c.name;if(n&&!l)g[n]=d(h[1]);else for(n=0;n<l.length;n+=1)null!=h[n+1]&&(g[l[n]]=d(h[n+1]));!0;c.push&&a[c.push].push(g);break}}}),g.media=b,g};var a=function(a,c){c=c.split(/=(.+)/,2);return 2===c.length&&(a[c[0]]=d(c[1])),a};r.parseParams=function(c){return c.split(/\;\s?/).reduce(a,{})};r.parseFmtpConfig=r.parseParams;r.parsePayloads=function(a){return a.split(" ").map(Number)};r.parseRemoteCandidates=function(a){var c=[];a=a.split(" ").map(d);
for(var b=0;b<a.length;b+=3)c.push({component:a[b],ip:a[b+1],port:a[b+2]});return c};r.parseImageAttributes=function(c){return c.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(a,{})})};r.parseSimulcastStreamList=function(a){return a.split(";").map(function(a){return a.split(",").map(function(a){var b,c=!1;return"~"!==a[0]?b=d(a):(b=d(a.substring(1,a.length)),c=!0),{scid:b,paused:c}})})}},function(l,r,h){l=h(31);h=h(30);r.write=h;r.parse=l.parse;r.parseFmtpConfig=l.parseFmtpConfig;
r.parseParams=l.parseParams;r.parsePayloads=l.parsePayloads;r.parseRemoteCandidates=l.parseRemoteCandidates;r.parseImageAttributes=l.parseImageAttributes;r.parseSimulcastStreamList=l.parseSimulcastStreamList},function(l,r,h){function d(a,b,c){var d=b.simulcast["dir"+a];a=b.simulcast["list"+a];if(d){var e=k.byValue(d);f.parseSimulcastStreamList(a).forEach(function(a){var b=[];a.forEach(function(a){b.push(new A(a.scid,a.paused))});c.addSimulcastAlternativeStreams(e,b)})}}var f=h(32),c=h(17),a=h(16),
u=h(15),g=h(14),b=h(13),e=h(6),n=h(4),k=h(3),t=h(11),x=h(10),w=h(9),p=h(8),q=h(29),m=h(12),A=h(28),B=h(27),v=function(a){this.version=a||1;this.name="sdp-semantic";this.streams=new Map;this.medias=[];this.candidates=[];this.dtls=this.ice=this.connection=null};v.prototype.clone=function(){var a=new v(this.version);return a.name=this.name,a.setConnection(this.connection),this.medias.forEach(function(b){a.addMedia(b.clone())}),this.streams.forEach(function(b){a.addStream(b.clone())}),this.candidates.forEach(function(b){a.addCandidate(b.clone())}),
a.setICE(this.ice.clone()),a.setDTLS(this.dtls.clone()),a};v.prototype.plain=function(){var a={version:this.version,name:this.name,streams:[],medias:[],candidates:[],connection:this.connection};return this.medias.forEach(function(b){a.medias.push(b.plain())}),this.streams.forEach(function(b){a.streams.push(b.plain())}),this.candidates.forEach(function(b){a.candidates.push(b.plain())}),a.ice=this.ice&&this.ice.plain(),a.dtls=this.dtls&&this.dtls.plain(),a};v.prototype.setVersion=function(a){this.version=
a};v.prototype.setOrigin=function(a){this.origin=a};v.prototype.setName=function(a){this.name=a};v.prototype.getConnection=function(){return this.connection};v.prototype.setConnection=function(a){this.connection=a};v.prototype.setTiming=function(a){this.timing=a};v.prototype.addMedia=function(a){this.medias.push(a)};v.prototype.getMedia=function(a){var b;return this.medias.forEach(function(c){c.getType().toLowerCase()===a.toLowerCase()&&(b=c)}),b};v.prototype.getMedias=function(a){if(!a)return this.medias;
var b=[];return this.medias.forEach(function(c){c.getType().toLowerCase()===a.toLowerCase()&&b.push(c)}),b};v.prototype.getMediaById=function(a){var b;return this.medias.forEach(function(c){c.getId().toLowerCase()===a.toLowerCase()&&(b=c)}),b};v.prototype.getVersion=function(){return this.version};v.prototype.getDTLS=function(){return this.dtls};v.prototype.setDTLS=function(a){this.dtls=a};v.prototype.getICE=function(){return this.ice};v.prototype.setICE=function(a){this.ice=a};v.prototype.addCandidate=
function(a){this.candidates.push(a)};v.prototype.addCandidates=function(a){var b=this;a.forEach(function(a){b.addCandidate(a)})};v.prototype.getCandidates=function(){return this.candidates};v.prototype.getStream=function(a){return this.streams.get(a)};v.prototype.getStreams=function(){return this.streams};v.prototype.getFirstStream=function(){return 0<this.streams.values().length?this.streams.values()[0]:null};v.prototype.addStream=function(a){this.streams.set(a.getId(),a)};v.prototype.removeStream=
function(a){this.streams.delete(a.getId())};v.prototype.toJSON=function(){var a={version:0,media:[]};a.version=this.version||0;a.origin=this.origin||{username:"-",sessionId:(new Date).getTime(),sessionVersion:this.version,netType:"IN",ipVer:4,address:"127.0.0.1"};a.name=this.name||"semantic-sdp";a.connection=this.getConnection();a.timing=this.timing||{start:0,stop:0};var b=this.getICE();b&&(b.isLite()&&(a.icelite="ice-lite"),a.iceOptions=b.getOpts(),a.iceUfrag=b.getUfrag(),a.icePwd=b.getPwd());a.msidSemantic=
this.msidSemantic||{semantic:"WMS",token:"*"};a.groups=[];var c={type:"BUNDLE",mids:[]},d=this.getDTLS();d&&(a.fingerprint={type:d.getHash(),hash:d.getFingerprint()},a.setup=e.toString(d.getSetup()));this.medias.forEach(function(c){var f={type:c.getType(),port:c.getPort(),protocol:"UDP/TLS/RTP/SAVPF",fmtp:[],rtp:[],rtcpFb:[],ext:[],bandwidth:[],candidates:[],ssrcGroups:[],ssrcs:[],rids:[]};f.direction=n.toString(c.getDirection());f.rtcpMux="rtcp-mux";f.connection=c.getConnection();f.xGoogleFlag=c.getXGoogleFlag();
f.mid=c.getId();h.mids.push(c.getId());f.rtcp=c.rtcp;0<c.getBitrate()&&f.bandwidth.push({type:"AS",limit:c.getBitrate()});c.getCandidates().forEach(function(a){f.candidates.push({foundation:a.getFoundation(),component:a.getComponentId(),transport:a.getTransport(),priority:a.getPriority(),ip:a.getAddress(),port:a.getPort(),type:a.getType(),relAddr:a.getRelAddr(),relPort:a.getRelPort(),generation:a.getGeneration()})});(b=c.getICE())&&(b.isLite()&&(f.icelite="ice-lite"),f.iceOptions=b.getOpts(),f.iceUfrag=
b.getUfrag(),f.icePwd=b.getPwd(),b.isEndOfCandidates()&&(f.endOfCandidates=b.isEndOfCandidates()));(d=c.getDTLS())&&(f.fingerprint={type:d.getHash(),hash:d.getFingerprint()},f.setup=e.toString(d.getSetup()));c.setup&&(f.setup=e.toString(c.setup));c.getCodecs().forEach(function(a){f.rtp.push({payload:a.getType(),codec:a.getCodec(),rate:a.getRate(),encoding:a.getEncoding()});var b=a.getParams();0<Object.keys(b).length&&f.fmtp.push({payload:a.getType(),config:Object.keys(b).map(function(a){return a+
(b[a]?"\x3d"+b[a]:"")}).join(";")});a.getFeedback().forEach(function(b){f.rtcpFb.push({payload:a.getType(),type:b.type,subtype:b.subtype})});a.hasRTX()&&(f.rtp.push({payload:a.getRTX(),codec:"rtx",rate:a.getRate(),encoding:a.getEncoding()}),f.fmtp.push({payload:a.getRTX(),config:"apt\x3d"+a.getType()}))});var g=[];f.rtp.forEach(function(a){g.push(a.payload)});f.payloads=g.join(" ");c.getExtensions().forEach(function(a,b){f.ext.push({value:b,uri:a})});c.getRIDs().forEach(function(a){var b={id:a.getId(),
direction:k.toString(a.getDirection()),params:""};a.getFormats().length&&(b.params="pt\x3d"+a.getFormats().join(","));a.getParams().forEach(function(a,c){b.params+=""+(b.params.length?";":"")+c+"\x3d"+a});f.rids.push(b)});var h=c.getSimulcast();c=c.getSimulcast03();if(h){var l=1;f.simulcast={};var m=h.getSimulcastStreams(k.SEND);h=h.getSimulcastStreams(k.RECV);if(m&&m.length){var p="";m.forEach(function(a){var b="";a.forEach(function(a){b+=(b.length?",":"")+(a.isPaused()?"~":"")+a.getId()});p+=(p.length?
";":"")+b});f.simulcast["dir"+l]="send";f.simulcast["list"+l]=p;l+=1}if(h&&h.length){var q=[];h.forEach(function(a){var b="";a.forEach(function(a){b+=(b.length?",":"")+(a.isPaused()?"~":"")+a.getId()});q+=(q.length?";":"")+b});f.simulcast["dir"+l]="recv";f.simulcast["list"+l]=q;l+=1}}c&&(f.simulcast_03={value:c.getSimulcastPlainString()});a.media.push(f)});c.mids.sort();a.media.sort(function(a,b){return a.mid<b.mid?-1:a.mid>b.mid?1:0});for(var f=$jscomp.makeIterator(this.streams.values()),g=f.next();!g.done;g=
f.next())for(var g=g.value,h=$jscomp.makeIterator(g.getTracks().values()),l=h.next();!l.done;l=h.next())for(var l=l.value,m={},p=$jscomp.makeIterator(a.media),q=p.next();!q.done;m={r$105:m.r$105},q=p.next())if(m.r$105=q.value,l.getMediaId()){if(l.getMediaId()===m.r$105.mid){l.getSourceGroups().forEach(function(a){return function(b){a.r$105.ssrcGroups.push({semantics:b.getSemantics(),ssrcs:b.getSSRCs().join(" ")})}}(m));l.getSSRCs().forEach(function(a){return function(b){a.r$105.ssrcs.push({id:b.ssrc,
attribute:"cname",value:b.getCName()})}}(m));g.getId()&&l.getId()&&(m.r$105.msid=g.getId()+" "+l.getId());break}}else if(m.r$105.type.toLowerCase()===l.getMedia().toLowerCase()){l.getSourceGroups().forEach(function(a){return function(b){a.r$105.ssrcGroups.push({semantics:b.getSemantics(),ssrcs:b.getSSRCs().join(" ")})}}(m));l.getSSRCs().forEach(function(a){return function(b){a.r$105.ssrcs.push({id:b.ssrc,attribute:"cname",value:b.getCName()});b.getStreamId()&&b.getTrackId()&&a.r$105.ssrcs.push({id:b.ssrc,
attribute:"msid",value:b.getStreamId()+" "+b.getTrackId()});b.getMSLabel()&&a.r$105.ssrcs.push({id:b.ssrc,attribute:"mslabel",value:b.getMSLabel()});b.getLabel()&&a.r$105.ssrcs.push({id:b.ssrc,attribute:"label",value:b.getLabel()})}}(m));break}return c.mids=c.mids.join(" "),a.groups.push(c),a};v.prototype.toString=function(){var a=this.toJSON();return f.write(a)};v.processString=function(a){a=f.parse(a);return v.process(a)};v.process=function(f){var h=new v;h.setVersion(f.version);h.setTiming(f.timing);
h.setConnection(f.connection);h.setOrigin(f.origin);h.msidSemantic=f.msidSemantic;h.name=f.name;var l=f.iceUfrag,r=f.icePwd,A=f.iceOptions;(l||r||A)&&h.setICE(new g(l,r,A));var D=f.fingerprint;if(D){l=D.type;var G=D.hash;var K=null;f.setup&&(K=e.byValue(f.setup));h.setDTLS(new u(K,l,G))}return f.media.forEach(function(f){var l,v=new b(f.mid,f.port,f.type);if(v.setXGoogleFlag(f.xGoogleFlag),v.rtcp=f.rtcp,v.setConnection(f.connection),f.bandwidth&&0<f.bandwidth.length&&f.bandwidth.forEach(function(a){"AS"===
a.type&&v.setBitrate(a.limit)}),l=f.iceUfrag,r=f.icePwd,A=f.iceOptions,l||r||A)l=new g(l,r,A),f.endOfCandidates&&l.setEndOfCandidates("end-of-candidates"),v.setICE(l);if(D=f.fingerprint){var z=D.type;l=D.hash;var C=e.ACTPASS;f.setup&&(C=e.byValue(f.setup));v.setDTLS(new u(C,z,l))}f.setup&&v.setSetup(e.byValue(f.setup));l=n.SENDRECV;f.direction&&(l=n.byValue(f.direction.toUpperCase()));v.setDirection(l);(l=f.candidates)&&l.forEach(function(a){v.addCandidate(new c(a.foundation,a.component,a.transport,
a.priority,a.ip,a.port,a.type,a.generation,a.relAddr,a.relPort))});(function(b,c){var d=new Map;c.rtp.forEach(function(e){var f=e.payload,g=e.codec,h=e.rate;e=e.encoding;var k={},l=[];c.fmtp.forEach(function(a){a.payload===f&&a.config.split(";").forEach(function(a){a=a.split("\x3d");k[a[0].trim()]=(a[1]||"").trim()})});c.rtcpFb&&c.rtcpFb.forEach(function(a){a.payload===f&&l.push({type:a.type,subtype:a.subtype})});"RTX"===g.toUpperCase()?d.set(parseInt(k.apt,10),f):b.addCodec(new a(g,f,h,e,k,l))});
d.forEach(function(a,c){(c=b.getCodecForType(c))&&c.setRTX(a)})})(v,f);(l=f.ext)&&l.forEach(function(a){v.addExtension(a.value,a.uri)});(function(a,b){(b=b.rids)&&b.forEach(function(b){var c=new B(b.id,k.byValue(b.direction)),d=[],e=new Map;if(b.params){var f=G.parseParams(b.params);Object.keys(f).forEach(function(a){"pt"===a?d=f[a].split(","):e.set(a,f[a])});c.setFormats(d);c.setParams(e)}a.addRID(c)})})(v,f);(function(a,b,c){var d=new Map,e=c.type;if(c.ssrcs){var f;c.ssrcs.forEach(function(c){var d=
c.id;var g=c.attribute;c=c.value;if((k=l.get(d))||(k=new x(d),l.set(k.getSSRC(),k)),"cname"===g.toLowerCase())k.setCName(c);else if("mslabel"===g.toLowerCase())k.setMSLabel(c);else if("label"===g.toLowerCase())k.setLabel(c);else if("msid"===g.toLowerCase()){d=c.split(" ");var l=d[0];d=d[1];k.setStreamId(l);k.setTrackId(d);(h=b.getStream(l))||(h=new w(l),b.addStream(h));(f=h.getTrack(d))||((f=new p(e,d)).setEncodings(a),h.addTrack(f));f.addSSRC(k)}})}if(c.msid){var g=c.msid.split(" ");var h=g[0];var k=
g[1];(g=b.getStream(h))||(g=new w(h),b.addStream(g));var l=g.getTrack(k);l||((l=new p(e,k)).setMediaId(c.mid),l.setEncodings(a),g.addTrack(l));d.forEach(function(a,b){a=d.get(b);a.getStreamId()||(a.setStreamId(h),a.setTrackId(k),l.addSSRC(a))})}c.ssrcGroups&&c.ssrcGroups.forEach(function(a){var c=a.ssrcs.split(" ");a=new t(a.semantics,c);c=d.get(parseInt(c[0],10));b.getStream(c.getStreamId()).getTrack(c.getTrackId()).addSourceGroup(a)})})(function(a,b){var c=[];if(b.simulcast){var e=new m;d("1",b,
e);d("2",b,e);e.getSimulcastStreams(k.SEND).forEach(function(b){var d=[];b.forEach(function(b){var c=new q(b.getId(),b.isPaused());(b=a.getRID(c.getId()))&&(b.getFormats().forEach(function(b){(b=a.getCodecForType(b))&&c.addCodec(b)}),c.setParams(b.getParams()),d.push(c))});d.length&&c.push(d)});a.setSimulcast(e)}b.simulcast_03&&(e=new m,e.setSimulcastPlainString(b.simulcast_03.value),!0,a.setSimulcast03(e));return c}(v,f),h,f);h.addMedia(v)}),h};l.exports=v}]).default;
//# sourceMappingURL=erizo.js.map
