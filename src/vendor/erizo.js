(function(c,a){c.version="0.9.6";c.protocol=1;c.transports=[];c.j=[];c.sockets={};c.connect=function(b,d){var e=c.util.parseUri(b),h,j;a&&a.location&&(e.protocol=e.protocol||a.location.protocol.slice(0,-1),e.host=e.host||(a.document?a.document.domain:a.location.hostname),e.port=e.port||a.location.port);h=c.util.uniqueUri(e);var k={host:e.host,secure:"https"==e.protocol,port:e.port||("https"==e.protocol?443:80),query:e.query||""};c.util.merge(k,d);if(k["force new connection"]||!c.sockets[h])j=new c.Socket(k);
!k["force new connection"]&&j&&(c.sockets[h]=j);j=j||c.sockets[h];return j.of(1<e.path.length?e.path:"")}})("object"===typeof module?module.exports:this.io={},this);
(function(c,a){var b=c.util={},d=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,e="source,protocol,authority,userInfo,user,password,host,port,relative,path,directory,file,query,anchor".split(",");b.parseUri=function(a){for(var a=d.exec(a||""),c={},b=14;b--;)c[e[b]]=a[b]||"";return c};b.uniqueUri=function(c){var b=c.protocol,d=c.host,c=c.port;"document"in
a?(d=d||document.domain,c=c||("https"==b&&"https:"!==document.location.protocol?443:document.location.port)):(d=d||"localhost",!c&&"https"==b&&(c=443));return(b||"http")+"://"+d+":"+(c||80)};b.query=function(a,c){var d=b.chunkQuery(a||""),g=[];b.merge(d,b.chunkQuery(c||""));for(var i in d)d.hasOwnProperty(i)&&g.push(i+"="+d[i]);return g.length?"?"+g.join("&"):""};b.chunkQuery=function(a){for(var c={},a=a.split("&"),b=0,g=a.length,d;b<g;++b)d=a[b].split("="),d[0]&&(c[d[0]]=d[1]);return c};var h=!1;
b.load=function(c){if("document"in a&&"complete"===document.readyState||h)return c();b.on(a,"load",c,!1)};b.on=function(a,c,b,g){a.attachEvent?a.attachEvent("on"+c,b):a.addEventListener&&a.addEventListener(c,b,g)};b.request=function(a){if(a&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!a||b.ua.hasCORS))return new XMLHttpRequest;if(!a)try{return new (window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(c){}return null};"undefined"!=
typeof window&&b.load(function(){h=!0});b.defer=function(a){if(!b.ua.webkit||"undefined"!=typeof importScripts)return a();b.load(function(){setTimeout(a,100)})};b.merge=function(a,c,d,g){var g=g||[],d="undefined"==typeof d?2:d,i;for(i in c)c.hasOwnProperty(i)&&0>b.indexOf(g,i)&&("object"!==typeof a[i]||!d?(a[i]=c[i],g.push(c[i])):b.merge(a[i],c[i],d-1,g));return a};b.mixin=function(a,c){b.merge(a.prototype,c.prototype)};b.inherit=function(a,c){function b(){}b.prototype=c.prototype;a.prototype=new b};
b.isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};b.intersect=function(a,c){for(var d=[],g=a.length>c.length?a:c,i=a.length>c.length?c:a,e=0,h=i.length;e<h;e++)~b.indexOf(g,i[e])&&d.push(i[e]);return d};b.indexOf=function(a,c,b){for(var g=a.length,b=0>b?0>b+g?0:b+g:b||0;b<g&&a[b]!==c;b++);return g<=b?-1:b};b.toArray=function(a){for(var c=[],b=0,g=a.length;b<g;b++)c.push(a[b]);return c};b.ua={};b.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var a=
new XMLHttpRequest}catch(c){return!1}return void 0!=a.withCredentials}();b.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent)})("undefined"!=typeof io?io:module.exports,this);
(function(c,a){function b(){}c.EventEmitter=b;b.prototype.on=function(c,b){this.$events||(this.$events={});this.$events[c]?a.util.isArray(this.$events[c])?this.$events[c].push(b):this.$events[c]=[this.$events[c],b]:this.$events[c]=b;return this};b.prototype.addListener=b.prototype.on;b.prototype.once=function(a,c){function b(){j.removeListener(a,b);c.apply(this,arguments)}var j=this;b.listener=c;this.on(a,b);return this};b.prototype.removeListener=function(c,b){if(this.$events&&this.$events[c]){var h=
this.$events[c];if(a.util.isArray(h)){for(var j=-1,k=0,f=h.length;k<f;k++)if(h[k]===b||h[k].listener&&h[k].listener===b){j=k;break}if(0>j)return this;h.splice(j,1);h.length||delete this.$events[c]}else(h===b||h.listener&&h.listener===b)&&delete this.$events[c]}return this};b.prototype.removeAllListeners=function(a){this.$events&&this.$events[a]&&(this.$events[a]=null);return this};b.prototype.listeners=function(c){this.$events||(this.$events={});this.$events[c]||(this.$events[c]=[]);a.util.isArray(this.$events[c])||
(this.$events[c]=[this.$events[c]]);return this.$events[c]};b.prototype.emit=function(c){if(!this.$events)return!1;var b=this.$events[c];if(!b)return!1;var h=Array.prototype.slice.call(arguments,1);if("function"==typeof b)b.apply(this,h);else if(a.util.isArray(b))for(var b=b.slice(),j=0,k=b.length;j<k;j++)b[j].apply(this,h);else return!1;return!0}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);
(function(c,a){function b(a){return 10>a?"0"+a:a}function d(a){k.lastIndex=0;return k.test(a)?'"'+a.replace(k,function(a){var g=i[a];return"string"===typeof g?g:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function e(a,c){var i,h,j,k,p=f,s,r=c[a];r instanceof Date&&(r=isFinite(a.valueOf())?a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1)+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())+"Z":null);"function"===typeof m&&(r=m.call(c,a,
r));switch(typeof r){case "string":return d(r);case "number":return isFinite(r)?""+r:"null";case "boolean":case "null":return""+r;case "object":if(!r)return"null";f+=g;s=[];if("[object Array]"===Object.prototype.toString.apply(r)){k=r.length;for(i=0;i<k;i+=1)s[i]=e(i,r)||"null";j=0===s.length?"[]":f?"[\n"+f+s.join(",\n"+f)+"\n"+p+"]":"["+s.join(",")+"]";f=p;return j}if(m&&"object"===typeof m){k=m.length;for(i=0;i<k;i+=1)"string"===typeof m[i]&&(h=m[i],(j=e(h,r))&&s.push(d(h)+(f?": ":":")+j))}else for(h in r)Object.prototype.hasOwnProperty.call(r,
h)&&(j=e(h,r))&&s.push(d(h)+(f?": ":":")+j);j=0===s.length?"{}":f?"{\n"+f+s.join(",\n"+f)+"\n"+p+"}":"{"+s.join(",")+"}";f=p;return j}}if(a&&a.parse)return c.JSON={parse:a.parse,stringify:a.stringify};var h=c.JSON={},j=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,k=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,g,i={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f",
"\r":"\\r",'"':'\\"',"\\":"\\\\"},m;h.stringify=function(a,c,b){var i;g=f="";if("number"===typeof b)for(i=0;i<b;i+=1)g+=" ";else"string"===typeof b&&(g=b);if((m=c)&&"function"!==typeof c&&("object"!==typeof c||"number"!==typeof c.length))throw Error("JSON.stringify");return e("",{"":a})};h.parse=function(a,g){function c(a,b){var i,d,e=a[b];if(e&&"object"===typeof e)for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&(d=c(e,i),void 0!==d?e[i]=d:delete e[i]);return g.call(a,b,e)}var b,a=""+a;j.lastIndex=
0;j.test(a)&&(a=a.replace(j,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return b=eval("("+a+")"),"function"===typeof g?c({"":b},""):b;throw new SyntaxError("JSON.parse");}})("undefined"!=typeof io?io:module.exports,"undefined"!==typeof JSON?JSON:void 0);
(function(c,a){var b=c.parser={},d=b.packets="disconnect,connect,heartbeat,message,json,event,ack,error,noop".split(","),e=b.reasons=["transport not supported","client not handshaken","unauthorized"],h=b.advice=["reconnect"],j=a.JSON,k=a.util.indexOf;b.encodePacket=function(a){var c=k(d,a.type),b=a.id||"",f=a.endpoint||"",o=a.ack,q=null;switch(a.type){case "error":var u=a.reason?k(e,a.reason):"",a=a.advice?k(h,a.advice):"";if(""!==u||""!==a)q=u+(""!==a?"+"+a:"");break;case "message":""!==a.data&&
(q=a.data);break;case "event":q={name:a.name};a.args&&a.args.length&&(q.args=a.args);q=j.stringify(q);break;case "json":q=j.stringify(a.data);break;case "connect":a.qs&&(q=a.qs);break;case "ack":q=a.ackId+(a.args&&a.args.length?"+"+j.stringify(a.args):"")}c=[c,b+("data"==o?"+":""),f];null!==q&&void 0!==q&&c.push(q);return c.join(":")};b.encodePayload=function(a){var c="";if(1==a.length)return a[0];for(var b=0,d=a.length;b<d;b++)c+="\ufffd"+a[b].length+"\ufffd"+a[b];return c};var f=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;
b.decodePacket=function(a){var c=a.match(f);if(!c)return{};var b=c[2]||"",a=c[5]||"",k={type:d[c[1]],endpoint:c[4]||""};b&&(k.id=b,k.ack=c[3]?"data":!0);switch(k.type){case "error":c=a.split("+");k.reason=e[c[0]]||"";k.advice=h[c[1]]||"";break;case "message":k.data=a||"";break;case "event":try{var o=j.parse(a);k.name=o.name;k.args=o.args}catch(q){}k.args=k.args||[];break;case "json":try{k.data=j.parse(a)}catch(u){}break;case "connect":k.qs=a||"";break;case "ack":if(c=a.match(/^([0-9]+)(\+)?(.*)/))if(k.ackId=
c[1],k.args=[],c[3])try{k.args=c[3]?j.parse(c[3]):[]}catch(v){}}return k};b.decodePayload=function(a){if("\ufffd"==a.charAt(0)){for(var c=[],d=1,e="";d<a.length;d++)"\ufffd"==a.charAt(d)?(c.push(b.decodePacket(a.substr(d+1).substr(0,e))),d+=Number(e)+1,e=""):e+=a.charAt(d);return c}return[b.decodePacket(a)]}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);
(function(c,a){function b(a,c){this.socket=a;this.sessid=c}c.Transport=b;a.util.mixin(b,a.EventEmitter);b.prototype.onData=function(c){this.clearCloseTimeout();(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout();if(""!==c&&(c=a.parser.decodePayload(c))&&c.length)for(var b=0,h=c.length;b<h;b++)this.onPacket(c[b]);return this};b.prototype.onPacket=function(a){this.socket.setHeartbeatTimeout();if("heartbeat"==a.type)return this.onHeartbeat();if("connect"==
a.type&&""==a.endpoint)this.onConnect();"error"==a.type&&"reconnect"==a.advice&&(this.open=!1);this.socket.onPacket(a);return this};b.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var a=this;this.closeTimeout=setTimeout(function(){a.onDisconnect()},this.socket.closeTimeout)}};b.prototype.onDisconnect=function(){this.close&&this.open&&this.close();this.clearTimeouts();this.socket.onDisconnect();return this};b.prototype.onConnect=function(){this.socket.onConnect();return this};b.prototype.clearCloseTimeout=
function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)};b.prototype.clearTimeouts=function(){this.clearCloseTimeout();this.reopenTimeout&&clearTimeout(this.reopenTimeout)};b.prototype.packet=function(c){this.send(a.parser.encodePacket(c))};b.prototype.onHeartbeat=function(){this.packet({type:"heartbeat"})};b.prototype.onOpen=function(){this.open=!0;this.clearCloseTimeout();this.socket.onOpen()};b.prototype.onClose=function(){this.open=!1;this.socket.onClose();this.onDisconnect()};
b.prototype.prepareUrl=function(){var c=this.socket.options;return this.scheme()+"://"+c.host+":"+c.port+"/"+c.resource+"/"+a.protocol+"/"+this.name+"/"+this.sessid};b.prototype.ready=function(a,c){c.call(this)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);
(function(c,a,b){function d(c){this.options={port:80,secure:!1,document:"document"in b?document:!1,resource:"socket.io",transports:a.transports,"connect timeout":1E4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":Infinity,"reopen delay":3E3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843};a.util.merge(this.options,c);this.reconnecting=this.connecting=this.open=this.connected=!1;this.namespaces={};this.buffer=
[];this.doBuffer=!1;if(this.options["sync disconnect on unload"]&&(!this.isXDomain()||a.util.ua.hasCORS)){var d=this;a.util.on(b,"unload",function(){d.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function e(){}c.Socket=d;a.util.mixin(d,a.EventEmitter);d.prototype.of=function(c){this.namespaces[c]||(this.namespaces[c]=new a.SocketNamespace(this,c),""!==c&&this.namespaces[c].packet({type:"connect"}));return this.namespaces[c]};d.prototype.publish=function(){this.emit.apply(this,
arguments);var a,c;for(c in this.namespaces)this.namespaces.hasOwnProperty(c)&&(a=this.of(c),a.$emit.apply(a,arguments))};d.prototype.handshake=function(c){function b(a){if(a instanceof Error)d.onError(a.message);else c.apply(null,a.split(":"))}var d=this,f=this.options,f=["http"+(f.secure?"s":"")+":/",f.host+":"+f.port,f.resource,a.protocol,a.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!a.util.ua.hasCORS){var g=document.getElementsByTagName("script")[0],i=document.createElement("script");
i.src=f+"&jsonp="+a.j.length;g.parentNode.insertBefore(i,g);a.j.push(function(a){b(a);i.parentNode.removeChild(i)})}else{var m=a.util.request();m.open("GET",f,!0);m.withCredentials=!0;m.onreadystatechange=function(){4==m.readyState&&(m.onreadystatechange=e,200==m.status?b(m.responseText):!d.reconnecting&&d.onError(m.responseText))};m.send(null)}};d.prototype.getTransport=function(c){for(var c=c||this.transports,b=0,d;d=c[b];b++)if(a.Transport[d]&&a.Transport[d].check(this)&&(!this.isXDomain()||a.Transport[d].xdomainCheck()))return new a.Transport[d](this,
this.sessionid);return null};d.prototype.connect=function(c){if(this.connecting)return this;var b=this;this.handshake(function(d,e,g,i){function m(a){b.transport&&b.transport.clearTimeouts();b.transport=b.getTransport(a);if(!b.transport)return b.publish("connect_failed");b.transport.ready(b,function(){b.connecting=!0;b.publish("connecting",b.transport.name);b.transport.open();b.options["connect timeout"]&&(b.connectTimeoutTimer=setTimeout(function(){if(!b.connected&&(b.connecting=!1,b.options["try multiple transports"])){b.remainingTransports||
(b.remainingTransports=b.transports.slice(0));for(var a=b.remainingTransports;0<a.length&&a.splice(0,1)[0]!=b.transport.name;);a.length?m(a):b.publish("connect_failed")}},b.options["connect timeout"]))})}b.sessionid=d;b.closeTimeout=1E3*g;b.heartbeatTimeout=1E3*e;b.transports=i?a.util.intersect(i.split(","),b.options.transports):b.options.transports;b.setHeartbeatTimeout();m(b.transports);b.once("connect",function(){clearTimeout(b.connectTimeoutTimer);c&&"function"==typeof c&&c()})});return this};
d.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);var a=this;this.heartbeatTimeoutTimer=setTimeout(function(){a.transport.onClose()},this.heartbeatTimeout)};d.prototype.packet=function(a){this.connected&&!this.doBuffer?this.transport.packet(a):this.buffer.push(a);return this};d.prototype.setBuffer=function(a){this.doBuffer=a;!a&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])};d.prototype.disconnect=function(){if(this.connected||
this.connecting)this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted");return this};d.prototype.disconnectSync=function(){a.util.request().open("GET",this.resource+"/"+a.protocol+"/"+this.sessionid,!0);this.onDisconnect("booted")};d.prototype.isXDomain=function(){var a=b.location.port||("https:"==b.location.protocol?443:80);return this.options.host!==b.location.hostname||this.options.port!=a};d.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=
!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))};d.prototype.onOpen=function(){this.open=!0};d.prototype.onClose=function(){this.open=!1;clearTimeout(this.heartbeatTimeoutTimer)};d.prototype.onPacket=function(a){this.of(a.endpoint).onPacket(a)};d.prototype.onError=function(a){if(a&&a.advice&&"reconnect"===a.advice&&(this.connected||this.connecting))this.disconnect(),this.options.reconnect&&this.reconnect();this.publish("error",a&&a.reason?a.reason:a)};d.prototype.onDisconnect=function(a){var c=
this.connected,b=this.connecting;this.open=this.connecting=this.connected=!1;if(c||b)this.transport.close(),this.transport.clearTimeouts(),c&&(this.publish("disconnect",a),"booted"!=a&&this.options.reconnect&&!this.reconnecting&&this.reconnect())};d.prototype.reconnect=function(){function a(){if(b.connected){for(var d in b.namespaces)b.namespaces.hasOwnProperty(d)&&""!==d&&b.namespaces[d].packet({type:"connect"});b.publish("reconnect",b.transport.name,b.reconnectionAttempts)}clearTimeout(b.reconnectionTimer);
b.removeListener("connect_failed",c);b.removeListener("connect",c);b.reconnecting=!1;delete b.reconnectionAttempts;delete b.reconnectionDelay;delete b.reconnectionTimer;delete b.redoTransports;b.options["try multiple transports"]=g}function c(){if(b.reconnecting){if(b.connected)return a();if(b.connecting&&b.reconnecting)return b.reconnectionTimer=setTimeout(c,1E3);b.reconnectionAttempts++>=d?b.redoTransports?(b.publish("reconnect_failed"),a()):(b.on("connect_failed",c),b.options["try multiple transports"]=
!0,b.transport=b.getTransport(),b.redoTransports=!0,b.connect()):(b.reconnectionDelay<i&&(b.reconnectionDelay*=2),b.connect(),b.publish("reconnecting",b.reconnectionDelay,b.reconnectionAttempts),b.reconnectionTimer=setTimeout(c,b.reconnectionDelay))}}this.reconnecting=!0;this.reconnectionAttempts=0;this.reconnectionDelay=this.options["reconnection delay"];var b=this,d=this.options["max reconnection attempts"],g=this.options["try multiple transports"],i=this.options["reconnection limit"];this.options["try multiple transports"]=
!1;this.reconnectionTimer=setTimeout(c,this.reconnectionDelay);this.on("connect",c)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);
(function(c,a){function b(a,c){this.socket=a;this.name=c||"";this.flags={};this.json=new d(this,"json");this.ackPackets=0;this.acks={}}function d(a,c){this.namespace=a;this.name=c}c.SocketNamespace=b;a.util.mixin(b,a.EventEmitter);b.prototype.$emit=a.EventEmitter.prototype.emit;b.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)};b.prototype.packet=function(a){a.endpoint=this.name;this.socket.packet(a);this.flags={};return this};b.prototype.send=function(a,c){var b={type:this.flags.json?
"json":"message",data:a};"function"==typeof c&&(b.id=++this.ackPackets,b.ack=!0,this.acks[b.id]=c);return this.packet(b)};b.prototype.emit=function(a){var c=Array.prototype.slice.call(arguments,1),b=c[c.length-1],d={type:"event",name:a};"function"==typeof b&&(d.id=++this.ackPackets,d.ack="data",this.acks[d.id]=b,c=c.slice(0,c.length-1));d.args=c;return this.packet(d)};b.prototype.disconnect=function(){""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect"));
return this};b.prototype.onPacket=function(c){function b(){d.packet({type:"ack",args:a.util.toArray(arguments),ackId:c.id})}var d=this;switch(c.type){case "connect":this.$emit("connect");break;case "disconnect":if(""===this.name)this.socket.onDisconnect(c.reason||"booted");else this.$emit("disconnect",c.reason);break;case "message":case "json":var k=["message",c.data];"data"==c.ack?k.push(b):c.ack&&this.packet({type:"ack",ackId:c.id});this.$emit.apply(this,k);break;case "event":k=[c.name].concat(c.args);
"data"==c.ack&&k.push(b);this.$emit.apply(this,k);break;case "ack":this.acks[c.ackId]&&(this.acks[c.ackId].apply(this,c.args),delete this.acks[c.ackId]);break;case "error":if(c.advice)this.socket.onError(c);else"unauthorized"==c.reason?this.$emit("connect_failed",c.reason):this.$emit("error",c.reason)}};d.prototype.send=function(){this.namespace.flags[this.name]=!0;this.namespace.send.apply(this.namespace,arguments)};d.prototype.emit=function(){this.namespace.flags[this.name]=!0;this.namespace.emit.apply(this.namespace,
arguments)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);
(function(c,a,b){function d(c){a.Transport.apply(this,arguments)}c.websocket=d;a.util.inherit(d,a.Transport);d.prototype.name="websocket";d.prototype.open=function(){var c=a.util.query(this.socket.options.query),d=this,j;j||(j=b.MozWebSocket||b.WebSocket);this.websocket=new j(this.prepareUrl()+c);this.websocket.onopen=function(){d.onOpen();d.socket.setBuffer(!1)};this.websocket.onmessage=function(a){d.onData(a.data)};this.websocket.onclose=function(){d.onClose();d.socket.setBuffer(!0)};this.websocket.onerror=
function(a){d.onError(a)};return this};d.prototype.send=function(a){this.websocket.send(a);return this};d.prototype.payload=function(a){for(var c=0,b=a.length;c<b;c++)this.packet(a[c]);return this};d.prototype.close=function(){this.websocket.close();return this};d.prototype.onError=function(a){this.socket.onError(a)};d.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"};d.check=function(){return"WebSocket"in b&&!("__addTask"in WebSocket)||"MozWebSocket"in b};d.xdomainCheck=function(){return!0};
a.transports.push("websocket")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);
(function(c,a){function b(){a.Transport.websocket.apply(this,arguments)}c.flashsocket=b;a.util.inherit(b,a.Transport.websocket);b.prototype.name="flashsocket";b.prototype.open=function(){var c=this,b=arguments;WebSocket.__addTask(function(){a.Transport.websocket.prototype.open.apply(c,b)});return this};b.prototype.send=function(){var c=this,b=arguments;WebSocket.__addTask(function(){a.Transport.websocket.prototype.send.apply(c,b)});return this};b.prototype.close=function(){WebSocket.__tasks.length=
0;a.Transport.websocket.prototype.close.call(this);return this};b.prototype.ready=function(c,e){function h(){var a=c.options,f=a["flash policy port"],g=["http"+(a.secure?"s":"")+":/",a.host+":"+a.port,a.resource,"static/flashsocket","WebSocketMain"+(c.isXDomain()?"Insecure":"")+".swf"];b.loaded||("undefined"===typeof WEB_SOCKET_SWF_LOCATION&&(WEB_SOCKET_SWF_LOCATION=g.join("/")),843!==f&&WebSocket.loadFlashPolicyFile("xmlsocket://"+a.host+":"+f),WebSocket.__initialize(),b.loaded=!0);e.call(j)}var j=
this;if(document.body)return h();a.util.load(h)};b.check=function(){return"undefined"==typeof WebSocket||!("__initialize"in WebSocket)||!swfobject?!1:10<=swfobject.getFlashPlayerVersion().major};b.xdomainCheck=function(){return!0};"undefined"!=typeof window&&(WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0);a.transports.push("flashsocket")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports);
if("undefined"!=typeof window)var swfobject=function(){function c(){if(!B){try{var a=n.getElementsByTagName("body")[0].appendChild(n.createElement("span"));a.parentNode.removeChild(a)}catch(c){return}B=!0;for(var a=E.length,b=0;b<a;b++)E[b]()}}function a(a){B?a():E[E.length]=a}function b(a){if(typeof x.addEventListener!=p)x.addEventListener("load",a,!1);else if(typeof n.addEventListener!=p)n.addEventListener("load",a,!1);else if(typeof x.attachEvent!=p)o(x,"onload",a);else if("function"==typeof x.onload){var c=
x.onload;x.onload=function(){c();a()}}else x.onload=a}function d(){var a=n.getElementsByTagName("body")[0],c=n.createElement(s);c.setAttribute("type",r);var b=a.appendChild(c);if(b){var g=0;(function(){if(typeof b.GetVariable!=p){var d=b.GetVariable("$version");d&&(d=d.split(" ")[1].split(","),l.pv=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)])}else if(10>g){g++;setTimeout(arguments.callee,10);return}a.removeChild(c);b=null;e()})()}else e()}function e(){var a=z.length;if(0<a)for(var c=0;c<
a;c++){var b=z[c].id,g=z[c].callbackFn,d={success:!1,id:b};if(0<l.pv[0]){var i=t(b);if(i)if(q(z[c].swfVersion)&&!(l.wk&&312>l.wk))v(b,!0),g&&(d.success=!0,d.ref=h(b),g(d));else if(z[c].expressInstall&&j()){d={};d.data=z[c].expressInstall;d.width=i.getAttribute("width")||"0";d.height=i.getAttribute("height")||"0";i.getAttribute("class")&&(d.styleclass=i.getAttribute("class"));i.getAttribute("align")&&(d.align=i.getAttribute("align"));for(var e={},i=i.getElementsByTagName("param"),m=i.length,o=0;o<
m;o++)"movie"!=i[o].getAttribute("name").toLowerCase()&&(e[i[o].getAttribute("name")]=i[o].getAttribute("value"));k(d,e,b,g)}else f(i),g&&g(d)}else if(v(b,!0),g){if((b=h(b))&&typeof b.SetVariable!=p)d.success=!0,d.ref=b;g(d)}}}function h(a){var c=null;if((a=t(a))&&"OBJECT"==a.nodeName)typeof a.SetVariable!=p?c=a:(a=a.getElementsByTagName(s)[0])&&(c=a);return c}function j(){return!F&&q("6.0.65")&&(l.win||l.mac)&&!(l.wk&&312>l.wk)}function k(a,c,b,d){F=!0;I=d||null;K={success:!1,id:b};var f=t(b);if(f){"OBJECT"==
f.nodeName?(D=g(f),G=null):(D=f,G=b);a.id=M;if(typeof a.width==p||!/%$/.test(a.width)&&310>parseInt(a.width,10))a.width="310";if(typeof a.height==p||!/%$/.test(a.height)&&137>parseInt(a.height,10))a.height="137";n.title=n.title.slice(0,47)+" - Flash Player Installation";d=l.ie&&l.win?["Active"].concat("").join("X"):"PlugIn";d="MMredirectURL="+x.location.toString().replace(/&/g,"%26")+"&MMplayerType="+d+"&MMdoctitle="+n.title;c.flashvars=typeof c.flashvars!=p?c.flashvars+("&"+d):d;l.ie&&l.win&&4!=
f.readyState&&(d=n.createElement("div"),b+="SWFObjectNew",d.setAttribute("id",b),f.parentNode.insertBefore(d,f),f.style.display="none",function(){f.readyState==4?f.parentNode.removeChild(f):setTimeout(arguments.callee,10)}());i(a,c,b)}}function f(a){if(l.ie&&l.win&&4!=a.readyState){var c=n.createElement("div");a.parentNode.insertBefore(c,a);c.parentNode.replaceChild(g(a),c);a.style.display="none";(function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)})()}else a.parentNode.replaceChild(g(a),
a)}function g(a){var c=n.createElement("div");if(l.win&&l.ie)c.innerHTML=a.innerHTML;else if(a=a.getElementsByTagName(s)[0])if(a=a.childNodes)for(var b=a.length,g=0;g<b;g++)!(1==a[g].nodeType&&"PARAM"==a[g].nodeName)&&8!=a[g].nodeType&&c.appendChild(a[g].cloneNode(!0));return c}function i(a,c,b){var g,d=t(b);if(l.wk&&312>l.wk)return g;if(d)if(typeof a.id==p&&(a.id=b),l.ie&&l.win){var i="",f;for(f in a)a[f]!=Object.prototype[f]&&("data"==f.toLowerCase()?c.movie=a[f]:"styleclass"==f.toLowerCase()?i+=
' class="'+a[f]+'"':"classid"!=f.toLowerCase()&&(i+=" "+f+'="'+a[f]+'"'));f="";for(var e in c)c[e]!=Object.prototype[e]&&(f+='<param name="'+e+'" value="'+c[e]+'" />');d.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+i+">"+f+"</object>";H[H.length]=a.id;g=t(a.id)}else{e=n.createElement(s);e.setAttribute("type",r);for(var m in a)a[m]!=Object.prototype[m]&&("styleclass"==m.toLowerCase()?e.setAttribute("class",a[m]):"classid"!=m.toLowerCase()&&e.setAttribute(m,a[m]));for(i in c)c[i]!=
Object.prototype[i]&&"movie"!=i.toLowerCase()&&(a=e,f=i,m=c[i],b=n.createElement("param"),b.setAttribute("name",f),b.setAttribute("value",m),a.appendChild(b));d.parentNode.replaceChild(e,d);g=e}return g}function m(a){var c=t(a);c&&"OBJECT"==c.nodeName&&(l.ie&&l.win?(c.style.display="none",function(){if(4==c.readyState){var b=t(a);if(b){for(var g in b)"function"==typeof b[g]&&(b[g]=null);b.parentNode.removeChild(b)}}else setTimeout(arguments.callee,10)}()):c.parentNode.removeChild(c))}function t(a){var c=
null;try{c=n.getElementById(a)}catch(b){}return c}function o(a,c,b){a.attachEvent(c,b);C[C.length]=[a,c,b]}function q(a){var c=l.pv,a=a.split(".");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10)||0;a[2]=parseInt(a[2],10)||0;return c[0]>a[0]||c[0]==a[0]&&c[1]>a[1]||c[0]==a[0]&&c[1]==a[1]&&c[2]>=a[2]?!0:!1}function u(a,c,b,g){if(!l.ie||!l.mac){var d=n.getElementsByTagName("head")[0];if(d){b=b&&"string"==typeof b?b:"screen";g&&(J=y=null);if(!y||J!=b)g=n.createElement("style"),g.setAttribute("type","text/css"),
g.setAttribute("media",b),y=d.appendChild(g),l.ie&&l.win&&typeof n.styleSheets!=p&&0<n.styleSheets.length&&(y=n.styleSheets[n.styleSheets.length-1]),J=b;l.ie&&l.win?y&&typeof y.addRule==s&&y.addRule(a,c):y&&typeof n.createTextNode!=p&&y.appendChild(n.createTextNode(a+" {"+c+"}"))}}}function v(a,c){if(N){var b=c?"visible":"hidden";B&&t(a)?t(a).style.visibility=b:u("#"+a,"visibility:"+b)}}function w(a){return null!=/[\\\"<>\.;]/.exec(a)&&typeof encodeURIComponent!=p?encodeURIComponent(a):a}var p="undefined",
s="object",r="application/x-shockwave-flash",M="SWFObjectExprInst",x=window,n=document,A=navigator,O=!1,E=[function(){O?d():e()}],z=[],H=[],C=[],D,G,I,K,B=!1,F=!1,y,J,N=!0,l=function(){var a=typeof n.getElementById!=p&&typeof n.getElementsByTagName!=p&&typeof n.createElement!=p,c=A.userAgent.toLowerCase(),b=A.platform.toLowerCase(),g=b?/win/.test(b):/win/.test(c),b=b?/mac/.test(b):/mac/.test(c),c=/webkit/.test(c)?parseFloat(c.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,d=!+"\v1",i=[0,0,0],f=null;
if(typeof A.plugins!=p&&typeof A.plugins["Shockwave Flash"]==s){if((f=A.plugins["Shockwave Flash"].description)&&!(typeof A.mimeTypes!=p&&A.mimeTypes[r]&&!A.mimeTypes[r].enabledPlugin))O=!0,d=!1,f=f.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),i[0]=parseInt(f.replace(/^(.*)\..*$/,"$1"),10),i[1]=parseInt(f.replace(/^.*\.(.*)\s.*$/,"$1"),10),i[2]=/[a-zA-Z]/.test(f)?parseInt(f.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}else if(typeof x[["Active"].concat("Object").join("X")]!=p)try{var e=new (window[["Active"].concat("Object").join("X")])("ShockwaveFlash.ShockwaveFlash");
if(e&&(f=e.GetVariable("$version")))d=!0,f=f.split(" ")[1].split(","),i=[parseInt(f[0],10),parseInt(f[1],10),parseInt(f[2],10)]}catch(m){}return{w3:a,pv:i,wk:c,ie:d,win:g,mac:b}}();(function(){l.w3&&((typeof n.readyState!=p&&"complete"==n.readyState||typeof n.readyState==p&&(n.getElementsByTagName("body")[0]||n.body))&&c(),B||(typeof n.addEventListener!=p&&n.addEventListener("DOMContentLoaded",c,!1),l.ie&&l.win&&(n.attachEvent("onreadystatechange",function(){"complete"==n.readyState&&(n.detachEvent("onreadystatechange",
arguments.callee),c())}),x==top&&function(){if(!B){try{n.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}c()}}()),l.wk&&function(){B||(/loaded|complete/.test(n.readyState)?c():setTimeout(arguments.callee,0))}(),b(c)))})();(function(){l.ie&&l.win&&window.attachEvent("onunload",function(){for(var a=C.length,c=0;c<a;c++)C[c][0].detachEvent(C[c][1],C[c][2]);a=H.length;for(c=0;c<a;c++)m(H[c]);for(var b in l)l[b]=null;l=null;for(var g in swfobject)swfobject[g]=null;swfobject=
null})})();return{registerObject:function(a,c,b,g){if(l.w3&&a&&c){var d={};d.id=a;d.swfVersion=c;d.expressInstall=b;d.callbackFn=g;z[z.length]=d;v(a,!1)}else g&&g({success:!1,id:a})},getObjectById:function(a){if(l.w3)return h(a)},embedSWF:function(c,b,g,d,f,e,m,h,o,t){var u={success:!1,id:b};l.w3&&!(l.wk&&312>l.wk)&&c&&b&&g&&d&&f?(v(b,!1),a(function(){g+="";d+="";var a={};if(o&&typeof o===s)for(var l in o)a[l]=o[l];a.data=c;a.width=g;a.height=d;l={};if(h&&typeof h===s)for(var n in h)l[n]=h[n];if(m&&
typeof m===s)for(var r in m)l.flashvars=typeof l.flashvars!=p?l.flashvars+("&"+r+"="+m[r]):r+"="+m[r];if(q(f))n=i(a,l,b),a.id==b&&v(b,!0),u.success=!0,u.ref=n;else{if(e&&j()){a.data=e;k(a,l,b,t);return}v(b,!0)}t&&t(u)})):t&&t(u)},switchOffAutoHideShow:function(){N=!1},ua:l,getFlashPlayerVersion:function(){return{major:l.pv[0],minor:l.pv[1],release:l.pv[2]}},hasFlashPlayerVersion:q,createSWF:function(a,c,b){if(l.w3)return i(a,c,b)},showExpressInstall:function(a,c,b,g){l.w3&&j()&&k(a,c,b,g)},removeSWF:function(a){l.w3&&
m(a)},createCSS:function(a,c,b,g){l.w3&&u(a,c,b,g)},addDomLoadEvent:a,addLoadEvent:b,getQueryParamValue:function(a){var c=n.location.search||n.location.hash;if(c){/\?/.test(c)&&(c=c.split("?")[1]);if(null==a)return w(c);for(var c=c.split("&"),b=0;b<c.length;b++)if(c[b].substring(0,c[b].indexOf("="))==a)return w(c[b].substring(c[b].indexOf("=")+1))}return""},expressInstallCallback:function(){if(F){var a=t(M);a&&D&&(a.parentNode.replaceChild(D,a),G&&(v(G,!0),l.ie&&l.win&&(D.style.display="block")),
I&&I(K));F=!1}}}}();
(function(){if(!("undefined"==typeof window||window.WebSocket)){var c=window.console;if(!c||!c.log||!c.error)c={log:function(){},error:function(){}};swfobject.hasFlashPlayerVersion("10.0.0")?("file:"==location.protocol&&c.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(a,c,d,e,h){var j=this;j.__id=WebSocket.__nextId++;WebSocket.__instances[j.__id]=j;j.readyState=WebSocket.CONNECTING;
j.bufferedAmount=0;j.__events={};c?"string"==typeof c&&(c=[c]):c=[];setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(j.__id,a,c,d||null,e||0,h||null)})},0)},WebSocket.prototype.send=function(a){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";a=WebSocket.__flash.send(this.__id,encodeURIComponent(a));if(0>a)return!0;this.bufferedAmount+=a;return!1},WebSocket.prototype.close=function(){this.readyState==WebSocket.CLOSED||
this.readyState==WebSocket.CLOSING||(this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id))},WebSocket.prototype.addEventListener=function(a,c){a in this.__events||(this.__events[a]=[]);this.__events[a].push(c)},WebSocket.prototype.removeEventListener=function(a,c){if(a in this.__events)for(var d=this.__events[a],e=d.length-1;0<=e;--e)if(d[e]===c){d.splice(e,1);break}},WebSocket.prototype.dispatchEvent=function(a){for(var c=this.__events[a.type]||[],d=0;d<c.length;++d)c[d](a);(c=this["on"+
a.type])&&c(a)},WebSocket.prototype.__handleEvent=function(a){"readyState"in a&&(this.readyState=a.readyState);"protocol"in a&&(this.protocol=a.protocol);if("open"==a.type||"error"==a.type)a=this.__createSimpleEvent(a.type);else if("close"==a.type)a=this.__createSimpleEvent("close");else if("message"==a.type)a=this.__createMessageEvent("message",decodeURIComponent(a.message));else throw"unknown event type: "+a.type;this.dispatchEvent(a)},WebSocket.prototype.__createSimpleEvent=function(a){if(document.createEvent&&
window.Event){var c=document.createEvent("Event");c.initEvent(a,!1,!1);return c}return{type:a,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(a,c){if(document.createEvent&&window.MessageEvent&&!window.opera){var d=document.createEvent("MessageEvent");d.initMessageEvent("message",!1,!1,c,null,null,window,null);return d}return{type:a,data:c,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances=
{},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(a){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(a)})},WebSocket.__initialize=function(){if(!WebSocket.__flash)if(WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),window.WEB_SOCKET_SWF_LOCATION){var a=document.createElement("div");a.id="webSocketContainer";a.style.position="absolute";WebSocket.__isFlashLite()?(a.style.left="0px",a.style.top="0px"):(a.style.left=
"-100px",a.style.top="-100px");var b=document.createElement("div");b.id="webSocketFlash";a.appendChild(b);document.body.appendChild(a);swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(a){a.success||c.error("[WebSocket] swfobject.embedSWF failed")})}else c.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf")},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=
document.getElementById("webSocketFlash");WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var a=0;a<WebSocket.__tasks.length;++a)WebSocket.__tasks[a]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){setTimeout(function(){try{for(var a=WebSocket.__flash.receiveEvents(),b=0;b<a.length;++b)WebSocket.__instances[a[b].webSocketId].__handleEvent(a[b])}catch(d){c.error(d)}},0);return!0},WebSocket.__log=function(a){c.log(decodeURIComponent(a))},
WebSocket.__error=function(a){c.error(decodeURIComponent(a))},WebSocket.__addTask=function(a){WebSocket.__flash?a():WebSocket.__tasks.push(a)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var a=window.navigator.mimeTypes["application/x-shockwave-flash"];return!a||!a.enabledPlugin||!a.enabledPlugin.filename?!1:a.enabledPlugin.filename.match(/flashlite/i)?!0:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",
function(){WebSocket.__initialize()},!1):window.attachEvent("onload",function(){WebSocket.__initialize()}))):c.error("Flash Player >= 10.0.0 is required.")}})();
(function(c,a,b){function d(c){c&&(a.Transport.apply(this,arguments),this.sendBuffer=[])}function e(){}c.XHR=d;a.util.inherit(d,a.Transport);d.prototype.open=function(){this.socket.setBuffer(!1);this.onOpen();this.get();this.setCloseTimeout();return this};d.prototype.payload=function(c){for(var b=[],d=0,f=c.length;d<f;d++)b.push(a.parser.encodePacket(c[d]));this.send(a.parser.encodePayload(b))};d.prototype.send=function(a){this.post(a);return this};d.prototype.post=function(a){function c(){if(4==
this.readyState)if(this.onreadystatechange=e,f.posting=!1,200==this.status)f.socket.setBuffer(!1);else f.onClose()}function d(){this.onload=e;f.socket.setBuffer(!1)}var f=this;this.socket.setBuffer(!0);this.sendXHR=this.request("POST");b.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=d:this.sendXHR.onreadystatechange=c;this.sendXHR.send(a)};d.prototype.close=function(){this.onClose();return this};d.prototype.request=function(c){var b=a.util.request(this.socket.isXDomain()),
d=a.util.query(this.socket.options.query,"t="+ +new Date);b.open(c||"GET",this.prepareUrl()+d,!0);if("POST"==c)try{b.setRequestHeader?b.setRequestHeader("Content-type","text/plain;charset=UTF-8"):b.contentType="text/plain"}catch(f){}return b};d.prototype.scheme=function(){return this.socket.options.secure?"https":"http"};d.check=function(c,d){try{var e=a.util.request(d),f=b.XDomainRequest&&e instanceof XDomainRequest,g=(c&&c.options&&c.options.secure?"https:":"http:")!=b.location.protocol;if(e&&(!f||
!g))return!0}catch(i){}return!1};d.xdomainCheck=function(){return d.check(null,!0)}})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);
(function(c,a){function b(c){a.Transport.XHR.apply(this,arguments)}c.htmlfile=b;a.util.inherit(b,a.Transport.XHR);b.prototype.name="htmlfile";b.prototype.get=function(){this.doc=new (window[["Active"].concat("Object").join("X")])("htmlfile");this.doc.open();this.doc.write("<html></html>");this.doc.close();this.doc.parentWindow.s=this;var c=this.doc.createElement("div");c.className="socketio";this.doc.body.appendChild(c);this.iframe=this.doc.createElement("iframe");c.appendChild(this.iframe);var b=
this,c=a.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+c;a.util.on(window,"unload",function(){b.destroy()})};b.prototype._=function(a,c){this.onData(a);try{var b=c.getElementsByTagName("script")[0];b.parentNode.removeChild(b)}catch(j){}};b.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(a){}this.doc=null;this.iframe.parentNode.removeChild(this.iframe);this.iframe=null;CollectGarbage()}};b.prototype.close=function(){this.destroy();
return a.Transport.XHR.prototype.close.call(this)};b.check=function(){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window)try{return new (window[["Active"].concat("Object").join("X")])("htmlfile")&&a.Transport.XHR.check()}catch(c){}return!1};b.xdomainCheck=function(){return!1};a.transports.push("htmlfile")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports);
(function(c,a,b){function d(){a.Transport.XHR.apply(this,arguments)}function e(){}c["xhr-polling"]=d;a.util.inherit(d,a.Transport.XHR);a.util.merge(d,a.Transport.XHR);d.prototype.name="xhr-polling";d.prototype.open=function(){a.Transport.XHR.prototype.open.call(this);return!1};d.prototype.get=function(){function a(){if(4==this.readyState)if(this.onreadystatechange=e,200==this.status)f.onData(this.responseText),f.get();else f.onClose()}function c(){this.onerror=this.onload=e;f.onData(this.responseText);
f.get()}function d(){f.onClose()}if(this.open){var f=this;this.xhr=this.request();b.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=c,this.xhr.onerror=d):this.xhr.onreadystatechange=a;this.xhr.send(null)}};d.prototype.onClose=function(){a.Transport.XHR.prototype.onClose.call(this);if(this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=e;try{this.xhr.abort()}catch(c){}this.xhr=null}};d.prototype.ready=function(c,b){var d=this;a.util.defer(function(){b.call(d)})};
a.transports.push("xhr-polling")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);
(function(c,a,b){function d(c){a.Transport["xhr-polling"].apply(this,arguments);this.index=a.j.length;var b=this;a.j.push(function(a){b._(a)})}var e=b.document&&"MozAppearance"in b.document.documentElement.style;c["jsonp-polling"]=d;a.util.inherit(d,a.Transport["xhr-polling"]);d.prototype.name="jsonp-polling";d.prototype.post=function(c){function b(){d();f.socket.setBuffer(!1)}function d(){f.iframe&&f.form.removeChild(f.iframe);try{o=document.createElement('<iframe name="'+f.iframeId+'">')}catch(a){o=
document.createElement("iframe"),o.name=f.iframeId}o.id=f.iframeId;f.form.appendChild(o);f.iframe=o}var f=this,g=a.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var i=document.createElement("form"),e=document.createElement("textarea"),t=this.iframeId="socketio_iframe_"+this.index,o;i.className="socketio";i.style.position="absolute";i.style.top="0px";i.style.left="0px";i.style.display="none";i.target=t;i.method="POST";i.setAttribute("accept-charset","utf-8");
e.name="d";i.appendChild(e);document.body.appendChild(i);this.form=i;this.area=e}this.form.action=this.prepareUrl()+g;d();this.area.value=a.JSON.stringify(c);try{this.form.submit()}catch(q){}this.iframe.attachEvent?o.onreadystatechange=function(){"complete"==f.iframe.readyState&&b()}:this.iframe.onload=b;this.socket.setBuffer(!0)};d.prototype.get=function(){var c=this,b=document.createElement("script"),d=a.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),
this.script=null);b.async=!0;b.src=this.prepareUrl()+d;b.onerror=function(){c.onClose()};d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(b,d);this.script=b;e&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a);document.body.removeChild(a)},100)};d.prototype._=function(a){this.onData(a);this.open&&this.get();return this};d.prototype.ready=function(c,b){var d=this;if(!e)return b.call(this);a.util.load(function(){b.call(d)})};d.check=function(){return"document"in
b};d.xdomainCheck=function(){return!0};a.transports.push("jsonp-polling")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);var Erizo=Erizo||{};
Erizo.EventDispatcher=function(c){var a={};c.dispatcher={};c.dispatcher.eventListeners={};a.addEventListener=function(a,d){void 0===c.dispatcher.eventListeners[a]&&(c.dispatcher.eventListeners[a]=[]);c.dispatcher.eventListeners[a].push(d)};a.removeEventListener=function(a,d){var e;e=c.dispatcher.eventListeners[a].indexOf(d);-1!==e&&c.dispatcher.eventListeners[a].splice(e,1)};a.dispatchEvent=function(a){var d;L.Logger.debug("Event: "+a.type);for(d in c.dispatcher.eventListeners[a.type])if(c.dispatcher.eventListeners[a.type].hasOwnProperty(d))c.dispatcher.eventListeners[a.type][d](a)};return a};
Erizo.LicodeEvent=function(c){var a={};a.type=c.type;return a};Erizo.RoomEvent=function(c){var a=Erizo.LicodeEvent(c);a.streams=c.streams;return a};Erizo.StreamEvent=function(c){var a=Erizo.LicodeEvent(c);a.stream=c.stream;a.msg=c.msg;return a};Erizo.PublisherEvent=function(c){return Erizo.LicodeEvent(c)};Erizo=Erizo||{};Erizo.FcStack=function(){return{addStream:function(){}}};Erizo=Erizo||{};
Erizo.BowserStack=function(c){var a={},b=webkitRTCPeerConnection;a.pc_config={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==c.stunServerUrl&&a.pc_config.iceServers.push({url:c.stunServerUrl});(c.turnServer||{}).url&&a.pc_config.iceServers.push({username:c.turnServer.username,credential:c.turnServer.password,url:c.turnServer.url});void 0===c.audio&&(c.audio=!0);void 0===c.video&&(c.video=!0);a.mediaConstraints={offerToReceiveVideo:c.video,offerToReceiveAudio:c.audio};a.peerConnection=
new b(a.pc_config,a.con);c.remoteDescriptionSet=!1;var d=function(a){if(c.maxVideoBW){var b=a.match(/m=video.*\r\n/);b==null&&(b=a.match(/m=video.*\n/));if(b&&b.length>0)var d=b[0]+"b=AS:"+c.maxVideoBW+"\r\n",a=a.replace(b[0],d)}if(c.maxAudioBW){b=a.match(/m=audio.*\r\n/);b==null&&(b=a.match(/m=audio.*\n/));if(b&&b.length>0){d=b[0]+"b=AS:"+c.maxAudioBW+"\r\n";a=a.replace(b[0],d)}}return a};a.close=function(){a.state="closed";a.peerConnection.close()};c.localCandidates=[];a.peerConnection.onicecandidate=
function(b){if(b.candidate){if(!b.candidate.candidate.match(/a=/))b.candidate.candidate="a="+b.candidate.candidate;c.remoteDescriptionSet?c.callback({type:"candidate",candidate:b.candidate}):c.localCandidates.push(b.candidate)}else console.log("End of candidates.",a.peerConnection.localDescription)};a.peerConnection.onaddstream=function(c){if(a.onaddstream)a.onaddstream(c)};a.peerConnection.onremovestream=function(c){if(a.onremovestream)a.onremovestream(c)};var e=function(a){console.log("Error in Stack ",
a)},h,j=function(b){b.sdp=d(b.sdp);console.log("Set local description",b.sdp);h=b;a.peerConnection.setLocalDescription(h,function(){console.log("The final LocalDesc",a.peerConnection.localDescription);c.callback(a.peerConnection.localDescription)},e)},k=function(b){b.sdp=d(b.sdp);c.callback(b);h=b;a.peerConnection.setLocalDescription(b)};a.createOffer=function(c){c===true?a.peerConnection.createOffer(j,e,a.mediaConstraints):a.peerConnection.createOffer(j,e)};a.addStream=function(c){a.peerConnection.addStream(c)};
c.remoteCandidates=[];a.processSignalingMessage=function(b){console.log("Process Signaling Message",b);if(b.type==="offer"){b.sdp=d(b.sdp);a.peerConnection.setRemoteDescription(new RTCSessionDescription(b));a.peerConnection.createAnswer(k,null,a.mediaConstraints);c.remoteDescriptionSet=true}else if(b.type==="answer"){console.log("Set remote description",b.sdp);b.sdp=d(b.sdp);a.peerConnection.setRemoteDescription(new RTCSessionDescription(b),function(){c.remoteDescriptionSet=true;for(console.log("Candidates to be added: ",
c.remoteCandidates.length);c.remoteCandidates.length>0;){console.log("Candidate :",c.remoteCandidates[c.remoteCandidates.length-1]);a.peerConnection.addIceCandidate(c.remoteCandidates.shift(),function(){},e)}for(;c.localCandidates.length>0;)c.callback({type:"candidate",candidate:c.localCandidates.shift()})},function(){console.log("Error Setting Remote Description")})}else if(b.type==="candidate"){console.log("Message with candidate");try{var g;g=typeof b.candidate==="object"?b.candidate:JSON.parse(b.candidate);
g.candidate=g.candidate.replace(/a=/g,"");g.sdpMLineIndex=parseInt(g.sdpMLineIndex);g.sdpMLineIndex=g.sdpMid=="audio"?0:1;var i=new RTCIceCandidate(g);console.log("Remote Candidate",i);c.remoteDescriptionSet?a.peerConnection.addIceCandidate(i,function(){},e):c.remoteCandidates.push(i)}catch(m){L.Logger.error("Error parsing candidate",b.candidate)}}};return a};Erizo=Erizo||{};
Erizo.FirefoxStack=function(c){var a={},b=mozRTCPeerConnection,d=mozRTCSessionDescription,e=mozRTCIceCandidate;a.pc_config={iceServers:[]};void 0!==c.stunServerUrl&&a.pc_config.iceServers.push({url:c.stunServerUrl});(c.turnServer||{}).url&&a.pc_config.iceServers.push({username:c.turnServer.username,credential:c.turnServer.password,url:c.turnServer.url});void 0===c.audio&&(c.audio=!0);void 0===c.video&&(c.video=!0);a.mediaConstraints={offerToReceiveAudio:c.audio,offerToReceiveVideo:c.video,mozDontOfferDataChannel:!0};
var h=function(a){L.Logger.error("Error in Stack ",a)},j=!1;a.peerConnection=new b(a.pc_config,a.con);c.localCandidates=[];a.peerConnection.onicecandidate=function(a){if(a.candidate){j=true;if(!a.candidate.candidate.match(/a=/))a.candidate.candidate="a="+a.candidate.candidate;if(c.remoteDescriptionSet)c.callback({type:"candidate",candidate:a.candidate});else{c.localCandidates.push(a.candidate);console.log("Local Candidates stored: ",c.localCandidates.length,c.localCandidates)}}else console.log("End of candidates.")};
a.peerConnection.onaddstream=function(c){if(a.onaddstream)a.onaddstream(c)};a.peerConnection.onremovestream=function(c){if(a.onremovestream)a.onremovestream(c)};var k=function(a){if(c.video&&c.maxVideoBW){var b=a.match(/m=video.*\r\n/);b==null&&(b=a.match(/m=video.*\n/));if(b&&b.length>0)var g=b[0]+"b=AS:"+c.maxVideoBW+"\r\n",a=a.replace(b[0],g)}if(c.audio&&c.maxAudioBW){b=a.match(/m=audio.*\r\n/);b==null&&(b=a.match(/m=audio.*\n/));if(b&&b.length>0){g=b[0]+"b=AS:"+c.maxAudioBW+"\r\n";a=a.replace(b[0],
g)}}return a},f,g=function(a){a.sdp=k(a.sdp);a.sdp=a.sdp.replace(/a=ice-options:google-ice\r\n/g,"");c.callback(a);f=a},i=function(b){b.sdp=k(b.sdp);b.sdp=b.sdp.replace(/a=ice-options:google-ice\r\n/g,"");c.callback(b);f=b;a.peerConnection.setLocalDescription(f)};a.createOffer=function(c){c===true?a.peerConnection.createOffer(g,h,a.mediaConstraints):a.peerConnection.createOffer(g,h)};a.addStream=function(c){a.peerConnection.addStream(c)};c.remoteCandidates=[];c.remoteDescriptionSet=!1;a.close=function(){a.state=
"closed";a.peerConnection.close()};a.processSignalingMessage=function(b){if(b.type==="offer"){b.sdp=k(b.sdp);a.peerConnection.setRemoteDescription(new d(b),function(){a.peerConnection.createAnswer(i,function(a){L.Logger.error("Error",a)},a.mediaConstraints);c.remoteDescriptionSet=true},function(a){L.Logger.error("Error setting Remote Description",a)})}else if(b.type==="answer"){console.log("Set remote and local description",b.sdp);b.sdp=k(b.sdp);a.peerConnection.setLocalDescription(f,function(){a.peerConnection.setRemoteDescription(new d(b),
function(){c.remoteDescriptionSet=true;for(L.Logger.info("Remote Description successfully set");c.remoteCandidates.length>0&&j;){L.Logger.info("Setting stored remote candidates");a.peerConnection.addIceCandidate(c.remoteCandidates.shift())}for(;c.localCandidates.length>0;){L.Logger.info("Sending Candidate from list");c.callback({type:"candidate",candidate:c.localCandidates.shift()})}},function(a){L.Logger.error("Error Setting Remote Description",a)})},function(a){L.Logger.error("Failure setting Local Description",
a)})}else if(b.type==="candidate")try{var g;g=typeof b.candidate==="object"?b.candidate:JSON.parse(b.candidate);g.candidate=g.candidate.replace(/ generation 0/g,"");g.candidate=g.candidate.replace(/ udp /g," UDP ");g.sdpMLineIndex=parseInt(g.sdpMLineIndex);var o=new e(g);if(c.remoteDescriptionSet&&j)for(a.peerConnection.addIceCandidate(o);c.remoteCandidates.length>0;){L.Logger.info("Setting stored remote candidates");a.peerConnection.addIceCandidate(c.remoteCandidates.shift())}else c.remoteCandidates.push(o)}catch(h){L.Logger.error("Error parsing candidate",
b.candidate,h)}};return a};Erizo=Erizo||{};
Erizo.ChromeStableStack=function(c){var a={},b=webkitRTCPeerConnection;a.pc_config={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==c.stunServerUrl&&a.pc_config.iceServers.push({url:c.stunServerUrl});(c.turnServer||{}).url&&a.pc_config.iceServers.push({username:c.turnServer.username,credential:c.turnServer.password,url:c.turnServer.url});void 0===c.audio&&(c.audio=!0);void 0===c.video&&(c.video=!0);a.mediaConstraints={mandatory:{OfferToReceiveVideo:c.video,OfferToReceiveAudio:c.audio}};var d=
function(a){console.log("Error in Stack ",a)};a.peerConnection=new b(a.pc_config,a.con);var e=function(a){if(c.video&&c.maxVideoBW){var a=a.replace(/b=AS:.*\r\n/g,""),b=a.match(/m=video.*\r\n/);b==null&&(b=a.match(/m=video.*\n/));if(b&&b.length>0)var d=b[0]+"b=AS:"+c.maxVideoBW+"\r\n",a=a.replace(b[0],d)}if(c.audio&&c.maxAudioBW){b=a.match(/m=audio.*\r\n/);b==null&&(b=a.match(/m=audio.*\n/));if(b&&b.length>0){d=b[0]+"b=AS:"+c.maxAudioBW+"\r\n";a=a.replace(b[0],d)}}return a};a.close=function(){a.state=
"closed";a.peerConnection.close()};c.localCandidates=[];a.peerConnection.onicecandidate=function(a){if(a.candidate){if(!a.candidate.candidate.match(/a=/))a.candidate.candidate="a="+a.candidate.candidate;a={sdpMLineIndex:a.candidate.sdpMLineIndex,sdpMid:a.candidate.sdpMid,candidate:a.candidate.candidate};if(c.remoteDescriptionSet)c.callback({type:"candidate",candidate:a});else{c.localCandidates.push(a);L.Logger.info("Storing candidate: ",c.localCandidates.length,a)}}else console.log("End of candidates.")};
a.peerConnection.onaddstream=function(c){if(a.onaddstream)a.onaddstream(c)};a.peerConnection.onremovestream=function(c){if(a.onremovestream)a.onremovestream(c)};var h,j,k=function(a){a.sdp=e(a.sdp);a.sdp=a.sdp.replace(/a=ice-options:google-ice\r\n/g,"");c.callback({type:a.type,sdp:a.sdp});h=a},f=function(b){b.sdp=e(b.sdp);c.callback({type:b.type,sdp:b.sdp});h=b;a.peerConnection.setLocalDescription(b)};a.updateSpec=function(b,d){if(b.maxVideoBW||b.maxAudioBW){if(b.maxVideoBW){console.log("Maxvideo Requested",
b.maxVideoBW,"limit",c.limitMaxVideoBW);if(b.maxVideoBW>c.limitMaxVideoBW)b.maxVideoBW=c.limitMaxVideoBW;c.maxVideoBW=b.maxVideoBW;console.log("Result",c.maxVideoBW)}if(b.maxAudioBW){if(b.maxAudioBW>c.limitMaxAudioBW)b.maxAudioBW=c.limitMaxAudioBW;c.maxAudioBW=b.maxAudioBW}h.sdp=e(h.sdp);a.peerConnection.setLocalDescription(h,function(){j.sdp=e(j.sdp);a.peerConnection.setRemoteDescription(new RTCSessionDescription(j),function(){c.remoteDescriptionSet=true;d&&d("success")})})}};a.createOffer=function(c){c===
true?a.peerConnection.createOffer(k,d,a.mediaConstraints):a.peerConnection.createOffer(k,d)};a.addStream=function(c){a.peerConnection.addStream(c)};c.remoteCandidates=[];c.remoteDescriptionSet=!1;a.processSignalingMessage=function(b){if(b.type==="offer"){b.sdp=e(b.sdp);a.peerConnection.setRemoteDescription(new RTCSessionDescription(b),function(){a.peerConnection.createAnswer(f,function(a){L.Logger.error("Error: ",a)},a.mediaConstraints);c.remoteDescriptionSet=true},function(a){L.Logger.error("Error setting Remote Description",
a)})}else if(b.type==="answer"){console.log("Set remote and local description",b.sdp);b.sdp=e(b.sdp);j=b;a.peerConnection.setLocalDescription(h,function(){a.peerConnection.setRemoteDescription(new RTCSessionDescription(b),function(){c.remoteDescriptionSet=true;for(console.log("Candidates to be added: ",c.remoteCandidates.length,c.remoteCandidates);c.remoteCandidates.length>0;)a.peerConnection.addIceCandidate(c.remoteCandidates.shift());for(console.log("Local candidates to send:",c.localCandidates.length);c.localCandidates.length>
0;)c.callback({type:"candidate",candidate:c.localCandidates.shift()})})})}else if(b.type==="candidate")try{var d;d=typeof b.candidate==="object"?b.candidate:JSON.parse(b.candidate);d.candidate=d.candidate.replace(/a=/g,"");d.sdpMLineIndex=parseInt(d.sdpMLineIndex);var m=new RTCIceCandidate(d);c.remoteDescriptionSet?a.peerConnection.addIceCandidate(m):c.remoteCandidates.push(m)}catch(k){L.Logger.error("Error parsing candidate",b.candidate)}};return a};Erizo=Erizo||{};
Erizo.ChromeCanaryStack=function(c){var a={},b=webkitRTCPeerConnection;a.pc_config={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==c.stunServerUrl&&a.pc_config.iceServers.push({url:c.stunServerUrl});(c.turnServer||{}).url&&a.pc_config.iceServers.push({username:c.turnServer.username,credential:c.turnServer.password,url:c.turnServer.url});if(void 0===c.audio||c.nop2p)c.audio=!0;if(void 0===c.video||c.nop2p)c.video=!0;a.mediaConstraints={mandatory:{OfferToReceiveVideo:c.video,OfferToReceiveAudio:c.audio}};
a.roapSessionId=103;a.peerConnection=new b(a.pc_config,a.con);a.peerConnection.onicecandidate=function(b){L.Logger.debug("PeerConnection: ",c.session_id);if(b.candidate)a.iceCandidateCount+=1;else if(L.Logger.debug("State: "+a.peerConnection.iceGatheringState),void 0===a.ices&&(a.ices=0),a.ices+=1,1<=a.ices&&a.moreIceComing)a.moreIceComing=!1,a.markActionNeeded()};var d=function(a){if(c.maxVideoBW){var b=a.match(/m=video.*\r\n/);if(b&&0<b.length)var d=b[0]+"b=AS:"+c.maxVideoBW+"\r\n",a=a.replace(b[0],
d)}if(c.maxAudioBW&&(b=a.match(/m=audio.*\r\n/))&&0<b.length)d=b[0]+"b=AS:"+c.maxAudioBW+"\r\n",a=a.replace(b[0],d);return a};a.processSignalingMessage=function(b){L.Logger.debug("Activity on conn "+a.sessionId);b=JSON.parse(b);a.incomingMessage=b;"new"===a.state?"OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.state="offer-received",a.markActionNeeded()):a.error("Illegal message for this state: "+b.messageType+" in state "+
a.state):"offer-sent"===a.state?"ANSWER"===b.messageType?(b={sdp:b.sdp,type:"answer"},L.Logger.debug("Received ANSWER: ",b.sdp),b.sdp=d(b.sdp),a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.sendOK(),a.state="established"):"pr-answer"===b.messageType?(b={sdp:b.sdp,type:"pr-answer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b))):"offer"===b.messageType?a.error("Not written yet"):a.error("Illegal message for this state: "+b.messageType+" in state "+a.state):
"established"===a.state&&("OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.state="offer-received",a.markActionNeeded()):a.error("Illegal message for this state: "+b.messageType+" in state "+a.state))};a.addStream=function(b){a.peerConnection.addStream(b);a.markActionNeeded()};a.removeStream=function(){a.markActionNeeded()};a.close=function(){a.state="closed";a.peerConnection.close()};a.markActionNeeded=function(){a.actionNeeded=
!0;a.doLater(function(){a.onstablestate()})};a.doLater=function(a){window.setTimeout(a,1)};a.onstablestate=function(){var b;if(a.actionNeeded){if("new"===a.state||"established"===a.state)a.peerConnection.createOffer(function(b){b.sdp=d(b.sdp);L.Logger.debug("Changed",b.sdp);b.sdp!==a.prevOffer?(a.peerConnection.setLocalDescription(b),a.state="preparing-offer",a.markActionNeeded()):L.Logger.debug("Not sending a new offer")},null,a.mediaConstraints);else if("preparing-offer"===a.state){if(a.moreIceComing)return;
a.prevOffer=a.peerConnection.localDescription.sdp;L.Logger.debug("Sending OFFER: "+a.prevOffer);a.sendMessage("OFFER",a.prevOffer);a.state="offer-sent"}else if("offer-received"===a.state)a.peerConnection.createAnswer(function(b){a.peerConnection.setLocalDescription(b);a.state="offer-received-preparing-answer";a.iceStarted?a.markActionNeeded():(L.Logger.debug((new Date).getTime()+": Starting ICE in responder"),a.iceStarted=!0)},null,a.mediaConstraints);else if("offer-received-preparing-answer"===a.state){if(a.moreIceComing)return;
b=a.peerConnection.localDescription.sdp;a.sendMessage("ANSWER",b);a.state="established"}else a.error("Dazed and confused in state "+a.state+", stopping here");a.actionNeeded=!1}};a.sendOK=function(){a.sendMessage("OK")};a.sendMessage=function(b,c){var d={};d.messageType=b;d.sdp=c;"OFFER"===b?(d.offererSessionId=a.sessionId,d.answererSessionId=a.otherSessionId,d.seq=a.sequenceNumber+=1,d.tiebreaker=Math.floor(429496723*Math.random()+1)):(d.offererSessionId=a.incomingMessage.offererSessionId,d.answererSessionId=
a.sessionId,d.seq=a.incomingMessage.seq);a.onsignalingmessage(JSON.stringify(d))};a.error=function(a){throw"Error in RoapOnJsep: "+a;};a.sessionId=a.roapSessionId+=1;a.sequenceNumber=0;a.actionNeeded=!1;a.iceStarted=!1;a.moreIceComing=!0;a.iceCandidateCount=0;a.onsignalingmessage=c.callback;a.peerConnection.onopen=function(){if(a.onopen)a.onopen()};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};
a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b.currentTarget.iceConnectionState)};a.onaddstream=null;a.onremovestream=null;a.state="new";a.markActionNeeded();return a};Erizo=Erizo||{};Erizo.sessionId=103;
Erizo.Connection=function(c){var a={};c.session_id=Erizo.sessionId+=1;a.browser=Erizo.getBrowser();if("undefined"!==typeof module&&module.exports)L.Logger.error("Publish/subscribe video/audio streams not supported in erizofc yet"),a=Erizo.FcStack(c);else if("mozilla"===a.browser)L.Logger.debug("Firefox Stack"),a=Erizo.FirefoxStack(c);else if("bowser"===a.browser)L.Logger.debug("Bowser Stack"),a=Erizo.BowserStack(c);else if("chrome-stable"===a.browser)L.Logger.debug("Stable!"),a=Erizo.ChromeStableStack(c);
else throw L.Logger.debug("None!"),"WebRTC stack not available";a.updateSpec||(a.updateSpec=function(a,c){L.Logger.error("Update Configuration not implemented in this browser");c&&c("unimplemented")});return a};
Erizo.getBrowser=function(){var c="none";null!==window.navigator.userAgent.match("Firefox")?c="mozilla":null!==window.navigator.userAgent.match("Bowser")?c="bowser":null!==window.navigator.userAgent.match("Chrome")?26<=window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]&&(c="chrome-stable"):null!==window.navigator.userAgent.match("Safari")?c="bowser":null!==window.navigator.userAgent.match("AppleWebKit")&&(c="bowser");return c};
Erizo.GetUserMedia=function(c,a,b){navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;if(c.screen)switch(L.Logger.debug("Screen access requested"),Erizo.getBrowser()){case "mozilla":L.Logger.debug("Screen sharing in Firefox");var d={};void 0!=c.video?(d.video=c.video,d.video.mediaSource="window"):d={video:{mediaSource:"window"}};navigator.getMedia(d,a,b);break;case "chrome-stable":L.Logger.debug("Screen sharing in Chrome");
d="okeephmleflklcdebijnponpabbmmgeo";c.extensionId&&(L.Logger.debug("extensionId supplied, using "+c.extensionId),d=c.extensionId);L.Logger.debug("Screen access on chrome stable, looking for extension");try{chrome.runtime.sendMessage(d,{getStream:!0},function(d){var e={};if(d==void 0){L.Logger.debug("Access to screen denied");b({code:"Access to screen denied"})}else{d=d.streamId;if(c.video.mandatory!=void 0){e.video=c.video;e.video.mandatory.chromeMediaSource="desktop";e.video.mandatory.chromeMediaSourceId=
d}else e={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:d}}};navigator.getMedia(e,a,b)}})}catch(e){L.Logger.debug("Lynckia screensharing plugin is not accessible ");b({code:"no_plugin_present"});break}break;default:L.Logger.debug("This browser does not support screenSharing")}else"undefined"!==typeof module&&module.exports?L.Logger.error("Video/audio streams not supported in erizofc yet"):navigator.getMedia(c,a,b)};Erizo=Erizo||{};
Erizo.Stream=function(c){var a=Erizo.EventDispatcher(c),b;a.stream=c.stream;a.url=c.url;a.recording=c.recording;a.room=void 0;a.showing=!1;a.local=!1;a.video=c.video;a.audio=c.audio;a.screen=c.screen;a.videoSize=c.videoSize;a.videoOptions=c.videoOptions||{mandatory:{},optional:[]};a.extensionId=c.extensionId;if(void 0!==a.videoSize&&(!(a.videoSize instanceof Array)||4!=a.videoSize.length))throw Error("Invalid Video Size");if(void 0===c.local||!0===c.local)a.local=!0;a.getID=function(){return c.streamID};a.getAttributes=
function(){return c.attributes};a.setAttributes=function(){L.Logger.error("Failed to set attributes data. This Stream object has not been published.")};a.updateLocalAttributes=function(a){c.attributes=a};a.hasAudio=function(){return c.audio};a.hasVideo=function(){return c.video};a.hasData=function(){return c.data};a.hasScreen=function(){return c.screen};a.sendData=function(){L.Logger.error("Failed to send data. This Stream object has not that channel enabled.")};a.init=function(){try{if((c.audio||
c.video||c.screen)&&void 0===c.url){L.Logger.debug("Requested access to local media");!0==c.video&&void 0!==a.videoSize&&(a.videoOptions.mandatory.minWidth=a.videoSize[0],a.videoOptions.mandatory.minHeight=a.videoSize[1],a.videoOptions.mandatory.maxWidth=a.videoSize[2],a.videoOptions.mandatory.maxHeight=a.videoSize[3]);var b={video:a.videoOptions,audio:c.audio,fake:c.fake,screen:c.screen,extensionId:a.extensionId};L.Logger.debug(b);Erizo.GetUserMedia(b,function(b){L.Logger.info("User has granted access to local media.");
a.stream=b;b=Erizo.StreamEvent({type:"access-accepted"});a.dispatchEvent(b)},function(b){L.Logger.error("Failed to get access to local media. Error code was "+b.code+".");b=Erizo.StreamEvent({type:"access-denied"});a.dispatchEvent(b)})}else{var e=Erizo.StreamEvent({type:"access-accepted"});a.dispatchEvent(e)}}catch(h){L.Logger.error("Error accessing to local media",h)}};a.close=function(){a.local&&(void 0!==a.room&&a.room.unpublish(a),a.hide(),void 0!==a.stream&&a.stream.stop(),a.stream=void 0)};
a.play=function(b,c){c=c||{};a.elementID=b;if(a.hasVideo()||this.hasScreen()){if(void 0!==b){var h=new Erizo.VideoPlayer({id:a.getID(),stream:a,elementID:b,options:c});a.player=h;a.showing=!0}}else a.hasAudio&&(h=new Erizo.AudioPlayer({id:a.getID(),stream:a,elementID:b,options:c}),a.player=h,a.showing=!0)};a.stop=function(){a.showing&&void 0!==a.player&&(a.player.destroy(),a.showing=!1)};a.show=a.play;a.hide=a.stop;b=function(){if(void 0!==a.player&&void 0!==a.stream){var b=a.player.video,c=document.defaultView.getComputedStyle(b),
h=parseInt(c.getPropertyValue("width"),10),j=parseInt(c.getPropertyValue("height"),10),k=parseInt(c.getPropertyValue("left"),10),c=parseInt(c.getPropertyValue("top"),10),f=document.getElementById(a.elementID),g=document.defaultView.getComputedStyle(f),f=parseInt(g.getPropertyValue("width"),10),g=parseInt(g.getPropertyValue("height"),10),i=document.createElement("canvas");i.id="testing";i.width=f;i.height=g;i.setAttribute("style","display: none");i.getContext("2d").drawImage(b,k,c,h,j);return i}return null};
a.getVideoFrameURL=function(a){var c=b();return null!==c?a?c.toDataURL(a):c.toDataURL():null};a.getVideoFrame=function(){var a=b();return null!==a?a.getContext("2d").getImageData(0,0,a.width,a.height):null};a.updateConfiguration=function(b,c){if(void 0!==b)if(a.pc)a.pc.updateSpec(b,c);else return"This stream has not been published, ignoring"};return a};Erizo=Erizo||{};
Erizo.Room=function(c){function a(a){if(a)console.log("hijacked SDP!");else return console.log("WARN: SDP is `"+typeof a+"` and cannot be hijacked!"),a;var b=null;console.log("Updating BitRate!");if(b=a.match(/a=rtpmap:100 VP8\/90000.*\r\n/))a=a.replace(b[0],"a=rtpmap:100 VP8/90000\r\na=fmtp:100 x-google-min-bitrate=800; x-google-max-bitrate=1200; x-google-max-quantization=56\r\n");else if(b=a.match(/a=rtpmap:100 VP8\/90000.*\n/))a=a.replace(b[0],"a=rtpmap:100 VP8/90000\na=fmtp:100 x-google-min-bitrate=800; x-google-max-bitrate=1200; x-google-max-quantization=56\n");console.log("Removing REMB!");
(b=a.match(/a=rtcp-fb:100 goog-remb\r\n/))||(b=a.match(/a=rtcp-fb:100 goog-remb\n/));b&&(a=a.replace(b[0],""));return a}var b=Erizo.EventDispatcher(c),d,e,h,j,k,f;b.remoteStreams={};b.localStreams={};b.roomID="";b.socket={};b.state=0;b.p2p=!1;b.addEventListener("room-disconnected",function(){var a,c;b.state=0;for(a in b.remoteStreams)b.remoteStreams.hasOwnProperty(a)&&(c=b.remoteStreams[a],f(c),delete b.remoteStreams[a],c=Erizo.StreamEvent({type:"stream-removed",stream:c}),b.dispatchEvent(c));b.remoteStreams=
{};for(a in b.localStreams)b.localStreams.hasOwnProperty(a)&&(c=b.localStreams[a],c.pc.close(),delete b.localStreams[a]);try{b.socket.disconnect()}catch(d){L.Logger.debug("Socket already disconnected")}b.socket=void 0});f=function(a){void 0!==a.stream&&(a.hide(),a.pc&&a.pc.close(),a.local&&a.stream.stop())};j=function(a,b){a.local?e("sendDataStream",{id:a.getID(),msg:b}):L.Logger.error("You can not send data through a remote stream")};k=function(a,b){a.local?(a.updateLocalAttributes(b),e("updateStreamAttributes",
{id:a.getID(),attrs:b})):L.Logger.error("You can not update attributes in a remote stream")};d=function(a,d,m){console.log(a);b.socket=io.connect(a.host,{reconnect:!1,secure:a.secure,"force new connection":!0});b.socket.on("onAddStream",function(a){var c=Erizo.Stream({streamID:a.id,local:!1,audio:a.audio,video:a.video,data:a.data,screen:a.screen,attributes:a.attributes});b.remoteStreams[a.id]=c;a=Erizo.StreamEvent({type:"stream-added",stream:c});b.dispatchEvent(a)});b.socket.on("signaling_message_erizo",
function(a){var c;(c=a.peerId?b.remoteStreams[a.peerId]:b.localStreams[a.streamId])&&c.pc.processSignalingMessage(a.mess)});b.socket.on("signaling_message_peer",function(a){var c=b.localStreams[a.streamId];c?c.pc[a.peerSocket].processSignalingMessage(a.msg):(c=b.remoteStreams[a.streamId],c.pc||j(c,a.peerSocket),c.pc.processSignalingMessage(a.msg))});b.socket.on("publish_me",function(a){var c=b.localStreams[a.streamId];void 0===c.pc&&(c.pc={});c.pc[a.peerSocket]=Erizo.Connection({callback:function(b){h("signaling_message",
{streamId:a.streamId,peerSocket:a.peerSocket,msg:b})},audio:c.hasAudio(),video:c.hasVideo(),stunServerUrl:b.stunServerUrl,turnServer:b.turnServer});c.pc[a.peerSocket].oniceconnectionstatechange=function(b){if(b==="disconnected"){c.pc[a.peerSocket].close();delete c.pc[a.peerSocket]}};c.pc[a.peerSocket].addStream(c.stream);c.pc[a.peerSocket].createOffer()});var j=function(a,d){a.pc=Erizo.Connection({callback:function(b){h("signaling_message",{streamId:a.getID(),peerSocket:d,msg:b})},stunServerUrl:b.stunServerUrl,
turnServer:b.turnServer,maxAudioBW:c.maxAudioBW,maxVideoBW:c.maxVideoBW,limitMaxAudioBW:c.maxAudioBW,limitMaxVideoBW:c.maxVideoBW});a.pc.onaddstream=function(c){L.Logger.info("Stream subscribed");a.stream=c.stream;c=Erizo.StreamEvent({type:"stream-subscribed",stream:a});b.dispatchEvent(c)}};b.socket.on("onDataStream",function(a){var c=b.remoteStreams[a.id],a=Erizo.StreamEvent({type:"stream-data",msg:a.msg,stream:c});c.dispatchEvent(a)});b.socket.on("onUpdateAttributeStream",function(a){var c=b.remoteStreams[a.id],
d=Erizo.StreamEvent({type:"stream-attributes-update",attrs:a.attrs,stream:c});c.updateLocalAttributes(a.attrs);c.dispatchEvent(d)});b.socket.on("onRemoveStream",function(a){var c=b.remoteStreams[a.id];delete b.remoteStreams[a.id];f(c);a=Erizo.StreamEvent({type:"stream-removed",stream:c});b.dispatchEvent(a)});b.socket.on("disconnect",function(){L.Logger.info("Socket disconnected");if(0!==b.state){var a=Erizo.RoomEvent({type:"room-disconnected"});b.dispatchEvent(a)}});b.socket.on("connection_failed",
function(){L.Logger.info("ICE Connection Failed");if(0!==b.state){var a=Erizo.RoomEvent({type:"stream-failed"});b.dispatchEvent(a)}});e("token",a,d,m)};e=function(a,c,d,f){b.socket.emit(a,c,function(a,b){"success"===a?void 0!==d&&d(b):"error"===a?void 0!==f&&f(b):void 0!==d&&d(a,b)})};h=function(c,d,f,e){"signaling_message"==c&&"object"==typeof d&&"offer"==d.msg.type&&d.msg.sdp&&(d.msg.sdp=a(d.msg.sdp));b.socket.emit(c,d,f,function(a,b){e!==void 0&&e(a,b)})};b.connect=function(){var a=L.Base64.decodeBase64(c.token);
0!==b.state&&L.Logger.error("Room already connected");b.state=1;d(JSON.parse(a),function(a){var d=0,g=[],f,e,h;f=a.streams||[];b.p2p=a.p2p;e=a.id;b.stunServerUrl=a.stunServerUrl;b.turnServer=a.turnServer;b.state=2;c.defaultVideoBW=a.defaultVideoBW;c.defaultAudioBW=a.defaultAudioBW;c.maxVideoBW=a.maxVideoBW;c.maxAudioBW=a.maxAudioBW;for(d in f)f.hasOwnProperty(d)&&(h=f[d],a=Erizo.Stream({streamID:h.id,local:!1,audio:h.audio,video:h.video,data:h.data,screen:h.screen,attributes:h.attributes}),g.push(a),
b.remoteStreams[h.id]=a);b.roomID=e;L.Logger.info("Connected to room "+b.roomID);d=Erizo.RoomEvent({type:"room-connected",streams:g});b.dispatchEvent(d)},function(a){L.Logger.error("Not Connected! Error: "+a)})};b.disconnect=function(){var a=Erizo.RoomEvent({type:"room-disconnected"});b.dispatchEvent(a)};b.publish=function(a,d,f){d=d||{};d.maxVideoBW=d.maxVideoBW||c.defaultVideoBW;d.maxVideoBW>c.maxVideoBW&&(d.maxVideoBW=c.maxVideoBW);d.maxAudioBW=d.maxAudioBW||c.defaultAudioBW;d.maxAudioBW>c.maxAudioBW&&
(d.maxAudioBW=c.maxAudioBW);if(a.local&&void 0===b.localStreams[a.getID()])if(a.hasAudio()||a.hasVideo()||a.hasScreen())if(void 0!==a.url||void 0!==a.recording){var e,o;a.url?(e="url",o=a.url):(e="recording",o=a.recording);h("publish",{state:e,data:a.hasData(),audio:a.hasAudio(),video:a.hasVideo(),attributes:a.getAttributes()},o,function(c,d){if(c!==null){L.Logger.info("Stream published");a.getID=function(){return c};a.sendData=function(b){j(a,b)};a.setAttributes=function(b){k(a,b)};b.localStreams[c]=
a;a.room=b;f&&f(c)}else{L.Logger.error("Error when publishing the stream",d);f&&f(void 0,d)}})}else b.p2p?(c.maxAudioBW=d.maxAudioBW,c.maxVideoBW=d.maxVideoBW,h("publish",{state:"p2p",data:a.hasData(),audio:a.hasAudio(),video:a.hasVideo(),screen:a.hasScreen(),attributes:a.getAttributes()},void 0,function(c,d){if(c===null){L.Logger.error("Error when publishing the stream",d);f&&f(void 0,d)}L.Logger.info("Stream published");a.getID=function(){return c};if(a.hasData())a.sendData=function(b){j(a,b)};
a.setAttributes=function(b){k(a,b)};b.localStreams[c]=a;a.room=b})):h("publish",{state:"erizo",data:a.hasData(),audio:a.hasAudio(),video:a.hasVideo(),screen:a.hasScreen(),attributes:a.getAttributes()},void 0,function(e,o){if(e===null){L.Logger.error("Error when publishing the stream: ",o);f&&f(void 0,o)}else{L.Logger.info("Stream published");a.getID=function(){return e};if(a.hasData())a.sendData=function(b){j(a,b)};a.setAttributes=function(b){k(a,b)};b.localStreams[e]=a;a.room=b;a.pc=Erizo.Connection({callback:function(b){console.log("Sending message",
b);h("signaling_message",{streamId:a.getID(),msg:b},void 0,function(){})},stunServerUrl:b.stunServerUrl,turnServer:b.turnServer,maxAudioBW:d.maxAudioBW,maxVideoBW:d.maxVideoBW,limitMaxAudioBW:c.maxAudioBW,limitMaxVideoBW:c.maxVideoBW,audio:a.hasAudio(),video:a.hasVideo()});a.pc.addStream(a.stream);a.pc.createOffer();f&&f(e)}});else a.hasData()&&h("publish",{state:"data",data:a.hasData(),audio:!1,video:!1,screen:!1,attributes:a.getAttributes()},void 0,function(c,d){if(c===null){L.Logger.error("Error publishing stream ",
d);f&&f(void 0,d)}else{L.Logger.info("Stream published");a.getID=function(){return c};a.sendData=function(b){j(a,b)};a.setAttributes=function(b){k(a,b)};b.localStreams[c]=a;a.room=b;f&&f(c)}})};b.startRecording=function(a,b){L.Logger.debug("Start Recording streamaa: "+a.getID());e("startRecorder",{to:a.getID()},function(a,c){null===a?(L.Logger.error("Error on start recording",c),b&&b(void 0,c)):(L.Logger.info("Start recording",a),b&&b(a))})};b.stopRecording=function(a,b){e("stopRecorder",{id:a},function(a,
c){null===a?(L.Logger.error("Error on stop recording",c),b&&b(void 0,c)):(L.Logger.info("Stop recording"),b&&b(!0))})};b.unpublish=function(a,c){if(a.local){e("unpublish",a.getID(),function(a,b){null===a?(L.Logger.error("Error unpublishing stream",b),c&&c(void 0,b)):(L.Logger.info("Stream unpublished"),c&&c(!0))});var d=a.room.p2p;a.room=void 0;if((a.hasAudio()||a.hasVideo()||a.hasScreen())&&void 0===a.url&&!d)a.pc.close(),a.pc=void 0;delete b.localStreams[a.getID()];a.getID=function(){};a.sendData=
function(){};a.setAttributes=function(){}}};b.subscribe=function(a,c,d){c=c||{};if(!a.local){if(a.hasVideo()||a.hasAudio()||a.hasScreen())b.p2p?(h("subscribe",{streamId:a.getID()}),d&&d(!0)):h("subscribe",{streamId:a.getID(),audio:c.audio,video:c.video,data:c.data,browser:Erizo.getBrowser()},void 0,function(c,f){null===c?(L.Logger.error("Error subscribing to stream ",f),d&&d(void 0,f)):(L.Logger.info("Subscriber added"),a.pc=Erizo.Connection({callback:function(b){L.Logger.info("Sending message",b);
h("signaling_message",{streamId:a.getID(),msg:b,browser:a.pc.browser},void 0,function(){})},nop2p:!0,audio:a.hasAudio(),video:a.hasVideo(),stunServerUrl:b.stunServerUrl,turnServer:b.turnServer}),a.pc.onaddstream=function(c){L.Logger.info("Stream subscribed");a.stream=c.stream;c=Erizo.StreamEvent({type:"stream-subscribed",stream:a});b.dispatchEvent(c)},a.pc.createOffer(!0),d&&d(!0))});else if(a.hasData()&&!1!==c.data)h("subscribe",{streamId:a.getID(),data:c.data},void 0,function(c,f){if(null===c)L.Logger.error("Error subscribing to stream ",
f),d&&d(void 0,f);else{L.Logger.info("Stream subscribed");var i=Erizo.StreamEvent({type:"stream-subscribed",stream:a});b.dispatchEvent(i);d&&d(!0)}});else{L.Logger.info("Subscribing to anything");return}L.Logger.info("Subscribing to: "+a.getID())}};b.unsubscribe=function(a,c){void 0!==b.socket&&(a.local||e("unsubscribe",a.getID(),function(b,d){null===b?c&&c(void 0,d):(f(a),c&&c(!0))},function(){L.Logger.error("Error calling unsubscribe.")}))};b.getStreamsByAttribute=function(a,c){var d=[],f,e;for(f in b.remoteStreams)b.remoteStreams.hasOwnProperty(f)&&
(e=b.remoteStreams[f],void 0!==e.getAttributes()&&void 0!==e.getAttributes()[a]&&e.getAttributes()[a]===c&&d.push(e));return d};return b};var L=L||{};
L.Logger=function(c){return{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5,enableLogPanel:function(){c.Logger.panel=document.createElement("textarea");c.Logger.panel.setAttribute("id","licode-logs");c.Logger.panel.setAttribute("style","width: 100%; height: 100%; display: none");c.Logger.panel.setAttribute("rows",20);c.Logger.panel.setAttribute("cols",20);c.Logger.panel.setAttribute("readOnly",!0);document.body.appendChild(c.Logger.panel)},setLogLevel:function(a){a>c.Logger.NONE?a=c.Logger.NONE:a<
c.Logger.DEBUG&&(a=c.Logger.DEBUG);c.Logger.logLevel=a},log:function(a){var b="";if(!(a<c.Logger.logLevel)){a===c.Logger.DEBUG?b+="DEBUG":a===c.Logger.TRACE?b+="TRACE":a===c.Logger.INFO?b+="INFO":a===c.Logger.WARNING?b+="WARNING":a===c.Logger.ERROR&&(b+="ERROR");for(var b=b+": ",d=[],e=0;e<arguments.length;e++)d[e]=arguments[e];d=d.slice(1);d=[b].concat(d);if(void 0!==c.Logger.panel){b="";for(e=0;e<d.length;e++)b+=d[e];c.Logger.panel.value=c.Logger.panel.value+"\n"+b}else console.log.apply(console,
d)}},debug:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];c.Logger.log.apply(c.Logger,[c.Logger.DEBUG].concat(a))},trace:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];c.Logger.log.apply(c.Logger,[c.Logger.TRACE].concat(a))},info:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];c.Logger.log.apply(c.Logger,[c.Logger.INFO].concat(a))},warning:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];c.Logger.log.apply(c.Logger,
[c.Logger.WARNING].concat(a))},error:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];c.Logger.log.apply(c.Logger,[c.Logger.ERROR].concat(a))}}}(L);L=L||{};
L.Base64=function(){var c,a,b,d,e,h,j,k,f;c="A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,0,1,2,3,4,5,6,7,8,9,+,/".split(",");a=[];for(e=0;e<c.length;e+=1)a[c[e]]=e;h=function(a){b=a;d=0};j=function(){var a;if(!b||d>=b.length)return-1;a=b.charCodeAt(d)&255;d+=1;return a};k=function(){if(!b)return-1;for(;;){if(d>=b.length)return-1;var c=b.charAt(d);d+=1;if(a[c])return a[c];if("A"===c)return 0}};f=function(a){a=a.toString(16);1===a.length&&(a=
"0"+a);return unescape("%"+a)};return{encodeBase64:function(a){var b,d,f;h(a);a="";b=Array(3);d=0;for(f=!1;!f&&-1!==(b[0]=j());)if(b[1]=j(),b[2]=j(),a+=c[b[0]>>2],-1!==b[1]?(a+=c[b[0]<<4&48|b[1]>>4],-1!==b[2]?(a+=c[b[1]<<2&60|b[2]>>6],a+=c[b[2]&63]):(a+=c[b[1]<<2&60],a+="=",f=!0)):(a+=c[b[0]<<4&48],a+="=",a+="=",f=!0),d+=4,76<=d)a+="\n",d=0;return a},decodeBase64:function(a){var b,c;h(a);a="";b=Array(4);for(c=!1;!c&&-1!==(b[0]=k())&&-1!==(b[1]=k());)b[2]=k(),b[3]=k(),a+=f(b[0]<<2&255|b[1]>>4),-1!==
b[2]?(a+=f(b[1]<<4&255|b[2]>>2),-1!==b[3]?a+=f(b[2]<<6&255|b[3]):c=!0):c=!0;return a}}}(L);(function(){function c(){(new L.ElementQueries).init()}this.L=this.L||{};this.L.ElementQueries=function(){function a(a){a||(a=document.documentElement);a=getComputedStyle(a,"fontSize");return parseFloat(a)||16}function b(b,c){var d=c.replace(/[0-9]*/,""),c=parseFloat(c);switch(d){case "px":return c;case "em":return c*a(b);case "rem":return c*a();case "vw":return c*document.documentElement.clientWidth/100;case "vh":return c*document.documentElement.clientHeight/100;case "vmin":case "vmax":return c*
(0,Math["vmin"===d?"min":"max"])(document.documentElement.clientWidth/100,document.documentElement.clientHeight/100);default:return c}}function c(a){this.element=a;this.options=[];var d,e,h,j=0,k=0,q,u,v,w,p;this.addOption=function(a){this.options.push(a)};var s=["min-width","min-height","max-width","max-height"];this.call=function(){j=this.element.offsetWidth;k=this.element.offsetHeight;v={};d=0;for(e=this.options.length;d<e;d++)h=this.options[d],q=b(this.element,h.value),u="width"==h.property?j:
k,p=h.mode+"-"+h.property,w="","min"==h.mode&&u>=q&&(w+=h.value),"max"==h.mode&&u<=q&&(w+=h.value),v[p]||(v[p]=""),w&&-1===(" "+v[p]+" ").indexOf(" "+w+" ")&&(v[p]+=" "+w);for(var a in s)v[s[a]]?this.element.setAttribute(s[a],v[s[a]].substr(1)):this.element.removeAttribute(s[a])}}function e(a,b){a.elementQueriesSetupInformation?a.elementQueriesSetupInformation.addOption(b):(a.elementQueriesSetupInformation=new c(a),a.elementQueriesSetupInformation.addOption(b),new ResizeSensor(a,function(){a.elementQueriesSetupInformation.call()}));
a.elementQueriesSetupInformation.call()}function h(a){for(var b,a=a.replace(/'/g,'"');null!==(b=k.exec(a));)if(5<b.length){var c=b[1]||b[5],d=b[2],h=b[3];b=b[4];var j=void 0;document.querySelectorAll&&(j=document.querySelectorAll.bind(document));!j&&"undefined"!==typeof $$&&(j=$$);!j&&"undefined"!==typeof jQuery&&(j=jQuery);if(!j)throw"No document.querySelectorAll, jQuery or Mootools's $$ found.";for(var c=j(c),j=0,q=c.length;j<q;j++)e(c[j],{mode:d,property:h,value:b})}}function j(a){var b="";if(a)if("string"===
typeof a)a=a.toLowerCase(),(-1!==a.indexOf("min-width")||-1!==a.indexOf("max-width"))&&h(a);else for(var c=0,d=a.length;c<d;c++)1===a[c].type?(b=a[c].selectorText||a[c].cssText,-1!==b.indexOf("min-height")||-1!==b.indexOf("max-height")?h(b):(-1!==b.indexOf("min-width")||-1!==b.indexOf("max-width"))&&h(b)):4===a[c].type&&j(a[c].cssRules||a[c].rules)}var k=/,?([^,\n]*)\[[\s\t]*(min|max)-(width|height)[\s\t]*[~$\^]?=[\s\t]*"([^"]*)"[\s\t]*]([^\n\s\{]*)/mgi;this.init=function(){for(var a=0,b=document.styleSheets.length;a<
b;a++)j(document.styleSheets[a].cssText||document.styleSheets[a].cssRules||document.styleSheets[a].rules)}};window.addEventListener?window.addEventListener("load",c,!1):window.attachEvent("onload",c);this.L.ResizeSensor=function(a,b){function c(a,b){window.OverflowEvent?a.addEventListener("overflowchanged",function(a){b.call(this,a)}):(a.addEventListener("overflow",function(a){b.call(this,a)}),a.addEventListener("underflow",function(a){b.call(this,a)}))}function e(){this.q=[];this.add=function(a){this.q.push(a)};
var a,b;this.call=function(){a=0;for(b=this.q.length;a<b;a++)this.q[a].call()}}function h(a,b){function h(){var b=!1,c=a.resizeSensor.offsetWidth,d=a.resizeSensor.offsetHeight;k!=c&&(q.width=c-1+"px",u.width=c+1+"px",b=!0,k=c);o!=d&&(q.height=d-1+"px",u.height=d+1+"px",b=!0,o=d);return b}if(a.resizedAttached){if(a.resizedAttached){a.resizedAttached.add(b);return}}else a.resizedAttached=new e,a.resizedAttached.add(b);var j=function(){h()&&a.resizedAttached.call()};a.resizeSensor=document.createElement("div");
a.resizeSensor.className="resize-sensor";a.resizeSensor.style.cssText="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1;";a.resizeSensor.innerHTML='<div class="resize-sensor-overflow" style="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1;"><div></div></div><div class="resize-sensor-underflow" style="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1;"><div></div></div>';a.appendChild(a.resizeSensor);
if("absolute"!==(a.currentStyle?a.currentStyle.position:window.getComputedStyle?window.getComputedStyle(a,null).getPropertyValue("position"):a.style.position))a.style.position="relative";var k=-1,o=-1,q=a.resizeSensor.firstElementChild.firstChild.style,u=a.resizeSensor.lastElementChild.firstChild.style;h();c(a.resizeSensor,j);c(a.resizeSensor.firstElementChild,j);c(a.resizeSensor.lastElementChild,j)}if("array"===typeof a||"undefined"!==typeof jQuery&&a instanceof jQuery||"undefined"!==typeof Elements&&
a instanceof Elements)for(var j=0,k=a.length;j<k;j++)h(a[j],b);else h(a,b)}})();Erizo=Erizo||{};Erizo.View=function(){var c=Erizo.EventDispatcher({});c.url="http://chotis2.dit.upm.es:3000";return c};Erizo=Erizo||{};
Erizo.VideoPlayer=function(c){var a=Erizo.View({});a.id=c.id;a.stream=c.stream.stream;a.elementID=c.elementID;a.destroy=function(){a.video.pause();delete a.resizer;a.parentNode.removeChild(a.div)};a.resize=function(){var b=a.container.offsetWidth,d=a.container.offsetHeight;if(c.stream.screen||!1===c.options.crop)0.75*b<d?(a.video.style.width=b+"px",a.video.style.height=0.75*b+"px",a.video.style.top=-(0.75*b/2-d/2)+"px",a.video.style.left="0px"):(a.video.style.height=d+"px",a.video.style.width=4/3*
d+"px",a.video.style.left=-(4/3*d/2-b/2)+"px",a.video.style.top="0px");else if(b!==a.containerWidth||d!==a.containerHeight)0.75*b>d?(a.video.style.width=b+"px",a.video.style.height=0.75*b+"px",a.video.style.top=-(0.75*b/2-d/2)+"px",a.video.style.left="0px"):(a.video.style.height=d+"px",a.video.style.width=4/3*d+"px",a.video.style.left=-(4/3*d/2-b/2)+"px",a.video.style.top="0px");a.containerWidth=b;a.containerHeight=d};L.Logger.debug("Creating URL from stream "+a.stream);a.stream_url=(window.URL||
webkitURL).createObjectURL(a.stream);a.div=document.createElement("div");a.div.setAttribute("id","player_"+a.id);a.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;");a.loader=document.createElement("img");a.loader.setAttribute("style","width: 16px; height: 16px; position: absolute; top: 50%; left: 50%; margin-top: -8px; margin-left: -8px");a.loader.setAttribute("id","back_"+a.id);a.loader.setAttribute("src",a.url+"/assets/loader.gif");
a.video=document.createElement("video");a.video.setAttribute("id","stream"+a.id);a.video.setAttribute("style","width: 100%; height: 100%; position: absolute");a.video.setAttribute("autoplay","autoplay");c.stream.local&&(a.video.volume=0);void 0!==a.elementID?(document.getElementById(a.elementID).appendChild(a.div),a.container=document.getElementById(a.elementID)):(document.body.appendChild(a.div),a.container=document.body);a.parentNode=a.div.parentNode;a.div.appendChild(a.loader);a.div.appendChild(a.video);
a.containerWidth=0;a.containerHeight=0;a.resizer=new L.ResizeSensor(a.container,a.resize);a.resize();a.bar=new Erizo.Bar({elementID:"player_"+a.id,id:a.id,stream:c.stream,media:a.video,options:c.options});a.div.onmouseover=function(){a.bar.display()};a.div.onmouseout=function(){a.bar.hide()};a.video.src=a.stream_url;return a};Erizo=Erizo||{};
Erizo.AudioPlayer=function(c){var a=Erizo.View({}),b,d;a.id=c.id;a.stream=c.stream.stream;a.elementID=c.elementID;L.Logger.debug("Creating URL from stream "+a.stream);a.stream_url=(window.URL||webkitURL).createObjectURL(a.stream);a.audio=document.createElement("audio");a.audio.setAttribute("id","stream"+a.id);a.audio.setAttribute("style","width: 100%; height: 100%; position: absolute");a.audio.setAttribute("autoplay","autoplay");c.stream.local&&(a.audio.volume=0);c.stream.local&&(a.audio.volume=0);
void 0!==a.elementID?(a.destroy=function(){a.audio.pause();a.parentNode.removeChild(a.div)},b=function(){a.bar.display()},d=function(){a.bar.hide()},a.div=document.createElement("div"),a.div.setAttribute("id","player_"+a.id),a.div.setAttribute("style","width: 100%; height: 100%; position: relative; overflow: hidden;"),document.getElementById(a.elementID).appendChild(a.div),a.container=document.getElementById(a.elementID),a.parentNode=a.div.parentNode,a.div.appendChild(a.audio),a.bar=new Erizo.Bar({elementID:"player_"+
a.id,id:a.id,stream:c.stream,media:a.audio,options:c.options}),a.div.onmouseover=b,a.div.onmouseout=d):(a.destroy=function(){a.audio.pause();a.parentNode.removeChild(a.audio)},document.body.appendChild(a.audio),a.parentNode=document.body);a.audio.src=a.stream_url;return a};Erizo=Erizo||{};
Erizo.Bar=function(c){var a=Erizo.View({}),b,d;a.elementID=c.elementID;a.id=c.id;a.div=document.createElement("div");a.div.setAttribute("id","bar_"+a.id);a.bar=document.createElement("div");a.bar.setAttribute("style","width: 100%; height: 15%; max-height: 30px; position: absolute; bottom: 0; right: 0; background-color: rgba(255,255,255,0.62)");a.bar.setAttribute("id","subbar_"+a.id);a.link=document.createElement("a");a.link.setAttribute("href","http://www.lynckia.com/");a.link.setAttribute("target","_blank");
a.logo=document.createElement("img");a.logo.setAttribute("style","width: 100%; height: 100%; max-width: 30px; position: absolute; top: 0; left: 2px;");a.logo.setAttribute("alt","Lynckia");a.logo.setAttribute("src",a.url+"/assets/star.svg");d=function(c){"block"!==c?c="none":clearTimeout(b);a.div.setAttribute("style","width: 100%; height: 100%; position: relative; bottom: 0; right: 0; display:"+c)};a.display=function(){d("block")};a.hide=function(){b=setTimeout(d,1E3)};document.getElementById(a.elementID).appendChild(a.div);
a.div.appendChild(a.bar);a.bar.appendChild(a.link);a.link.appendChild(a.logo);if(!c.stream.screen&&(void 0===c.options||void 0===c.options.speaker||!0===c.options.speaker))a.speaker=new Erizo.Speaker({elementID:"subbar_"+a.id,id:a.id,stream:c.stream,media:c.media});a.display();a.hide();return a};Erizo=Erizo||{};
Erizo.Speaker=function(c){var a=Erizo.View({}),b,d,e,h=50;a.elementID=c.elementID;a.media=c.media;a.id=c.id;a.stream=c.stream;a.div=document.createElement("div");a.div.setAttribute("style","width: 40%; height: 100%; max-width: 32px; position: absolute; right: 0;z-index:0;");a.icon=document.createElement("img");a.icon.setAttribute("id","volume_"+a.id);a.icon.setAttribute("src",a.url+"/assets/sound48.png");a.icon.setAttribute("style","width: 80%; height: 100%; position: absolute;");a.div.appendChild(a.icon);
a.stream.local?(d=function(){a.media.muted=!0;a.icon.setAttribute("src",a.url+"/assets/mute48.png");a.stream.stream.getAudioTracks()[0].enabled=!1},e=function(){a.media.muted=!1;a.icon.setAttribute("src",a.url+"/assets/sound48.png");a.stream.stream.getAudioTracks()[0].enabled=!0},a.icon.onclick=function(){a.media.muted?e():d()}):(a.picker=document.createElement("input"),a.picker.setAttribute("id","picker_"+a.id),a.picker.type="range",a.picker.min=0,a.picker.max=100,a.picker.step=10,a.picker.value=
h,a.picker.setAttribute("orient","vertical"),a.div.appendChild(a.picker),a.media.volume=a.picker.value/100,a.media.muted=!1,a.picker.oninput=function(){0<a.picker.value?(a.media.muted=!1,a.icon.setAttribute("src",a.url+"/assets/sound48.png")):(a.media.muted=!0,a.icon.setAttribute("src",a.url+"/assets/mute48.png"));a.media.volume=a.picker.value/100},b=function(b){a.picker.setAttribute("style","background: transparent; width: 32px; height: 100px; position: absolute; bottom: 90%; z-index: 1;"+a.div.offsetHeight+
"px; right: 0px; -webkit-appearance: slider-vertical; display: "+b)},d=function(){a.icon.setAttribute("src",a.url+"/assets/mute48.png");h=a.picker.value;a.picker.value=0;a.media.volume=0;a.media.muted=!0},e=function(){a.icon.setAttribute("src",a.url+"/assets/sound48.png");a.picker.value=h;a.media.volume=a.picker.value/100;a.media.muted=!1},a.icon.onclick=function(){a.media.muted?e():d()},a.div.onmouseover=function(){b("block")},a.div.onmouseout=function(){b("none")},b("none"));document.getElementById(a.elementID).appendChild(a.div);
return a};
