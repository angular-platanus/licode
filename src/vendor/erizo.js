(function(e,t){var n=e;n.version="0.9.6",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(e,r){var i=n.util.parseUri(e),s,o;t&&t.location&&(i.protocol=i.protocol||t.location.protocol.slice(0,-1),i.host=i.host||(t.document?t.document.domain:t.location.hostname),i.port=i.port||t.location.port),s=n.util.uniqueUri(i);var u={host:i.host,secure:"https"==i.protocol,port:i.port||("https"==i.protocol?443:80),query:i.query||""};n.util.merge(u,r);if(u["force new connection"]||!n.sockets[s])o=new n.Socket(u);return!u["force new connection"]&&o&&(n.sockets[s]=o),o=o||n.sockets[s],o.of(i.path.length>1?i.path:"")}})("object"==typeof module?module.exports:this.io={},this),function(e,t){var n=e.util={},r=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(e){var t=r.exec(e||""),n={},s=14;while(s--)n[i[s]]=t[s]||"";return n},n.uniqueUri=function(e){var n=e.protocol,r=e.host,i=e.port;return"document"in t?(r=r||document.domain,i=i||(n=="https"&&document.location.protocol!=="https:"?443:document.location.port)):(r=r||"localhost",!i&&n=="https"&&(i=443)),(n||"http")+"://"+r+":"+(i||80)},n.query=function(e,t){var r=n.chunkQuery(e||""),i=[];n.merge(r,n.chunkQuery(t||""));for(var s in r)r.hasOwnProperty(s)&&i.push(s+"="+r[s]);return i.length?"?"+i.join("&"):""},n.chunkQuery=function(e){var t={},n=e.split("&"),r=0,i=n.length,s;for(;r<i;++r)s=n[r].split("="),s[0]&&(t[s[0]]=s[1]);return t};var s=!1;n.load=function(e){if("document"in t&&document.readyState==="complete"||s)return e();n.on(t,"load",e,!1)},n.on=function(e,t,n,r){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,r)},n.request=function(e){if(e&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||n.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}return null},"undefined"!=typeof window&&n.load(function(){s=!0}),n.defer=function(e){if(!n.ua.webkit||"undefined"!=typeof importScripts)return e();n.load(function(){setTimeout(e,100)})},n.merge=function(t,r,i,s){var o=s||[],u=typeof i=="undefined"?2:i,a;for(a in r)r.hasOwnProperty(a)&&n.indexOf(o,a)<0&&(typeof t[a]!="object"||!u?(t[a]=r[a],o.push(r[a])):n.merge(t[a],r[a],u-1,o));return t},n.mixin=function(e,t){n.merge(e.prototype,t.prototype)},n.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},n.isArray=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},n.intersect=function(e,t){var r=[],i=e.length>t.length?e:t,s=e.length>t.length?t:e;for(var o=0,u=s.length;o<u;o++)~n.indexOf(i,s[o])&&r.push(s[o]);return r},n.indexOf=function(e,t,n){for(var r=e.length,n=n<0?n+r<0?0:n+r:n||0;n<r&&e[n]!==t;n++);return r<=n?-1:n},n.toArray=function(e){var t=[];for(var n=0,r=e.length;n<r;n++)t.push(e[n]);return t},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(t){return!1}return e.withCredentials!=undefined}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,this),function(e,t){function n(){}e.EventEmitter=n,n.prototype.on=function(e,n){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(n):this.$events[e]=[this.$events[e],n]:this.$events[e]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(e,t){function r(){n.removeListener(e,r),t.apply(this,arguments)}var n=this;return r.listener=t,this.on(e,r),this},n.prototype.removeListener=function(e,n){if(this.$events&&this.$events[e]){var r=this.$events[e];if(t.util.isArray(r)){var i=-1;for(var s=0,o=r.length;s<o;s++)if(r[s]===n||r[s].listener&&r[s].listener===n){i=s;break}if(i<0)return this;r.splice(i,1),r.length||delete this.$events[e]}else(r===n||r.listener&&r.listener===n)&&delete this.$events[e]}return this},n.prototype.removeAllListeners=function(e){return this.$events&&this.$events[e]&&(this.$events[e]=null),this},n.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},n.prototype.emit=function(e){if(!this.$events)return!1;var n=this.$events[e];if(!n)return!1;var r=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,r);else{if(!t.util.isArray(n))return!1;var i=n.slice();for(var s=0,o=i.length;s<o;s++)i[s].apply(this,r)}return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,nativeJSON){function f(e){return e<10?"0"+e:e}function date(e,t){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a instanceof Date&&(a=date(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")},JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}("undefined"!=typeof io?io:module.exports,typeof JSON!="undefined"?JSON:undefined),function(e,t){var n=e.parser={},r=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],i=n.reasons=["transport not supported","client not handshaken","unauthorized"],s=n.advice=["reconnect"],o=t.JSON,u=t.util.indexOf;n.encodePacket=function(e){var t=u(r,e.type),n=e.id||"",a=e.endpoint||"",f=e.ack,l=null;switch(e.type){case"error":var c=e.reason?u(i,e.reason):"",h=e.advice?u(s,e.advice):"";if(c!==""||h!=="")l=c+(h!==""?"+"+h:"");break;case"message":e.data!==""&&(l=e.data);break;case"event":var p={name:e.name};e.args&&e.args.length&&(p.args=e.args),l=o.stringify(p);break;case"json":l=o.stringify(e.data);break;case"connect":e.qs&&(l=e.qs);break;case"ack":l=e.ackId+(e.args&&e.args.length?"+"+o.stringify(e.args):"")}var d=[t,n+(f=="data"?"+":""),a];return l!==null&&l!==undefined&&d.push(l),d.join(":")},n.encodePayload=function(e){var t="";if(e.length==1)return e[0];for(var n=0,r=e.length;n<r;n++){var i=e[n];t+="�"+i.length+"�"+e[n]}return t};var a=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;n.decodePacket=function(e){var t=e.match(a);if(!t)return{};var n=t[2]||"",e=t[5]||"",u={type:r[t[1]],endpoint:t[4]||""};n&&(u.id=n,t[3]?u.ack="data":u.ack=!0);switch(u.type){case"error":var t=e.split("+");u.reason=i[t[0]]||"",u.advice=s[t[1]]||"";break;case"message":u.data=e||"";break;case"event":try{var f=o.parse(e);u.name=f.name,u.args=f.args}catch(l){}u.args=u.args||[];break;case"json":try{u.data=o.parse(e)}catch(l){}break;case"connect":u.qs=e||"";break;case"ack":var t=e.match(/^([0-9]+)(\+)?(.*)/);if(t){u.ackId=t[1],u.args=[];if(t[3])try{u.args=t[3]?o.parse(t[3]):[]}catch(l){}}break;case"disconnect":case"heartbeat":}return u},n.decodePayload=function(e){if(e.charAt(0)=="�"){var t=[];for(var r=1,i="";r<e.length;r++)e.charAt(r)=="�"?(t.push(n.decodePacket(e.substr(r+1).substr(0,i))),r+=Number(i)+1,i=""):i+=e.charAt(r);return t}return[n.decodePacket(e)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t){function n(e,t){this.socket=e,this.sessid=t}e.Transport=n,t.util.mixin(n,t.EventEmitter),n.prototype.onData=function(e){this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout();if(e!==""){var n=t.parser.decodePayload(e);if(n&&n.length)for(var r=0,i=n.length;r<i;r++)this.onPacket(n[r])}return this},n.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),e.type=="heartbeat"?this.onHeartbeat():(e.type=="connect"&&e.endpoint==""&&this.onConnect(),e.type=="error"&&e.advice=="reconnect"&&(this.open=!1),this.socket.onPacket(e),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.close&&this.open&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},n.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.open=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){var e=this;this.open=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},n.prototype.ready=function(e,t){t.call(this)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,n){function r(e){this.options={port:80,secure:!1,document:"document"in n?document:!1,resource:"socket.io",transports:t.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":Infinity,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1;if(this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var r=this;t.util.on(n,"unload",function(){r.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function i(){}e.Socket=r,t.util.mixin(r,t.EventEmitter),r.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),e!==""&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},r.prototype.publish=function(){this.emit.apply(this,arguments);var e;for(var t in this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t),e.$emit.apply(e,arguments))},r.prototype.handshake=function(e){function s(t){t instanceof Error?n.onError(t.message):e.apply(null,t.split(":"))}var n=this,r=this.options,o=["http"+(r.secure?"s":"")+":/",r.host+":"+r.port,r.resource,t.protocol,t.util.query(this.options.query,"t="+ +(new Date))].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS){var u=document.getElementsByTagName("script")[0],a=document.createElement("script");a.src=o+"&jsonp="+t.j.length,u.parentNode.insertBefore(a,u),t.j.push(function(e){s(e),a.parentNode.removeChild(a)})}else{var f=t.util.request();f.open("GET",o,!0),f.withCredentials=!0,f.onreadystatechange=function(){f.readyState==4&&(f.onreadystatechange=i,f.status==200?s(f.responseText):!n.reconnecting&&n.onError(f.responseText))},f.send(null)}},r.prototype.getTransport=function(e){var n=e||this.transports,r;for(var i=0,s;s=n[i];i++)if(t.Transport[s]&&t.Transport[s].check(this)&&(!this.isXDomain()||t.Transport[s].xdomainCheck()))return new t.Transport[s](this,this.sessionid);return null},r.prototype.connect=function(e){if(this.connecting)return this;var n=this;return this.handshake(function(r,i,s,o){function u(e){n.transport&&n.transport.clearTimeouts(),n.transport=n.getTransport(e);if(!n.transport)return n.publish("connect_failed");n.transport.ready(n,function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout(function(){if(!n.connected){n.connecting=!1;if(n.options["try multiple transports"]){n.remainingTransports||(n.remainingTransports=n.transports.slice(0));var e=n.remainingTransports;while(e.length>0&&e.splice(0,1)[0]!=n.transport.name);e.length?u(e):n.publish("connect_failed")}}},n.options["connect timeout"]))})}n.sessionid=r,n.closeTimeout=s*1e3,n.heartbeatTimeout=i*1e3,n.transports=o?t.util.intersect(o.split(","),n.options.transports):n.options.transports,n.setHeartbeatTimeout(),u(n.transports),n.once("connect",function(){clearTimeout(n.connectTimeoutTimer),e&&typeof e=="function"&&e()})}),this},r.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport.onClose()},this.heartbeatTimeout)},r.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},r.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])},r.prototype.disconnect=function(){if(this.connected||this.connecting)this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted");return this},r.prototype.disconnectSync=function(){var e=t.util.request(),n=this.resource+"/"+t.protocol+"/"+this.sessionid;e.open("GET",n,!0),this.onDisconnect("booted")},r.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e},r.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},r.prototype.onOpen=function(){this.open=!0},r.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},r.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},r.prototype.onError=function(e){e&&e.advice&&e.advice==="reconnect"&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},r.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1;if(t||n)this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect())},r.prototype.reconnect=function(){function i(){if(e.connected){for(var t in e.namespaces)e.namespaces.hasOwnProperty(t)&&""!==t&&e.namespaces[t].packet({type:"connect"});e.publish("reconnect",e.transport.name,e.reconnectionAttempts)}clearTimeout(e.reconnectionTimer),e.removeListener("connect_failed",s),e.removeListener("connect",s),e.reconnecting=!1,delete e.reconnectionAttempts,delete e.reconnectionDelay,delete e.reconnectionTimer,delete e.redoTransports,e.options["try multiple transports"]=n}function s(){if(!e.reconnecting)return;if(e.connected)return i();if(e.connecting&&e.reconnecting)return e.reconnectionTimer=setTimeout(s,1e3);e.reconnectionAttempts++>=t?e.redoTransports?(e.publish("reconnect_failed"),i()):(e.on("connect_failed",s),e.options["try multiple transports"]=!0,e.transport=e.getTransport(),e.redoTransports=!0,e.connect()):(e.reconnectionDelay<r&&(e.reconnectionDelay*=2),e.connect(),e.publish("reconnecting",e.reconnectionDelay,e.reconnectionAttempts),e.reconnectionTimer=setTimeout(s,e.reconnectionDelay))}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var e=this,t=this.options["max reconnection attempts"],n=this.options["try multiple transports"],r=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(s,this.reconnectionDelay),this.on("connect",s)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function n(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new r(this,"json"),this.ackPackets=0,this.acks={}}function r(e,t){this.namespace=e,this.name=t}e.SocketNamespace=n,t.util.mixin(n,t.EventEmitter),n.prototype.$emit=t.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=t),this.packet(n)},n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],r={type:"event",name:e};return"function"==typeof n&&(r.id=++this.ackPackets,r.ack="data",this.acks[r.id]=n,t=t.slice(0,t.length-1)),r.args=t,this.packet(r)},n.prototype.disconnect=function(){return this.name===""?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(e){function r(){n.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var n=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":this.name===""?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":var i=["message",e.data];e.ack=="data"?i.push(r):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,i);break;case"event":var i=[e.name].concat(e.args);e.ack=="data"&&i.push(r),this.$emit.apply(this,i);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):e.reason=="unauthorized"?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},r.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},r.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,n){function r(e){t.Transport.apply(this,arguments)}e.websocket=r,t.util.inherit(r,t.Transport),r.prototype.name="websocket",r.prototype.open=function(){var e=t.util.query(this.socket.options.query),r=this,i;return i||(i=n.MozWebSocket||n.WebSocket),this.websocket=new i(this.prepareUrl()+e),this.websocket.onopen=function(){r.onOpen(),r.socket.setBuffer(!1)},this.websocket.onmessage=function(e){r.onData(e.data)},this.websocket.onclose=function(){r.onClose(),r.socket.setBuffer(!0)},this.websocket.onerror=function(e){r.onError(e)},this},r.prototype.send=function(e){return this.websocket.send(e),this},r.prototype.payload=function(e){for(var t=0,n=e.length;t<n;t++)this.packet(e[t]);return this},r.prototype.close=function(){return this.websocket.close(),this},r.prototype.onError=function(e){this.socket.onError(e)},r.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},r.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},r.xdomainCheck=function(){return!0},t.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function n(){t.Transport.websocket.apply(this,arguments)}e.flashsocket=n,t.util.inherit(n,t.Transport.websocket),n.prototype.name="flashsocket",n.prototype.open=function(){var e=this,n=arguments;return WebSocket.__addTask(function(){t.Transport.websocket.prototype.open.apply(e,n)}),this},n.prototype.send=function(){var e=this,n=arguments;return WebSocket.__addTask(function(){t.Transport.websocket.prototype.send.apply(e,n)}),this},n.prototype.close=function(){return WebSocket.__tasks.length=0,t.Transport.websocket.prototype.close.call(this),this},n.prototype.ready=function(e,r){function i(){var t=e.options,i=t["flash policy port"],o=["http"+(t.secure?"s":"")+":/",t.host+":"+t.port,t.resource,"static/flashsocket","WebSocketMain"+(e.isXDomain()?"Insecure":"")+".swf"];n.loaded||(typeof WEB_SOCKET_SWF_LOCATION=="undefined"&&(WEB_SOCKET_SWF_LOCATION=o.join("/")),i!==843&&WebSocket.loadFlashPolicyFile("xmlsocket://"+t.host+":"+i),WebSocket.__initialize(),n.loaded=!0),r.call(s)}var s=this;if(document.body)return i();t.util.load(i)},n.check=function(){return typeof WebSocket!="undefined"&&"__initialize"in WebSocket&&!!swfobject?swfobject.getFlashPlayerVersion().major>=10:!1},n.xdomainCheck=function(){return!0},typeof window!="undefined"&&(WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0),t.transports.push("flashsocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports);if("undefined"!=typeof window)var swfobject=function(){function C(){if(b)return;try{var e=a.getElementsByTagName("body")[0].appendChild(U("span"));e.parentNode.removeChild(e)}catch(t){return}b=!0;var n=c.length;for(var r=0;r<n;r++)c[r]()}function k(e){b?e():c[c.length]=e}function L(t){if(typeof u.addEventListener!=e)u.addEventListener("load",t,!1);else if(typeof a.addEventListener!=e)a.addEventListener("load",t,!1);else if(typeof u.attachEvent!=e)z(u,"onload",t);else if(typeof u.onload=="function"){var n=u.onload;u.onload=function(){n(),t()}}else u.onload=t}function A(){l?O():M()}function O(){var n=a.getElementsByTagName("body")[0],r=U(t);r.setAttribute("type",i);var s=n.appendChild(r);if(s){var o=0;(function(){if(typeof s.GetVariable!=e){var t=s.GetVariable("$version");t&&(t=t.split(" ")[1].split(","),T.pv=[parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10)])}else if(o<10){o++,setTimeout(arguments.callee,10);return}n.removeChild(r),s=null,M()})()}else M()}function M(){var t=h.length;if(t>0)for(var n=0;n<t;n++){var r=h[n].id,i=h[n].callbackFn,s={success:!1,id:r};if(T.pv[0]>0){var o=R(r);if(o)if(W(h[n].swfVersion)&&!(T.wk&&T.wk<312))V(r,!0),i&&(s.success=!0,s.ref=_(r),i(s));else if(h[n].expressInstall&&D()){var u={};u.data=h[n].expressInstall,u.width=o.getAttribute("width")||"0",u.height=o.getAttribute("height")||"0",o.getAttribute("class")&&(u.styleclass=o.getAttribute("class")),o.getAttribute("align")&&(u.align=o.getAttribute("align"));var a={},f=o.getElementsByTagName("param"),l=f.length;for(var c=0;c<l;c++)f[c].getAttribute("name").toLowerCase()!="movie"&&(a[f[c].getAttribute("name")]=f[c].getAttribute("value"));P(u,a,r,i)}else H(o),i&&i(s)}else{V(r,!0);if(i){var p=_(r);p&&typeof p.SetVariable!=e&&(s.success=!0,s.ref=p),i(s)}}}}function _(n){var r=null,i=R(n);if(i&&i.nodeName=="OBJECT")if(typeof i.SetVariable!=e)r=i;else{var s=i.getElementsByTagName(t)[0];s&&(r=s)}return r}function D(){return!w&&W("6.0.65")&&(T.win||T.mac)&&!(T.wk&&T.wk<312)}function P(t,n,r,i){w=!0,g=i||null,y={success:!1,id:r};var o=R(r);if(o){o.nodeName=="OBJECT"?(v=B(o),m=null):(v=o,m=r),t.id=s;if(typeof t.width==e||!/%$/.test(t.width)&&parseInt(t.width,10)<310)t.width="310";if(typeof t.height==e||!/%$/.test(t.height)&&parseInt(t.height,10)<137)t.height="137";a.title=a.title.slice(0,47)+" - Flash Player Installation";var f=T.ie&&T.win?["Active"].concat("").join("X"):"PlugIn",l="MMredirectURL="+u.location.toString().replace(/&/g,"%26")+"&MMplayerType="+f+"&MMdoctitle="+a.title;typeof n.flashvars!=e?n.flashvars+="&"+l:n.flashvars=l;if(T.ie&&T.win&&o.readyState!=4){var c=U("div");r+="SWFObjectNew",c.setAttribute("id",r),o.parentNode.insertBefore(c,o),o.style.display="none",function(){o.readyState==4?o.parentNode.removeChild(o):setTimeout(arguments.callee,10)}()}j(t,n,r)}}function H(e){if(T.ie&&T.win&&e.readyState!=4){var t=U("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(B(e),t),e.style.display="none",function(){e.readyState==4?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(B(e),e)}function B(e){var n=U("div");if(T.win&&T.ie)n.innerHTML=e.innerHTML;else{var r=e.getElementsByTagName(t)[0];if(r){var i=r.childNodes;if(i){var s=i.length;for(var o=0;o<s;o++)(i[o].nodeType!=1||i[o].nodeName!="PARAM")&&i[o].nodeType!=8&&n.appendChild(i[o].cloneNode(!0))}}}return n}function j(n,r,s){var o,u=R(s);if(T.wk&&T.wk<312)return o;if(u){typeof n.id==e&&(n.id=s);if(T.ie&&T.win){var a="";for(var f in n)n[f]!=Object.prototype[f]&&(f.toLowerCase()=="data"?r.movie=n[f]:f.toLowerCase()=="styleclass"?a+=' class="'+n[f]+'"':f.toLowerCase()!="classid"&&(a+=" "+f+'="'+n[f]+'"'));var l="";for(var c in r)r[c]!=Object.prototype[c]&&(l+='<param name="'+c+'" value="'+r[c]+'" />');u.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+a+">"+l+"</object>",p[p.length]=n.id,o=R(n.id)}else{var h=U(t);h.setAttribute("type",i);for(var d in n)n[d]!=Object.prototype[d]&&(d.toLowerCase()=="styleclass"?h.setAttribute("class",n[d]):d.toLowerCase()!="classid"&&h.setAttribute(d,n[d]));for(var v in r)r[v]!=Object.prototype[v]&&v.toLowerCase()!="movie"&&F(h,v,r[v]);u.parentNode.replaceChild(h,u),o=h}}return o}function F(e,t,n){var r=U("param");r.setAttribute("name",t),r.setAttribute("value",n),e.appendChild(r)}function I(e){var t=R(e);t&&t.nodeName=="OBJECT"&&(T.ie&&T.win?(t.style.display="none",function(){t.readyState==4?q(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function q(e){var t=R(e);if(t){for(var n in t)typeof t[n]=="function"&&(t[n]=null);t.parentNode.removeChild(t)}}function R(e){var t=null;try{t=a.getElementById(e)}catch(n){}return t}function U(e){return a.createElement(e)}function z(e,t,n){e.attachEvent(t,n),d[d.length]=[e,t,n]}function W(e){var t=T.pv,n=e.split(".");return n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||0,n[2]=parseInt(n[2],10)||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?!0:!1}function X(n,r,i,s){if(T.ie&&T.mac)return;var o=a.getElementsByTagName("head")[0];if(!o)return;var u=i&&typeof i=="string"?i:"screen";s&&(E=null,S=null);if(!E||S!=u){var f=U("style");f.setAttribute("type","text/css"),f.setAttribute("media",u),E=o.appendChild(f),T.ie&&T.win&&typeof a.styleSheets!=e&&a.styleSheets.length>0&&(E=a.styleSheets[a.styleSheets.length-1]),S=u}T.ie&&T.win?E&&typeof E.addRule==t&&E.addRule(n,r):E&&typeof a.createTextNode!=e&&E.appendChild(a.createTextNode(n+" {"+r+"}"))}function V(e,t){if(!x)return;var n=t?"visible":"hidden";b&&R(e)?R(e).style.visibility=n:X("#"+e,"visibility:"+n)}function $(t){var n=/[\\\"<>\.;]/,r=n.exec(t)!=null;return r&&typeof encodeURIComponent!=e?encodeURIComponent(t):t}var e="undefined",t="object",n="Shockwave Flash",r="ShockwaveFlash.ShockwaveFlash",i="application/x-shockwave-flash",s="SWFObjectExprInst",o="onreadystatechange",u=window,a=document,f=navigator,l=!1,c=[A],h=[],p=[],d=[],v,m,g,y,b=!1,w=!1,E,S,x=!0,T=function(){var s=typeof a.getElementById!=e&&typeof a.getElementsByTagName!=e&&typeof a.createElement!=e,o=f.userAgent.toLowerCase(),c=f.platform.toLowerCase(),h=c?/win/.test(c):/win/.test(o),p=c?/mac/.test(c):/mac/.test(o),d=/webkit/.test(o)?parseFloat(o.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,v=!1,m=[0,0,0],g=null;if(typeof f.plugins!=e&&typeof f.plugins[n]==t)g=f.plugins[n].description,g&&(typeof f.mimeTypes==e||!f.mimeTypes[i]||!!f.mimeTypes[i].enabledPlugin)&&(l=!0,v=!1,g=g.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),m[0]=parseInt(g.replace(/^(.*)\..*$/,"$1"),10),m[1]=parseInt(g.replace(/^.*\.(.*)\s.*$/,"$1"),10),m[2]=/[a-zA-Z]/.test(g)?parseInt(g.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof u[["Active"].concat("Object").join("X")]!=e)try{var y=new(window[["Active"].concat("Object").join("X")])(r);y&&(g=y.GetVariable("$version"),g&&(v=!0,g=g.split(" ")[1].split(","),m=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)]))}catch(b){}return{w3:s,pv:m,wk:d,ie:v,win:h,mac:p}}(),N=function(){if(!T.w3)return;(typeof a.readyState!=e&&a.readyState=="complete"||typeof a.readyState==e&&(a.getElementsByTagName("body")[0]||a.body))&&C(),b||(typeof a.addEventListener!=e&&a.addEventListener("DOMContentLoaded",C,!1),T.ie&&T.win&&(a.attachEvent(o,function(){a.readyState=="complete"&&(a.detachEvent(o,arguments.callee),C())}),u==top&&function(){if(b)return;try{a.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}C()}()),T.wk&&function(){if(b)return;if(!/loaded|complete/.test(a.readyState)){setTimeout(arguments.callee,0);return}C()}(),L(C))}(),J=function(){T.ie&&T.win&&window.attachEvent("onunload",function(){var e=d.length;for(var t=0;t<e;t++)d[t][0].detachEvent(d[t][1],d[t][2]);var n=p.length;for(var r=0;r<n;r++)I(p[r]);for(var i in T)T[i]=null;T=null;for(var s in swfobject)swfobject[s]=null;swfobject=null})}();return{registerObject:function(e,t,n,r){if(T.w3&&e&&t){var i={};i.id=e,i.swfVersion=t,i.expressInstall=n,i.callbackFn=r,h[h.length]=i,V(e,!1)}else r&&r({success:!1,id:e})},getObjectById:function(e){if(T.w3)return _(e)},embedSWF:function(n,r,i,s,o,u,a,f,l,c){var h={success:!1,id:r};T.w3&&!(T.wk&&T.wk<312)&&n&&r&&i&&s&&o?(V(r,!1),k(function(){i+="",s+="";var p={};if(l&&typeof l===t)for(var d in l)p[d]=l[d];p.data=n,p.width=i,p.height=s;var v={};if(f&&typeof f===t)for(var m in f)v[m]=f[m];if(a&&typeof a===t)for(var g in a)typeof v.flashvars!=e?v.flashvars+="&"+g+"="+a[g]:v.flashvars=g+"="+a[g];if(W(o)){var y=j(p,v,r);p.id==r&&V(r,!0),h.success=!0,h.ref=y}else{if(u&&D()){p.data=u,P(p,v,r,c);return}V(r,!0)}c&&c(h)})):c&&c(h)},switchOffAutoHideShow:function(){x=!1},ua:T,getFlashPlayerVersion:function(){return{major:T.pv[0],minor:T.pv[1],release:T.pv[2]}},hasFlashPlayerVersion:W,createSWF:function(e,t,n){return T.w3?j(e,t,n):undefined},showExpressInstall:function(e,t,n,r){T.w3&&D()&&P(e,t,n,r)},removeSWF:function(e){T.w3&&I(e)},createCSS:function(e,t,n,r){T.w3&&X(e,t,n,r)},addDomLoadEvent:k,addLoadEvent:L,getQueryParamValue:function(e){var t=a.location.search||a.location.hash;if(t){/\?/.test(t)&&(t=t.split("?")[1]);if(e==null)return $(t);var n=t.split("&");for(var r=0;r<n.length;r++)if(n[r].substring(0,n[r].indexOf("="))==e)return $(n[r].substring(n[r].indexOf("=")+1))}return""},expressInstallCallback:function(){if(w){var e=R(s);e&&v&&(e.parentNode.replaceChild(v,e),m&&(V(m,!0),T.ie&&T.win&&(v.style.display="block")),g&&g(y)),w=!1}}}}();(function(){if("undefined"==typeof window||window.WebSocket)return;var e=window.console;if(!e||!e.log||!e.error)e={log:function(){},error:function(){}};if(!swfobject.hasFlashPlayerVersion("10.0.0")){e.error("Flash Player >= 10.0.0 is required.");return}location.protocol=="file:"&&e.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(e,t,n,r,i){var s=this;s.__id=WebSocket.__nextId++,WebSocket.__instances[s.__id]=s,s.readyState=WebSocket.CONNECTING
,s.bufferedAmount=0,s.__events={},t?typeof t=="string"&&(t=[t]):t=[],setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(s.__id,e,t,n||null,r||0,i||null)})},0)},WebSocket.prototype.send=function(e){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";var t=WebSocket.__flash.send(this.__id,encodeURIComponent(e));return t<0?!0:(this.bufferedAmount+=t,!1)},WebSocket.prototype.close=function(){if(this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING)return;this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id)},WebSocket.prototype.addEventListener=function(e,t,n){e in this.__events||(this.__events[e]=[]),this.__events[e].push(t)},WebSocket.prototype.removeEventListener=function(e,t,n){if(!(e in this.__events))return;var r=this.__events[e];for(var i=r.length-1;i>=0;--i)if(r[i]===t){r.splice(i,1);break}},WebSocket.prototype.dispatchEvent=function(e){var t=this.__events[e.type]||[];for(var n=0;n<t.length;++n)t[n](e);var r=this["on"+e.type];r&&r(e)},WebSocket.prototype.__handleEvent=function(e){"readyState"in e&&(this.readyState=e.readyState),"protocol"in e&&(this.protocol=e.protocol);var t;if(e.type=="open"||e.type=="error")t=this.__createSimpleEvent(e.type);else if(e.type=="close")t=this.__createSimpleEvent("close");else{if(e.type!="message")throw"unknown event type: "+e.type;var n=decodeURIComponent(e.message);t=this.__createMessageEvent("message",n)}this.dispatchEvent(t)},WebSocket.prototype.__createSimpleEvent=function(e){if(document.createEvent&&window.Event){var t=document.createEvent("Event");return t.initEvent(e,!1,!1),t}return{type:e,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(e,t){if(document.createEvent&&window.MessageEvent&&!window.opera){var n=document.createEvent("MessageEvent");return n.initMessageEvent("message",!1,!1,t,null,null,window,null),n}return{type:e,data:t,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(e){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(e)})},WebSocket.__initialize=function(){if(WebSocket.__flash)return;WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation);if(!window.WEB_SOCKET_SWF_LOCATION){e.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");return}var t=document.createElement("div");t.id="webSocketContainer",t.style.position="absolute",WebSocket.__isFlashLite()?(t.style.left="0px",t.style.top="0px"):(t.style.left="-100px",t.style.top="-100px");var n=document.createElement("div");n.id="webSocketFlash",t.appendChild(n),document.body.appendChild(t),swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(t){t.success||e.error("[WebSocket] swfobject.embedSWF failed")})},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash"),WebSocket.__flash.setCallerUrl(location.href),WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var e=0;e<WebSocket.__tasks.length;++e)WebSocket.__tasks[e]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){return setTimeout(function(){try{var t=WebSocket.__flash.receiveEvents();for(var n=0;n<t.length;++n)WebSocket.__instances[t[n].webSocketId].__handleEvent(t[n])}catch(r){e.error(r)}},0),!0},WebSocket.__log=function(t){e.log(decodeURIComponent(t))},WebSocket.__error=function(t){e.error(decodeURIComponent(t))},WebSocket.__addTask=function(e){WebSocket.__flash?e():WebSocket.__tasks.push(e)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var e=window.navigator.mimeTypes["application/x-shockwave-flash"];return!e||!e.enabledPlugin||!e.enabledPlugin.filename?!1:e.enabledPlugin.filename.match(/flashlite/i)?!0:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",function(){WebSocket.__initialize()},!1):window.attachEvent("onload",function(){WebSocket.__initialize()}))})(),function(e,t,n){function r(e){if(!e)return;t.Transport.apply(this,arguments),this.sendBuffer=[]}function i(){}e.XHR=r,t.util.inherit(r,t.Transport),r.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},r.prototype.payload=function(e){var n=[];for(var r=0,i=e.length;r<i;r++)n.push(t.parser.encodePacket(e[r]));this.send(t.parser.encodePayload(n))},r.prototype.send=function(e){return this.post(e),this},r.prototype.post=function(e){function r(){this.readyState==4&&(this.onreadystatechange=i,t.posting=!1,this.status==200?t.socket.setBuffer(!1):t.onClose())}function s(){this.onload=i,t.socket.setBuffer(!1)}var t=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=s:this.sendXHR.onreadystatechange=r,this.sendXHR.send(e)},r.prototype.close=function(){return this.onClose(),this},r.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),r=t.util.query(this.socket.options.query,"t="+ +(new Date));n.open(e||"GET",this.prepareUrl()+r,!0);if(e=="POST")try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(i){}return n},r.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},r.check=function(e,r){try{var i=t.util.request(r),s=n.XDomainRequest&&i instanceof XDomainRequest,o=e&&e.options&&e.options.secure?"https:":"http:",u=o!=n.location.protocol;if(i&&(!s||!u))return!0}catch(a){}return!1},r.xdomainCheck=function(){return r.check(null,!0)}}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function n(e){t.Transport.XHR.apply(this,arguments)}e.htmlfile=n,t.util.inherit(n,t.Transport.XHR),n.prototype.name="htmlfile",n.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this;var e=this.doc.createElement("div");e.className="socketio",this.doc.body.appendChild(e),this.iframe=this.doc.createElement("iframe"),e.appendChild(this.iframe);var n=this,r=t.util.query(this.socket.options.query,"t="+ +(new Date));this.iframe.src=this.prepareUrl()+r,t.util.on(window,"unload",function(){n.destroy()})},n.prototype._=function(e,t){this.onData(e);try{var n=t.getElementsByTagName("script")[0];n.parentNode.removeChild(n)}catch(r){}},n.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(e){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},n.prototype.close=function(){return this.destroy(),t.Transport.XHR.prototype.close.call(this)},n.check=function(){if(typeof window!="undefined"&&["Active"].concat("Object").join("X")in window)try{var e=new(window[["Active"].concat("Object").join("X")])("htmlfile");return e&&t.Transport.XHR.check()}catch(n){}return!1},n.xdomainCheck=function(){return!1},t.transports.push("htmlfile")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,n){function r(){t.Transport.XHR.apply(this,arguments)}function i(){}e["xhr-polling"]=r,t.util.inherit(r,t.Transport.XHR),t.util.merge(r,t.Transport.XHR),r.prototype.name="xhr-polling",r.prototype.open=function(){var e=this;return t.Transport.XHR.prototype.open.call(e),!1},r.prototype.get=function(){function t(){this.readyState==4&&(this.onreadystatechange=i,this.status==200?(e.onData(this.responseText),e.get()):e.onClose())}function r(){this.onload=i,this.onerror=i,e.onData(this.responseText),e.get()}function s(){e.onClose()}if(!this.open)return;var e=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=r,this.xhr.onerror=s):this.xhr.onreadystatechange=t,this.xhr.send(null)},r.prototype.onClose=function(){t.Transport.XHR.prototype.onClose.call(this);if(this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i;try{this.xhr.abort()}catch(e){}this.xhr=null}},r.prototype.ready=function(e,n){var r=this;t.util.defer(function(){n.call(r)})},t.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t,n){function i(e){t.Transport["xhr-polling"].apply(this,arguments),this.index=t.j.length;var n=this;t.j.push(function(e){n._(e)})}var r=n.document&&"MozAppearance"in n.document.documentElement.style;e["jsonp-polling"]=i,t.util.inherit(i,t.Transport["xhr-polling"]),i.prototype.name="jsonp-polling",i.prototype.post=function(e){function a(){f(),n.socket.setBuffer(!1)}function f(){n.iframe&&n.form.removeChild(n.iframe);try{u=document.createElement('<iframe name="'+n.iframeId+'">')}catch(e){u=document.createElement("iframe"),u.name=n.iframeId}u.id=n.iframeId,n.form.appendChild(u),n.iframe=u}var n=this,r=t.util.query(this.socket.options.query,"t="+ +(new Date)+"&i="+this.index);if(!this.form){var i=document.createElement("form"),s=document.createElement("textarea"),o=this.iframeId="socketio_iframe_"+this.index,u;i.className="socketio",i.style.position="absolute",i.style.top="0px",i.style.left="0px",i.style.display="none",i.target=o,i.method="POST",i.setAttribute("accept-charset","utf-8"),s.name="d",i.appendChild(s),document.body.appendChild(i),this.form=i,this.area=s}this.form.action=this.prepareUrl()+r,f(),this.area.value=t.JSON.stringify(e);try{this.form.submit()}catch(l){}this.iframe.attachEvent?u.onreadystatechange=function(){n.iframe.readyState=="complete"&&a()}:this.iframe.onload=a,this.socket.setBuffer(!0)},i.prototype.get=function(){var e=this,n=document.createElement("script"),i=t.util.query(this.socket.options.query,"t="+ +(new Date)+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),n.async=!0,n.src=this.prepareUrl()+i,n.onerror=function(){e.onClose()};var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(n,s),this.script=n,r&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},i.prototype._=function(e){return this.onData(e),this.open&&this.get(),this},i.prototype.ready=function(e,n){var i=this;if(!r)return n.call(this);t.util.load(function(){n.call(i)})},i.check=function(){return"document"in n},i.xdomainCheck=function(){return!0},t.transports.push("jsonp-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);var Erizo=Erizo||{};Erizo.EventDispatcher=function(e){var t={};return e.dispatcher={},e.dispatcher.eventListeners={},t.addEventListener=function(t,n){e.dispatcher.eventListeners[t]===undefined&&(e.dispatcher.eventListeners[t]=[]),e.dispatcher.eventListeners[t].push(n)},t.removeEventListener=function(t,n){var r;r=e.dispatcher.eventListeners[t].indexOf(n),r!==-1&&e.dispatcher.eventListeners[t].splice(r,1)},t.dispatchEvent=function(t){var n;L.Logger.debug("Event: "+t.type);for(n in e.dispatcher.eventListeners[t.type])e.dispatcher.eventListeners[t.type].hasOwnProperty(n)&&e.dispatcher.eventListeners[t.type][n](t)},t},Erizo.LicodeEvent=function(e){var t={};return t.type=e.type,t},Erizo.RoomEvent=function(e){var t=Erizo.LicodeEvent(e);return t.streams=e.streams,t},Erizo.StreamEvent=function(e){var t=Erizo.LicodeEvent(e);return t.stream=e.stream,t.msg=e.msg,t},Erizo.PublisherEvent=function(e){var t=Erizo.LicodeEvent(e);return t};var Erizo=Erizo||{};Erizo.FcStack=function(e){var t={};return t.addStream=function(e){},t};var Erizo=Erizo||{};Erizo.BowserStack=function(e){var t={},n=webkitRTCPeerConnection;t.pc_config={iceServers:[]},t.con={optional:[{DtlsSrtpKeyAgreement:!0}]},e.stunServerUrl!==undefined&&t.pc_config.iceServers.push({url:e.stunServerUrl}),(e.turnServer||{}).url&&t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.password,url:e.turnServer.url}),e.audio===undefined&&(e.audio=!0),e.video===undefined&&(e.video=!0),t.mediaConstraints={offerToReceiveVideo:e.video,offerToReceiveAudio:e.audio},t.peerConnection=new n(t.pc_config,t.con),e.remoteDescriptionSet=!1;var r=function(t){if(e.maxVideoBW){var n=t.match(/m=video.*\r\n/);n==null&&(n=t.match(/m=video.*\n/));var r=n[0]+"b=AS:"+e.maxVideoBW+"\r\n";t=t.replace(n[0],r)}if(e.maxAudioBW){var n=t.match(/m=audio.*\r\n/);n==null&&(n=t.match(/m=audio.*\n/));var r=n[0]+"b=AS:"+e.maxAudioBW+"\r\n";t=t.replace(n[0],r)}return t};t.close=function(){t.state="closed",t.peerConnection.close()},e.localCandidates=[],t.peerConnection.onicecandidate=function(n){n.candidate?(n.candidate.candidate.match(/a=/)||(n.candidate.candidate="a="+n.candidate.candidate),e.remoteDescriptionSet?e.callback({type:"candidate",candidate:n.candidate}):e.localCandidates.push(n.candidate)):console.log("End of candidates.",t.peerConnection.localDescription)},t.peerConnection.onaddstream=function(e){t.onaddstream&&t.onaddstream(e)},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)};var i=function(e){console.log("Error in Stack ",e)},s,o=function(n){n.sdp=r(n.sdp),console.log("Set local description",n.sdp),s=n,t.peerConnection.setLocalDescription(s,function(){console.log("The final LocalDesc",t.peerConnection.localDescription),e.callback(t.peerConnection.localDescription)},i)},u=function(n){n.sdp=r(n.sdp),e.callback(n),s=n,t.peerConnection.setLocalDescription(n)};return t.createOffer=function(e){e===!0?t.peerConnection.createOffer(o,i,t.mediaConstraints):t.peerConnection.createOffer(o,i)},t.addStream=function(e){t.peerConnection.addStream(e)},e.remoteCandidates=[],t.processSignalingMessage=function(n){console.log("Process Signaling Message",n);if(n.type==="offer")n.sdp=r(n.sdp),t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)),t.peerConnection.createAnswer(u,null,t.mediaConstraints),e.remoteDescriptionSet=!0;else if(n.type==="answer")console.log("Set remote description",n.sdp),n.sdp=r(n.sdp),t.peerConnection.setRemoteDescription(new RTCSessionDescription(n),function(){e.remoteDescriptionSet=!0,console.log("Candidates to be added: ",e.remoteCandidates.length);while(e.remoteCandidates.length>0)console.log("Candidate :",e.remoteCandidates[e.remoteCandidates.length-1]),t.peerConnection.addIceCandidate(e.remoteCandidates.shift(),function(){},i);while(e.localCandidates.length>0)e.callback({type:"candidate",candidate:e.localCandidates.shift()})},function(){console.log("Error Setting Remote Description")});else if(n.type==="candidate"){console.log("Message with candidate");try{var s;typeof n.candidate=="object"?s=n.candidate:s=JSON.parse(n.candidate),s.candidate=s.candidate.replace(/a=/g,""),s.sdpMLineIndex=parseInt(s.sdpMLineIndex),s.sdpMLineIndex=s.sdpMid=="audio"?0:1;var o=new RTCIceCandidate(s);console.log("Remote Candidate",o),e.remoteDescriptionSet?t.peerConnection.addIceCandidate(o,function(){},i):e.remoteCandidates.push(o)}catch(a){L.Logger.error("Error parsing candidate",n.candidate)}}},t};var Erizo=Erizo||{};Erizo.FirefoxStack=function(e){var t={},n=mozRTCPeerConnection,r=mozRTCSessionDescription,i=mozRTCIceCandidate,s=!1;t.pc_config={iceServers:[]},e.stunServerUrl!==undefined&&t.pc_config.iceServers.push({url:e.stunServerUrl}),(e.turnServer||{}).url&&t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.password,url:e.turnServer.url}),e.audio===undefined&&(e.audio=!0),e.video===undefined&&(e.video=!0),t.mediaConstraints={offerToReceiveAudio:e.audio,offerToReceiveVideo:e.video,mozDontOfferDataChannel:!0},t.roapSessionId=103,t.peerConnection=new n(t.pc_config,t.con),e.localCandidates=[],t.peerConnection.onicecandidate=function(t){t.candidate?(t.candidate.candidate.match(/a=/)||(t.candidate.candidate="a="+t.candidate.candidate),e.remoteDescriptionSet?e.callback({type:"candidate",candidate:t.candidate}):(e.localCandidates.push(t.candidate),console.log("Local Candidates stored: ",e.localCandidates.length,e.localCandidates))):console.log("End of candidates.")},t.peerConnection.onaddstream=function(e){t.onaddstream&&t.onaddstream(e)},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)};var o=function(t){if(e.video&&e.maxVideoBW){var n=t.match(/m=video.*\r\n/);n==null&&(n=t.match(/m=video.*\n/));var r=n[0]+"b=AS:"+e.maxVideoBW+"\r\n";t=t.replace(n[0],r)}if(e.audio&&e.maxAudioBW){var n=t.match(/m=audio.*\r\n/);n==null&&(n=t.match(/m=audio.*\n/));var r=n[0]+"b=AS:"+e.maxAudioBW+"\r\n";t=t.replace(n[0],r)}return t},u,a=function(t){t.sdp=o(t.sdp),t.sdp=t.sdp.replace(/a=ice-options:google-ice\r\n/g,""),e.callback(t),u=t},f=function(n){n.sdp=o(n.sdp),n.sdp=n.sdp.replace(/a=ice-options:google-ice\r\n/g,""),e.callback(n),u=n,t.peerConnection.setLocalDescription(u)};return t.createOffer=function(){t.peerConnection.createOffer(a,function(e){L.Logger.error("Error",e)},t.mediaConstraints)},t.addStream=function(e){t.peerConnection.addStream(e)},e.remoteCandidates=[],e.remoteDescriptionSet=!1,t.close=function(){t.state="closed",t.peerConnection.close()},t.processSignalingMessage=function(n){if(n.type==="offer")n.sdp=o(n.sdp),t.peerConnection.setRemoteDescription(new r(n)),t.peerConnection.createAnswer(f,function(e){L.Logger.error("Error",e)},t.mediaConstraints),e.remoteDescriptionSet=!0;else if(n.type==="answer")console.log("Set remote and local description",n.sdp),n.sdp=o(n.sdp),t.peerConnection.setLocalDescription(u,function(){t.peerConnection.setRemoteDescription(new r(n),function(){e.remoteDescriptionSet=!0;while(e.remoteCandidates.length>0)t.peerConnection.addIceCandidate(e.remoteCandidates.shift());while(e.localCandidates.length>0)L.Logger.info("Sending Candidate"),e.callback({type:"candidate",candidate:e.localCandidates.shift()})})});else if(n.type==="candidate")try{var s;typeof n.candidate=="object"?s=n.candidate:s=JSON.parse(n.candidate),s.candidate=s.candidate.replace(/ generation 0/g,""),s.candidate=s.candidate.replace(/ udp /g," UDP "),s.sdpMLineIndex=parseInt(s.sdpMLineIndex);var a=new i(s);e.remoteDescriptionSet?t.peerConnection.addIceCandidate(a):e.remoteCandidates.push(a)}catch(l){L.Logger.error("Error parsing candidate",n.candidate,l)}},t};var Erizo=Erizo||{};Erizo.ChromeStableStack=function(e){var t={},n=webkitRTCPeerConnection;t.pc_config={iceServers:[]},t.con={optional:[{DtlsSrtpKeyAgreement:!0}]},e.stunServerUrl!==undefined&&t.pc_config.iceServers.push({url:e.stunServerUrl}),(e.turnServer||{}).url&&t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.password,url:e.turnServer.url}),e.audio===undefined&&(e.audio=!0),e.video===undefined&&(e.video=!0),t.mediaConstraints={mandatory:{OfferToReceiveVideo:e.video,OfferToReceiveAudio:e.audio}};var r=function(e){console.log("Error in Stack ",e)};t.peerConnection=new n(t.pc_config,t.con);var i=function(t){console.log("Removing REMB");var n=t.match(/a=rtcp-fb:100 goog-remb\r\n/);n===null&&(n=t.match(/a=rtcp-fb:100 goog-remb\n/)),n&&(t=t.replace(n[0],""));if(e.video&&e.maxVideoBW){var n=t.match(/m=video.*\r\n/);n==null&&(n=t.match(/m=video.*\n/));var r=n[0]+"b=AS:"+e.maxVideoBW+"\r\n";t=t.replace(n[0],r)}if(e.audio&&e.maxAudioBW){var n=t.match(/m=audio.*\r\n/);n==null&&(n=t.match(/m=audio.*\n/));var r=n[0]+"b=AS:"+e.maxAudioBW+"\r\n";t=t.replace(n[0],r)}return t};t.close=function(){t.state="closed",t.peerConnection.close()},e.localCandidates=[],t.peerConnection.onicecandidate=function(t){t.candidate?(t.candidate.candidate.match(/a=/)||(t.candidate.candidate="a="+t.candidate.candidate),e.remoteDescriptionSet?e.callback({type:"candidate",candidate:t.candidate}):(e.localCandidates.push(t.candidate),console.log("Local Candidates stored: ",e.localCandidates.length,e.localCandidates))):console.log("End of candidates.")},t.peerConnection.onaddstream=function(e){t.onaddstream&&t.onaddstream(e)},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)};var s,o=function(t){t.sdp=i(t.sdp),t.sdp=t.sdp.replace(/a=ice-options:google-ice\r\n/g,""),e.callback(t),s=t},u=function(n){n.sdp=i(n.sdp),n.sdp=n.sdp.replace(/a=ice-options:google-ice\r\n/g,""),e.callback(n),s=n,t.peerConnection.setLocalDescription(n)};return t.createOffer=function(e){e===!0?t.peerConnection.createOffer(o,r,t.mediaConstraints):t.peerConnection.createOffer(o,r)},t.addStream=function(e){t.peerConnection.addStream(e)},e.remoteCandidates=[],e.remoteDescriptionSet=!1,t.processSignalingMessage=function(n){if(n.type==="offer")n.sdp=i(n.sdp),t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)),t.peerConnection.createAnswer(u,null,t.mediaConstraints),e.remoteDescriptionSet=!0;else if(n.type==="answer")console.log("Set remote and local description",n.sdp),n.sdp=i(n.sdp),t.peerConnection.setLocalDescription(s,function(){t.peerConnection.setRemoteDescription(new RTCSessionDescription(n),function(){e.remoteDescriptionSet=!0,console.log("Candidates to be added: ",e.remoteCandidates.length,e.remoteCandidates);while(e.remoteCandidates.length>0)t.peerConnection.addIceCandidate(e.remoteCandidates.shift());console.log("Local candidates to send:",e.localCandidates.length);while(e.localCandidates.length>0)e.callback({type:"candidate",candidate:e.localCandidates.shift()})})});else if(n.type==="candidate")try{var r;typeof n.candidate=="object"?r=n.candidate:r=JSON.parse(n.candidate),r.candidate=r.candidate.replace(/a=/g,""),r.sdpMLineIndex=parseInt(r.sdpMLineIndex);var o=new RTCIceCandidate(r);e.remoteDescriptionSet?t.peerConnection.addIceCandidate(o):e.remoteCandidates.push(o)}catch(a){L.Logger.error("Error parsing candidate",n.candidate)}},t};var Erizo=Erizo||{};Erizo.ChromeCanaryStack=function(e){var t={},n=webkitRTCPeerConnection;t.pc_config={iceServers:[]},t.con={optional:[{DtlsSrtpKeyAgreement:!0}]},e.stunServerUrl!==undefined&&t.pc_config.iceServers.push({url:e.stunServerUrl}),(e.turnServer||{}).url&&t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.password,url:e.turnServer.url});if(e.audio===undefined||e.nop2p)e.audio=!0;if(e.video===undefined||e.nop2p)e.video=!0;t.mediaConstraints={mandatory:{OfferToReceiveVideo:e.video,OfferToReceiveAudio:e.audio}},t.roapSessionId=103,t.peerConnection=new n(t.pc_config,t.con),t.peerConnection.onicecandidate=function(n){L.Logger.debug("PeerConnection: ",e.session_id),n.candidate?t.iceCandidateCount+=1:(L.Logger.debug("State: "+t.peerConnection.iceGatheringState),t.ices===undefined&&(t.ices=0),t.ices=t.ices+1,t.ices>=1&&t.moreIceComing&&(t.moreIceComing=!1,t.markActionNeeded()))};var r=function(t){if(e.maxVideoBW){var n=t.match(/m=video.*\r\n/),r=n[0]+"b=AS:"+e.maxVideoBW+"\r\n";t=t.replace(n[0],r)}if(e.maxAudioBW){var n=t.match(/m=audio.*\r\n/),r=n[0]+"b=AS:"+e.maxAudioBW+"\r\n";t=t.replace(n[0],r)}return t};return t.processSignalingMessage=function(e){L.Logger.debug("Activity on conn "+t.sessionId);var n=JSON.parse(e),i,s,o;t.incomingMessage=n,t.state==="new"?n.messageType==="OFFER"?(i={sdp:n.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(i)),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+n.messageType+" in state "+t.state):t.state==="offer-sent"?n.messageType==="ANSWER"?(i={sdp:n.sdp,type:"answer"},L.Logger.debug("Received ANSWER: ",i.sdp),i.sdp=r(i.sdp),t.peerConnection.setRemoteDescription(new RTCSessionDescription(i)),t.sendOK(),t.state="established"):n.messageType==="pr-answer"?(i={sdp:n.sdp,type:"pr-answer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(i))):n.messageType==="offer"?t.error("Not written yet"):t.error("Illegal message for this state: "+n.messageType+" in state "+t.state):t.state==="established"&&(n.messageType==="OFFER"?(i={sdp:n.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(i)),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+n.messageType+" in state "+t.state))},t.addStream=function(e){t.peerConnection.addStream(e),t.markActionNeeded()},t.removeStream=function(e){t.markActionNeeded()},t.close=function(){t.state="closed",t.peerConnection.close()},t.markActionNeeded=function(){t.actionNeeded=!0,t.doLater(function(){t.onstablestate()})},t.doLater=function(e){window.setTimeout(e,1)},t.onstablestate=function(){var e,n={};if(t.actionNeeded){if(t.state==="new"||t.state==="established")t.peerConnection.createOffer(function(e){e.sdp=r(e.sdp),L.Logger.debug("Changed",e.sdp);var n=e.sdp;if(n!==t.prevOffer){t.peerConnection.setLocalDescription(e),t.state="preparing-offer",t.markActionNeeded();return}L.Logger.debug("Not sending a new offer")},null,t.mediaConstraints);else if(t.state==="preparing-offer"){if(t.moreIceComing)return;t.prevOffer=t.peerConnection.localDescription.sdp,L.Logger.debug("Sending OFFER: "+t.prevOffer),t.sendMessage("OFFER",t.prevOffer),t.state="offer-sent"}else if(t.state==="offer-received")t.peerConnection.createAnswer(function(e){t.peerConnection.setLocalDescription(e),t.state="offer-received-preparing-answer";if(!!t.iceStarted){t.markActionNeeded();return}var n=new Date;L.Logger.debug(n.getTime()+": Starting ICE in responder"),t.iceStarted=!0},null,t.mediaConstraints);else if(t.state==="offer-received-preparing-answer"){if(t.moreIceComing)return;e=t.peerConnection.localDescription.sdp,t.sendMessage("ANSWER",e),t.state="established"}else t.error("Dazed and confused in state "+t.state+", stopping here");t.actionNeeded=!1}},t.sendOK=function(){t.sendMessage("OK")},t.sendMessage=function(e,n){var r={};r.messageType=e,r.sdp=n,e==="OFFER"?(r.offererSessionId=t.sessionId,r.answererSessionId=t.otherSessionId,r.seq=t.sequenceNumber+=1,r.tiebreaker=Math.floor(Math.random()*429496723+1)):(r.offererSessionId=t.incomingMessage.offererSessionId,r.answererSessionId=t.sessionId,r.seq=t.incomingMessage.seq),t.onsignalingmessage(JSON.stringify(r))},t.error=function(e){throw"Error in RoapOnJsep: "+e},t.sessionId=t.roapSessionId+=1,t.sequenceNumber=0,t.actionNeeded=!1,t.iceStarted=!1,t.moreIceComing=!0,t.iceCandidateCount=0,t.onsignalingmessage=e.callback,t.peerConnection.onopen=function(){t.onopen&&t.onopen()},t.peerConnection.onaddstream=function(e){t.onaddstream&&t.onaddstream(e)},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)},t.peerConnection.oniceconnectionstatechange=function(e){t.oniceconnectionstatechange&&t.oniceconnectionstatechange(e.currentTarget.iceConnectionState)},t.onaddstream=null,t.onremovestream=null,t.state="new",t.markActionNeeded(),t};var Erizo=Erizo||{};Erizo.sessionId=103,Erizo.Connection=function(e){var t={};e.session_id=Erizo.sessionId+=1,t.browser=Erizo.getBrowser();if(typeof module!="undefined"&&module.exports)L.Logger.error("Publish/subscribe video/audio streams not supported in erizofc yet"),t=Erizo.FcStack(e);else if(t.browser==="mozilla")L.Logger.debug("Firefox Stack"),t=Erizo.FirefoxStack(e);else if(t.browser==="bowser")L.Logger.debug("Bowser Stack"),t=Erizo.BowserStack(e);else{if(t.browser!=="chrome-stable")throw L.Logger.debug("None!"),"WebRTC stack not available";L.Logger.debug("Stable!"),t=Erizo.ChromeStableStack(e)}return t},Erizo.getBrowser=function(){var e="none";return window.navigator.userAgent.match("Firefox")!==null?e="mozilla":window.navigator.userAgent.match("Bowser")!==null?e="bowser":window.navigator.userAgent.match("Chrome")!==null?window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]>=26&&(e="chrome-stable"):window.navigator.userAgent.match("Safari")!==null?e="bowser":window.navigator.userAgent.match("AppleWebKit")!==null&&(e="bowser"),e},Erizo.GetUserMedia=function(e,t,n){navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;if(e.screen){L.Logger.debug("Screen access requested");if(!window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]>=34){n({code:"This browser does not support screen sharing"});return}var r="okeephmleflklcdebijnponpabbmmgeo";e.extensionId&&(L.Logger.debug("extensionId supplied, using "+e.extensionId),r=e.extensionId),L.Logger.debug("Screen access on chrome stable, looking for extension");try{chrome.runtime.sendMessage(r,{getStream:!0},function(r){if(r==undefined){L.Logger.debug("Access to screen denied");var i={code:"Access to screen denied"};n(i);return}var s=r.streamId;e={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s}}},navigator.getMedia(e,t,n)})}catch(i){L.Logger.debug("Lynckia screensharing plugin is not accessible ");var s={code:"no_plugin_present"};n(s);return}}else typeof module!="undefined"&&module.exports?L.Logger.error("Video/audio streams not supported in erizofc yet"):navigator.getMedia(e,t,n)};var Erizo=Erizo||{};Erizo.Stream=function(e){var t=Erizo.EventDispatcher(e),n;t.stream=e.stream,t.url=e.url,t.recording=e.recording,t.room=undefined,t.showing=!1,t.local=!1,t.video=e.video,t.audio=e.audio,t.screen=e.screen,t.videoSize=e.videoSize,t.videoOptions=e.videoOptions||{mandatory:{},optional:{}},t.extensionId=e.extensionId;if(t.videoSize===undefined||t.videoSize instanceof Array&&t.videoSize.length==4){if(e.local===undefined||e.local===!0)t.local=!0;return t.getID=function(){return e.streamID},t.getAttributes=function(){return e.attributes},t.setAttributes=function(e){L.Logger.error("Failed to set attributes data. This Stream object has not been published.")},t.updateLocalAttributes=function(t){e.attributes=t},t.hasAudio=function(){return e.audio},t.hasVideo=function(){return e.video},t.hasData=function(){return e.data},t.hasScreen=function(){return e.screen},t.sendData=function(e){L.Logger.error("Failed to send data. This Stream object has not that channel enabled.")},t.init=function(){try{if((e.audio||e.video||e.screen)&&e.url===undefined){L.Logger.debug("Requested access to local media"),e.video==1&&t.videoSize!==undefined&&(t.videoOptions.mandatory.minWidth=t.videoSize[0],t.videoOptions.mandatory.minHeight=t.videoSize[1],t.videoOptions.mandatory.maxWidth=t.videoSize[2],t.videoOptions.mandatory.maxHeight=t.videoSize[3]);var n={video:t.videoOptions,audio:e.audio,fake:e.fake,screen:e.screen,extensionId:t.extensionId};L.Logger.debug(n),Erizo.GetUserMedia(n,function(e){L.Logger.info("User has granted access to local media."),t.stream=e;var n=Erizo.StreamEvent({type:"access-accepted"});t.dispatchEvent(n)},function(e){L.Logger.error("Failed to get access to local media. Error code was "+e.code+".");var n=Erizo.StreamEvent({type:"access-denied"});t.dispatchEvent(n)})}else{var r=Erizo.StreamEvent({type:"access-accepted"});t.dispatchEvent(r)}}catch(i){L.Logger.error("Error accessing to local media",i)}},t.close=function(){t.local&&(t.room!==undefined&&t.room.unpublish(t),t.hide(),t.stream!==undefined&&t.stream.stop(),t.stream=undefined)},t.play=function(e,n){n=n||{},t.elementID=e;if(t.hasVideo()||this.hasScreen()){if(e!==undefined){var r=new Erizo.VideoPlayer({id:t.getID(),stream:t,elementID:e,options:n});t.player=r,t.showing=!0}}else if(t.hasAudio){var r=new Erizo.AudioPlayer({id:t.getID(),stream:t,elementID:e,options:n});t.player=r,t.showing=!0}},t.stop=function(){t.showing&&t.player!==undefined&&(t.player.destroy(),t.showing=!1)},t.show=t.play,t.hide=t.stop,n=function(){if(t.player!==undefined&&t.stream!==undefined){var e=t.player.video,n=document.defaultView.getComputedStyle(e),r=parseInt(n.getPropertyValue("width"),10),i=parseInt(n.getPropertyValue("height"),10),s=parseInt(n.getPropertyValue("left"),10),o=parseInt(n.getPropertyValue("top"),10),u=document.getElementById(t.elementID),a=document.defaultView.getComputedStyle(u),f=parseInt(a.getPropertyValue("width"),10),l=parseInt(a.getPropertyValue("height"),10),c=document.createElement("canvas"),h;return c.id="testing",c.width=f,c.height=l,c.setAttribute("style","display: none"),h=c.getContext("2d"),h.drawImage(e,s,o,r,i),c}return null},t.getVideoFrameURL=function(e){var t=n();return t!==null?e?t.toDataURL(e):t.toDataURL():null},t.getVideoFrame=function(){var e=n();return e!==null?e.getContext("2d").getImageData(0,0,e.width,e.height):null},t}throw Error("Invalid Video Size")};var Erizo=Erizo||{};Erizo.Room=function(e){var t=Erizo.EventDispatcher(e),n,r,i,s,o,u,a=0,f=1,l=2;return t.remoteStreams={},t.localStreams={},t.roomID="",t.socket={},t.state=a,t.p2p=!1,t.addEventListener("room-disconnected",function(e){var n,r,i;t.state=a;for(n in t.remoteStreams)t.remoteStreams.hasOwnProperty(n)&&(r=t.remoteStreams[n],u(r),delete 
t.remoteStreams[n],i=Erizo.StreamEvent({type:"stream-removed",stream:r}),t.dispatchEvent(i));t.remoteStreams={};for(n in t.localStreams)t.localStreams.hasOwnProperty(n)&&(r=t.localStreams[n],r.pc.close(),delete t.localStreams[n]);try{t.socket.disconnect()}catch(s){L.Logger.debug("Socket already disconnected")}t.socket=undefined}),u=function(e){e.stream!==undefined&&(e.hide(),e.pc&&e.pc.close(),e.local&&e.stream.stop())},s=function(e,t){e.local?r("sendDataStream",{id:e.getID(),msg:t}):L.Logger.error("You can not send data through a remote stream")},o=function(e,t){e.local?(e.updateLocalAttributes(t),r("updateStreamAttributes",{id:e.getID(),attrs:t})):L.Logger.error("You can not update attributes in a remote stream")},n=function(n,s,o){console.log(n),t.socket=io.connect(n.host,{reconnect:!1,secure:n.secure,"force new connection":!0}),t.socket.on("onAddStream",function(e){var n=Erizo.Stream({streamID:e.id,local:!1,audio:e.audio,video:e.video,data:e.data,screen:e.screen,attributes:e.attributes}),r;t.remoteStreams[e.id]=n,r=Erizo.StreamEvent({type:"stream-added",stream:n}),t.dispatchEvent(r)}),t.socket.on("signaling_message_erizo",function(e){var n;e.peerId?n=t.remoteStreams[e.peerId]:n=t.localStreams[e.streamId],n&&n.pc.processSignalingMessage(e.mess)}),t.socket.on("signaling_message_peer",function(e){var n=t.localStreams[e.streamId];n?n.pc[e.peerSocket].processSignalingMessage(e.msg):(n=t.remoteStreams[e.streamId],n.pc||f(n,e.peerSocket),n.pc.processSignalingMessage(e.msg))}),t.socket.on("publish_me",function(e){var n=t.localStreams[e.streamId];n.pc===undefined&&(n.pc={}),n.pc[e.peerSocket]=Erizo.Connection({callback:function(t){i("signaling_message",{streamId:e.streamId,peerSocket:e.peerSocket,msg:t})},audio:n.hasAudio(),video:n.hasVideo(),stunServerUrl:t.stunServerUrl,turnServer:t.turnServer}),n.pc[e.peerSocket].oniceconnectionstatechange=function(t){t==="disconnected"&&(n.pc[e.peerSocket].close(),delete n.pc[e.peerSocket])},n.pc[e.peerSocket].addStream(n.stream),n.pc[e.peerSocket].createOffer()});var f=function(n,r){n.pc=Erizo.Connection({callback:function(e){i("signaling_message",{streamId:n.getID(),peerSocket:r,msg:e})},stunServerUrl:t.stunServerUrl,turnServer:t.turnServer,maxAudioBW:e.maxAudioBW,maxVideoBW:e.maxVideoBW}),n.pc.onaddstream=function(e){L.Logger.info("Stream subscribed"),n.stream=e.stream;var r=Erizo.StreamEvent({type:"stream-subscribed",stream:n});t.dispatchEvent(r)}};t.socket.on("onDataStream",function(e){var n=t.remoteStreams[e.id],r=Erizo.StreamEvent({type:"stream-data",msg:e.msg,stream:n});n.dispatchEvent(r)}),t.socket.on("onUpdateAttributeStream",function(e){var n=t.remoteStreams[e.id],r=Erizo.StreamEvent({type:"stream-attributes-update",attrs:e.attrs,stream:n});n.updateLocalAttributes(e.attrs),n.dispatchEvent(r)}),t.socket.on("onRemoveStream",function(e){var n=t.remoteStreams[e.id],r;delete t.remoteStreams[e.id],u(n),r=Erizo.StreamEvent({type:"stream-removed",stream:n}),t.dispatchEvent(r)}),t.socket.on("disconnect",function(e){L.Logger.info("Socket disconnected");if(t.state!==a){var n=Erizo.RoomEvent({type:"room-disconnected"});t.dispatchEvent(n)}}),t.socket.on("connection_failed",function(e){L.Logger.info("ICE Connection Failed");if(t.state!==a){var n=Erizo.RoomEvent({type:"stream-failed"});t.dispatchEvent(n)}}),r("token",n,s,o)},r=function(e,n,r,i){t.socket.emit(e,n,function(e,t){e==="success"?r!==undefined&&r(t):e==="error"?i!==undefined&&i(t):r!==undefined&&r(e,t)})},i=function(e,n,r,i){t.socket.emit(e,n,r,function(e,t){i!==undefined&&i(e,t)})},t.connect=function(){var r=[],i=L.Base64.decodeBase64(e.token);t.state!==a&&L.Logger.error("Room already connected"),t.state=f,n(JSON.parse(i),function(n){var r=0,i,s=[],o,u,a,f;o=n.streams||[],t.p2p=n.p2p,u=n.id,t.stunServerUrl=n.stunServerUrl,t.turnServer=n.turnServer,t.state=l,e.defaultVideoBW=n.defaultVideoBW,e.maxVideoBW=n.maxVideoBW;for(r in o)o.hasOwnProperty(r)&&(a=o[r],i=Erizo.Stream({streamID:a.id,local:!1,audio:a.audio,video:a.video,data:a.data,screen:a.screen,attributes:a.attributes}),s.push(i),t.remoteStreams[a.id]=i);t.roomID=u,L.Logger.info("Connected to room "+t.roomID),f=Erizo.RoomEvent({type:"room-connected",streams:s}),t.dispatchEvent(f)},function(e){L.Logger.error("Not Connected! Error: "+e)})},t.disconnect=function(){var e=Erizo.RoomEvent({type:"room-disconnected"});t.dispatchEvent(e)},t.publish=function(n,r,u){r=r||{};var a;r.maxVideoBW=r.maxVideoBW||e.defaultVideoBW,r.maxVideoBW>e.maxVideoBW&&(r.maxVideoBW=e.maxVideoBW);if(n.local&&t.localStreams[n.getID()]===undefined)if(n.hasAudio()||n.hasVideo()||n.hasScreen())if(n.url!==undefined||n.recording!==undefined){var f,l;n.url?(f="url",l=n.url):(f="recording",l=n.recording),i("publish",{state:f,data:n.hasData(),audio:n.hasAudio(),video:n.hasVideo(),attributes:n.getAttributes()},l,function(e,r){e!==null?(L.Logger.info("Stream published"),n.getID=function(){return e},n.sendData=function(e){s(n,e)},n.setAttributes=function(e){o(n,e)},t.localStreams[e]=n,n.room=t,u&&u(e)):(L.Logger.error("Error when publishing the stream",r),u&&u(undefined,r))})}else t.p2p?(e.maxAudioBW=r.maxAudioBW,e.maxVideoBW=r.maxVideoBW,i("publish",{state:"p2p",data:n.hasData(),audio:n.hasAudio(),video:n.hasVideo(),screen:n.hasScreen(),attributes:n.getAttributes()},undefined,function(e,r){e===null&&(L.Logger.error("Error when publishing the stream",r),u&&u(undefined,r)),L.Logger.info("Stream published"),n.getID=function(){return e},n.hasData()&&(n.sendData=function(e){s(n,e)}),n.setAttributes=function(e){o(n,e)},t.localStreams[e]=n,n.room=t})):i("publish",{state:"erizo",data:n.hasData(),audio:n.hasAudio(),video:n.hasVideo(),screen:n.hasScreen(),attributes:n.getAttributes()},undefined,function(e,o){if(e===null){L.Logger.error("Error when publishing the stream: ",o),u&&u(undefined,o);return}L.Logger.info("Stream published"),n.getID=function(){return e},n.hasData()&&(n.sendData=function(e){s(n,e)}),t.localStreams[e]=n,n.room=t,n.pc=Erizo.Connection({callback:function(e){console.log("Sending message",e),i("signaling_message",{streamId:n.getID(),msg:e},undefined,function(){})},stunServerUrl:t.stunServerUrl,turnServer:t.turnServer,maxAudioBW:r.maxAudioBW,maxVideoBW:r.maxVideoBW,audio:n.hasAudio(),video:n.hasVideo()}),n.pc.addStream(n.stream),n.pc.createOffer(),u&&u(e)});else n.hasData()&&i("publish",{state:"data",data:n.hasData(),audio:!1,video:!1,screen:!1,attributes:n.getAttributes()},undefined,function(e,r){if(e===null){L.Logger.error("Error publishing stream ",r),u&&u(undefined,r);return}L.Logger.info("Stream published"),n.getID=function(){return e},n.sendData=function(e){s(n,e)},n.setAttributes=function(e){o(n,e)},t.localStreams[e]=n,n.room=t,u&&u(e)})},t.startRecording=function(e,t){L.Logger.debug("Start Recording streamaa: "+e.getID()),r("startRecorder",{to:e.getID()},function(e,n){if(e===null){L.Logger.error("Error on start recording",n),t&&t(undefined,n);return}L.Logger.info("Start recording",e),t&&t(e)})},t.stopRecording=function(e,t){r("stopRecorder",{id:e},function(e,n){if(e===null){L.Logger.error("Error on stop recording",n),t&&t(undefined,n);return}L.Logger.info("Stop recording"),t&&t(!0)})},t.unpublish=function(e,n){if(e.local){r("unpublish",e.getID(),function(e,t){if(e===null){L.Logger.error("Error unpublishing stream",t),n&&n(undefined,t);return}L.Logger.info("Stream unpublished"),n&&n(!0)});var i=e.room.p2p;e.room=undefined,(e.hasAudio()||e.hasVideo()||e.hasScreen())&&e.url===undefined&&!i&&(e.pc.close(),e.pc=undefined),delete t.localStreams[e.getID()],e.getID=function(){},e.sendData=function(e){},e.setAttributes=function(e){}}},t.subscribe=function(e,n,r){n=n||{};if(!e.local){if(e.hasVideo()||e.hasAudio()||e.hasScreen())t.p2p?(i("subscribe",{streamId:e.getID()}),r&&r(!0)):i("subscribe",{streamId:e.getID(),audio:n.audio,video:n.video,data:n.data,browser:Erizo.getBrowser()},undefined,function(n,s){if(n===null){L.Logger.error("Error subscribing to stream ",s),r&&r(undefined,s);return}L.Logger.info("Subscriber added"),e.pc=Erizo.Connection({callback:function(t){L.Logger.info("Sending message",t),i("signaling_message",{streamId:e.getID(),msg:t,browser:e.pc.browser},undefined,function(){})},nop2p:!0,audio:e.hasAudio(),video:e.hasVideo(),stunServerUrl:t.stunServerUrl,turnServer:t.turnServer}),e.pc.onaddstream=function(n){L.Logger.info("Stream subscribed"),e.stream=n.stream;var r=Erizo.StreamEvent({type:"stream-subscribed",stream:e});t.dispatchEvent(r)},e.pc.createOffer(!0),r&&r(!0)});else{if(!e.hasData()||n.data===!1){L.Logger.info("Subscribing to anything");return}i("subscribe",{streamId:e.getID(),data:n.data},undefined,function(n,i){if(n===null){L.Logger.error("Error subscribing to stream ",i),r&&r(undefined,i);return}L.Logger.info("Stream subscribed");var s=Erizo.StreamEvent({type:"stream-subscribed",stream:e});t.dispatchEvent(s),r&&r(!0)})}L.Logger.info("Subscribing to: "+e.getID())}},t.unsubscribe=function(e,n){t.socket!==undefined&&(e.local||r("unsubscribe",e.getID(),function(t,r){if(t===null){n&&n(undefined,r);return}u(e),n&&n(!0)},function(){L.Logger.error("Error calling unsubscribe.")}))},t.getStreamsByAttribute=function(e,n){var r=[],i,s;for(i in t.remoteStreams)t.remoteStreams.hasOwnProperty(i)&&(s=t.remoteStreams[i],s.getAttributes()!==undefined&&s.getAttributes()[e]!==undefined&&s.getAttributes()[e]===n&&r.push(s));return r},t};var L=L||{};L.Logger=function(e){var t=0,n=1,r=2,i=3,s=4,o=5,u=t,a,f,l,c,h,p,d,v;return a=function(){e.Logger.panel=document.createElement("textarea"),e.Logger.panel.setAttribute("id","licode-logs"),e.Logger.panel.setAttribute("style","width: 100%; height: 100%; display: none"),e.Logger.panel.setAttribute("rows",20),e.Logger.panel.setAttribute("cols",20),e.Logger.panel.setAttribute("readOnly",!0),document.body.appendChild(e.Logger.panel)},f=function(t){t>e.Logger.NONE?t=e.Logger.NONE:t<e.Logger.DEBUG&&(t=e.Logger.DEBUG),e.Logger.logLevel=t},l=function(t){var n="";if(t<e.Logger.logLevel)return;t===e.Logger.DEBUG?n+="DEBUG":t===e.Logger.TRACE?n+="TRACE":t===e.Logger.INFO?n+="INFO":t===e.Logger.WARNING?n+="WARNING":t===e.Logger.ERROR&&(n+="ERROR"),n+=": ";var r=[];for(var i=0;i<arguments.length;i++)r[i]=arguments[i];var s=r.slice(1),r=[n].concat(s);if(e.Logger.panel!==undefined){var o="";for(var u=0;u<r.length;u++)o+=r[u];e.Logger.panel.value=e.Logger.panel.value+"\n"+o}else console.log.apply(console,r)},c=function(){var t=[];for(var n=0;n<arguments.length;n++)t[n]=arguments[n];e.Logger.log.apply(e.Logger,[e.Logger.DEBUG].concat(t))},h=function(){var t=[];for(var n=0;n<arguments.length;n++)t[n]=arguments[n];e.Logger.log.apply(e.Logger,[e.Logger.TRACE].concat(t))},p=function(){var t=[];for(var n=0;n<arguments.length;n++)t[n]=arguments[n];e.Logger.log.apply(e.Logger,[e.Logger.INFO].concat(t))},d=function(){var t=[];for(var n=0;n<arguments.length;n++)t[n]=arguments[n];e.Logger.log.apply(e.Logger,[e.Logger.WARNING].concat(t))},v=function(){var t=[];for(var n=0;n<arguments.length;n++)t[n]=arguments[n];e.Logger.log.apply(e.Logger,[e.Logger.ERROR].concat(t))},{DEBUG:t,TRACE:n,INFO:r,WARNING:i,ERROR:s,NONE:o,enableLogPanel:a,setLogLevel:f,log:l,debug:c,trace:h,info:p,warning:d,error:v}}(L);var L=L||{};L.Base64=function(e){var t,n,r,i,s,o,u,a,f,l,c,h;t=-1,n=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],r=[];for(o=0;o<n.length;o+=1)r[n[o]]=o;return u=function(e){i=e,s=0},a=function(){var e;return i?s>=i.length?t:(e=i.charCodeAt(s)&255,s+=1,e):t},f=function(e){var r,i,s,o;u(e),r="",i=new Array(3),s=0,o=!1;while(!o&&(i[0]=a())!==t)i[1]=a(),i[2]=a(),r+=n[i[0]>>2],i[1]!==t?(r+=n[i[0]<<4&48|i[1]>>4],i[2]!==t?(r+=n[i[1]<<2&60|i[2]>>6],r+=n[i[2]&63]):(r+=n[i[1]<<2&60],r+="=",o=!0)):(r+=n[i[0]<<4&48],r+="=",r+="=",o=!0),s+=4,s>=76&&(r+="\n",s=0);return r},l=function(){if(!i)return t;for(;;){if(s>=i.length)return t;var e=i.charAt(s);s+=1;if(r[e])return r[e];if(e==="A")return 0}},c=function(e){return e=e.toString(16),e.length===1&&(e="0"+e),e="%"+e,unescape(e)},h=function(e){var n,r,i;u(e),n="",r=new Array(4),i=!1;while(!i&&(r[0]=l())!==t&&(r[1]=l())!==t)r[2]=l(),r[3]=l(),n+=c(r[0]<<2&255|r[1]>>4),r[2]!==t?(n+=c(r[1]<<4&255|r[2]>>2),r[3]!==t?n+=c(r[2]<<6&255|r[3]):i=!0):i=!0;return n},{encodeBase64:f,decodeBase64:h}}(L),function(){function e(){(new L.ElementQueries).init()}this.L=this.L||{},this.L.ElementQueries=function(){function e(e){e||(e=document.documentElement);var t=getComputedStyle(e,"fontSize");return parseFloat(t)||16}function t(t,n){var r=n.replace(/[0-9]*/,"");n=parseFloat(n);switch(r){case"px":return n;case"em":return n*e(t);case"rem":return n*e();case"vw":return n*document.documentElement.clientWidth/100;case"vh":return n*document.documentElement.clientHeight/100;case"vmin":case"vmax":var i=document.documentElement.clientWidth/100,s=document.documentElement.clientHeight/100,o=Math[r==="vmin"?"min":"max"];return n*o(i,s);default:return n}}function n(e){this.element=e,this.options=[];var n,r,i,s=0,o=0,u,a,f,l,c;this.addOption=function(e){this.options.push(e)};var h=["min-width","min-height","max-width","max-height"];this.call=function(){s=this.element.offsetWidth,o=this.element.offsetHeight,f={};for(n=0,r=this.options.length;n<r;n++)i=this.options[n],u=t(this.element,i.value),a=i.property=="width"?s:o,c=i.mode+"-"+i.property,l="",i.mode=="min"&&a>=u&&(l+=i.value),i.mode=="max"&&a<=u&&(l+=i.value),f[c]||(f[c]=""),l&&-1===(" "+f[c]+" ").indexOf(" "+l+" ")&&(f[c]+=" "+l);for(var e in h)f[h[e]]?this.element.setAttribute(h[e],f[h[e]].substr(1)):this.element.removeAttribute(h[e])}}function r(e,t){e.elementQueriesSetupInformation?e.elementQueriesSetupInformation.addOption(t):(e.elementQueriesSetupInformation=new n(e),e.elementQueriesSetupInformation.addOption(t),new ResizeSensor(e,function(){e.elementQueriesSetupInformation.call()})),e.elementQueriesSetupInformation.call()}function i(e,t,n,i){var s;document.querySelectorAll&&(s=document.querySelectorAll.bind(document)),!s&&"undefined"!=typeof $$&&(s=$$),!s&&"undefined"!=typeof jQuery&&(s=jQuery);if(!s)throw"No document.querySelectorAll, jQuery or Mootools's $$ found.";var o=s(e);for(var u=0,a=o.length;u<a;u++)r(o[u],{mode:t,property:n,value:i})}function o(e){var t;e=e.replace(/'/g,'"');while(null!==(t=s.exec(e)))5<t.length&&i(t[1]||t[5],t[2],t[3],t[4])}function u(e){var t="";if(!e)return;if("string"==typeof e)e=e.toLowerCase(),(-1!==e.indexOf("min-width")||-1!==e.indexOf("max-width"))&&o(e);else for(var n=0,r=e.length;n<r;n++)1===e[n].type?(t=e[n].selectorText||e[n].cssText,-1!==t.indexOf("min-height")||-1!==t.indexOf("max-height")?o(t):(-1!==t.indexOf("min-width")||-1!==t.indexOf("max-width"))&&o(t)):4===e[n].type&&u(e[n].cssRules||e[n].rules)}var s=/,?([^,\n]*)\[[\s\t]*(min|max)-(width|height)[\s\t]*[~$\^]?=[\s\t]*"([^"]*)"[\s\t]*]([^\n\s\{]*)/mgi;this.init=function(){for(var e=0,t=document.styleSheets.length;e<t;e++)u(document.styleSheets[e].cssText||document.styleSheets[e].cssRules||document.styleSheets[e].rules)}},window.addEventListener?window.addEventListener("load",e,!1):window.attachEvent("onload",e),this.L.ResizeSensor=function(e,t){function n(e,t){window.OverflowEvent?e.addEventListener("overflowchanged",function(e){t.call(this,e)}):(e.addEventListener("overflow",function(e){t.call(this,e)}),e.addEventListener("underflow",function(e){t.call(this,e)}))}function r(){this.q=[],this.add=function(e){this.q.push(e)};var e,t;this.call=function(){for(e=0,t=this.q.length;e<t;e++)this.q[e].call()}}function i(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):e.style[t]}function s(e,t){function c(){var t=!1,n=e.resizeSensor.offsetWidth,r=e.resizeSensor.offsetHeight;return u!=n&&(f.width=n-1+"px",l.width=n+1+"px",t=!0,u=n),a!=r&&(f.height=r-1+"px",l.height=r+1+"px",t=!0,a=r),t}if(!e.resizedAttached)e.resizedAttached=new r,e.resizedAttached.add(t);else if(e.resizedAttached){e.resizedAttached.add(t);return}var s=function(){c()&&e.resizedAttached.call()};e.resizeSensor=document.createElement("div"),e.resizeSensor.className="resize-sensor";var o="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1;";e.resizeSensor.style.cssText=o,e.resizeSensor.innerHTML='<div class="resize-sensor-overflow" style="'+o+'">'+"<div></div>"+"</div>"+'<div class="resize-sensor-underflow" style="'+o+'">'+"<div></div>"+"</div>",e.appendChild(e.resizeSensor),"absolute"!==i(e,"position")&&(e.style.position="relative");var u=-1,a=-1,f=e.resizeSensor.firstElementChild.firstChild.style,l=e.resizeSensor.lastElementChild.firstChild.style;c(),n(e.resizeSensor,s),n(e.resizeSensor.firstElementChild,s),n(e.resizeSensor.lastElementChild,s)}if("array"==typeof e||"undefined"!=typeof jQuery&&e instanceof jQuery||"undefined"!=typeof Elements&&e instanceof Elements){var o=0,u=e.length;for(;o<u;o++)s(e[o],t)}else s(e,t)}}();var Erizo=Erizo||{};Erizo.View=function(e){var t=Erizo.EventDispatcher({});return t.url="http://chotis2.dit.upm.es:3000",t};var Erizo=Erizo||{};Erizo.VideoPlayer=function(e){var t=Erizo.View({}),n,r;t.id=e.id,t.stream=e.stream.stream,t.elementID=e.elementID,n=function(e){t.bar.display()},r=function(e){t.bar.hide()},t.destroy=function(){t.video.pause(),delete t.resizer,t.parentNode.removeChild(t.div)},t.resize=function(){var n=t.container.offsetWidth,r=t.container.offsetHeight;if(e.stream.screen||e.options.crop===!1)n*.75<r?(t.video.style.width=n+"px",t.video.style.height=.75*n+"px",t.video.style.top=-(.75*n/2-r/2)+"px",t.video.style.left="0px"):(t.video.style.height=r+"px",t.video.style.width=4/3*r+"px",t.video.style.left=-(4/3*r/2-n/2)+"px",t.video.style.top="0px");else if(n!==t.containerWidth||r!==t.containerHeight)n*.75>r?(t.video.style.width=n+"px",t.video.style.height=.75*n+"px",t.video.style.top=-(.75*n/2-r/2)+"px",t.video.style.left="0px"):(t.video.style.height=r+"px",t.video.style.width=4/3*r+"px",t.video.style.left=-(4/3*r/2-n/2)+"px",t.video.style.top="0px");t.containerWidth=n,t.containerHeight=r},L.Logger.debug("Creating URL from stream "+t.stream);var i=window.URL||webkitURL;return t.stream_url=i.createObjectURL(t.stream),t.div=document.createElement("div"),t.div.setAttribute("id","player_"+t.id),t.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"),t.loader=document.createElement("img"),t.loader.setAttribute("style","width: 16px; height: 16px; position: absolute; top: 50%; left: 50%; margin-top: -8px; margin-left: -8px"),t.loader.setAttribute("id","back_"+t.id),t.loader.setAttribute("src",t.url+"/assets/loader.gif"),t.video=document.createElement("video"),t.video.setAttribute("id","stream"+t.id),t.video.setAttribute("style","width: 100%; height: 100%; position: absolute"),t.video.setAttribute("autoplay","autoplay"),e.stream.local&&(t.video.volume=0),t.elementID!==undefined?(document.getElementById(t.elementID).appendChild(t.div),t.container=document.getElementById(t.elementID)):(document.body.appendChild(t.div),t.container=document.body),t.parentNode=t.div.parentNode,t.div.appendChild(t.loader),t.div.appendChild(t.video),t.containerWidth=0,t.containerHeight=0,t.resizer=new L.ResizeSensor(t.container,t.resize),t.resize(),t.bar=new Erizo.Bar({elementID:"player_"+t.id,id:t.id,stream:e.stream,media:t.video,options:e.options}),t.div.onmouseover=n,t.div.onmouseout=r,t.video.src=t.stream_url,t};var Erizo=Erizo||{};Erizo.AudioPlayer=function(e){var t=Erizo.View({}),n,r;t.id=e.id,t.stream=e.stream.stream,t.elementID=e.elementID,L.Logger.debug("Creating URL from stream "+t.stream);var i=window.URL||webkitURL;return t.stream_url=i.createObjectURL(t.stream),t.audio=document.createElement("audio"),t.audio.setAttribute("id","stream"+t.id),t.audio.setAttribute("style","width: 100%; height: 100%; position: absolute"),t.audio.setAttribute("autoplay","autoplay"),e.stream.local&&(t.audio.volume=0),e.stream.local&&(t.audio.volume=0),t.elementID!==undefined?(t.destroy=function(){t.audio.pause(),t.parentNode.removeChild(t.div)},n=function(e){t.bar.display()},r=function(e){t.bar.hide()},t.div=document.createElement("div"),t.div.setAttribute("id","player_"+t.id),t.div.setAttribute("style","width: 100%; height: 100%; position: relative; overflow: hidden;"),document.getElementById(t.elementID).appendChild(t.div),t.container=document.getElementById(t.elementID),t.parentNode=t.div.parentNode,t.div.appendChild(t.audio),t.bar=new Erizo.Bar({elementID:"player_"+t.id,id:t.id,stream:e.stream,media:t.audio,options:e.options}),t.div.onmouseover=n,t.div.onmouseout=r):(t.destroy=function(){t.audio.pause(),t.parentNode.removeChild(t.audio)},document.body.appendChild(t.audio),t.parentNode=document.body),t.audio.src=t.stream_url,t};var Erizo=Erizo||{};Erizo.Bar=function(e){var t=Erizo.View({}),n,r;return t.elementID=e.elementID,t.id=e.id,t.div=document.createElement("div"),t.div.setAttribute("id","bar_"+t.id),t.bar=document.createElement("div"),t.bar.setAttribute("style","width: 100%; height: 15%; max-height: 30px; position: absolute; bottom: 0; right: 0; background-color: rgba(255,255,255,0.62)"),t.bar.setAttribute("id","subbar_"+t.id),t.link=document.createElement("a"),t.link.setAttribute("href","http://www.lynckia.com/"),t.link.setAttribute("target","_blank"),t.logo=document.createElement("img"),t.logo.setAttribute("style","width: 100%; height: 100%; max-width: 30px; position: absolute; top: 0; left: 2px;"),t.logo.setAttribute("alt","Lynckia"),t.logo.setAttribute("src",t.url+"/assets/star.svg"),r=function(e){e!=="block"?e="none":clearTimeout(n),t.div.setAttribute("style","width: 100%; height: 100%; position: relative; bottom: 0; right: 0; display:"+e)},t.display=function(){r("block")},t.hide=function(){n=setTimeout(r,1e3)},document.getElementById(t.elementID).appendChild(t.div),t.div.appendChild(t.bar),t.bar.appendChild(t.link),t.link.appendChild(t.logo),!e.stream.screen&&(e.options===undefined||e.options.speaker===undefined||e.options.speaker===!0)&&(t.speaker=new Erizo.Speaker({elementID:"subbar_"+t.id,id:t.id,stream:e.stream,media:e.media})),t.display(),t.hide(),t};var Erizo=Erizo||{};Erizo.Speaker=function(e){var t=Erizo.View({}),n,r,i,s=50;return t.elementID=e.elementID,t.media=e.media,t.id=e.id,t.stream=e.stream,t.div=document.createElement("div"),t.div.setAttribute("style","width: 40%; height: 100%; max-width: 32px; position: absolute; right: 0;z-index:0;"),t.icon=document.createElement("img"),t.icon.setAttribute("id","volume_"+t.id),t.icon.setAttribute("src",t.url+"/assets/sound48.png"),t.icon.setAttribute("style","width: 80%; height: 100%; position: absolute;"),t.div.appendChild(t.icon),t.stream.local?(r=function(){t.media.muted=!0,t.icon.setAttribute("src",t.url+"/assets/mute48.png"),t.stream.stream.getAudioTracks()[0].enabled=!1},i=function(){t.media.muted=!1,t.icon.setAttribute("src",t.url+"/assets/sound48.png"),t.stream.stream.getAudioTracks()[0].enabled=!0},t.icon.onclick=function(e){t.media.muted?i():r()}):(t.picker=document.createElement("input"),t.picker.setAttribute("id","picker_"+t.id),t.picker.type="range",t.picker.min=0,t.picker.max=100,t.picker.step=10,t.picker.value=s,t.picker.setAttribute("orient","vertical"),t.div.appendChild(t.picker),t.media.volume=t.picker.value/100,t.media.muted=!1,t.picker.oninput=function(e){t.picker.value>0?(t.media.muted=!1,t.icon.setAttribute("src",t.url+"/assets/sound48.png")):(t.media.muted=!0,t.icon.setAttribute("src",t.url+"/assets/mute48.png")),t.media.volume=t.picker.value/100},n=function(e){t.picker.setAttribute("style","background: transparent; width: 32px; height: 100px; position: absolute; bottom: 90%; z-index: 1;"+t.div.offsetHeight+"px; right: 0px; -webkit-appearance: slider-vertical; display: "+e)},r=function(){t.icon.setAttribute("src",t.url+"/assets/mute48.png"),s=t.picker.value,t.picker.value=0,t.media.volume=0,t.media.muted=!0},i=function(){t.icon.setAttribute("src",t.url+"/assets/sound48.png"),t.picker.value=s,t.media.volume=t.picker.value/100,t.media.muted=!1},t.icon.onclick=function(e){t.media.muted?i():r()},t.div.onmouseover=function(e){n("block")},t.div.onmouseout=function(e){n("none")},n("none")),document.getElementById(t.elementID).appendChild(t.div),t};